{"version":3,"sources":["editors/panels.js"],"names":["define","$","store","jsbin","Panel","panels","stringAsPanelsToOpen","query","validPanels","split","reduce","toopen","key","indexOf","push","getVisible","this","named","visible","panel","save","embed","state","left","width","window","i","length","$el","css","parseFloat","name","sessionStorage","setItem","JSON","stringify","restore","location","search","substring","hash","parse","getItem","hasContent","editors","javascript","getCode","html","init","panelURLValue","openWithSameDimensions","$window","focused","history","replaceState","pathname","origin","getURL","qs","obj","regexp","len","kstr","vstr","k","v","x","replace","idx","substr","decodeURIComponent","e","hasOwnProperty","isArray","getQuery","Object","keys","js","live","undefined","mobile","settings","saveOnExit","editor","setCode","show","todo","deferredInsert","event","data","code","parts","panelId","ready","splice","$document","unbind","bind","distribute","$body","addClass","savecontent","getHighlightLines","lines","highlightLines","string","toUpperCase","join","focus","removeClass","filter","id","alt","map","p","updateQuery","throttle","owner","ajax","url","withRevision","type","success","userResizeable","hasClass","height","innerW","innerH","outerHeight","right","top","nestedPanels","bottom","splitter","trigger","find","each","setTimeout","hide","hideAll","fromShow","prototype","panelInit","label","getValue","blank","forEach","line","trim","setCursor","ch","indentLine","renderLivePreview","console","upgradeConsolePanel","render","showAlerts","allEditors","fn","editorsReady","setInterval","resizeTimer","match","RegExp","altLibraries","altRun","on","clearInterval","resize","clearTimeout","codepan"],"mappings":"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","file":"../../editors/panels.js","sourcesContent":["define([\r\n  \"skylark-jquery\",\r\n   \"skylark-jsbin-base/storage\",\r\n  \"../jsbin\",\r\n   \"./panel\"\r\n],function ($,store,jsbin,Panel) {\r\n  var panels = {};\r\n\r\n  panels.getVisible = function () {\r\n    var panels = this.named,  // this.panels => this.named\r\n        visible = [];\r\n    for (var panel in panels) {\r\n      if (panels[panel].visible) visible.push(panels[panel]);\r\n    }\r\n    return visible;\r\n  };\r\n\r\n  panels.save = function () {\r\n    // don't save panel state if we're in embed mode\r\n    if (jsbin.embed) {\r\n      return;\r\n    }\r\n\r\n    var visible = this.getVisible(),\r\n        state = {},\r\n        panel,\r\n        left = '',\r\n        width = $(window).width();\r\n\r\n    for (var i = 0; i < visible.length; i++) {\r\n      panel = visible[i];\r\n      left = panel.$el.css('left');\r\n      if (left.indexOf('%') === -1) {\r\n        // convert the pixel to relative - this is because jQuery pulls\r\n        // % for Webkit based, but px for Firefox & Opera. Cover our bases\r\n        left = (parseFloat(left)  / width * 100) + '%';\r\n      }\r\n      state[panel.name] = left;\r\n    }\r\n\r\n    store.sessionStorage.setItem('jsbin.panels', JSON.stringify(state));\r\n  };\r\n\r\n  function getQuery(qs) {\r\n    /*globals $*/\r\n    var sep = '&';\r\n    var eq = '=';\r\n    var obj = {};\r\n\r\n    var regexp = /\\+/g;\r\n    qs = qs.split(sep);\r\n\r\n    var maxKeys = 1000;\r\n\r\n    var len = qs.length;\r\n    // maxKeys <= 0 means that we should not limit keys count\r\n    if (maxKeys > 0 && len > maxKeys) {\r\n      len = maxKeys;\r\n    }\r\n\r\n    for (var i = 0; i < len; ++i) {\r\n      var x = qs[i].replace(regexp, '%20'),\r\n          idx = x.indexOf(eq),\r\n          kstr, vstr, k, v;\r\n\r\n      if (idx >= 0) {\r\n        kstr = x.substr(0, idx);\r\n        vstr = x.substr(idx + 1);\r\n      } else {\r\n        kstr = x;\r\n        vstr = '';\r\n      }\r\n\r\n      try {\r\n        k = decodeURIComponent(kstr);\r\n        v = decodeURIComponent(vstr);\r\n      } catch (e) {\r\n        k = kstr;\r\n        v = vstr;\r\n      }\r\n\r\n      if (!(window.hasOwnProperty ? window.hasOwnProperty(obj, k) : obj.hasOwnProperty(k))) {\r\n        obj[k] = v;\r\n      } else if ($.isArray(obj[k])) {\r\n        obj[k].push(v);\r\n      } else {\r\n        obj[k] = [obj[k], v];\r\n      }\r\n    }\r\n\r\n    return obj;\r\n  }\r\n\r\n  function stringAsPanelsToOpen(query) {\r\n    var validPanels = ['live', 'javascript', 'html', 'css', 'console'];\r\n\r\n    return query.split(',').reduce(function (toopen, key) {\r\n      if (key === 'js') {\r\n        key = 'javascript';\r\n      }\r\n\r\n      if (key === 'output') {\r\n        key = 'live';\r\n      }\r\n\r\n      if (validPanels.indexOf(key) !== -1) {\r\n        toopen.push(key);\r\n      }\r\n\r\n      return toopen;\r\n    }, []);\r\n  }\r\n\r\n  panels.restore = function () {\r\n    'use strict';\r\n    /*globals jsbin, editors, $window, $document*/\r\n    // if there are panel names on the hash (v2 of jsbin) or in the query (v3)\r\n    // then restore those specific panels and evenly distribute them.\r\n    var open = [],\r\n        defaultPanels = ['html', 'live'], // sigh, live == output :(\r\n        location = window.location,\r\n        search = location.search.substring(1),\r\n        hash = location.hash.substring(1),\r\n        toopen = [],\r\n        state = jsbin.embed ? null : JSON.parse(store.sessionStorage.getItem('jsbin.panels') || 'null'),\r\n        hasContent = { javascript: editors.javascript.getCode().length,\r\n          css: editors.css.getCode().length,\r\n          html: editors.html.getCode().length\r\n        },\r\n        name = '',\r\n        i = 0,\r\n        panel = null,\r\n        init = [],\r\n        panelURLValue = '',\r\n        openWithSameDimensions = false,\r\n        width = $window.width(),\r\n        deferredCodeInsert = '',\r\n        focused = !!store.sessionStorage.getItem('panel'),\r\n        validPanels = 'live javascript html css console'.split(' '),\r\n        cachedHash = '';\r\n\r\n    if (history.replaceState && (location.pathname.indexOf('/edit') !== -1) || ((location.origin + location.pathname) === jsbin.getURL() + '/')) {\r\n      // history.replaceState(null, '', jsbin.getURL() + (jsbin.getURL() === jsbin.root ? '' : '/edit') + (hash ? '#' + hash : ''));\r\n    }\r\n\r\n    if (search || hash) {\r\n      var query = (search || hash);\r\n\r\n      // assume the query is: html=xyz\r\n      if (query.indexOf('&') !== -1) {\r\n        query = getQuery(search || hash);\r\n        toopen = Object.keys(query).reduce(function (toopen, key) {\r\n          if (key.indexOf(',') !== -1 && query[key] === '') {\r\n            toopen = stringAsPanelsToOpen(key);\r\n            return toopen;\r\n          }\r\n\r\n          if (key === 'js') {\r\n            query.javascript = query.js;\r\n            key = 'javascript';\r\n          }\r\n\r\n          if (key === 'output') {\r\n            query.live = query.live;\r\n            key = 'live';\r\n          }\r\n\r\n          if (query[key] === undefined) {\r\n            query[key] = '';\r\n          }\r\n\r\n          if (validPanels.indexOf(key) !== -1) {\r\n            toopen.push(key + '=' + query[key]);\r\n          }\r\n\r\n          return toopen;\r\n        }, []);\r\n      } else {\r\n        toopen = stringAsPanelsToOpen(query);\r\n      }\r\n    }\r\n\r\n    if (toopen.length === 0) {\r\n      if (state !== null) {\r\n        toopen = Object.keys(state);\r\n      }\r\n      else {\r\n        // load from personal settings\r\n        toopen = jsbin.mobile ? [jsbin.settings.panels[0]] : jsbin.settings.panels;\r\n      }\r\n    }\r\n\r\n    if (toopen.length === 0) {\r\n      if (hasContent.javascript) {toopen.push('javascript');}\r\n      if (hasContent.html) {toopen.push('html');}\r\n      if (hasContent.css) {toopen.push('css');}\r\n      toopen.push('live');\r\n    }\r\n\r\n    panels.saveOnExit = true;\r\n\r\n    /* Boot code */\r\n    // then allow them to view specific panels based on comma separated hash fragment/query\r\n    i = 0;\r\n\r\n    if (toopen.length === 0) {\r\n      toopen = defaultPanels;\r\n    }\r\n\r\n    if (toopen.length) {\r\n      for (name in state) {\r\n        if (toopen.indexOf(name) !== -1) {\r\n          i++;\r\n        }\r\n      }\r\n\r\n      if (i === toopen.length) {\r\n        openWithSameDimensions = true;\r\n      }\r\n\r\n      for (i = 0; i < toopen.length; i++) {\r\n        panelURLValue = null;\r\n        name = toopen[i];\r\n\r\n        // if name contains an `=` it means we also need to set that particular panel to that code\r\n        if (name.indexOf('=') !== -1) {\r\n          panelURLValue = name.substring(name.indexOf('=') + 1);\r\n          name = name.substring(0, name.indexOf('='));\r\n        }\r\n\r\n        if (panels.named[name]) { // panels.panels => panels.named\r\n          panel = panels.named[name]; // panels.panels => panels.named\r\n          // console.log(name, 'width', state[name], width * parseFloat(state[name]) / 100);\r\n          if (panel.editor && panelURLValue !== null) {\r\n            panel.setCode(decodeURIComponent(panelURLValue));\r\n          }\r\n\r\n          if (openWithSameDimensions && toopen.length > 1) {\r\n            panel.show(width * parseFloat(state[name]) / 100);\r\n          } else {\r\n            panel.show();\r\n          }\r\n          init.push(panel);\r\n        } else if (name && panelURLValue !== null) { // TODO support any varible insertion\r\n          (function (name, panelURLValue) {\r\n            var todo = ['html', 'javascript', 'css'];\r\n\r\n            var deferredInsert = function (event, data) {\r\n              var code, parts, panel = panels.named[data.panelId] || {}; // panels.panels => panels.named\r\n\r\n              if (data.panelId && panel.editor && panel.ready === true) {\r\n                todo.splice(todo.indexOf(data.panelId), 1);\r\n                try {\r\n                  code = panel.getCode();\r\n                } catch (e) {\r\n                  // this really shouldn't happen\r\n                  // console.error(e);\r\n                }\r\n                if (code.indexOf('%' + name + '%') !== -1) {\r\n                  parts = code.split('%' + name + '%');\r\n                  code = parts[0] + decodeURIComponent(panelURLValue) + parts[1];\r\n                  panel.setCode(code);\r\n                  $document.unbind('codeChange', deferredInsert);\r\n                }\r\n              }\r\n\r\n              if (todo.length === 0) {\r\n                $document.unbind('codeChange', deferredInsert);\r\n              }\r\n            };\r\n\r\n            $document.bind('codeChange', deferredInsert);\r\n          }(name, panelURLValue));\r\n        }\r\n      }\r\n\r\n      // support the old jsbin v1 links directly to the preview\r\n      if (toopen.length === 1 && toopen[0] === 'preview') {\r\n        panels.named.live.show(); // panels.panels => panels.named\r\n      }\r\n\r\n      if (!openWithSameDimensions) {this.distribute();}\r\n    }\r\n\r\n    // now restore any data from sessionStorage\r\n    // TODO add default templates somewhere\r\n    // var template = {};\r\n    // for (name in this.panels) {\r\n    //   panel = this.panels[name];\r\n    //   if (panel.editor) {\r\n    //     // panel.setCode(store.sessionStorage.getItem('jsbin.content.' + name) || template[name]);\r\n    //   }\r\n    // }\r\n\r\n    for (i = 0; i < init.length; i++) {\r\n      init[i].init();\r\n    }\r\n\r\n    var visible = panels.getVisible();\r\n    if (visible.length) {\r\n      $body.addClass('panelsVisible');\r\n      if (!focused) {\r\n        visible[0].show();\r\n      }\r\n    }\r\n\r\n  };\r\n\r\n  panels.savecontent = function () {\r\n    // loop through each panel saving it's content to sessionStorage\r\n    var name, panel;\r\n    for (name in this.named) {  // this.panels => this.named\r\n      panel = this.named[name]; // this.panels => this.named\r\n      if (panel.editor) store.sessionStorage.setItem('jsbin.content.' + name, panel.getCode());\r\n    }\r\n  };\r\n\r\n  panels.getHighlightLines = function () {\r\n    'use strict';\r\n    var hash = [];\r\n    var lines = '';\r\n    var panel;\r\n    for (name in panels.named) { // panels.panels => panels.named\r\n      panel = panels.named[name]; // panels.panels => panels.named\r\n      if (panel.editor) {\r\n        lines = panel.editor.highlightLines().string;\r\n        if (lines) {\r\n          hash.push(name.substr(0, 1).toUpperCase() + ':L' + lines);\r\n        }\r\n      }\r\n    }\r\n    return hash.join(',');\r\n  };\r\n\r\n  panels.focus = function (panel) {\r\n    this.focused = panel;\r\n    if (panel) {\r\n      $('.panel').removeClass('focus').filter('.' + panel.id).addClass('focus');\r\n    }\r\n  }\r\n\r\n  panels.getQuery = function () {\r\n    var alt = {\r\n      javascript: 'js',\r\n      live: 'output'\r\n    };\r\n\r\n    var visible = panels.getVisible();\r\n\r\n    return visible.map(function (p) {\r\n      return alt[p.id] || p.id;\r\n    }).join(',');\r\n  }\r\n\r\n  panels.updateQuery = throttle(function updateQuery() {\r\n    var query = panels.getQuery();\r\n\r\n    if (jsbin.state.code && jsbin.state.owner) {\r\n      $.ajax({\r\n        url: jsbin.getURL({ withRevision: true }) + '/settings',\r\n        type: 'PUT',\r\n        data: { panels: visible.map(function (p) { return p.id; }) },\r\n        success: function () {}\r\n      });\r\n    }\r\n\r\n    if (history.replaceState) {\r\n      history.replaceState(null, null, '?' + query);\r\n    }\r\n  }, 100);\r\n\r\n  var userResizeable = !$('html').hasClass('layout');\r\n\r\n  if (!userResizeable) {\r\n    $('#source').removeClass('stretch');\r\n  }\r\n\r\n  // evenly distribute the width of all the visible panels\r\n  panels.distribute = function () {\r\n    if (!userResizeable) {\r\n      return;\r\n    }\r\n\r\n    var visible = $('#source .panelwrapper:visible'),\r\n        width = 100,\r\n        height = 0,\r\n        innerW = $window.width() - (visible.length - 1), // to compensate for border-left\r\n        innerH = $('#source').outerHeight(),\r\n        left = 0,\r\n        right = 0,\r\n        top = 0,\r\n        panel,\r\n        nestedPanels = [];\r\n\r\n    if (visible.length) {\r\n      $body.addClass('panelsVisible');\r\n\r\n      // visible = visible.sort(function (a, b) {\r\n      //   return a.order < b.order ? -1 : 1;\r\n      // });\r\n\r\n      width = 100 / visible.length;\r\n      for (var i = 0; i < visible.length; i++) {\r\n        panel = $.data(visible[i], 'panel');\r\n        right = 100 - (width * (i+1));\r\n        panel.$el.css({ top: 0, bottom: 0, left: left + '%', right: right + '%' });\r\n        panel.splitter.trigger('init', innerW * left/100);\r\n        panel.splitter[i == 0 ? 'hide' : 'show']();\r\n        left += width;\r\n\r\n        nestedPanels = $(visible[i]).find('.panel');\r\n        if (nestedPanels.length > 1) {\r\n          top = 0;\r\n          nestedPanels = nestedPanels.filter(':visible');\r\n          height = 100 / nestedPanels.length;\r\n          nestedPanels.each(function (i) {\r\n            bottom = 100 - (height * (i+1));\r\n            var panel = panels.named[$.data(this, 'name')];  // jsbin.panels.panels => panels.named\r\n            // $(this).css({ top: top + '%', bottom: bottom + '%' });\r\n            $(this).css('top', top + '%');\r\n            $(this).css('bottom', bottom + '%' );\r\n            if (panel.splitter.hasClass('vertical')) {\r\n              panel.splitter.trigger('init', innerH * top/100);\r\n              panel.splitter[i == 0 ? 'hide' : 'show']();\r\n            }\r\n            top += height;\r\n          });\r\n        }\r\n      }\r\n    } else if (!jsbin.embed) {\r\n      $('#history').show();\r\n      setTimeout(function () {\r\n        $body.removeClass('panelsVisible');\r\n      }, 100); // 100 is on purpose to add to the effect of the reveal\r\n    }\r\n  };\r\n\r\n  panels.show = function (panelId) {\r\n    this.named[panelId].show();  // this.panels => this.named\r\n    if (this.named[panelId].editor) { // this.panels => this.named\r\n      this.named[panelId].editor.focus(); // this.panels => this.named\r\n    }\r\n    this.named[panelId].focus(); // this.panels => this.named\r\n  };\r\n\r\n  panels.hide = function (panelId) {\r\n    var $history = $('#history'); // TODO shouldn't have to keep hitting this\r\n    var panels = this.named; // this.panels => this.named\r\n    if (panels[panelId].visible) {\r\n      panels[panelId].hide();\r\n    }\r\n\r\n    var visible = panels.getVisible();\r\n    if (visible.length) {\r\n      panels.focused = visible[0];\r\n      if (panels.focused.editor) {\r\n        panels.focused.editor.focus();\r\n      } else {\r\n        panels.focused.$el.focus();\r\n      }\r\n      panels.focused.focus();\r\n    }\r\n\r\n    /*\r\n    } else if ($history.length && !$body.hasClass('panelsVisible')) {\r\n      $body.toggleClass('dave', $history.is(':visible'));\r\n      $history.toggle(100);\r\n    } else if ($history.length === 0) {\r\n      // TODO load up the history\r\n    }\r\n    */\r\n  };\r\n\r\n  panels.hideAll = function (fromShow) {\r\n    var visible = panels.getVisible(),\r\n        i = visible.length;\r\n    while (i--) {\r\n      visible[i].hide(fromShow);\r\n    }\r\n  };\r\n\r\n  // dirty, but simple\r\n  Panel.prototype.distribute = function () {\r\n    panels.distribute();\r\n  };\r\n\r\n  var ignoreDuringLive = /^\\s*(while|do|for)[\\s*|$]/;\r\n\r\n\r\n  var panelInit = {\r\n    html: function () {\r\n      var init = function () {\r\n        // set cursor position on first blank line\r\n        // 1. read all the inital lines\r\n        var lines = this.editor.getValue().split('\\n'),\r\n            blank = -1;\r\n        lines.forEach(function (line, i) {\r\n          if (blank === -1 && line.trim().length === 0) {\r\n            blank = i;\r\n            //exit\r\n          }\r\n        });\r\n\r\n        if (blank !== -1) {\r\n          this.editor.setCursor({ line: blank, ch: 2 });\r\n          if (lines[blank].length === 0) {\r\n            this.editor.indentLine(blank, 'add');\r\n          }\r\n        }\r\n      };\r\n\r\n      return new Panel('html', { editor: true, label: 'HTML', init: init });\r\n    },\r\n    css: function () {\r\n      return new Panel('css', { editor: true, label: 'CSS' });\r\n    },\r\n    javascript: function () {\r\n      return new Panel('javascript', { editor: true, label: 'JavaScript' });\r\n    },\r\n    console: function () {\r\n      // hide and show callbacks registered in console.js\r\n      return new Panel('console', { label: 'Console' });\r\n    },\r\n    live: function () {\r\n      function show() {\r\n        // var panel = this;\r\n        if (panels.ready) {\r\n          renderLivePreview();\r\n        }\r\n      }\r\n\r\n      function hide() {\r\n        // detroy the iframe if we hide the panel\r\n        // note: $live is defined in live.js\r\n        // Commented out so that the live iframe is never destroyed\r\n        if (panels.named.console.visible === false) { // panels.panels => panels.named\r\n          // $live.find('iframe').remove();\r\n        }\r\n      }\r\n\r\n      return new Panel('live', { label: 'Output', show: show, hide: hide });\r\n    }\r\n  };\r\n\r\n  var editors = panels.named = {};  // panels.panels => panels.named\r\n\r\n  // show all panels (change the order to control the panel order)\r\n  editors.html = panelInit.html();\r\n  editors.css = panelInit.css();\r\n  editors.javascript = panelInit.javascript();\r\n  editors.console = panelInit.console();\r\n  upgradeConsolePanel(editors.console);\r\n  editors.live = panelInit.live();\r\n\r\n  editors.live.settings.render = function (showAlerts) {\r\n    if (panels.ready) {\r\n      renderLivePreview(showAlerts);\r\n    }\r\n  };\r\n\r\n  panels.allEditors = function (fn) {\r\n    var panelId, panel;\r\n    for (panelId in panels.named) {  // panels.panels => panels.named\r\n      panel = panels.named[panelId]; // panels.panels => panels.named\r\n      if (panel.editor) fn(panel);\r\n    }\r\n  };\r\n\r\n  setTimeout(function () {\r\n    panels.restore();\r\n  }, 10);\r\n  panels.focus(panels.getVisible()[0] || null);\r\n\r\n  var editorsReady = setInterval(function () {\r\n    var ready = true,\r\n        resizeTimer = null,\r\n        panel,\r\n        panelId,\r\n        hash = window.location.hash.substring(1);\r\n\r\n\r\n    for (panelId in panels.named) {  // panels.panels => panels.named\r\n      panel = panels.named[panelId]; // panels.panels => panels.named\r\n      if (panel.visible && !panel.ready) {\r\n        ready = false;\r\n        break;\r\n      }\r\n    }\r\n\r\n    panels.ready = ready;\r\n\r\n    if (ready) {\r\n      panels.allEditors(function (panel) {\r\n        var key = panel.id.substr(0, 1).toUpperCase() + ':L';\r\n        if (hash.indexOf(key) !== -1) {\r\n          var lines = hash.match(new RegExp(key + '(\\\\d+(?:-\\\\d+)?)'));\r\n          if (lines !== null) {\r\n            panel.editor.highlightLines(lines[1]);\r\n          }\r\n        }\r\n      });\r\n\r\n      var altLibraries = $('li.add-library');\r\n      var altRun = $('li.run-with-js');\r\n      editors.live.on('hide', function () {\r\n        altLibraries.show();\r\n        altRun.hide();\r\n      });\r\n\r\n      editors.live.on('show', function () {\r\n        altLibraries.hide();\r\n        altRun.show();\r\n      });\r\n\r\n      if (panels.named.live.visible) { // panels.panels => panels.named\r\n        editors.live.trigger('show');\r\n      } else {\r\n        editors.live.trigger('hide');\r\n      }\r\n\r\n      clearInterval(editorsReady);\r\n\r\n      // if the console is visible, it'll handle rendering of the output and console\r\n      if (panels.named.console.visible) { // panels.panels => panels.named\r\n        editors.console.render();\r\n      } else {\r\n        // otherwise, force a render\r\n        renderLivePreview();\r\n      }\r\n\r\n\r\n      if (!jsbin.mobile) {\r\n        $(window).resize(function () {\r\n          clearTimeout(resizeTimer);\r\n          resizeTimer = setTimeout(function () {\r\n            $document.trigger('sizeeditors');\r\n          }, 100);\r\n        });\r\n      }\r\n\r\n      $document.trigger('sizeeditors');\r\n      $document.trigger('jsbinReady');\r\n    }\r\n  }, 100);\r\n\r\n\r\n\r\n  setTimeout(function () {\r\n    panels.restore();\r\n  }, 10);\r\n  panels.focus(panels.getVisible()[0] || null);\r\n\r\n\r\n  return jsbin.codepan.panels = panels;\r\n});"]}