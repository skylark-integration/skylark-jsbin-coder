{"version":3,"sources":["editors/panels.js"],"names":["define","$","jsbin","Panel","panels","stringAsPanelsToOpen","query","validPanels","split","reduce","toopen","key","indexOf","push","getVisible","this","named","visible","panel","save","embed","state","left","width","window","i","length","$el","css","parseFloat","name","store","sessionStorage","setItem","JSON","stringify","restore","location","search","substring","hash","parse","getItem","hasContent","editors","javascript","getCode","html","init","panelURLValue","openWithSameDimensions","$window","focused","history","replaceState","pathname","origin","getURL","qs","obj","regexp","len","kstr","vstr","k","v","x","replace","idx","substr","decodeURIComponent","e","hasOwnProperty","isArray","getQuery","Object","keys","js","live","undefined","mobile","settings","saveOnExit","editor","setCode","show","todo","deferredInsert","event","data","code","parts","panelId","ready","splice","$document","unbind","bind","distribute","$body","addClass","savecontent","getHighlightLines","lines","highlightLines","string","toUpperCase","join","focus","removeClass","filter","id","alt","map","p","updateQuery","throttle","owner","ajax","url","withRevision","type","success","userResizeable","hasClass","height","innerW","innerH","outerHeight","right","top","nestedPanels","bottom","splitter","trigger","find","each","setTimeout","hide","hideAll","fromShow","prototype","panelInit","label","getValue","blank","forEach","line","trim","setCursor","ch","indentLine","renderLivePreview","console","upgradeConsolePanel","render","showAlerts","allEditors","fn","editorsReady","setInterval","resizeTimer","match","RegExp","altLibraries","altRun","on","clearInterval","resize","clearTimeout","codepan"],"mappings":"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","file":"../../editors/panels.js","sourcesContent":["define([\r\n  \"skylark-jquery\",\r\n   \"../jsbin\",\r\n   \"./panel\"\r\n],function ($,jsbin,Panel) {\r\n  var panels = {};\r\n\r\n  panels.getVisible = function () {\r\n    var panels = this.named,  // this.panels => this.named\r\n        visible = [];\r\n    for (var panel in panels) {\r\n      if (panels[panel].visible) visible.push(panels[panel]);\r\n    }\r\n    return visible;\r\n  };\r\n\r\n  panels.save = function () {\r\n    // don't save panel state if we're in embed mode\r\n    if (jsbin.embed) {\r\n      return;\r\n    }\r\n\r\n    var visible = this.getVisible(),\r\n        state = {},\r\n        panel,\r\n        left = '',\r\n        width = $(window).width();\r\n\r\n    for (var i = 0; i < visible.length; i++) {\r\n      panel = visible[i];\r\n      left = panel.$el.css('left');\r\n      if (left.indexOf('%') === -1) {\r\n        // convert the pixel to relative - this is because jQuery pulls\r\n        // % for Webkit based, but px for Firefox & Opera. Cover our bases\r\n        left = (parseFloat(left)  / width * 100) + '%';\r\n      }\r\n      state[panel.name] = left;\r\n    }\r\n\r\n    store.sessionStorage.setItem('jsbin.panels', JSON.stringify(state));\r\n  };\r\n\r\n  function getQuery(qs) {\r\n    /*globals $*/\r\n    var sep = '&';\r\n    var eq = '=';\r\n    var obj = {};\r\n\r\n    var regexp = /\\+/g;\r\n    qs = qs.split(sep);\r\n\r\n    var maxKeys = 1000;\r\n\r\n    var len = qs.length;\r\n    // maxKeys <= 0 means that we should not limit keys count\r\n    if (maxKeys > 0 && len > maxKeys) {\r\n      len = maxKeys;\r\n    }\r\n\r\n    for (var i = 0; i < len; ++i) {\r\n      var x = qs[i].replace(regexp, '%20'),\r\n          idx = x.indexOf(eq),\r\n          kstr, vstr, k, v;\r\n\r\n      if (idx >= 0) {\r\n        kstr = x.substr(0, idx);\r\n        vstr = x.substr(idx + 1);\r\n      } else {\r\n        kstr = x;\r\n        vstr = '';\r\n      }\r\n\r\n      try {\r\n        k = decodeURIComponent(kstr);\r\n        v = decodeURIComponent(vstr);\r\n      } catch (e) {\r\n        k = kstr;\r\n        v = vstr;\r\n      }\r\n\r\n      if (!(window.hasOwnProperty ? window.hasOwnProperty(obj, k) : obj.hasOwnProperty(k))) {\r\n        obj[k] = v;\r\n      } else if ($.isArray(obj[k])) {\r\n        obj[k].push(v);\r\n      } else {\r\n        obj[k] = [obj[k], v];\r\n      }\r\n    }\r\n\r\n    return obj;\r\n  }\r\n\r\n  function stringAsPanelsToOpen(query) {\r\n    var validPanels = ['live', 'javascript', 'html', 'css', 'console'];\r\n\r\n    return query.split(',').reduce(function (toopen, key) {\r\n      if (key === 'js') {\r\n        key = 'javascript';\r\n      }\r\n\r\n      if (key === 'output') {\r\n        key = 'live';\r\n      }\r\n\r\n      if (validPanels.indexOf(key) !== -1) {\r\n        toopen.push(key);\r\n      }\r\n\r\n      return toopen;\r\n    }, []);\r\n  }\r\n\r\n  panels.restore = function () {\r\n    'use strict';\r\n    /*globals jsbin, editors, $window, $document*/\r\n    // if there are panel names on the hash (v2 of jsbin) or in the query (v3)\r\n    // then restore those specific panels and evenly distribute them.\r\n    var open = [],\r\n        defaultPanels = ['html', 'live'], // sigh, live == output :(\r\n        location = window.location,\r\n        search = location.search.substring(1),\r\n        hash = location.hash.substring(1),\r\n        toopen = [],\r\n        state = jsbin.embed ? null : JSON.parse(store.sessionStorage.getItem('jsbin.panels') || 'null'),\r\n        hasContent = { javascript: editors.javascript.getCode().length,\r\n          css: editors.css.getCode().length,\r\n          html: editors.html.getCode().length\r\n        },\r\n        name = '',\r\n        i = 0,\r\n        panel = null,\r\n        init = [],\r\n        panelURLValue = '',\r\n        openWithSameDimensions = false,\r\n        width = $window.width(),\r\n        deferredCodeInsert = '',\r\n        focused = !!store.sessionStorage.getItem('panel'),\r\n        validPanels = 'live javascript html css console'.split(' '),\r\n        cachedHash = '';\r\n\r\n    if (history.replaceState && (location.pathname.indexOf('/edit') !== -1) || ((location.origin + location.pathname) === jsbin.getURL() + '/')) {\r\n      // history.replaceState(null, '', jsbin.getURL() + (jsbin.getURL() === jsbin.root ? '' : '/edit') + (hash ? '#' + hash : ''));\r\n    }\r\n\r\n    if (search || hash) {\r\n      var query = (search || hash);\r\n\r\n      // assume the query is: html=xyz\r\n      if (query.indexOf('&') !== -1) {\r\n        query = getQuery(search || hash);\r\n        toopen = Object.keys(query).reduce(function (toopen, key) {\r\n          if (key.indexOf(',') !== -1 && query[key] === '') {\r\n            toopen = stringAsPanelsToOpen(key);\r\n            return toopen;\r\n          }\r\n\r\n          if (key === 'js') {\r\n            query.javascript = query.js;\r\n            key = 'javascript';\r\n          }\r\n\r\n          if (key === 'output') {\r\n            query.live = query.live;\r\n            key = 'live';\r\n          }\r\n\r\n          if (query[key] === undefined) {\r\n            query[key] = '';\r\n          }\r\n\r\n          if (validPanels.indexOf(key) !== -1) {\r\n            toopen.push(key + '=' + query[key]);\r\n          }\r\n\r\n          return toopen;\r\n        }, []);\r\n      } else {\r\n        toopen = stringAsPanelsToOpen(query);\r\n      }\r\n    }\r\n\r\n    if (toopen.length === 0) {\r\n      if (state !== null) {\r\n        toopen = Object.keys(state);\r\n      }\r\n      else {\r\n        // load from personal settings\r\n        toopen = jsbin.mobile ? [jsbin.settings.panels[0]] : jsbin.settings.panels;\r\n      }\r\n    }\r\n\r\n    if (toopen.length === 0) {\r\n      if (hasContent.javascript) {toopen.push('javascript');}\r\n      if (hasContent.html) {toopen.push('html');}\r\n      if (hasContent.css) {toopen.push('css');}\r\n      toopen.push('live');\r\n    }\r\n\r\n    panels.saveOnExit = true;\r\n\r\n    /* Boot code */\r\n    // then allow them to view specific panels based on comma separated hash fragment/query\r\n    i = 0;\r\n\r\n    if (toopen.length === 0) {\r\n      toopen = defaultPanels;\r\n    }\r\n\r\n    if (toopen.length) {\r\n      for (name in state) {\r\n        if (toopen.indexOf(name) !== -1) {\r\n          i++;\r\n        }\r\n      }\r\n\r\n      if (i === toopen.length) {\r\n        openWithSameDimensions = true;\r\n      }\r\n\r\n      for (i = 0; i < toopen.length; i++) {\r\n        panelURLValue = null;\r\n        name = toopen[i];\r\n\r\n        // if name contains an `=` it means we also need to set that particular panel to that code\r\n        if (name.indexOf('=') !== -1) {\r\n          panelURLValue = name.substring(name.indexOf('=') + 1);\r\n          name = name.substring(0, name.indexOf('='));\r\n        }\r\n\r\n        if (panels.named[name]) { // panels.panels => panels.named\r\n          panel = panels.named[name]; // panels.panels => panels.named\r\n          // console.log(name, 'width', state[name], width * parseFloat(state[name]) / 100);\r\n          if (panel.editor && panelURLValue !== null) {\r\n            panel.setCode(decodeURIComponent(panelURLValue));\r\n          }\r\n\r\n          if (openWithSameDimensions && toopen.length > 1) {\r\n            panel.show(width * parseFloat(state[name]) / 100);\r\n          } else {\r\n            panel.show();\r\n          }\r\n          init.push(panel);\r\n        } else if (name && panelURLValue !== null) { // TODO support any varible insertion\r\n          (function (name, panelURLValue) {\r\n            var todo = ['html', 'javascript', 'css'];\r\n\r\n            var deferredInsert = function (event, data) {\r\n              var code, parts, panel = panels.named[data.panelId] || {}; // panels.panels => panels.named\r\n\r\n              if (data.panelId && panel.editor && panel.ready === true) {\r\n                todo.splice(todo.indexOf(data.panelId), 1);\r\n                try {\r\n                  code = panel.getCode();\r\n                } catch (e) {\r\n                  // this really shouldn't happen\r\n                  // console.error(e);\r\n                }\r\n                if (code.indexOf('%' + name + '%') !== -1) {\r\n                  parts = code.split('%' + name + '%');\r\n                  code = parts[0] + decodeURIComponent(panelURLValue) + parts[1];\r\n                  panel.setCode(code);\r\n                  $document.unbind('codeChange', deferredInsert);\r\n                }\r\n              }\r\n\r\n              if (todo.length === 0) {\r\n                $document.unbind('codeChange', deferredInsert);\r\n              }\r\n            };\r\n\r\n            $document.bind('codeChange', deferredInsert);\r\n          }(name, panelURLValue));\r\n        }\r\n      }\r\n\r\n      // support the old jsbin v1 links directly to the preview\r\n      if (toopen.length === 1 && toopen[0] === 'preview') {\r\n        panels.named.live.show(); // panels.panels => panels.named\r\n      }\r\n\r\n      if (!openWithSameDimensions) {this.distribute();}\r\n    }\r\n\r\n    // now restore any data from sessionStorage\r\n    // TODO add default templates somewhere\r\n    // var template = {};\r\n    // for (name in this.panels) {\r\n    //   panel = this.panels[name];\r\n    //   if (panel.editor) {\r\n    //     // panel.setCode(store.sessionStorage.getItem('jsbin.content.' + name) || template[name]);\r\n    //   }\r\n    // }\r\n\r\n    for (i = 0; i < init.length; i++) {\r\n      init[i].init();\r\n    }\r\n\r\n    var visible = panels.getVisible();\r\n    if (visible.length) {\r\n      $body.addClass('panelsVisible');\r\n      if (!focused) {\r\n        visible[0].show();\r\n      }\r\n    }\r\n\r\n  };\r\n\r\n  panels.savecontent = function () {\r\n    // loop through each panel saving it's content to sessionStorage\r\n    var name, panel;\r\n    for (name in this.named) {  // this.panels => this.named\r\n      panel = this.named[name]; // this.panels => this.named\r\n      if (panel.editor) store.sessionStorage.setItem('jsbin.content.' + name, panel.getCode());\r\n    }\r\n  };\r\n\r\n  panels.getHighlightLines = function () {\r\n    'use strict';\r\n    var hash = [];\r\n    var lines = '';\r\n    var panel;\r\n    for (name in panels.named) { // panels.panels => panels.named\r\n      panel = panels.named[name]; // panels.panels => panels.named\r\n      if (panel.editor) {\r\n        lines = panel.editor.highlightLines().string;\r\n        if (lines) {\r\n          hash.push(name.substr(0, 1).toUpperCase() + ':L' + lines);\r\n        }\r\n      }\r\n    }\r\n    return hash.join(',');\r\n  };\r\n\r\n  panels.focus = function (panel) {\r\n    this.focused = panel;\r\n    if (panel) {\r\n      $('.panel').removeClass('focus').filter('.' + panel.id).addClass('focus');\r\n    }\r\n  }\r\n\r\n  panels.getQuery = function () {\r\n    var alt = {\r\n      javascript: 'js',\r\n      live: 'output'\r\n    };\r\n\r\n    var visible = panels.getVisible();\r\n\r\n    return visible.map(function (p) {\r\n      return alt[p.id] || p.id;\r\n    }).join(',');\r\n  }\r\n\r\n  panels.updateQuery = throttle(function updateQuery() {\r\n    var query = panels.getQuery();\r\n\r\n    if (jsbin.state.code && jsbin.state.owner) {\r\n      $.ajax({\r\n        url: jsbin.getURL({ withRevision: true }) + '/settings',\r\n        type: 'PUT',\r\n        data: { panels: visible.map(function (p) { return p.id; }) },\r\n        success: function () {}\r\n      });\r\n    }\r\n\r\n    if (history.replaceState) {\r\n      history.replaceState(null, null, '?' + query);\r\n    }\r\n  }, 100);\r\n\r\n  var userResizeable = !$('html').hasClass('layout');\r\n\r\n  if (!userResizeable) {\r\n    $('#source').removeClass('stretch');\r\n  }\r\n\r\n  // evenly distribute the width of all the visible panels\r\n  panels.distribute = function () {\r\n    if (!userResizeable) {\r\n      return;\r\n    }\r\n\r\n    var visible = $('#source .panelwrapper:visible'),\r\n        width = 100,\r\n        height = 0,\r\n        innerW = $window.width() - (visible.length - 1), // to compensate for border-left\r\n        innerH = $('#source').outerHeight(),\r\n        left = 0,\r\n        right = 0,\r\n        top = 0,\r\n        panel,\r\n        nestedPanels = [];\r\n\r\n    if (visible.length) {\r\n      $body.addClass('panelsVisible');\r\n\r\n      // visible = visible.sort(function (a, b) {\r\n      //   return a.order < b.order ? -1 : 1;\r\n      // });\r\n\r\n      width = 100 / visible.length;\r\n      for (var i = 0; i < visible.length; i++) {\r\n        panel = $.data(visible[i], 'panel');\r\n        right = 100 - (width * (i+1));\r\n        panel.$el.css({ top: 0, bottom: 0, left: left + '%', right: right + '%' });\r\n        panel.splitter.trigger('init', innerW * left/100);\r\n        panel.splitter[i == 0 ? 'hide' : 'show']();\r\n        left += width;\r\n\r\n        nestedPanels = $(visible[i]).find('.panel');\r\n        if (nestedPanels.length > 1) {\r\n          top = 0;\r\n          nestedPanels = nestedPanels.filter(':visible');\r\n          height = 100 / nestedPanels.length;\r\n          nestedPanels.each(function (i) {\r\n            bottom = 100 - (height * (i+1));\r\n            var panel = panels.named[$.data(this, 'name')];  // jsbin.panels.panels => panels.named\r\n            // $(this).css({ top: top + '%', bottom: bottom + '%' });\r\n            $(this).css('top', top + '%');\r\n            $(this).css('bottom', bottom + '%' );\r\n            if (panel.splitter.hasClass('vertical')) {\r\n              panel.splitter.trigger('init', innerH * top/100);\r\n              panel.splitter[i == 0 ? 'hide' : 'show']();\r\n            }\r\n            top += height;\r\n          });\r\n        }\r\n      }\r\n    } else if (!jsbin.embed) {\r\n      $('#history').show();\r\n      setTimeout(function () {\r\n        $body.removeClass('panelsVisible');\r\n      }, 100); // 100 is on purpose to add to the effect of the reveal\r\n    }\r\n  };\r\n\r\n  panels.show = function (panelId) {\r\n    this.named[panelId].show();  // this.panels => this.named\r\n    if (this.named[panelId].editor) { // this.panels => this.named\r\n      this.named[panelId].editor.focus(); // this.panels => this.named\r\n    }\r\n    this.named[panelId].focus(); // this.panels => this.named\r\n  };\r\n\r\n  panels.hide = function (panelId) {\r\n    var $history = $('#history'); // TODO shouldn't have to keep hitting this\r\n    var panels = this.named; // this.panels => this.named\r\n    if (panels[panelId].visible) {\r\n      panels[panelId].hide();\r\n    }\r\n\r\n    var visible = panels.getVisible();\r\n    if (visible.length) {\r\n      panels.focused = visible[0];\r\n      if (panels.focused.editor) {\r\n        panels.focused.editor.focus();\r\n      } else {\r\n        panels.focused.$el.focus();\r\n      }\r\n      panels.focused.focus();\r\n    }\r\n\r\n    /*\r\n    } else if ($history.length && !$body.hasClass('panelsVisible')) {\r\n      $body.toggleClass('dave', $history.is(':visible'));\r\n      $history.toggle(100);\r\n    } else if ($history.length === 0) {\r\n      // TODO load up the history\r\n    }\r\n    */\r\n  };\r\n\r\n  panels.hideAll = function (fromShow) {\r\n    var visible = panels.getVisible(),\r\n        i = visible.length;\r\n    while (i--) {\r\n      visible[i].hide(fromShow);\r\n    }\r\n  };\r\n\r\n  // dirty, but simple\r\n  Panel.prototype.distribute = function () {\r\n    panels.distribute();\r\n  };\r\n\r\n  var ignoreDuringLive = /^\\s*(while|do|for)[\\s*|$]/;\r\n\r\n\r\n  var panelInit = {\r\n    html: function () {\r\n      var init = function () {\r\n        // set cursor position on first blank line\r\n        // 1. read all the inital lines\r\n        var lines = this.editor.getValue().split('\\n'),\r\n            blank = -1;\r\n        lines.forEach(function (line, i) {\r\n          if (blank === -1 && line.trim().length === 0) {\r\n            blank = i;\r\n            //exit\r\n          }\r\n        });\r\n\r\n        if (blank !== -1) {\r\n          this.editor.setCursor({ line: blank, ch: 2 });\r\n          if (lines[blank].length === 0) {\r\n            this.editor.indentLine(blank, 'add');\r\n          }\r\n        }\r\n      };\r\n\r\n      return new Panel('html', { editor: true, label: 'HTML', init: init });\r\n    },\r\n    css: function () {\r\n      return new Panel('css', { editor: true, label: 'CSS' });\r\n    },\r\n    javascript: function () {\r\n      return new Panel('javascript', { editor: true, label: 'JavaScript' });\r\n    },\r\n    console: function () {\r\n      // hide and show callbacks registered in console.js\r\n      return new Panel('console', { label: 'Console' });\r\n    },\r\n    live: function () {\r\n      function show() {\r\n        // var panel = this;\r\n        if (panels.ready) {\r\n          renderLivePreview();\r\n        }\r\n      }\r\n\r\n      function hide() {\r\n        // detroy the iframe if we hide the panel\r\n        // note: $live is defined in live.js\r\n        // Commented out so that the live iframe is never destroyed\r\n        if (panels.named.console.visible === false) { // panels.panels => panels.named\r\n          // $live.find('iframe').remove();\r\n        }\r\n      }\r\n\r\n      return new Panel('live', { label: 'Output', show: show, hide: hide });\r\n    }\r\n  };\r\n\r\n  var editors = panels.named = {};  // panels.panels => panels.named\r\n\r\n  // show all panels (change the order to control the panel order)\r\n  editors.html = panelInit.html();\r\n  editors.css = panelInit.css();\r\n  editors.javascript = panelInit.javascript();\r\n  editors.console = panelInit.console();\r\n  upgradeConsolePanel(editors.console);\r\n  editors.live = panelInit.live();\r\n\r\n  editors.live.settings.render = function (showAlerts) {\r\n    if (panels.ready) {\r\n      renderLivePreview(showAlerts);\r\n    }\r\n  };\r\n\r\n  panels.allEditors = function (fn) {\r\n    var panelId, panel;\r\n    for (panelId in panels.named) {  // panels.panels => panels.named\r\n      panel = panels.named[panelId]; // panels.panels => panels.named\r\n      if (panel.editor) fn(panel);\r\n    }\r\n  };\r\n\r\n  setTimeout(function () {\r\n    panels.restore();\r\n  }, 10);\r\n  panels.focus(panels.getVisible()[0] || null);\r\n\r\n  var editorsReady = setInterval(function () {\r\n    var ready = true,\r\n        resizeTimer = null,\r\n        panel,\r\n        panelId,\r\n        hash = window.location.hash.substring(1);\r\n\r\n\r\n    for (panelId in panels.named) {  // panels.panels => panels.named\r\n      panel = panels.named[panelId]; // panels.panels => panels.named\r\n      if (panel.visible && !panel.ready) {\r\n        ready = false;\r\n        break;\r\n      }\r\n    }\r\n\r\n    panels.ready = ready;\r\n\r\n    if (ready) {\r\n      panels.allEditors(function (panel) {\r\n        var key = panel.id.substr(0, 1).toUpperCase() + ':L';\r\n        if (hash.indexOf(key) !== -1) {\r\n          var lines = hash.match(new RegExp(key + '(\\\\d+(?:-\\\\d+)?)'));\r\n          if (lines !== null) {\r\n            panel.editor.highlightLines(lines[1]);\r\n          }\r\n        }\r\n      });\r\n\r\n      var altLibraries = $('li.add-library');\r\n      var altRun = $('li.run-with-js');\r\n      editors.live.on('hide', function () {\r\n        altLibraries.show();\r\n        altRun.hide();\r\n      });\r\n\r\n      editors.live.on('show', function () {\r\n        altLibraries.hide();\r\n        altRun.show();\r\n      });\r\n\r\n      if (panels.named.live.visible) { // panels.panels => panels.named\r\n        editors.live.trigger('show');\r\n      } else {\r\n        editors.live.trigger('hide');\r\n      }\r\n\r\n      clearInterval(editorsReady);\r\n\r\n      // if the console is visible, it'll handle rendering of the output and console\r\n      if (panels.named.console.visible) { // panels.panels => panels.named\r\n        editors.console.render();\r\n      } else {\r\n        // otherwise, force a render\r\n        renderLivePreview();\r\n      }\r\n\r\n\r\n      if (!jsbin.mobile) {\r\n        $(window).resize(function () {\r\n          clearTimeout(resizeTimer);\r\n          resizeTimer = setTimeout(function () {\r\n            $document.trigger('sizeeditors');\r\n          }, 100);\r\n        });\r\n      }\r\n\r\n      $document.trigger('sizeeditors');\r\n      $document.trigger('jsbinReady');\r\n    }\r\n  }, 100);\r\n\r\n\r\n\r\n  setTimeout(function () {\r\n    panels.restore();\r\n  }, 10);\r\n  panels.focus(panels.getVisible()[0] || null);\r\n\r\n\r\n  return jsbin.codepan.panels = panels;\r\n});"]}