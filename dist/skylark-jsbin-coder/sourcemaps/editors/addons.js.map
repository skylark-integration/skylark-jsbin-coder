{"version":3,"sources":["editors/addons.js"],"names":["define","$","jsbin","coder","CodeMirror","panels","embed","mobile","processors","state","settings","addons","closebrackets","highlight","vim","emacs","trailingspace","fold","sublime","tern","activeline","matchbrackets","detailsSupport","document","createElement","settingsHints","settingsHintShow","forEach","val","h","d","undefined","extend","console","line","under","gutter","hintShow","tooltip","settingsAddons","url","test","defaultTest","done","cm","setOption","keyMap","matchtags","scanForClosingTag","optionHandlers","matchTags","bothTags","addKeyMap","Ctrl-J","helpers","foldGutter","gutters","$body","addClass","Ctrl-Q","foldCode","getCursor","copyGutters","getOption","slice","push","cmd","browser","platform","removeKeyMap","version","window","ternBasicDefs","showHint","TernServer","startTern","defaults","styleActiveLine","matchBrackets","csshint","hintingTest","CSSLint","css","hintingDone","jshint","msie","JSHINT","javascript","eqnull","htmlhint","HTMLHint","html","coffeescripthint","coffeelint","defhintOptions","mode","opt","consoleParent","getWrapperElement","parentNode","indexOf","ln","delay","options","consolelint","$document","trigger","head","on","this","nextAll","toggle","setTimeout","Object","keys","loadAddon","reloadAddons","arr","load","static","ajax","dataType","cache","Deferred","append","resolve","option","value","prop","lint","key","addon","when","call","map","timer","start","Date","getTime","last","setInterval","clearInterval","reject","ready","then","allEditors","panel","editor"],"mappings":"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","file":"../../editors/addons.js","sourcesContent":["define([\r\n  \"skylark-jquery\",\r\n   \"../jsbin\",\r\n   \"../coder\",\r\n   \"./codemirror\",\r\n   \"./panels\",\r\n   \"./tern\"\r\n],function ($,jsbin,coder,CodeMirror,panels) {\r\n  'use strict';\r\n  /*globals $, jsbin, CodeMirror*/\r\n\r\n  // ignore addons for embedded views\r\n  if (jsbin.embed || jsbin.mobile) {\r\n    return;\r\n  }\r\n\r\n  var processors = jsbin.state.processors;\r\n\r\n  var defaults = {\r\n    closebrackets: true,\r\n    highlight: false,\r\n    vim: false,\r\n    emacs: false,\r\n    trailingspace: false,\r\n    fold: false,\r\n    sublime: false,\r\n    tern: false,\r\n    activeline: true,\r\n    matchbrackets: false\r\n  };\r\n\r\n  if (!jsbin.settings.addons) {\r\n    jsbin.settings.addons = defaults;\r\n  }\r\n\r\n  var detailsSupport = 'open' in document.createElement('details');\r\n\r\n  var settingsHints = {};\r\n  var settingsHintShow = {};\r\n  var hintShow = {\r\n    console: true,\r\n    line: false,\r\n    under: false,\r\n    gutter: false\r\n  };\r\n  // css must go last for the moment due to CSSLint creating the\r\n  // global variable 'exports'\r\n  ['js', 'html', 'coffeescript', 'css'].forEach(function (val) {\r\n    var h = val + 'hint';\r\n    var d = false;\r\n    if (val === 'js') {\r\n      d = true;\r\n    }\r\n    settingsHints[h] = (jsbin.settings[h] !== undefined) ? jsbin.settings[h] : d;\r\n  });\r\n\r\n  settingsHintShow = $.extend({}, hintShow, jsbin.settings.hintShow);\r\n  settingsHintShow.tooltip = settingsHintShow.gutter;\r\n  var settingsAddons = $.extend({}, jsbin.settings.addons, settingsHints);\r\n\r\n  var addons = {\r\n    closebrackets: {\r\n      url: '/js/vendor/codemirror5/addon/edit/closebrackets.js',\r\n      test: defaultTest('autoCloseBrackets'),\r\n      done: function (cm) {\r\n        setOption(cm, 'autoCloseBrackets', true);\r\n      }\r\n    },\r\n    highlight: {\r\n      url: '/js/vendor/codemirror5/addon/search/match-highlighter.js',\r\n      test: defaultTest('highlightSelectionMatches'),\r\n      done: function (cm) {\r\n        setOption(cm, 'highlightSelectionMatches', true);\r\n      }\r\n    },\r\n    vim: {\r\n      url: [\r\n        '/js/vendor/codemirror5/keymap/vim.js'\r\n      ],\r\n      test: defaultTest('vimMode'),\r\n      done: function (cm) {\r\n        setOption(cm, 'vimMode', true);\r\n        setOption(cm, 'showCursorWhenSelecting', true);\r\n      }\r\n    },\r\n    emacs: {\r\n      url: [\r\n        '/js/vendor/codemirror5/keymap/emacs.js'\r\n      ],\r\n      test: function () {\r\n        return CodeMirror.keyMap.emacs;\r\n      },\r\n      done: function (cm) {\r\n        setOption(cm, 'keyMap', 'emacs');\r\n      }\r\n    },\r\n    matchtags: {\r\n      url: [\r\n        '/js/vendor/codemirror5/addon/fold/xml-fold.js',\r\n        '/js/vendor/codemirror5/addon/edit/matchtags.js'\r\n      ],\r\n      test: function () {\r\n        return CodeMirror.scanForClosingTag &&\r\n               CodeMirror.optionHandlers.matchTags;\r\n      },\r\n      done: function (cm) {\r\n        setOption(cm, 'matchTags', { bothTags: true });\r\n        cm.addKeyMap({'Ctrl-J': 'toMatchingTag' });\r\n      }\r\n    },\r\n    trailingspace: {\r\n      url: '/js/vendor/codemirror5/addon/edit/trailingspace.js',\r\n      test: defaultTest('showTrailingSpace'),\r\n      done: function (cm) {\r\n        setOption(cm, 'showTrailingSpace', true);\r\n      }\r\n    },\r\n    fold: {\r\n      url: [\r\n        '/js/vendor/codemirror5/addon/fold/foldgutter.css',\r\n        '/js/vendor/codemirror5/addon/fold/foldcode.js',\r\n        '/js/vendor/codemirror5/addon/fold/foldgutter.js',\r\n        '/js/vendor/codemirror5/addon/fold/brace-fold.js',\r\n        '/js/vendor/codemirror5/addon/fold/xml-fold.js',\r\n        '/js/vendor/codemirror5/addon/fold/comment-fold.js'\r\n      ],\r\n      test: function () {\r\n        return CodeMirror.helpers.fold &&\r\n               CodeMirror.optionHandlers.foldGutter &&\r\n               CodeMirror.optionHandlers.gutters;\r\n      },\r\n      done: function (cm) {\r\n        $body.addClass('code-fold');\r\n        cm.addKeyMap({'Ctrl-Q': function (cm) {\r\n          cm.foldCode(cm.getCursor());\r\n        }});\r\n        setOption(cm, 'foldGutter', true);\r\n        var gutters = cm.getOption('gutters');\r\n        var copyGutters = gutters.slice();\r\n        copyGutters.push('CodeMirror-foldgutter');\r\n        setOption(cm, 'gutters', copyGutters);\r\n      }\r\n    },\r\n    sublime: {\r\n      url: [\r\n        '/js/vendor/codemirror5/keymap/sublime.js'\r\n      ],\r\n      test: function () {\r\n        return CodeMirror.keyMap.sublime;\r\n      },\r\n      done: function (cm) {\r\n        setOption(cm, 'keyMap', 'sublime');\r\n        // Keys that CodeMirror should never take over\r\n        var cmd = $.browser.platform === 'mac' ? 'Cmd' : 'Ctrl';\r\n        delete CodeMirror.keyMap['sublime'][cmd + '-L'];\r\n        delete CodeMirror.keyMap['sublime'][cmd + '-T'];\r\n        delete CodeMirror.keyMap['sublime'][cmd + '-W'];\r\n        delete CodeMirror.keyMap['sublime'][cmd + '-J'];\r\n        delete CodeMirror.keyMap['sublime'][cmd + '-R'];\r\n        delete CodeMirror.keyMap['sublime'][cmd + '-Enter'];\r\n        delete CodeMirror.keyMap['sublime'][cmd + '-Up'];\r\n        delete CodeMirror.keyMap['sublime'][cmd + '-Down'];\r\n        CodeMirror.keyMap['sublime']['Shift-Tab'] = 'indentAuto';\r\n        cm.removeKeyMap('noEmmet');\r\n      }\r\n    },\r\n    tern: {\r\n      url: [\r\n        '/js/vendor/codemirror5/addon/hint/show-hint.css',\r\n        '/js/vendor/codemirror5/addon/tern/tern.css',\r\n        '/js/vendor/codemirror5/addon/hint/show-hint.js',\r\n        '/js/prod/addon-tern-' + jsbin.version + '.min.js'\r\n      ],\r\n      test: function () {\r\n        return (typeof window.ternBasicDefs !== 'undefined') &&\r\n               CodeMirror.showHint &&\r\n               CodeMirror.TernServer &&\r\n               CodeMirror.startTern;\r\n      },\r\n      done: function () {\r\n        CodeMirror.startTern();\r\n      }\r\n    },\r\n    activeline: {\r\n      url: [\r\n        '/js/vendor/codemirror5/addon/selection/active-line.js'\r\n      ],\r\n      test: function() {\r\n        return (typeof CodeMirror.defaults.styleActiveLine !== 'undefined');\r\n      },\r\n      done: function(cm) {\r\n        setOption(cm, 'styleActiveLine', true);\r\n      }\r\n    },\r\n    matchbrackets: {\r\n      url: [],\r\n      test: function() {\r\n        return (typeof CodeMirror.defaults.matchBrackets !== 'undefined');\r\n      },\r\n      done: function(cm) {\r\n        setOption(cm, 'matchBrackets', true);\r\n      }\r\n    },\r\n    csshint: {\r\n      url: [\r\n        '/js/vendor/csslint/csslint.min.js',\r\n        '/js/vendor/cm_addons/lint/css-lint.js'\r\n      ],\r\n      test: function() {\r\n        return hintingTest('css') &&\r\n               (typeof CSSLint !== 'undefined');\r\n      },\r\n      done: function(cm) {\r\n        if (cm.getOption('mode') !== 'css') {\r\n          return;\r\n        }\r\n\r\n        if (processors.css !== undefined && processors.css !== 'css') {\r\n          return;\r\n        }\r\n        hintingDone(cm);\r\n      }\r\n    },\r\n    jshint: {\r\n      url: [\r\n        // because jshint uses new style set/get - so we sniff for IE8 or lower\r\n        // since it's the only one that doesn't have it\r\n        $.browser.msie && $.browser.version < 9 ?\r\n        '/js/vendor/jshint/jshint.old.min.js' :\r\n        '/js/vendor/jshint/jshint.min.js',\r\n      ],\r\n      test: function() {\r\n        return hintingTest('javascript') &&\r\n               (typeof JSHINT !== 'undefined');\r\n      },\r\n      done: function(cm) {\r\n        if (cm.getOption('mode') !== 'javascript') {\r\n          return;\r\n        }\r\n\r\n        if (processors.javascript !== undefined && processors.javascript !== 'javascript') {\r\n          return;\r\n        }\r\n\r\n        hintingDone(cm, {\r\n          'eqnull': true\r\n        });\r\n      }\r\n    },\r\n    htmlhint: {\r\n      url: [\r\n        '/js/vendor/htmlhint/htmlhint.js',\r\n        '/js/vendor/cm_addons/lint/html-lint.js'\r\n      ],\r\n      test: function() {\r\n        return hintingTest('htmlmixed') &&\r\n               (typeof HTMLHint !== 'undefined');\r\n      },\r\n      done: function(cm) {\r\n        if (cm.getOption('mode') !== 'htmlmixed') {\r\n          return;\r\n        }\r\n\r\n        if (processors.html !== undefined && processors.html !== 'html') {\r\n          return;\r\n        }\r\n\r\n        hintingDone(cm);\r\n      }\r\n    },\r\n    coffeescripthint: {\r\n      url: [\r\n        '/js/vendor/coffeelint/coffeelint.min.js',\r\n        '/js/vendor/cm_addons/lint/coffeescript-lint.js'\r\n      ],\r\n      test: function() {\r\n        return hintingTest('coffeescript') &&\r\n               (typeof coffeelint !== 'undefined');\r\n      },\r\n      done: function(cm) {\r\n        if (cm.getOption('mode') !== 'coffeescript' || jsbin.state.processors.javascript !== 'coffeescript') {\r\n          return;\r\n        }\r\n        hintingDone(cm);\r\n      }\r\n    }\r\n  };\r\n\r\n  // begin loading user addons\r\n\r\n\r\n  var $body = $('body');\r\n\r\n  function load(url) {\r\n    if (url.indexOf('http') !== 0) {\r\n      url = jsbin.static + url;\r\n    }\r\n\r\n    if (url.slice(-3) === '.js') {\r\n      return $.ajax({\r\n        url: url + '?' + jsbin.version, // manual cache busting\r\n        dataType: 'script',\r\n        cache: true\r\n      });\r\n    } else if (url.slice(-4) === '.css') {\r\n      var d = $.Deferred();\r\n      setTimeout(function () {\r\n        $body.append('<link rel=\"stylesheet\" href=\"' + url + '?' + jsbin.version + '\">');\r\n        d.resolve();\r\n      }, 0);\r\n      return d;\r\n    }\r\n  }\r\n\r\n  function ready(test) {\r\n    var d = $.Deferred();\r\n    var timer = null;\r\n\r\n    if (test()) {\r\n      d.resolve();\r\n    } else {\r\n      var start = new Date().getTime();\r\n      var last = new Date();\r\n      timer = setInterval(function () {\r\n        last = new Date();\r\n        if (test()) {\r\n          clearInterval(timer);\r\n          d.resolve();\r\n        } else if (last.getTime() - start > 10 * 1000) {\r\n          clearInterval(timer);\r\n          d.reject();\r\n        }\r\n      }, 100);\r\n    }\r\n\r\n    return d;\r\n  }\r\n\r\n  function setOption(cm, option, value) {\r\n    cm.setOption(option, value);\r\n  }\r\n\r\n  function defaultTest(prop) {\r\n    return function () {\r\n      return (typeof CodeMirror.optionHandlers[prop] !== 'undefined');\r\n    };\r\n  }\r\n\r\n  function hintingTest(mode) {\r\n    return (typeof CodeMirror.defaults.lint !== 'undefined') &&\r\n           CodeMirror.helpers.lint &&\r\n           CodeMirror.helpers.lint[mode] &&\r\n           CodeMirror.optionHandlers.lint;\r\n  }\r\n\r\n  window.hintingDone = function(cm, defhintOptions) {\r\n    var mode = cm.getOption('mode');\r\n    if (mode === 'javascript') {\r\n      mode = 'js';\r\n    }\r\n    if (mode === 'htmlmixed') {\r\n      mode = 'html';\r\n    }\r\n    var opt = $.extend({}, settingsHintShow);\r\n    opt.consoleParent = cm.getWrapperElement().parentNode.parentNode;\r\n    setOption(cm, 'lintOpt', opt);\r\n    if (opt.gutter) {\r\n      var gutters = cm.getOption('gutters');\r\n      if (gutters.indexOf('CodeMirror-lint-markers') === -1) {\r\n        var copyGutters = gutters.slice();\r\n        copyGutters.push('CodeMirror-lint-markers');\r\n        setOption(cm, 'gutters', copyGutters);\r\n      }\r\n      var ln = cm.getOption('lineNumbers');\r\n      setOption(cm, 'lineNumbers', !ln);\r\n      setOption(cm, 'lineNumbers', ln);\r\n    }\r\n\r\n    setOption(cm, 'lint', { delay: 800, options: $.extend({}, defhintOptions, jsbin.settings[mode + 'hintOptions']) });\r\n\r\n    if (opt.console && cm.consolelint) {\r\n      $document.trigger('sizeeditors');\r\n      $(cm.consolelint.head).on('click', function() {\r\n        if (!detailsSupport) {\r\n          $(this).nextAll().toggle();\r\n        }\r\n        // trigger a resize after the click has completed and the details is close\r\n        setTimeout(function () {\r\n          $document.trigger('sizeeditors');\r\n        }, 10);\r\n      });\r\n    }\r\n  }\r\n\r\n  var options = Object.keys(settingsAddons);\r\n\r\n  function loadAddon(key) {\r\n    var addon = addons[key];\r\n    if (addon && settingsAddons[key]) {\r\n      if (typeof addon.url === 'string') {\r\n        addon.url = [addon.url];\r\n      }\r\n\r\n      // dirty jQuery way of doing .done on an array of promises\r\n      $.when.call($, addon.url.map(load)).done(function () {\r\n        if (addon.done) {\r\n          ready(addon.test).then(function () {\r\n            panels.allEditors(function (panel) {\r\n              if (panel.editor) {\r\n                addon.done(panel.editor);\r\n              }\r\n            });\r\n          });\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  options.forEach(loadAddon);\r\n\r\n  // External method to realod all the addons\r\n  window.reloadAddons = function(arr) {\r\n    if (arr) {\r\n      arr.forEach(loadAddon);\r\n    } else {\r\n      options.forEach(loadAddon);\r\n    }\r\n  };\r\n\r\n  // External method to realod the selected addon\r\n  // may be useful in the future\r\n  // window.reloadSelectedAddon = function(addon) {\r\n  //   if (options.indexOf(addon) !== -1) {\r\n  //     loadAddon(addon);\r\n  //   }\r\n  // };\r\n\r\n});\r\n"]}