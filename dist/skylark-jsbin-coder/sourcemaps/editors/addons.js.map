{"version":3,"sources":["editors/addons.js"],"names":["define","$","jsbin","coder","embed","mobile","processors","state","settings","addons","closebrackets","highlight","vim","emacs","trailingspace","fold","sublime","tern","activeline","matchbrackets","detailsSupport","document","createElement","settingsHints","settingsHintShow","forEach","val","h","d","undefined","extend","console","line","under","gutter","hintShow","tooltip","settingsAddons","url","test","defaultTest","done","cm","setOption","CodeMirror","keyMap","matchtags","scanForClosingTag","optionHandlers","matchTags","bothTags","addKeyMap","Ctrl-J","helpers","foldGutter","gutters","$body","addClass","Ctrl-Q","foldCode","getCursor","copyGutters","getOption","slice","push","cmd","browser","platform","removeKeyMap","version","window","ternBasicDefs","showHint","TernServer","startTern","defaults","styleActiveLine","matchBrackets","csshint","hintingTest","CSSLint","css","hintingDone","jshint","msie","JSHINT","javascript","eqnull","htmlhint","HTMLHint","html","coffeescripthint","coffeelint","defhintOptions","mode","opt","consoleParent","getWrapperElement","parentNode","indexOf","ln","delay","options","consolelint","$document","trigger","head","on","this","nextAll","toggle","setTimeout","Object","keys","loadAddon","reloadAddons","arr","load","static","ajax","dataType","cache","Deferred","append","resolve","option","value","prop","lint","key","addon","when","call","map","timer","start","Date","getTime","last","setInterval","clearInterval","reject","ready","then","panels","allEditors","panel","editor"],"mappings":"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","file":"../../editors/addons.js","sourcesContent":["define([\r\n  \"skylark-jquery\",\r\n   \"../jsbin\",\r\n   \"../coder\",\r\n   \"./tern\"\r\n],function ($,jsbin,coder) {\r\n  'use strict';\r\n  /*globals $, jsbin, CodeMirror*/\r\n\r\n  // ignore addons for embedded views\r\n  if (jsbin.embed || jsbin.mobile) {\r\n    return;\r\n  }\r\n\r\n  var processors = jsbin.state.processors;\r\n\r\n  var defaults = {\r\n    closebrackets: true,\r\n    highlight: false,\r\n    vim: false,\r\n    emacs: false,\r\n    trailingspace: false,\r\n    fold: false,\r\n    sublime: false,\r\n    tern: false,\r\n    activeline: true,\r\n    matchbrackets: false\r\n  };\r\n\r\n  if (!jsbin.settings.addons) {\r\n    jsbin.settings.addons = defaults;\r\n  }\r\n\r\n  var detailsSupport = 'open' in document.createElement('details');\r\n\r\n  var settingsHints = {};\r\n  var settingsHintShow = {};\r\n  var hintShow = {\r\n    console: true,\r\n    line: false,\r\n    under: false,\r\n    gutter: false\r\n  };\r\n  // css must go last for the moment due to CSSLint creating the\r\n  // global variable 'exports'\r\n  ['js', 'html', 'coffeescript', 'css'].forEach(function (val) {\r\n    var h = val + 'hint';\r\n    var d = false;\r\n    if (val === 'js') {\r\n      d = true;\r\n    }\r\n    settingsHints[h] = (jsbin.settings[h] !== undefined) ? jsbin.settings[h] : d;\r\n  });\r\n\r\n  settingsHintShow = $.extend({}, hintShow, jsbin.settings.hintShow);\r\n  settingsHintShow.tooltip = settingsHintShow.gutter;\r\n  var settingsAddons = $.extend({}, jsbin.settings.addons, settingsHints);\r\n\r\n  var addons = {\r\n    closebrackets: {\r\n      url: '/js/vendor/codemirror5/addon/edit/closebrackets.js',\r\n      test: defaultTest('autoCloseBrackets'),\r\n      done: function (cm) {\r\n        setOption(cm, 'autoCloseBrackets', true);\r\n      }\r\n    },\r\n    highlight: {\r\n      url: '/js/vendor/codemirror5/addon/search/match-highlighter.js',\r\n      test: defaultTest('highlightSelectionMatches'),\r\n      done: function (cm) {\r\n        setOption(cm, 'highlightSelectionMatches', true);\r\n      }\r\n    },\r\n    vim: {\r\n      url: [\r\n        '/js/vendor/codemirror5/keymap/vim.js'\r\n      ],\r\n      test: defaultTest('vimMode'),\r\n      done: function (cm) {\r\n        setOption(cm, 'vimMode', true);\r\n        setOption(cm, 'showCursorWhenSelecting', true);\r\n      }\r\n    },\r\n    emacs: {\r\n      url: [\r\n        '/js/vendor/codemirror5/keymap/emacs.js'\r\n      ],\r\n      test: function () {\r\n        return CodeMirror.keyMap.emacs;\r\n      },\r\n      done: function (cm) {\r\n        setOption(cm, 'keyMap', 'emacs');\r\n      }\r\n    },\r\n    matchtags: {\r\n      url: [\r\n        '/js/vendor/codemirror5/addon/fold/xml-fold.js',\r\n        '/js/vendor/codemirror5/addon/edit/matchtags.js'\r\n      ],\r\n      test: function () {\r\n        return CodeMirror.scanForClosingTag &&\r\n               CodeMirror.optionHandlers.matchTags;\r\n      },\r\n      done: function (cm) {\r\n        setOption(cm, 'matchTags', { bothTags: true });\r\n        cm.addKeyMap({'Ctrl-J': 'toMatchingTag' });\r\n      }\r\n    },\r\n    trailingspace: {\r\n      url: '/js/vendor/codemirror5/addon/edit/trailingspace.js',\r\n      test: defaultTest('showTrailingSpace'),\r\n      done: function (cm) {\r\n        setOption(cm, 'showTrailingSpace', true);\r\n      }\r\n    },\r\n    fold: {\r\n      url: [\r\n        '/js/vendor/codemirror5/addon/fold/foldgutter.css',\r\n        '/js/vendor/codemirror5/addon/fold/foldcode.js',\r\n        '/js/vendor/codemirror5/addon/fold/foldgutter.js',\r\n        '/js/vendor/codemirror5/addon/fold/brace-fold.js',\r\n        '/js/vendor/codemirror5/addon/fold/xml-fold.js',\r\n        '/js/vendor/codemirror5/addon/fold/comment-fold.js'\r\n      ],\r\n      test: function () {\r\n        return CodeMirror.helpers.fold &&\r\n               CodeMirror.optionHandlers.foldGutter &&\r\n               CodeMirror.optionHandlers.gutters;\r\n      },\r\n      done: function (cm) {\r\n        $body.addClass('code-fold');\r\n        cm.addKeyMap({'Ctrl-Q': function (cm) {\r\n          cm.foldCode(cm.getCursor());\r\n        }});\r\n        setOption(cm, 'foldGutter', true);\r\n        var gutters = cm.getOption('gutters');\r\n        var copyGutters = gutters.slice();\r\n        copyGutters.push('CodeMirror-foldgutter');\r\n        setOption(cm, 'gutters', copyGutters);\r\n      }\r\n    },\r\n    sublime: {\r\n      url: [\r\n        '/js/vendor/codemirror5/keymap/sublime.js'\r\n      ],\r\n      test: function () {\r\n        return CodeMirror.keyMap.sublime;\r\n      },\r\n      done: function (cm) {\r\n        setOption(cm, 'keyMap', 'sublime');\r\n        // Keys that CodeMirror should never take over\r\n        var cmd = $.browser.platform === 'mac' ? 'Cmd' : 'Ctrl';\r\n        delete CodeMirror.keyMap['sublime'][cmd + '-L'];\r\n        delete CodeMirror.keyMap['sublime'][cmd + '-T'];\r\n        delete CodeMirror.keyMap['sublime'][cmd + '-W'];\r\n        delete CodeMirror.keyMap['sublime'][cmd + '-J'];\r\n        delete CodeMirror.keyMap['sublime'][cmd + '-R'];\r\n        delete CodeMirror.keyMap['sublime'][cmd + '-Enter'];\r\n        delete CodeMirror.keyMap['sublime'][cmd + '-Up'];\r\n        delete CodeMirror.keyMap['sublime'][cmd + '-Down'];\r\n        CodeMirror.keyMap['sublime']['Shift-Tab'] = 'indentAuto';\r\n        cm.removeKeyMap('noEmmet');\r\n      }\r\n    },\r\n    tern: {\r\n      url: [\r\n        '/js/vendor/codemirror5/addon/hint/show-hint.css',\r\n        '/js/vendor/codemirror5/addon/tern/tern.css',\r\n        '/js/vendor/codemirror5/addon/hint/show-hint.js',\r\n        '/js/prod/addon-tern-' + jsbin.version + '.min.js'\r\n      ],\r\n      test: function () {\r\n        return (typeof window.ternBasicDefs !== 'undefined') &&\r\n               CodeMirror.showHint &&\r\n               CodeMirror.TernServer &&\r\n               CodeMirror.startTern;\r\n      },\r\n      done: function () {\r\n        CodeMirror.startTern();\r\n      }\r\n    },\r\n    activeline: {\r\n      url: [\r\n        '/js/vendor/codemirror5/addon/selection/active-line.js'\r\n      ],\r\n      test: function() {\r\n        return (typeof CodeMirror.defaults.styleActiveLine !== 'undefined');\r\n      },\r\n      done: function(cm) {\r\n        setOption(cm, 'styleActiveLine', true);\r\n      }\r\n    },\r\n    matchbrackets: {\r\n      url: [],\r\n      test: function() {\r\n        return (typeof CodeMirror.defaults.matchBrackets !== 'undefined');\r\n      },\r\n      done: function(cm) {\r\n        setOption(cm, 'matchBrackets', true);\r\n      }\r\n    },\r\n    csshint: {\r\n      url: [\r\n        '/js/vendor/csslint/csslint.min.js',\r\n        '/js/vendor/cm_addons/lint/css-lint.js'\r\n      ],\r\n      test: function() {\r\n        return hintingTest('css') &&\r\n               (typeof CSSLint !== 'undefined');\r\n      },\r\n      done: function(cm) {\r\n        if (cm.getOption('mode') !== 'css') {\r\n          return;\r\n        }\r\n\r\n        if (processors.css !== undefined && processors.css !== 'css') {\r\n          return;\r\n        }\r\n        hintingDone(cm);\r\n      }\r\n    },\r\n    jshint: {\r\n      url: [\r\n        // because jshint uses new style set/get - so we sniff for IE8 or lower\r\n        // since it's the only one that doesn't have it\r\n        $.browser.msie && $.browser.version < 9 ?\r\n        '/js/vendor/jshint/jshint.old.min.js' :\r\n        '/js/vendor/jshint/jshint.min.js',\r\n      ],\r\n      test: function() {\r\n        return hintingTest('javascript') &&\r\n               (typeof JSHINT !== 'undefined');\r\n      },\r\n      done: function(cm) {\r\n        if (cm.getOption('mode') !== 'javascript') {\r\n          return;\r\n        }\r\n\r\n        if (processors.javascript !== undefined && processors.javascript !== 'javascript') {\r\n          return;\r\n        }\r\n\r\n        hintingDone(cm, {\r\n          'eqnull': true\r\n        });\r\n      }\r\n    },\r\n    htmlhint: {\r\n      url: [\r\n        '/js/vendor/htmlhint/htmlhint.js',\r\n        '/js/vendor/cm_addons/lint/html-lint.js'\r\n      ],\r\n      test: function() {\r\n        return hintingTest('htmlmixed') &&\r\n               (typeof HTMLHint !== 'undefined');\r\n      },\r\n      done: function(cm) {\r\n        if (cm.getOption('mode') !== 'htmlmixed') {\r\n          return;\r\n        }\r\n\r\n        if (processors.html !== undefined && processors.html !== 'html') {\r\n          return;\r\n        }\r\n\r\n        hintingDone(cm);\r\n      }\r\n    },\r\n    coffeescripthint: {\r\n      url: [\r\n        '/js/vendor/coffeelint/coffeelint.min.js',\r\n        '/js/vendor/cm_addons/lint/coffeescript-lint.js'\r\n      ],\r\n      test: function() {\r\n        return hintingTest('coffeescript') &&\r\n               (typeof coffeelint !== 'undefined');\r\n      },\r\n      done: function(cm) {\r\n        if (cm.getOption('mode') !== 'coffeescript' || jsbin.state.processors.javascript !== 'coffeescript') {\r\n          return;\r\n        }\r\n        hintingDone(cm);\r\n      }\r\n    }\r\n  };\r\n\r\n  // begin loading user addons\r\n\r\n\r\n  var $body = $('body');\r\n\r\n  function load(url) {\r\n    if (url.indexOf('http') !== 0) {\r\n      url = jsbin.static + url;\r\n    }\r\n\r\n    if (url.slice(-3) === '.js') {\r\n      return $.ajax({\r\n        url: url + '?' + jsbin.version, // manual cache busting\r\n        dataType: 'script',\r\n        cache: true\r\n      });\r\n    } else if (url.slice(-4) === '.css') {\r\n      var d = $.Deferred();\r\n      setTimeout(function () {\r\n        $body.append('<link rel=\"stylesheet\" href=\"' + url + '?' + jsbin.version + '\">');\r\n        d.resolve();\r\n      }, 0);\r\n      return d;\r\n    }\r\n  }\r\n\r\n  function ready(test) {\r\n    var d = $.Deferred();\r\n    var timer = null;\r\n\r\n    if (test()) {\r\n      d.resolve();\r\n    } else {\r\n      var start = new Date().getTime();\r\n      var last = new Date();\r\n      timer = setInterval(function () {\r\n        last = new Date();\r\n        if (test()) {\r\n          clearInterval(timer);\r\n          d.resolve();\r\n        } else if (last.getTime() - start > 10 * 1000) {\r\n          clearInterval(timer);\r\n          d.reject();\r\n        }\r\n      }, 100);\r\n    }\r\n\r\n    return d;\r\n  }\r\n\r\n  function setOption(cm, option, value) {\r\n    cm.setOption(option, value);\r\n  }\r\n\r\n  function defaultTest(prop) {\r\n    return function () {\r\n      return (typeof CodeMirror.optionHandlers[prop] !== 'undefined');\r\n    };\r\n  }\r\n\r\n  function hintingTest(mode) {\r\n    return (typeof CodeMirror.defaults.lint !== 'undefined') &&\r\n           CodeMirror.helpers.lint &&\r\n           CodeMirror.helpers.lint[mode] &&\r\n           CodeMirror.optionHandlers.lint;\r\n  }\r\n\r\n  window.hintingDone = function(cm, defhintOptions) {\r\n    var mode = cm.getOption('mode');\r\n    if (mode === 'javascript') {\r\n      mode = 'js';\r\n    }\r\n    if (mode === 'htmlmixed') {\r\n      mode = 'html';\r\n    }\r\n    var opt = $.extend({}, settingsHintShow);\r\n    opt.consoleParent = cm.getWrapperElement().parentNode.parentNode;\r\n    setOption(cm, 'lintOpt', opt);\r\n    if (opt.gutter) {\r\n      var gutters = cm.getOption('gutters');\r\n      if (gutters.indexOf('CodeMirror-lint-markers') === -1) {\r\n        var copyGutters = gutters.slice();\r\n        copyGutters.push('CodeMirror-lint-markers');\r\n        setOption(cm, 'gutters', copyGutters);\r\n      }\r\n      var ln = cm.getOption('lineNumbers');\r\n      setOption(cm, 'lineNumbers', !ln);\r\n      setOption(cm, 'lineNumbers', ln);\r\n    }\r\n\r\n    setOption(cm, 'lint', { delay: 800, options: $.extend({}, defhintOptions, jsbin.settings[mode + 'hintOptions']) });\r\n\r\n    if (opt.console && cm.consolelint) {\r\n      $document.trigger('sizeeditors');\r\n      $(cm.consolelint.head).on('click', function() {\r\n        if (!detailsSupport) {\r\n          $(this).nextAll().toggle();\r\n        }\r\n        // trigger a resize after the click has completed and the details is close\r\n        setTimeout(function () {\r\n          $document.trigger('sizeeditors');\r\n        }, 10);\r\n      });\r\n    }\r\n  }\r\n\r\n  var options = Object.keys(settingsAddons);\r\n\r\n  function loadAddon(key) {\r\n    var addon = addons[key];\r\n    if (addon && settingsAddons[key]) {\r\n      if (typeof addon.url === 'string') {\r\n        addon.url = [addon.url];\r\n      }\r\n\r\n      // dirty jQuery way of doing .done on an array of promises\r\n      $.when.call($, addon.url.map(load)).done(function () {\r\n        if (addon.done) {\r\n          ready(addon.test).then(function () {\r\n            jsbin.panels.allEditors(function (panel) {\r\n              if (panel.editor) {\r\n                addon.done(panel.editor);\r\n              }\r\n            });\r\n          });\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  options.forEach(loadAddon);\r\n\r\n  // External method to realod all the addons\r\n  window.reloadAddons = function(arr) {\r\n    if (arr) {\r\n      arr.forEach(loadAddon);\r\n    } else {\r\n      options.forEach(loadAddon);\r\n    }\r\n  };\r\n\r\n  // External method to realod the selected addon\r\n  // may be useful in the future\r\n  // window.reloadSelectedAddon = function(addon) {\r\n  //   if (options.indexOf(addon) !== -1) {\r\n  //     loadAddon(addon);\r\n  //   }\r\n  // };\r\n\r\n});\r\n"]}