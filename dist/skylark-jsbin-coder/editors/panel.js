/**
 * skylark-jsbin-coder - A version of jsbin-editor  that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-jsbin-coder/
 * @license MIT
 */
define(["skylark-jquery","../jsbin","../coder","./codemirror","./snippets.cm"],function(e,t,s,i){var o=e(document),r=e("#source"),n=!e("html").hasClass("layout"),a={html:"htmlmixed",javascript:"javascript",css:"css",typescript:"javascript",markdown:"markdown",coffeescript:"coffeescript",livescript:"text/x-livescript",jsx:"javascript",less:"text/x-less",sass:"text/x-sass",scss:"text/x-scss",processing:"text/x-csrc",jade:"text/x-jade",clojurescript:"clojure"},l=new RegExp("[​- ]","g");"default"===t.settings.editor.tabMode?i.keyMap.basic.Tab=void 0:"classic"!==t.settings.editor.tabMode&&(i.keyMap.basic.Tab="indentMore"),i.commands||(i.commands={});i.commands.autocomplete=function(e){if(i.snippets(e)===i.Pass)return i.simpleHint(e,i.hint.javascript)},i.commands.snippets=function(e){"use strict";return-1===["htmlmixed","javascript","css",a.less,a.sass,a.scss].indexOf(e.options.mode)?i.simpleHint(e,i.hint.anyword):oldCodeMirror?oldCodeMirror.snippets(e):t.mobile?void 0:i.snippets(e)};var d=function(s,n){"use strict";var l=this,c=null,p={},h=s,u=e('<div class="stretch panelwrapper"></div>');if(l.settings=n=n||{},l.id=l.name=s,(c=e(".panel."+s)).data("name",s),l.$el=c.detach(),l.$el.appendTo(u),u.appendTo(r),l.$panel=l.$el,l.$el=l.$el.parent().hide(),l.el=document.getElementById(s),l.order=++d.order,l.label=n.label||s,l.$el.data("panel",l),this._eventHandlers={},l.on("show",panels.updateQuery),l.on("hide",panels.updateQuery),panelShortcuts[panelShortcuts.start+l.order]=l.id,1===l.order&&(n.nosplitter=!0),n.editor){if(p={parserfile:[],readOnly:!!t.state.embed&&"nocursor",dragDrop:!1,mode:a[h],lineWrapping:!1,theme:t.settings.theme||"jsbin",highlightLine:!0},e.extend(p,t.settings.editor||{}),p.extraKeys={},p.extraKeys.Tab="javascript"===s?"autocomplete":"snippets","html"===s&&e.extend(p,{syntax:s,profile:s}),"string"==typeof p.tabSize&&(p.tabSize=parseInt(p.tabSize,10)||2),"string"==typeof p.indentUnit&&(p.indentUnit=parseInt(p.indentUnit,10)||2),l.editor=i.fromTextArea(l.el,p),"html"!==s&&"css"!==s||(delete emmetCodeMirror.defaultKeymap["Cmd-D"],delete emmetCodeMirror.defaultKeymap["Ctrl-D"],emmetCodeMirror(l.editor)),l.editor.on("highlightLines",function(){window.location.hash=panels.getHighlightLines()}),l.editor.on("change",function(e,s){return t.saveDisabled?o.trigger("codeChange.live",[{panelId:l.id,revert:!0,origin:s.origin}]):o.trigger("codeChange",[{panelId:l.id,revert:!0,origin:s.origin}]),!0}),l.editor.on("focus",function(){l.focus()}),"javascript"===s){var g="mac"===e.browser.platform?"Cmd":"Ctrl",f={};f[g+"-D"]="deleteLine",f[g+"-/"]=function(e){i.commands.toggleComment(e)},f.name="noEmmet",l.editor.addKeyMap(f)}l._setupEditor(l.editor,s)}e("html").is(".layout")?(l.splitter=e(),l.$el.removeClass("stretch")):n.nosplitter?l.splitter=e():(l.splitter=l.$el.splitter({}).data("splitter"),l.splitter.hide()),t.state.processors&&t.state.processors[s]?(h=t.state.processors[s],t.processors.set(l,t.state.processors[s])):n.processor?(h=n.processors[n.processor],t.processors.set(l,n.processor)):processors[l.id]?t.processors.set(l,l.id):l.processor=function(e){return new Promise(function(t){t(e)})},n.beforeRender&&o.bind("render",e.proxy(n.beforeRender,l)),n.editor||(l.ready=!0),t.state.embed,this.controlButton=e('<a role="button" class="button group" href="?'+s+'">'+l.label+"</a>"),this.updateAriaState(),this.controlButton.on("click touchstart",function(){return l.toggle(),!1}),this.controlButton.appendTo("#panels"),c.focus(function(){l.focus()}),t.mobile||c.add(this.$el.find(".label")).click(function(){l.focus()})};function c(e,s){if(e.codeSet)a=!0;else{var i=store.sessionStorage.getItem("jsbin.content."+s),r=t.embed?null:store.localStorage.getItem("saved-"+s),n=store.sessionStorage.getItem("url"),a=!1;if(n===t.getURL()||t.state.checksum||(store.sessionStorage.removeItem("checksum"),saveChecksum=!1),template&&i==template[s])e.setCode(i);else if(i&&n==t.getURL()&&n!==t.root)e.setCode(i),a=i!=r&&i!=template[s];else if(template.post||null===r||/(edit|embed)$/.test(window.location)||window.location.search)e.setCode(template[s]);else{e.setCode(r);var l=JSON.parse(store.localStorage.getItem("saved-processors")||"{}")[s];l&&t.processors.set(t.panels.panels[s],l)}e.editor&&e.editor.clearHistory&&e.editor.clearHistory()}a&&o.trigger("codeChange",[{revert:!1,onload:!0}])}return d.order=0,d.prototype={virgin:!0,visible:!1,updateAriaState:function(){this.controlButton.attr("aria-label",this.label+" Panel: "+(this.visible?"Active":"Inactive"))},show:function(s){if(hideOpen(),!this.visible){o.trigger("history:close");var i=this,r=i.$el.find(".panel").length;if(analytics.showPanel(i.id),t.mobile&&panels.hideAll(!0),i.splitter.length){if(0===r||r>1)e(".panel."+i.id).show().closest(".panelwrapper").show();else i.$el.show();i.splitter.show()}else i.$el.show();if($body.addClass("panelsVisible"),i.settings.show&&i.settings.show.call(i,!0),i.controlButton.addClass("active"),i.visible=!0,this.updateAriaState(),t.mobile&&window.matchMedia&&window.matchMedia("(max-height: 410px) and (max-width: 640px)").matches&&i.editor&&i.editor.focus(),t.mobile)return i.focus(),void i.trigger("show");setTimeout(function(){if(n&&(void 0!==s?i.splitter.trigger("init",s):i.distribute()),i.editor){if(i.virgin){var r=i.$el.find(".label").outerHeight();r+=8,t.mobile||e(i.editor.scroller).find(".CodeMirror-lines").css("padding-top",r),c(i,i.name)}i.virgin&&!t.panels.ready||(i.editor.focus(),i.focus()),i.virgin&&i.settings.init&&setTimeout(function(){i.settings.init.call(i)},10)}else i.focus();o.trigger("sizeeditors"),i.trigger("show"),i.virgin=!1},0)}},hide:function(s){this.visible=!1,this.updateAriaState(),s?this.editor&&(getRenderedCode[this.id]=getRenderedCode.render(this.id)):analytics.hidePanel(this.id);var i=this.$el.find(".panel").length;if(0===i||i>1){var r=e(".panel."+this.id).hide();r.prev().hide(),0===r.closest(".panelwrapper").find(".panel:visible").length&&r.closest(".panelwrapper").hide()}else this.$el.hide(),this.splitter.hide();this.editor&&this.controlButton.toggleClass("hasContent",!!this.getCode().trim().length),this.controlButton.removeClass("active"),this.settings.hide&&this.settings.hide.call(this,!0);var n=t.panels.getVisible();n.length&&(t.panels.focused=n[0],t.panels.focused.editor?t.panels.focused.editor.focus():t.panels.focused.$el.focus(),t.panels.focused.focus()),!s&&t.mobile&&0===n.length&&(o.trigger("history:load"),e("#history").show(),setTimeout(function(){$body.removeClass("panelsVisible")},100)),this.trigger("hide"),s||(this.distribute(),o.trigger("sizeeditors"),o.trigger("history:open"))},toggle:function(){this[this.visible?"hide":"show"]()},getCode:function(){if(this.editor)return l.lastIndex=0,this.editor.getCode().replace(l,"")},setCode:function(e){this.editor&&(void 0===e&&(e=""),this.controlButton.toggleClass("hasContent",!!e.trim().length),this.codeSet=!0,this.editor.setCode(e.replace(l,"")))},codeSet:!1,blur:function(){this.$panel.addClass("blur")},focus:function(){this.$panel.removeClass("blur"),t.panels.focus(this)},render:function(){"use strict";var e=[].slice.call(arguments),s=this;return new Promise(function(i,o){s.editor?s.processor(s.getCode()).then(i,o):s.visible&&s.settings.render&&(t.panels.ready&&s.settings.render.apply(s,e),i())})},init:function(){this.settings.init&&this.settings.init.call(this)},_setupEditor:function(){var s=store.sessionStorage.getItem("panel")||t.settings.focusedPanel,i=this,n=i.editor;n.setCode=function(e){try{n.setValue(e)}catch(e){}},n.getCode=function(){return n.getValue()},n.currentLine=function(){return n.getCursor().line},t.embed&&(n._focus=n.focus,n.focus=function(){}),n.id=i.name,n.win=n.getWrapperElement(),n.scroller=e(n.getScrollerElement());var a=i.$el.find(".label");-1===document.body.className.indexOf("ie6")&&a.length&&n.on("scroll",function(t){n.getScrollInfo().top>10?a.stop().animate({opacity:0},20,function(){e(this).hide()}):a.show().stop().animate({opacity:1},150)});o.bind("sizeeditors",function(){if(i.visible){var e=i.editor.scroller.closest(".panel").outerHeight(),s=0;s+=i.$el.find("details").filter(":visible").height()||0,t.lameEditor||n.scroller.height(e-s);try{n.refresh()}catch(e){}setTimeout(function(){r[0].style.paddingLeft="1px",setTimeout(function(){r[0].style.paddingLeft="0"},0)},0)}}),setTimeout(function(){i.ready=!0,c(i,i.name),s==i.name&&setTimeout(function(){if(i.focus(),i.visible&&!t.mobile&&!t.tablet){n.focus();for(var e=n.getCode().split("\n"),s=null,o=0;o<e.length;o++)if(null===s&&""===e[o].trim()){s=o;break}n.setCursor({line:1*(store.sessionStorage.getItem("line")||s||0),ch:1*(store.sessionStorage.getItem("character")||0)})}},110)},0)},populateEditor:function(){c(this,this.name)},on:function(e,t){return(this._eventHandlers[e]=this._eventHandlers[e]||[]).push(t),this},trigger:function(e){var t=[].slice.call(arguments,1);t.unshift({type:e});for(var s=this._eventHandlers[e],i=0;s&&s[i];)s[i++].apply(this,t);return this}},s.editors.Panel=d});
//# sourceMappingURL=../sourcemaps/editors/panel.js.map
