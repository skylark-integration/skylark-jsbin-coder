/**
 * skylark-jsbin-coder - A version of jsbin-editor  that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-jsbin-coder/
 * @license MIT
 */
define(["skylark-jquery","skylark-jsbin-base/storage","../jsbin","./panel"],function(e,t,i,n){var s={};function o(e){var t=["live","javascript","html","css","console"];return e.split(",").reduce(function(e,i){return"js"===i&&(i="javascript"),"output"===i&&(i="live"),-1!==t.indexOf(i)&&e.push(i),e},[])}s.getVisible=function(){var e=this.named,t=[];for(var i in e)e[i].visible&&t.push(e[i]);return t},s.save=function(){if(!i.embed){for(var n,s=this.getVisible(),o={},r="",a=e(window).width(),l=0;l<s.length;l++)-1===(r=(n=s[l]).$el.css("left")).indexOf("%")&&(r=parseFloat(r)/a*100+"%"),o[n.name]=r;t.sessionStorage.setItem("jsbin.panels",JSON.stringify(o))}},s.restore=function(){"use strict";var n=window.location,r=n.search.substring(1),a=n.hash.substring(1),l=[],d=i.embed?null:JSON.parse(t.sessionStorage.getItem("jsbin.panels")||"null"),u=h.javascript.getCode().length,c=h.css.getCode().length,f=h.html.getCode().length,g="",p=0,v=null,m=[],b="",w=!1,y=$window.width(),j=!!t.sessionStorage.getItem("panel"),C="live javascript html css console".split(" ");if(history.replaceState&&-1!==n.pathname.indexOf("/edit")||(n.origin,n.pathname,i.getURL()),r||a){var O=r||a;-1!==O.indexOf("&")?(O=function(t){var i={},n=/\+/g,s=(t=t.split("&")).length;s>1e3&&(s=1e3);for(var o=0;o<s;++o){var r,a,l,d,u=t[o].replace(n,"%20"),c=u.indexOf("=");c>=0?(r=u.substr(0,c),a=u.substr(c+1)):(r=u,a="");try{l=decodeURIComponent(r),d=decodeURIComponent(a)}catch(e){l=r,d=a}(window.hasOwnProperty?window.hasOwnProperty(i,l):i.hasOwnProperty(l))?e.isArray(i[l])?i[l].push(d):i[l]=[i[l],d]:i[l]=d}return i}(r||a),l=Object.keys(O).reduce(function(e,t){return-1!==t.indexOf(",")&&""===O[t]?e=o(t):("js"===t&&(O.javascript=O.js,t="javascript"),"output"===t&&(O.live=O.live,t="live"),void 0===O[t]&&(O[t]=""),-1!==C.indexOf(t)&&e.push(t+"="+O[t]),e)},[])):l=o(O)}if(0===l.length&&(l=null!==d?Object.keys(d):i.mobile?[i.settings.panels[0]]:i.settings.panels),0===l.length&&(u&&l.push("javascript"),f&&l.push("html"),c&&l.push("css"),l.push("live")),s.saveOnExit=!0,p=0,0===l.length&&(l=["html","live"]),l.length){for(g in d)-1!==l.indexOf(g)&&p++;for(p===l.length&&(w=!0),p=0;p<l.length;p++)b=null,-1!==(g=l[p]).indexOf("=")&&(b=g.substring(g.indexOf("=")+1),g=g.substring(0,g.indexOf("="))),s.named[g]?((v=s.named[g]).editor&&null!==b&&v.setCode(decodeURIComponent(b)),w&&l.length>1?v.show(y*parseFloat(d[g])/100):v.show(),m.push(v)):g&&null!==b&&function(e,t){var i=["html","javascript","css"],n=function(o,r){var a,l,d=s.named[r.panelId]||{};if(r.panelId&&d.editor&&!0===d.ready){i.splice(i.indexOf(r.panelId),1);try{a=d.getCode()}catch(e){}-1!==a.indexOf("%"+e+"%")&&(a=(l=a.split("%"+e+"%"))[0]+decodeURIComponent(t)+l[1],d.setCode(a),$document.unbind("codeChange",n))}0===i.length&&$document.unbind("codeChange",n)};$document.bind("codeChange",n)}(g,b);1===l.length&&"preview"===l[0]&&s.named.live.show(),w||this.distribute()}for(p=0;p<m.length;p++)m[p].init();var x=s.getVisible();x.length&&($body.addClass("panelsVisible"),j||x[0].show())},s.savecontent=function(){var e,i;for(e in this.named)(i=this.named[e]).editor&&t.sessionStorage.setItem("jsbin.content."+e,i.getCode())},s.getHighlightLines=function(){"use strict";var e,t=[],i="";for(name in s.named)(e=s.named[name]).editor&&(i=e.editor.highlightLines().string)&&t.push(name.substr(0,1).toUpperCase()+":L"+i);return t.join(",")},s.focus=function(t){this.focused=t,t&&e(".panel").removeClass("focus").filter("."+t.id).addClass("focus")},s.getQuery=function(){var e={javascript:"js",live:"output"};return s.getVisible().map(function(t){return e[t.id]||t.id}).join(",")},s.updateQuery=throttle(function(){var t=s.getQuery();i.state.code&&i.state.owner&&e.ajax({url:i.getURL({withRevision:!0})+"/settings",type:"PUT",data:{panels:visible.map(function(e){return e.id})},success:function(){}}),history.replaceState&&history.replaceState(null,null,"?"+t)},100);var r=!e("html").hasClass("layout");r||e("#source").removeClass("stretch"),s.distribute=function(){if(r){var t,n=e("#source .panelwrapper:visible"),o=100,a=0,l=$window.width()-(n.length-1),d=e("#source").outerHeight(),u=0,c=0,h=0,f=[];if(n.length){$body.addClass("panelsVisible"),o=100/n.length;for(var g=0;g<n.length;g++)c=100-o*(g+1),(t=e.data(n[g],"panel")).$el.css({top:0,bottom:0,left:u+"%",right:c+"%"}),t.splitter.trigger("init",l*u/100),t.splitter[0==g?"hide":"show"](),u+=o,(f=e(n[g]).find(".panel")).length>1&&(h=0,f=f.filter(":visible"),a=100/f.length,f.each(function(t){bottom=100-a*(t+1);var i=s.named[e.data(this,"name")];e(this).css("top",h+"%"),e(this).css("bottom",bottom+"%"),i.splitter.hasClass("vertical")&&(i.splitter.trigger("init",d*h/100),i.splitter[0==t?"hide":"show"]()),h+=a}))}else i.embed||(e("#history").show(),setTimeout(function(){$body.removeClass("panelsVisible")},100))}},s.show=function(e){this.named[e].show(),this.named[e].editor&&this.named[e].editor.focus(),this.named[e].focus()},s.hide=function(t){e("#history");var i=this.named;i[t].visible&&i[t].hide();var n=i.getVisible();n.length&&(i.focused=n[0],i.focused.editor?i.focused.editor.focus():i.focused.$el.focus(),i.focused.focus())},s.hideAll=function(e){for(var t=s.getVisible(),i=t.length;i--;)t[i].hide(e)},n.prototype.distribute=function(){s.distribute()};var a=function(){return new n("html",{editor:!0,label:"HTML",init:function(){var e=this.editor.getValue().split("\n"),t=-1;e.forEach(function(e,i){-1===t&&0===e.trim().length&&(t=i)}),-1!==t&&(this.editor.setCursor({line:t,ch:2}),0===e[t].length&&this.editor.indentLine(t,"add"))}})},l=function(){return new n("css",{editor:!0,label:"CSS"})},d=function(){return new n("javascript",{editor:!0,label:"JavaScript"})},u=function(){return new n("console",{label:"Console"})},c=function(){return new n("live",{label:"Output",show:function(){s.ready&&renderLivePreview()},hide:function(){s.named.console.visible}})},h=s.named={};h.html=a(),h.css=l(),h.javascript=d(),h.console=u(),upgradeConsolePanel(h.console),h.live=c(),h.live.settings.render=function(e){s.ready&&renderLivePreview(e)},s.allEditors=function(e){var t,i;for(t in s.named)(i=s.named[t]).editor&&e(i)},setTimeout(function(){s.restore()},10),s.focus(s.getVisible()[0]||null);var f=setInterval(function(){var t,n,o=!0,r=null,a=window.location.hash.substring(1);for(n in s.named)if((t=s.named[n]).visible&&!t.ready){o=!1;break}if(s.ready=o,o){s.allEditors(function(e){var t=e.id.substr(0,1).toUpperCase()+":L";if(-1!==a.indexOf(t)){var i=a.match(new RegExp(t+"(\\d+(?:-\\d+)?)"));null!==i&&e.editor.highlightLines(i[1])}});var l=e("li.add-library"),d=e("li.run-with-js");h.live.on("hide",function(){l.show(),d.hide()}),h.live.on("show",function(){l.hide(),d.show()}),s.named.live.visible?h.live.trigger("show"):h.live.trigger("hide"),clearInterval(f),s.named.console.visible?h.console.render():renderLivePreview(),i.mobile||e(window).resize(function(){clearTimeout(r),r=setTimeout(function(){$document.trigger("sizeeditors")},100)}),$document.trigger("sizeeditors"),$document.trigger("jsbinReady")}},100);return setTimeout(function(){s.restore()},10),s.focus(s.getVisible()[0]||null),i.codepan.panels=s});
//# sourceMappingURL=../sourcemaps/editors/panels.js.map
