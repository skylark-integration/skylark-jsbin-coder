/**
 * skylark-jsbin-coder - A version of jsbin-editor  that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-jsbin-coder/
 * @license MIT
 */
define(["skylark-jquery","../jsbin","./panel"],function(e,t,i){var n={};function s(e){var t=["live","javascript","html","css","console"];return e.split(",").reduce(function(e,i){return"js"===i&&(i="javascript"),"output"===i&&(i="live"),-1!==t.indexOf(i)&&e.push(i),e},[])}n.getVisible=function(){var e=this.named,t=[];for(var i in e)e[i].visible&&t.push(e[i]);return t},n.save=function(){if(!t.embed){for(var i,n=this.getVisible(),s={},o="",r=e(window).width(),a=0;a<n.length;a++)-1===(o=(i=n[a]).$el.css("left")).indexOf("%")&&(o=parseFloat(o)/r*100+"%"),s[i.name]=o;store.sessionStorage.setItem("jsbin.panels",JSON.stringify(s))}},n.restore=function(){"use strict";var i=window.location,o=i.search.substring(1),r=i.hash.substring(1),a=[],l=t.embed?null:JSON.parse(store.sessionStorage.getItem("jsbin.panels")||"null"),d=c.javascript.getCode().length,u=c.css.getCode().length,h=c.html.getCode().length,f="",g=0,p=null,v=[],m="",b=!1,w=$window.width(),y=!!store.sessionStorage.getItem("panel"),C="live javascript html css console".split(" ");if(history.replaceState&&-1!==i.pathname.indexOf("/edit")||(i.origin,i.pathname,t.getURL()),o||r){var j=o||r;-1!==j.indexOf("&")?(j=function(t){var i={},n=/\+/g,s=(t=t.split("&")).length;s>1e3&&(s=1e3);for(var o=0;o<s;++o){var r,a,l,d,u=t[o].replace(n,"%20"),c=u.indexOf("=");c>=0?(r=u.substr(0,c),a=u.substr(c+1)):(r=u,a="");try{l=decodeURIComponent(r),d=decodeURIComponent(a)}catch(e){l=r,d=a}(window.hasOwnProperty?window.hasOwnProperty(i,l):i.hasOwnProperty(l))?e.isArray(i[l])?i[l].push(d):i[l]=[i[l],d]:i[l]=d}return i}(o||r),a=Object.keys(j).reduce(function(e,t){return-1!==t.indexOf(",")&&""===j[t]?e=s(t):("js"===t&&(j.javascript=j.js,t="javascript"),"output"===t&&(j.live=j.live,t="live"),void 0===j[t]&&(j[t]=""),-1!==C.indexOf(t)&&e.push(t+"="+j[t]),e)},[])):a=s(j)}if(0===a.length&&(a=null!==l?Object.keys(l):t.mobile?[t.settings.panels[0]]:t.settings.panels),0===a.length&&(d&&a.push("javascript"),h&&a.push("html"),u&&a.push("css"),a.push("live")),n.saveOnExit=!0,g=0,0===a.length&&(a=["html","live"]),a.length){for(f in l)-1!==a.indexOf(f)&&g++;for(g===a.length&&(b=!0),g=0;g<a.length;g++)m=null,-1!==(f=a[g]).indexOf("=")&&(m=f.substring(f.indexOf("=")+1),f=f.substring(0,f.indexOf("="))),n.named[f]?((p=n.named[f]).editor&&null!==m&&p.setCode(decodeURIComponent(m)),b&&a.length>1?p.show(w*parseFloat(l[f])/100):p.show(),v.push(p)):f&&null!==m&&function(e,t){var i=["html","javascript","css"],s=function(o,r){var a,l,d=n.named[r.panelId]||{};if(r.panelId&&d.editor&&!0===d.ready){i.splice(i.indexOf(r.panelId),1);try{a=d.getCode()}catch(e){}-1!==a.indexOf("%"+e+"%")&&(a=(l=a.split("%"+e+"%"))[0]+decodeURIComponent(t)+l[1],d.setCode(a),$document.unbind("codeChange",s))}0===i.length&&$document.unbind("codeChange",s)};$document.bind("codeChange",s)}(f,m);1===a.length&&"preview"===a[0]&&n.named.live.show(),b||this.distribute()}for(g=0;g<v.length;g++)v[g].init();var O=n.getVisible();O.length&&($body.addClass("panelsVisible"),y||O[0].show())},n.savecontent=function(){var e,t;for(e in this.named)(t=this.named[e]).editor&&store.sessionStorage.setItem("jsbin.content."+e,t.getCode())},n.getHighlightLines=function(){"use strict";var e,t=[],i="";for(name in n.named)(e=n.named[name]).editor&&(i=e.editor.highlightLines().string)&&t.push(name.substr(0,1).toUpperCase()+":L"+i);return t.join(",")},n.focus=function(t){this.focused=t,t&&e(".panel").removeClass("focus").filter("."+t.id).addClass("focus")},n.getQuery=function(){var e={javascript:"js",live:"output"};return n.getVisible().map(function(t){return e[t.id]||t.id}).join(",")},n.updateQuery=throttle(function(){var i=n.getQuery();t.state.code&&t.state.owner&&e.ajax({url:t.getURL({withRevision:!0})+"/settings",type:"PUT",data:{panels:visible.map(function(e){return e.id})},success:function(){}}),history.replaceState&&history.replaceState(null,null,"?"+i)},100);var o=!e("html").hasClass("layout");o||e("#source").removeClass("stretch"),n.distribute=function(){if(o){var i,s=e("#source .panelwrapper:visible"),r=100,a=0,l=$window.width()-(s.length-1),d=e("#source").outerHeight(),u=0,c=0,h=0,f=[];if(s.length){$body.addClass("panelsVisible"),r=100/s.length;for(var g=0;g<s.length;g++)c=100-r*(g+1),(i=e.data(s[g],"panel")).$el.css({top:0,bottom:0,left:u+"%",right:c+"%"}),i.splitter.trigger("init",l*u/100),i.splitter[0==g?"hide":"show"](),u+=r,(f=e(s[g]).find(".panel")).length>1&&(h=0,f=f.filter(":visible"),a=100/f.length,f.each(function(t){bottom=100-a*(t+1);var i=n.named[e.data(this,"name")];e(this).css("top",h+"%"),e(this).css("bottom",bottom+"%"),i.splitter.hasClass("vertical")&&(i.splitter.trigger("init",d*h/100),i.splitter[0==t?"hide":"show"]()),h+=a}))}else t.embed||(e("#history").show(),setTimeout(function(){$body.removeClass("panelsVisible")},100))}},n.show=function(e){this.named[e].show(),this.named[e].editor&&this.named[e].editor.focus(),this.named[e].focus()},n.hide=function(t){e("#history");var i=this.named;i[t].visible&&i[t].hide();var n=i.getVisible();n.length&&(i.focused=n[0],i.focused.editor?i.focused.editor.focus():i.focused.$el.focus(),i.focused.focus())},n.hideAll=function(e){for(var t=n.getVisible(),i=t.length;i--;)t[i].hide(e)},i.prototype.distribute=function(){n.distribute()};var r=function(){return new i("html",{editor:!0,label:"HTML",init:function(){var e=this.editor.getValue().split("\n"),t=-1;e.forEach(function(e,i){-1===t&&0===e.trim().length&&(t=i)}),-1!==t&&(this.editor.setCursor({line:t,ch:2}),0===e[t].length&&this.editor.indentLine(t,"add"))}})},a=function(){return new i("css",{editor:!0,label:"CSS"})},l=function(){return new i("javascript",{editor:!0,label:"JavaScript"})},d=function(){return new i("console",{label:"Console"})},u=function(){return new i("live",{label:"Output",show:function(){n.ready&&renderLivePreview()},hide:function(){n.named.console.visible}})},c=n.named={};c.html=r(),c.css=a(),c.javascript=l(),c.console=d(),upgradeConsolePanel(c.console),c.live=u(),c.live.settings.render=function(e){n.ready&&renderLivePreview(e)},n.allEditors=function(e){var t,i;for(t in n.named)(i=n.named[t]).editor&&e(i)},setTimeout(function(){n.restore()},10),n.focus(n.getVisible()[0]||null);var h=setInterval(function(){var i,s,o=!0,r=null,a=window.location.hash.substring(1);for(s in n.named)if((i=n.named[s]).visible&&!i.ready){o=!1;break}if(n.ready=o,o){n.allEditors(function(e){var t=e.id.substr(0,1).toUpperCase()+":L";if(-1!==a.indexOf(t)){var i=a.match(new RegExp(t+"(\\d+(?:-\\d+)?)"));null!==i&&e.editor.highlightLines(i[1])}});var l=e("li.add-library"),d=e("li.run-with-js");c.live.on("hide",function(){l.show(),d.hide()}),c.live.on("show",function(){l.hide(),d.show()}),n.named.live.visible?c.live.trigger("show"):c.live.trigger("hide"),clearInterval(h),n.named.console.visible?c.console.render():renderLivePreview(),t.mobile||e(window).resize(function(){clearTimeout(r),r=setTimeout(function(){$document.trigger("sizeeditors")},100)}),$document.trigger("sizeeditors"),$document.trigger("jsbinReady")}},100);return setTimeout(function(){n.restore()},10),n.focus(n.getVisible()[0]||null),t.codepan.panels=n});
//# sourceMappingURL=../sourcemaps/editors/panels.js.map
