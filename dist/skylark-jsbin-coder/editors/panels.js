/**
 * skylark-jsbin-coder - A version of jsbin-editor  that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-jsbin-coder/
 * @license MIT
 */
define(["skylark-jquery","skylark-jsbin-base/storage","skylark-jsbin-processors","../jsbin","./panel"],function(e,t,i,n,s){var r={};function o(e){var t=["live","javascript","html","css","console"];return e.split(",").reduce(function(e,i){return"js"===i&&(i="javascript"),"output"===i&&(i="live"),-1!==t.indexOf(i)&&e.push(i),e},[])}r.getVisible=function(){var e=this.named,t=[];for(var i in e)e[i].visible&&t.push(e[i]);return t},r.save=function(){if(!n.embed){for(var i,s=this.getVisible(),r={},o="",a=e(window).width(),l=0;l<s.length;l++)-1===(o=(i=s[l]).$el.css("left")).indexOf("%")&&(o=parseFloat(o)/a*100+"%"),r[i.name]=o;t.sessionStorage.setItem("jsbin.panels",JSON.stringify(r))}},r.restore=function(){"use strict";var i=window.location,s=i.search.substring(1),a=i.hash.substring(1),l=[],d=n.embed?null:JSON.parse(t.sessionStorage.getItem("jsbin.panels")||"null"),u=f.javascript.getCode().length,c=f.css.getCode().length,h=f.html.getCode().length,p="",v=0,g=null,m=[],b="",w=!1,y=$window.width(),j=!!t.sessionStorage.getItem("panel"),C="live javascript html css console".split(" ");if(history.replaceState&&-1!==i.pathname.indexOf("/edit")||(i.origin,i.pathname,n.getURL()),s||a){var O=s||a;-1!==O.indexOf("&")?(O=function(t){var i={},n=/\+/g,s=(t=t.split("&")).length;s>1e3&&(s=1e3);for(var r=0;r<s;++r){var o,a,l,d,u=t[r].replace(n,"%20"),c=u.indexOf("=");c>=0?(o=u.substr(0,c),a=u.substr(c+1)):(o=u,a="");try{l=decodeURIComponent(o),d=decodeURIComponent(a)}catch(e){l=o,d=a}(window.hasOwnProperty?window.hasOwnProperty(i,l):i.hasOwnProperty(l))?e.isArray(i[l])?i[l].push(d):i[l]=[i[l],d]:i[l]=d}return i}(s||a),l=Object.keys(O).reduce(function(e,t){return-1!==t.indexOf(",")&&""===O[t]?e=o(t):("js"===t&&(O.javascript=O.js,t="javascript"),"output"===t&&(O.live=O.live,t="live"),void 0===O[t]&&(O[t]=""),-1!==C.indexOf(t)&&e.push(t+"="+O[t]),e)},[])):l=o(O)}if(0===l.length&&(l=null!==d?Object.keys(d):n.mobile?[n.settings.panels[0]]:n.settings.panels),0===l.length&&(u&&l.push("javascript"),h&&l.push("html"),c&&l.push("css"),l.push("live")),r.saveOnExit=!0,v=0,0===l.length&&(l=["html","live"]),l.length){for(p in d)-1!==l.indexOf(p)&&v++;for(v===l.length&&(w=!0),v=0;v<l.length;v++)b=null,-1!==(p=l[v]).indexOf("=")&&(b=p.substring(p.indexOf("=")+1),p=p.substring(0,p.indexOf("="))),r.named[p]?((g=r.named[p]).editor&&null!==b&&g.setCode(decodeURIComponent(b)),w&&l.length>1?g.show(y*parseFloat(d[p])/100):g.show(),m.push(g)):p&&null!==b&&function(e,t){var i=["html","javascript","css"],n=function(s,o){var a,l,d=r.named[o.panelId]||{};if(o.panelId&&d.editor&&!0===d.ready){i.splice(i.indexOf(o.panelId),1);try{a=d.getCode()}catch(e){}-1!==a.indexOf("%"+e+"%")&&(a=(l=a.split("%"+e+"%"))[0]+decodeURIComponent(t)+l[1],d.setCode(a),$document.unbind("codeChange",n))}0===i.length&&$document.unbind("codeChange",n)};$document.bind("codeChange",n)}(p,b);1===l.length&&"preview"===l[0]&&r.named.live.show(),w||this.distribute()}for(v=0;v<m.length;v++)m[v].init();var x=r.getVisible();x.length&&($body.addClass("panelsVisible"),j||x[0].show())},r.savecontent=function(){var e,i;for(e in this.named)(i=this.named[e]).editor&&t.sessionStorage.setItem("jsbin.content."+e,i.getCode())},r.getHighlightLines=function(){"use strict";var e,t=[],i="";for(name in r.named)(e=r.named[name]).editor&&(i=e.editor.highlightLines().string)&&t.push(name.substr(0,1).toUpperCase()+":L"+i);return t.join(",")},r.focus=function(t){this.focused=t,t&&e(".panel").removeClass("focus").filter("."+t.id).addClass("focus")},r.getQuery=function(){var e={javascript:"js",live:"output"};return r.getVisible().map(function(t){return e[t.id]||t.id}).join(",")},r.updateQuery=n.throttle(function(){var t=r.getQuery();n.state.code&&n.state.owner&&e.ajax({url:n.getURL({withRevision:!0})+"/settings",type:"PUT",data:{panels:visible.map(function(e){return e.id})},success:function(){}}),history.replaceState&&history.replaceState(null,null,"?"+t)},100);var a=!e("html").hasClass("layout");a||e("#source").removeClass("stretch"),r.distribute=function(){if(a){var t,i=e("#source .panelwrapper:visible"),s=100,o=0,l=$window.width()-(i.length-1),d=e("#source").outerHeight(),u=0,c=0,h=0,f=[];if(i.length){$body.addClass("panelsVisible"),s=100/i.length;for(var p=0;p<i.length;p++)c=100-s*(p+1),(t=e.data(i[p],"panel")).$el.css({top:0,bottom:0,left:u+"%",right:c+"%"}),t.splitter.trigger("init",l*u/100),t.splitter[0==p?"hide":"show"](),u+=s,(f=e(i[p]).find(".panel")).length>1&&(h=0,f=f.filter(":visible"),o=100/f.length,f.each(function(t){bottom=100-o*(t+1);var i=r.named[e.data(this,"name")];e(this).css("top",h+"%"),e(this).css("bottom",bottom+"%"),i.splitter.hasClass("vertical")&&(i.splitter.trigger("init",d*h/100),i.splitter[0==t?"hide":"show"]()),h+=o}))}else n.embed||(e("#history").show(),setTimeout(function(){$body.removeClass("panelsVisible")},100))}},r.show=function(e){this.named[e].show(),this.named[e].editor&&this.named[e].editor.focus(),this.named[e].focus()},r.hide=function(t){e("#history");var i=this.named;i[t].visible&&i[t].hide();var n=i.getVisible();n.length&&(i.focused=n[0],i.focused.editor?i.focused.editor.focus():i.focused.$el.focus(),i.focused.focus())},r.hideAll=function(e){for(var t=r.getVisible(),i=t.length;i--;)t[i].hide(e)},s.prototype.distribute=function(){r.distribute()};var l=function(){return new s("html",{editor:!0,label:"HTML",init:function(){var e=this.editor.getValue().split("\n"),t=-1;e.forEach(function(e,i){-1===t&&0===e.trim().length&&(t=i)}),-1!==t&&(this.editor.setCursor({line:t,ch:2}),0===e[t].length&&this.editor.indentLine(t,"add"))}})},d=function(){return new s("css",{editor:!0,label:"CSS"})},u=function(){return new s("javascript",{editor:!0,label:"JavaScript"})},c=function(){return new s("console",{label:"Console"})},h=function(){return new s("live",{label:"Output",show:function(){r.ready&&renderLivePreview()},hide:function(){r.named.console.visible}})},f=r.named={};f.html=l(),f.css=d(),f.javascript=u(),f.console=c(),f.live=h(),f.live.settings.render=function(e){r.ready&&renderLivePreview(e)},r.allEditors=function(e){var t,i;for(t in r.named)(i=r.named[t]).editor&&e(i)},setTimeout(function(){r.restore()},10),r.focus(r.getVisible()[0]||null);var p=setInterval(function(){var t,i,s=!0,o=null,a=window.location.hash.substring(1);for(i in r.named)if((t=r.named[i]).visible&&!t.ready){s=!1;break}if(r.ready=s,s){r.allEditors(function(e){var t=e.id.substr(0,1).toUpperCase()+":L";if(-1!==a.indexOf(t)){var i=a.match(new RegExp(t+"(\\d+(?:-\\d+)?)"));null!==i&&e.editor.highlightLines(i[1])}});var l=e("li.add-library"),d=e("li.run-with-js");f.live.on("hide",function(){l.show(),d.hide()}),f.live.on("show",function(){l.hide(),d.show()}),r.named.live.visible?f.live.trigger("show"):f.live.trigger("hide"),clearInterval(p),r.named.console.visible?f.console.render():renderLivePreview(),n.mobile||e(window).resize(function(){clearTimeout(o),o=setTimeout(function(){$document.trigger("sizeeditors")},100)}),$document.trigger("sizeeditors"),$document.trigger("jsbinReady")}},100);setTimeout(function(){r.restore()},10),r.focus(r.getVisible()[0]||null);var v=function(){n.panels.ready&&f.console.render()},g=e("#panels"),m=(e("div.processorSelector").each(function(){var t=this.getAttribute("data-type"),s=e(this),r=s.closest(".label").find("strong a"),o=r.text();s.find("a").click(function(s){var a=n.panels.named[t],l=g.find('a[href$="'+t+'"]');s.preventDefault();var d=this.hash.substring(1),u=e(this).text(),c=e(this).data("label");"convert"!==d?(l.html(c||u),r.html("<span>"+u+"</span>"),d===t?(i.reset(t),v()):i.set(t,d,v)):(r.text(o),l.html(o),a.render().then(function(e){i.reset(t),a.setCode(e)}))}).bind("select",function(i,n){if(n===this.hash.substring(1)){var s=g.find('a[href$="'+t+'"]'),o=e(this);r.html("<span>"+o.text()+"</span>"),s.html(o.data("label")||o.text())}})}),i.set);return i.set=function(e,t,i){var r;r=e instanceof s?e:n.panels.named[e],m(r,t,i)},i.reset=function(e){i.set(e)},n.coder.panels=r});
//# sourceMappingURL=../sourcemaps/editors/panels.js.map
