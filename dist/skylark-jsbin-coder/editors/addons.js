/**
 * skylark-jsbin-coder - A version of jsbin-editor  that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-jsbin-coder/
 * @license MIT
 */
define(["skylark-jquery","../jsbin","../coder","./codemirror","./panels","./tern"],function(e,t,n,i,o){"use strict";if(!t.embed&&!t.mobile){var r=t.state.processors;t.settings.addons||(t.settings.addons={closebrackets:!0,highlight:!1,vim:!1,emacs:!1,trailingspace:!1,fold:!1,sublime:!1,tern:!1,activeline:!0,matchbrackets:!1});var s="open"in document.createElement("details"),l={},a={};["js","html","coffeescript","css"].forEach(function(e){var n=e+"hint",i=!1;"js"===e&&(i=!0),l[n]=void 0!==t.settings[n]?t.settings[n]:i}),(a=e.extend({},{console:!0,line:!1,under:!1,gutter:!1},t.settings.hintShow)).tooltip=a.gutter;var c=e.extend({},t.settings.addons,l),u={closebrackets:{url:[],test:h("autoCloseBrackets"),done:function(e){m(e,"autoCloseBrackets",!0)}},highlight:{url:[],test:h("highlightSelectionMatches"),done:function(e){m(e,"highlightSelectionMatches",!0)}},vim:{url:[],test:h("vimMode"),done:function(e){m(e,"vimMode",!0),m(e,"showCursorWhenSelecting",!0)}},emacs:{url:[],test:function(){return i.keyMap.emacs},done:function(e){m(e,"keyMap","emacs")}},matchtags:{url:[],test:function(){return i.scanForClosingTag&&i.optionHandlers.matchTags},done:function(e){m(e,"matchTags",{bothTags:!0}),e.addKeyMap({"Ctrl-J":"toMatchingTag"})}},trailingspace:{url:[],test:h("showTrailingSpace"),done:function(e){m(e,"showTrailingSpace",!0)}},fold:{url:[],test:function(){return i.helpers.fold&&i.optionHandlers.foldGutter&&i.optionHandlers.gutters},done:function(e){d.addClass("code-fold"),e.addKeyMap({"Ctrl-Q":function(e){e.foldCode(e.getCursor())}}),m(e,"foldGutter",!0);var t=e.getOption("gutters").slice();t.push("CodeMirror-foldgutter"),m(e,"gutters",t)}},sublime:{url:[],test:function(){return i.keyMap.sublime},done:function(t){m(t,"keyMap","sublime");var n="mac"===e.browser.platform?"Cmd":"Ctrl";delete i.keyMap.sublime[n+"-L"],delete i.keyMap.sublime[n+"-T"],delete i.keyMap.sublime[n+"-W"],delete i.keyMap.sublime[n+"-J"],delete i.keyMap.sublime[n+"-R"],delete i.keyMap.sublime[n+"-Enter"],delete i.keyMap.sublime[n+"-Up"],delete i.keyMap.sublime[n+"-Down"],i.keyMap.sublime["Shift-Tab"]="indentAuto",t.removeKeyMap("noEmmet")}},tern:{url:[],test:function(){return void 0!==window.ternBasicDefs&&i.showHint&&i.TernServer&&i.startTern},done:function(){i.startTern()}},activeline:{url:[],test:function(){return void 0!==i.defaults.styleActiveLine},done:function(e){m(e,"styleActiveLine",!0)}},matchbrackets:{url:[],test:function(){return void 0!==i.defaults.matchBrackets},done:function(e){m(e,"matchBrackets",!0)}},csshint:{url:[],test:function(){return g("css")&&"undefined"!=typeof CSSLint},done:function(e){"css"===e.getOption("mode")&&(void 0!==r.css&&"css"!==r.css||hintingDone(e))}},jshint:{url:[],test:function(){return g("javascript")&&"undefined"!=typeof JSHINT},done:function(e){"javascript"===e.getOption("mode")&&(void 0!==r.javascript&&"javascript"!==r.javascript||hintingDone(e,{eqnull:!0}))}},htmlhint:{url:[],test:function(){return g("htmlmixed")&&"undefined"!=typeof HTMLHint},done:function(e){"htmlmixed"===e.getOption("mode")&&(void 0!==r.html&&"html"!==r.html||hintingDone(e))}},coffeescripthint:{url:[],test:function(){return g("coffeescript")&&"undefined"!=typeof coffeelint},done:function(e){"coffeescript"===e.getOption("mode")&&"coffeescript"===t.state.processors.javascript&&hintingDone(e)}}},d=e("body");window.hintingDone=function(n,i){var o=n.getOption("mode");"javascript"===o&&(o="js"),"htmlmixed"===o&&(o="html");var r=e.extend({},a);if(r.consoleParent=n.getWrapperElement().parentNode.parentNode,m(n,"lintOpt",r),r.gutter){var l=n.getOption("gutters");if(-1===l.indexOf("CodeMirror-lint-markers")){var c=l.slice();c.push("CodeMirror-lint-markers"),m(n,"gutters",c)}var u=n.getOption("lineNumbers");m(n,"lineNumbers",!u),m(n,"lineNumbers",u)}m(n,"lint",{delay:800,options:e.extend({},i,t.settings[o+"hintOptions"])}),r.console&&n.consolelint&&($document.trigger("sizeeditors"),e(n.consolelint.head).on("click",function(){s||e(this).nextAll().toggle(),setTimeout(function(){$document.trigger("sizeeditors")},10)}))};var f=Object.keys(c);f.forEach(v),window.reloadAddons=function(e){e?e.forEach(v):f.forEach(v)}}function p(n){if(0!==n.indexOf("http")&&(n=t.static+n),".js"===n.slice(-3))return e.ajax({url:n+"?"+t.version,dataType:"script",cache:!0});if(".css"===n.slice(-4)){var i=e.Deferred();return setTimeout(function(){d.append('<link rel="stylesheet" href="'+n+"?"+t.version+'">'),i.resolve()},0),i}}function m(e,t,n){e.setOption(t,n)}function h(e){return function(){return void 0!==i.optionHandlers[e]}}function g(e){return void 0!==i.defaults.lint&&i.helpers.lint&&i.helpers.lint[e]&&i.optionHandlers.lint}function v(t){var n=u[t];n&&c[t]&&("string"==typeof n.url&&(n.url=[n.url]),e.when.call(e,n.url.map(p)).done(function(){n.done&&function(t){var n=e.Deferred(),i=null;if(t())n.resolve();else{var o=(new Date).getTime(),r=new Date;i=setInterval(function(){r=new Date,t()?(clearInterval(i),n.resolve()):r.getTime()-o>1e4&&(clearInterval(i),n.reject())},100)}return n}(n.test).then(function(){o.allEditors(function(e){e.editor&&n.done(e.editor)})})}))}});
//# sourceMappingURL=../sourcemaps/editors/addons.js.map
