{"version":3,"sources":["skylark-jsbin-coder.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"../skylark-jsbin-coder.js","sourcesContent":["define('skylark-jsbin-coder/jsbin',[\r\n  \"skylark-jsbin-base\"\r\n],function(jsbin){\r\n  return jsbin;\r\n});\r\n\r\n\ndefine('skylark-jsbin-coder/coder',[\r\n\t\"./jsbin\"\r\n],function(jsbin){\r\n\treturn jsbin.coder = {\r\n\t\teditors : {},\r\n\t\trender : {}\r\n\t};\r\n});\n// CodeMirror, copyright (c) by Marijn Haverbeke and others\r\n// Distributed under an MIT license: https://codemirror.net/LICENSE\r\n\r\ndefine('skylark-codemirror/mode/xml/xml',[\"../../CodeMirror\"], function(CodeMirror) {\r\n\r\n\r\nvar htmlConfig = {\r\n  autoSelfClosers: {'area': true, 'base': true, 'br': true, 'col': true, 'command': true,\r\n                    'embed': true, 'frame': true, 'hr': true, 'img': true, 'input': true,\r\n                    'keygen': true, 'link': true, 'meta': true, 'param': true, 'source': true,\r\n                    'track': true, 'wbr': true, 'menuitem': true},\r\n  implicitlyClosed: {'dd': true, 'li': true, 'optgroup': true, 'option': true, 'p': true,\r\n                     'rp': true, 'rt': true, 'tbody': true, 'td': true, 'tfoot': true,\r\n                     'th': true, 'tr': true},\r\n  contextGrabbers: {\r\n    'dd': {'dd': true, 'dt': true},\r\n    'dt': {'dd': true, 'dt': true},\r\n    'li': {'li': true},\r\n    'option': {'option': true, 'optgroup': true},\r\n    'optgroup': {'optgroup': true},\r\n    'p': {'address': true, 'article': true, 'aside': true, 'blockquote': true, 'dir': true,\r\n          'div': true, 'dl': true, 'fieldset': true, 'footer': true, 'form': true,\r\n          'h1': true, 'h2': true, 'h3': true, 'h4': true, 'h5': true, 'h6': true,\r\n          'header': true, 'hgroup': true, 'hr': true, 'menu': true, 'nav': true, 'ol': true,\r\n          'p': true, 'pre': true, 'section': true, 'table': true, 'ul': true},\r\n    'rp': {'rp': true, 'rt': true},\r\n    'rt': {'rp': true, 'rt': true},\r\n    'tbody': {'tbody': true, 'tfoot': true},\r\n    'td': {'td': true, 'th': true},\r\n    'tfoot': {'tbody': true},\r\n    'th': {'td': true, 'th': true},\r\n    'thead': {'tbody': true, 'tfoot': true},\r\n    'tr': {'tr': true}\r\n  },\r\n  doNotIndent: {\"pre\": true},\r\n  allowUnquoted: true,\r\n  allowMissing: true,\r\n  caseFold: true\r\n}\r\n\r\nvar xmlConfig = {\r\n  autoSelfClosers: {},\r\n  implicitlyClosed: {},\r\n  contextGrabbers: {},\r\n  doNotIndent: {},\r\n  allowUnquoted: false,\r\n  allowMissing: false,\r\n  allowMissingTagName: false,\r\n  caseFold: false\r\n}\r\n\r\nCodeMirror.defineMode(\"xml\", function(editorConf, config_) {\r\n  var indentUnit = editorConf.indentUnit\r\n  var config = {}\r\n  var defaults = config_.htmlMode ? htmlConfig : xmlConfig\r\n  for (var prop in defaults) config[prop] = defaults[prop]\r\n  for (var prop in config_) config[prop] = config_[prop]\r\n\r\n  // Return variables for tokenizers\r\n  var type, setStyle;\r\n\r\n  function inText(stream, state) {\r\n    function chain(parser) {\r\n      state.tokenize = parser;\r\n      return parser(stream, state);\r\n    }\r\n\r\n    var ch = stream.next();\r\n    if (ch == \"<\") {\r\n      if (stream.eat(\"!\")) {\r\n        if (stream.eat(\"[\")) {\r\n          if (stream.match(\"CDATA[\")) return chain(inBlock(\"atom\", \"]]>\"));\r\n          else return null;\r\n        } else if (stream.match(\"--\")) {\r\n          return chain(inBlock(\"comment\", \"-->\"));\r\n        } else if (stream.match(\"DOCTYPE\", true, true)) {\r\n          stream.eatWhile(/[\\w\\._\\-]/);\r\n          return chain(doctype(1));\r\n        } else {\r\n          return null;\r\n        }\r\n      } else if (stream.eat(\"?\")) {\r\n        stream.eatWhile(/[\\w\\._\\-]/);\r\n        state.tokenize = inBlock(\"meta\", \"?>\");\r\n        return \"meta\";\r\n      } else {\r\n        type = stream.eat(\"/\") ? \"closeTag\" : \"openTag\";\r\n        state.tokenize = inTag;\r\n        return \"tag bracket\";\r\n      }\r\n    } else if (ch == \"&\") {\r\n      var ok;\r\n      if (stream.eat(\"#\")) {\r\n        if (stream.eat(\"x\")) {\r\n          ok = stream.eatWhile(/[a-fA-F\\d]/) && stream.eat(\";\");\r\n        } else {\r\n          ok = stream.eatWhile(/[\\d]/) && stream.eat(\";\");\r\n        }\r\n      } else {\r\n        ok = stream.eatWhile(/[\\w\\.\\-:]/) && stream.eat(\";\");\r\n      }\r\n      return ok ? \"atom\" : \"error\";\r\n    } else {\r\n      stream.eatWhile(/[^&<]/);\r\n      return null;\r\n    }\r\n  }\r\n  inText.isInText = true;\r\n\r\n  function inTag(stream, state) {\r\n    var ch = stream.next();\r\n    if (ch == \">\" || (ch == \"/\" && stream.eat(\">\"))) {\r\n      state.tokenize = inText;\r\n      type = ch == \">\" ? \"endTag\" : \"selfcloseTag\";\r\n      return \"tag bracket\";\r\n    } else if (ch == \"=\") {\r\n      type = \"equals\";\r\n      return null;\r\n    } else if (ch == \"<\") {\r\n      state.tokenize = inText;\r\n      state.state = baseState;\r\n      state.tagName = state.tagStart = null;\r\n      var next = state.tokenize(stream, state);\r\n      return next ? next + \" tag error\" : \"tag error\";\r\n    } else if (/[\\'\\\"]/.test(ch)) {\r\n      state.tokenize = inAttribute(ch);\r\n      state.stringStartCol = stream.column();\r\n      return state.tokenize(stream, state);\r\n    } else {\r\n      stream.match(/^[^\\s\\u00a0=<>\\\"\\']*[^\\s\\u00a0=<>\\\"\\'\\/]/);\r\n      return \"word\";\r\n    }\r\n  }\r\n\r\n  function inAttribute(quote) {\r\n    var closure = function(stream, state) {\r\n      while (!stream.eol()) {\r\n        if (stream.next() == quote) {\r\n          state.tokenize = inTag;\r\n          break;\r\n        }\r\n      }\r\n      return \"string\";\r\n    };\r\n    closure.isInAttribute = true;\r\n    return closure;\r\n  }\r\n\r\n  function inBlock(style, terminator) {\r\n    return function(stream, state) {\r\n      while (!stream.eol()) {\r\n        if (stream.match(terminator)) {\r\n          state.tokenize = inText;\r\n          break;\r\n        }\r\n        stream.next();\r\n      }\r\n      return style;\r\n    }\r\n  }\r\n\r\n  function doctype(depth) {\r\n    return function(stream, state) {\r\n      var ch;\r\n      while ((ch = stream.next()) != null) {\r\n        if (ch == \"<\") {\r\n          state.tokenize = doctype(depth + 1);\r\n          return state.tokenize(stream, state);\r\n        } else if (ch == \">\") {\r\n          if (depth == 1) {\r\n            state.tokenize = inText;\r\n            break;\r\n          } else {\r\n            state.tokenize = doctype(depth - 1);\r\n            return state.tokenize(stream, state);\r\n          }\r\n        }\r\n      }\r\n      return \"meta\";\r\n    };\r\n  }\r\n\r\n  function Context(state, tagName, startOfLine) {\r\n    this.prev = state.context;\r\n    this.tagName = tagName;\r\n    this.indent = state.indented;\r\n    this.startOfLine = startOfLine;\r\n    if (config.doNotIndent.hasOwnProperty(tagName) || (state.context && state.context.noIndent))\r\n      this.noIndent = true;\r\n  }\r\n  function popContext(state) {\r\n    if (state.context) state.context = state.context.prev;\r\n  }\r\n  function maybePopContext(state, nextTagName) {\r\n    var parentTagName;\r\n    while (true) {\r\n      if (!state.context) {\r\n        return;\r\n      }\r\n      parentTagName = state.context.tagName;\r\n      if (!config.contextGrabbers.hasOwnProperty(parentTagName) ||\r\n          !config.contextGrabbers[parentTagName].hasOwnProperty(nextTagName)) {\r\n        return;\r\n      }\r\n      popContext(state);\r\n    }\r\n  }\r\n\r\n  function baseState(type, stream, state) {\r\n    if (type == \"openTag\") {\r\n      state.tagStart = stream.column();\r\n      return tagNameState;\r\n    } else if (type == \"closeTag\") {\r\n      return closeTagNameState;\r\n    } else {\r\n      return baseState;\r\n    }\r\n  }\r\n  function tagNameState(type, stream, state) {\r\n    if (type == \"word\") {\r\n      state.tagName = stream.current();\r\n      setStyle = \"tag\";\r\n      return attrState;\r\n    } else if (config.allowMissingTagName && type == \"endTag\") {\r\n      setStyle = \"tag bracket\";\r\n      return attrState(type, stream, state);\r\n    } else {\r\n      setStyle = \"error\";\r\n      return tagNameState;\r\n    }\r\n  }\r\n  function closeTagNameState(type, stream, state) {\r\n    if (type == \"word\") {\r\n      var tagName = stream.current();\r\n      if (state.context && state.context.tagName != tagName &&\r\n          config.implicitlyClosed.hasOwnProperty(state.context.tagName))\r\n        popContext(state);\r\n      if ((state.context && state.context.tagName == tagName) || config.matchClosing === false) {\r\n        setStyle = \"tag\";\r\n        return closeState;\r\n      } else {\r\n        setStyle = \"tag error\";\r\n        return closeStateErr;\r\n      }\r\n    } else if (config.allowMissingTagName && type == \"endTag\") {\r\n      setStyle = \"tag bracket\";\r\n      return closeState(type, stream, state);\r\n    } else {\r\n      setStyle = \"error\";\r\n      return closeStateErr;\r\n    }\r\n  }\r\n\r\n  function closeState(type, _stream, state) {\r\n    if (type != \"endTag\") {\r\n      setStyle = \"error\";\r\n      return closeState;\r\n    }\r\n    popContext(state);\r\n    return baseState;\r\n  }\r\n  function closeStateErr(type, stream, state) {\r\n    setStyle = \"error\";\r\n    return closeState(type, stream, state);\r\n  }\r\n\r\n  function attrState(type, _stream, state) {\r\n    if (type == \"word\") {\r\n      setStyle = \"attribute\";\r\n      return attrEqState;\r\n    } else if (type == \"endTag\" || type == \"selfcloseTag\") {\r\n      var tagName = state.tagName, tagStart = state.tagStart;\r\n      state.tagName = state.tagStart = null;\r\n      if (type == \"selfcloseTag\" ||\r\n          config.autoSelfClosers.hasOwnProperty(tagName)) {\r\n        maybePopContext(state, tagName);\r\n      } else {\r\n        maybePopContext(state, tagName);\r\n        state.context = new Context(state, tagName, tagStart == state.indented);\r\n      }\r\n      return baseState;\r\n    }\r\n    setStyle = \"error\";\r\n    return attrState;\r\n  }\r\n  function attrEqState(type, stream, state) {\r\n    if (type == \"equals\") return attrValueState;\r\n    if (!config.allowMissing) setStyle = \"error\";\r\n    return attrState(type, stream, state);\r\n  }\r\n  function attrValueState(type, stream, state) {\r\n    if (type == \"string\") return attrContinuedState;\r\n    if (type == \"word\" && config.allowUnquoted) {setStyle = \"string\"; return attrState;}\r\n    setStyle = \"error\";\r\n    return attrState(type, stream, state);\r\n  }\r\n  function attrContinuedState(type, stream, state) {\r\n    if (type == \"string\") return attrContinuedState;\r\n    return attrState(type, stream, state);\r\n  }\r\n\r\n  return {\r\n    startState: function(baseIndent) {\r\n      var state = {tokenize: inText,\r\n                   state: baseState,\r\n                   indented: baseIndent || 0,\r\n                   tagName: null, tagStart: null,\r\n                   context: null}\r\n      if (baseIndent != null) state.baseIndent = baseIndent\r\n      return state\r\n    },\r\n\r\n    token: function(stream, state) {\r\n      if (!state.tagName && stream.sol())\r\n        state.indented = stream.indentation();\r\n\r\n      if (stream.eatSpace()) return null;\r\n      type = null;\r\n      var style = state.tokenize(stream, state);\r\n      if ((style || type) && style != \"comment\") {\r\n        setStyle = null;\r\n        state.state = state.state(type || style, stream, state);\r\n        if (setStyle)\r\n          style = setStyle == \"error\" ? style + \" error\" : setStyle;\r\n      }\r\n      return style;\r\n    },\r\n\r\n    indent: function(state, textAfter, fullLine) {\r\n      var context = state.context;\r\n      // Indent multi-line strings (e.g. css).\r\n      if (state.tokenize.isInAttribute) {\r\n        if (state.tagStart == state.indented)\r\n          return state.stringStartCol + 1;\r\n        else\r\n          return state.indented + indentUnit;\r\n      }\r\n      if (context && context.noIndent) return CodeMirror.Pass;\r\n      if (state.tokenize != inTag && state.tokenize != inText)\r\n        return fullLine ? fullLine.match(/^(\\s*)/)[0].length : 0;\r\n      // Indent the starts of attribute names.\r\n      if (state.tagName) {\r\n        if (config.multilineTagIndentPastTag !== false)\r\n          return state.tagStart + state.tagName.length + 2;\r\n        else\r\n          return state.tagStart + indentUnit * (config.multilineTagIndentFactor || 1);\r\n      }\r\n      if (config.alignCDATA && /<!\\[CDATA\\[/.test(textAfter)) return 0;\r\n      var tagAfter = textAfter && /^<(\\/)?([\\w_:\\.-]*)/.exec(textAfter);\r\n      if (tagAfter && tagAfter[1]) { // Closing tag spotted\r\n        while (context) {\r\n          if (context.tagName == tagAfter[2]) {\r\n            context = context.prev;\r\n            break;\r\n          } else if (config.implicitlyClosed.hasOwnProperty(context.tagName)) {\r\n            context = context.prev;\r\n          } else {\r\n            break;\r\n          }\r\n        }\r\n      } else if (tagAfter) { // Opening tag spotted\r\n        while (context) {\r\n          var grabbers = config.contextGrabbers[context.tagName];\r\n          if (grabbers && grabbers.hasOwnProperty(tagAfter[2]))\r\n            context = context.prev;\r\n          else\r\n            break;\r\n        }\r\n      }\r\n      while (context && context.prev && !context.startOfLine)\r\n        context = context.prev;\r\n      if (context) return context.indent + indentUnit;\r\n      else return state.baseIndent || 0;\r\n    },\r\n\r\n    electricInput: /<\\/[\\s\\w:]+>$/,\r\n    blockCommentStart: \"<!--\",\r\n    blockCommentEnd: \"-->\",\r\n\r\n    configuration: config.htmlMode ? \"html\" : \"xml\",\r\n    helperType: config.htmlMode ? \"html\" : \"xml\",\r\n\r\n    skipAttribute: function(state) {\r\n      if (state.state == attrValueState)\r\n        state.state = attrState\r\n    }\r\n  };\r\n});\r\n\r\nCodeMirror.defineMIME(\"text/xml\", \"xml\");\r\nCodeMirror.defineMIME(\"application/xml\", \"xml\");\r\nif (!CodeMirror.mimeModes.hasOwnProperty(\"text/html\"))\r\n  CodeMirror.defineMIME(\"text/html\", {name: \"xml\", htmlMode: true});\r\n\r\n});\r\n\n// CodeMirror, copyright (c) by Marijn Haverbeke and others\r\n// Distributed under an MIT license: https://codemirror.net/LICENSE\r\n\r\ndefine('skylark-codemirror/mode/css/css',[\"../../CodeMirror\"], function(CodeMirror) {\r\n\r\n\r\nCodeMirror.defineMode(\"css\", function(config, parserConfig) {\r\n  var inline = parserConfig.inline\r\n  if (!parserConfig.propertyKeywords) parserConfig = CodeMirror.resolveMode(\"text/css\");\r\n\r\n  var indentUnit = config.indentUnit,\r\n      tokenHooks = parserConfig.tokenHooks,\r\n      documentTypes = parserConfig.documentTypes || {},\r\n      mediaTypes = parserConfig.mediaTypes || {},\r\n      mediaFeatures = parserConfig.mediaFeatures || {},\r\n      mediaValueKeywords = parserConfig.mediaValueKeywords || {},\r\n      propertyKeywords = parserConfig.propertyKeywords || {},\r\n      nonStandardPropertyKeywords = parserConfig.nonStandardPropertyKeywords || {},\r\n      fontProperties = parserConfig.fontProperties || {},\r\n      counterDescriptors = parserConfig.counterDescriptors || {},\r\n      colorKeywords = parserConfig.colorKeywords || {},\r\n      valueKeywords = parserConfig.valueKeywords || {},\r\n      allowNested = parserConfig.allowNested,\r\n      lineComment = parserConfig.lineComment,\r\n      supportsAtComponent = parserConfig.supportsAtComponent === true;\r\n\r\n  var type, override;\r\n  function ret(style, tp) { type = tp; return style; }\r\n\r\n  // Tokenizers\r\n\r\n  function tokenBase(stream, state) {\r\n    var ch = stream.next();\r\n    if (tokenHooks[ch]) {\r\n      var result = tokenHooks[ch](stream, state);\r\n      if (result !== false) return result;\r\n    }\r\n    if (ch == \"@\") {\r\n      stream.eatWhile(/[\\w\\\\\\-]/);\r\n      return ret(\"def\", stream.current());\r\n    } else if (ch == \"=\" || (ch == \"~\" || ch == \"|\") && stream.eat(\"=\")) {\r\n      return ret(null, \"compare\");\r\n    } else if (ch == \"\\\"\" || ch == \"'\") {\r\n      state.tokenize = tokenString(ch);\r\n      return state.tokenize(stream, state);\r\n    } else if (ch == \"#\") {\r\n      stream.eatWhile(/[\\w\\\\\\-]/);\r\n      return ret(\"atom\", \"hash\");\r\n    } else if (ch == \"!\") {\r\n      stream.match(/^\\s*\\w*/);\r\n      return ret(\"keyword\", \"important\");\r\n    } else if (/\\d/.test(ch) || ch == \".\" && stream.eat(/\\d/)) {\r\n      stream.eatWhile(/[\\w.%]/);\r\n      return ret(\"number\", \"unit\");\r\n    } else if (ch === \"-\") {\r\n      if (/[\\d.]/.test(stream.peek())) {\r\n        stream.eatWhile(/[\\w.%]/);\r\n        return ret(\"number\", \"unit\");\r\n      } else if (stream.match(/^-[\\w\\\\\\-]*/)) {\r\n        stream.eatWhile(/[\\w\\\\\\-]/);\r\n        if (stream.match(/^\\s*:/, false))\r\n          return ret(\"variable-2\", \"variable-definition\");\r\n        return ret(\"variable-2\", \"variable\");\r\n      } else if (stream.match(/^\\w+-/)) {\r\n        return ret(\"meta\", \"meta\");\r\n      }\r\n    } else if (/[,+>*\\/]/.test(ch)) {\r\n      return ret(null, \"select-op\");\r\n    } else if (ch == \".\" && stream.match(/^-?[_a-z][_a-z0-9-]*/i)) {\r\n      return ret(\"qualifier\", \"qualifier\");\r\n    } else if (/[:;{}\\[\\]\\(\\)]/.test(ch)) {\r\n      return ret(null, ch);\r\n    } else if (stream.match(/[\\w-.]+(?=\\()/)) {\r\n      if (/^(url(-prefix)?|domain|regexp)$/.test(stream.current().toLowerCase())) {\r\n        state.tokenize = tokenParenthesized;\r\n      }\r\n      return ret(\"variable callee\", \"variable\");\r\n    } else if (/[\\w\\\\\\-]/.test(ch)) {\r\n      stream.eatWhile(/[\\w\\\\\\-]/);\r\n      return ret(\"property\", \"word\");\r\n    } else {\r\n      return ret(null, null);\r\n    }\r\n  }\r\n\r\n  function tokenString(quote) {\r\n    return function(stream, state) {\r\n      var escaped = false, ch;\r\n      while ((ch = stream.next()) != null) {\r\n        if (ch == quote && !escaped) {\r\n          if (quote == \")\") stream.backUp(1);\r\n          break;\r\n        }\r\n        escaped = !escaped && ch == \"\\\\\";\r\n      }\r\n      if (ch == quote || !escaped && quote != \")\") state.tokenize = null;\r\n      return ret(\"string\", \"string\");\r\n    };\r\n  }\r\n\r\n  function tokenParenthesized(stream, state) {\r\n    stream.next(); // Must be '('\r\n    if (!stream.match(/\\s*[\\\"\\')]/, false))\r\n      state.tokenize = tokenString(\")\");\r\n    else\r\n      state.tokenize = null;\r\n    return ret(null, \"(\");\r\n  }\r\n\r\n  // Context management\r\n\r\n  function Context(type, indent, prev) {\r\n    this.type = type;\r\n    this.indent = indent;\r\n    this.prev = prev;\r\n  }\r\n\r\n  function pushContext(state, stream, type, indent) {\r\n    state.context = new Context(type, stream.indentation() + (indent === false ? 0 : indentUnit), state.context);\r\n    return type;\r\n  }\r\n\r\n  function popContext(state) {\r\n    if (state.context.prev)\r\n      state.context = state.context.prev;\r\n    return state.context.type;\r\n  }\r\n\r\n  function pass(type, stream, state) {\r\n    return states[state.context.type](type, stream, state);\r\n  }\r\n  function popAndPass(type, stream, state, n) {\r\n    for (var i = n || 1; i > 0; i--)\r\n      state.context = state.context.prev;\r\n    return pass(type, stream, state);\r\n  }\r\n\r\n  // Parser\r\n\r\n  function wordAsValue(stream) {\r\n    var word = stream.current().toLowerCase();\r\n    if (valueKeywords.hasOwnProperty(word))\r\n      override = \"atom\";\r\n    else if (colorKeywords.hasOwnProperty(word))\r\n      override = \"keyword\";\r\n    else\r\n      override = \"variable\";\r\n  }\r\n\r\n  var states = {};\r\n\r\n  states.top = function(type, stream, state) {\r\n    if (type == \"{\") {\r\n      return pushContext(state, stream, \"block\");\r\n    } else if (type == \"}\" && state.context.prev) {\r\n      return popContext(state);\r\n    } else if (supportsAtComponent && /@component/i.test(type)) {\r\n      return pushContext(state, stream, \"atComponentBlock\");\r\n    } else if (/^@(-moz-)?document$/i.test(type)) {\r\n      return pushContext(state, stream, \"documentTypes\");\r\n    } else if (/^@(media|supports|(-moz-)?document|import)$/i.test(type)) {\r\n      return pushContext(state, stream, \"atBlock\");\r\n    } else if (/^@(font-face|counter-style)/i.test(type)) {\r\n      state.stateArg = type;\r\n      return \"restricted_atBlock_before\";\r\n    } else if (/^@(-(moz|ms|o|webkit)-)?keyframes$/i.test(type)) {\r\n      return \"keyframes\";\r\n    } else if (type && type.charAt(0) == \"@\") {\r\n      return pushContext(state, stream, \"at\");\r\n    } else if (type == \"hash\") {\r\n      override = \"builtin\";\r\n    } else if (type == \"word\") {\r\n      override = \"tag\";\r\n    } else if (type == \"variable-definition\") {\r\n      return \"maybeprop\";\r\n    } else if (type == \"interpolation\") {\r\n      return pushContext(state, stream, \"interpolation\");\r\n    } else if (type == \":\") {\r\n      return \"pseudo\";\r\n    } else if (allowNested && type == \"(\") {\r\n      return pushContext(state, stream, \"parens\");\r\n    }\r\n    return state.context.type;\r\n  };\r\n\r\n  states.block = function(type, stream, state) {\r\n    if (type == \"word\") {\r\n      var word = stream.current().toLowerCase();\r\n      if (propertyKeywords.hasOwnProperty(word)) {\r\n        override = \"property\";\r\n        return \"maybeprop\";\r\n      } else if (nonStandardPropertyKeywords.hasOwnProperty(word)) {\r\n        override = \"string-2\";\r\n        return \"maybeprop\";\r\n      } else if (allowNested) {\r\n        override = stream.match(/^\\s*:(?:\\s|$)/, false) ? \"property\" : \"tag\";\r\n        return \"block\";\r\n      } else {\r\n        override += \" error\";\r\n        return \"maybeprop\";\r\n      }\r\n    } else if (type == \"meta\") {\r\n      return \"block\";\r\n    } else if (!allowNested && (type == \"hash\" || type == \"qualifier\")) {\r\n      override = \"error\";\r\n      return \"block\";\r\n    } else {\r\n      return states.top(type, stream, state);\r\n    }\r\n  };\r\n\r\n  states.maybeprop = function(type, stream, state) {\r\n    if (type == \":\") return pushContext(state, stream, \"prop\");\r\n    return pass(type, stream, state);\r\n  };\r\n\r\n  states.prop = function(type, stream, state) {\r\n    if (type == \";\") return popContext(state);\r\n    if (type == \"{\" && allowNested) return pushContext(state, stream, \"propBlock\");\r\n    if (type == \"}\" || type == \"{\") return popAndPass(type, stream, state);\r\n    if (type == \"(\") return pushContext(state, stream, \"parens\");\r\n\r\n    if (type == \"hash\" && !/^#([0-9a-fA-f]{3,4}|[0-9a-fA-f]{6}|[0-9a-fA-f]{8})$/.test(stream.current())) {\r\n      override += \" error\";\r\n    } else if (type == \"word\") {\r\n      wordAsValue(stream);\r\n    } else if (type == \"interpolation\") {\r\n      return pushContext(state, stream, \"interpolation\");\r\n    }\r\n    return \"prop\";\r\n  };\r\n\r\n  states.propBlock = function(type, _stream, state) {\r\n    if (type == \"}\") return popContext(state);\r\n    if (type == \"word\") { override = \"property\"; return \"maybeprop\"; }\r\n    return state.context.type;\r\n  };\r\n\r\n  states.parens = function(type, stream, state) {\r\n    if (type == \"{\" || type == \"}\") return popAndPass(type, stream, state);\r\n    if (type == \")\") return popContext(state);\r\n    if (type == \"(\") return pushContext(state, stream, \"parens\");\r\n    if (type == \"interpolation\") return pushContext(state, stream, \"interpolation\");\r\n    if (type == \"word\") wordAsValue(stream);\r\n    return \"parens\";\r\n  };\r\n\r\n  states.pseudo = function(type, stream, state) {\r\n    if (type == \"meta\") return \"pseudo\";\r\n\r\n    if (type == \"word\") {\r\n      override = \"variable-3\";\r\n      return state.context.type;\r\n    }\r\n    return pass(type, stream, state);\r\n  };\r\n\r\n  states.documentTypes = function(type, stream, state) {\r\n    if (type == \"word\" && documentTypes.hasOwnProperty(stream.current())) {\r\n      override = \"tag\";\r\n      return state.context.type;\r\n    } else {\r\n      return states.atBlock(type, stream, state);\r\n    }\r\n  };\r\n\r\n  states.atBlock = function(type, stream, state) {\r\n    if (type == \"(\") return pushContext(state, stream, \"atBlock_parens\");\r\n    if (type == \"}\" || type == \";\") return popAndPass(type, stream, state);\r\n    if (type == \"{\") return popContext(state) && pushContext(state, stream, allowNested ? \"block\" : \"top\");\r\n\r\n    if (type == \"interpolation\") return pushContext(state, stream, \"interpolation\");\r\n\r\n    if (type == \"word\") {\r\n      var word = stream.current().toLowerCase();\r\n      if (word == \"only\" || word == \"not\" || word == \"and\" || word == \"or\")\r\n        override = \"keyword\";\r\n      else if (mediaTypes.hasOwnProperty(word))\r\n        override = \"attribute\";\r\n      else if (mediaFeatures.hasOwnProperty(word))\r\n        override = \"property\";\r\n      else if (mediaValueKeywords.hasOwnProperty(word))\r\n        override = \"keyword\";\r\n      else if (propertyKeywords.hasOwnProperty(word))\r\n        override = \"property\";\r\n      else if (nonStandardPropertyKeywords.hasOwnProperty(word))\r\n        override = \"string-2\";\r\n      else if (valueKeywords.hasOwnProperty(word))\r\n        override = \"atom\";\r\n      else if (colorKeywords.hasOwnProperty(word))\r\n        override = \"keyword\";\r\n      else\r\n        override = \"error\";\r\n    }\r\n    return state.context.type;\r\n  };\r\n\r\n  states.atComponentBlock = function(type, stream, state) {\r\n    if (type == \"}\")\r\n      return popAndPass(type, stream, state);\r\n    if (type == \"{\")\r\n      return popContext(state) && pushContext(state, stream, allowNested ? \"block\" : \"top\", false);\r\n    if (type == \"word\")\r\n      override = \"error\";\r\n    return state.context.type;\r\n  };\r\n\r\n  states.atBlock_parens = function(type, stream, state) {\r\n    if (type == \")\") return popContext(state);\r\n    if (type == \"{\" || type == \"}\") return popAndPass(type, stream, state, 2);\r\n    return states.atBlock(type, stream, state);\r\n  };\r\n\r\n  states.restricted_atBlock_before = function(type, stream, state) {\r\n    if (type == \"{\")\r\n      return pushContext(state, stream, \"restricted_atBlock\");\r\n    if (type == \"word\" && state.stateArg == \"@counter-style\") {\r\n      override = \"variable\";\r\n      return \"restricted_atBlock_before\";\r\n    }\r\n    return pass(type, stream, state);\r\n  };\r\n\r\n  states.restricted_atBlock = function(type, stream, state) {\r\n    if (type == \"}\") {\r\n      state.stateArg = null;\r\n      return popContext(state);\r\n    }\r\n    if (type == \"word\") {\r\n      if ((state.stateArg == \"@font-face\" && !fontProperties.hasOwnProperty(stream.current().toLowerCase())) ||\r\n          (state.stateArg == \"@counter-style\" && !counterDescriptors.hasOwnProperty(stream.current().toLowerCase())))\r\n        override = \"error\";\r\n      else\r\n        override = \"property\";\r\n      return \"maybeprop\";\r\n    }\r\n    return \"restricted_atBlock\";\r\n  };\r\n\r\n  states.keyframes = function(type, stream, state) {\r\n    if (type == \"word\") { override = \"variable\"; return \"keyframes\"; }\r\n    if (type == \"{\") return pushContext(state, stream, \"top\");\r\n    return pass(type, stream, state);\r\n  };\r\n\r\n  states.at = function(type, stream, state) {\r\n    if (type == \";\") return popContext(state);\r\n    if (type == \"{\" || type == \"}\") return popAndPass(type, stream, state);\r\n    if (type == \"word\") override = \"tag\";\r\n    else if (type == \"hash\") override = \"builtin\";\r\n    return \"at\";\r\n  };\r\n\r\n  states.interpolation = function(type, stream, state) {\r\n    if (type == \"}\") return popContext(state);\r\n    if (type == \"{\" || type == \";\") return popAndPass(type, stream, state);\r\n    if (type == \"word\") override = \"variable\";\r\n    else if (type != \"variable\" && type != \"(\" && type != \")\") override = \"error\";\r\n    return \"interpolation\";\r\n  };\r\n\r\n  return {\r\n    startState: function(base) {\r\n      return {tokenize: null,\r\n              state: inline ? \"block\" : \"top\",\r\n              stateArg: null,\r\n              context: new Context(inline ? \"block\" : \"top\", base || 0, null)};\r\n    },\r\n\r\n    token: function(stream, state) {\r\n      if (!state.tokenize && stream.eatSpace()) return null;\r\n      var style = (state.tokenize || tokenBase)(stream, state);\r\n      if (style && typeof style == \"object\") {\r\n        type = style[1];\r\n        style = style[0];\r\n      }\r\n      override = style;\r\n      if (type != \"comment\")\r\n        state.state = states[state.state](type, stream, state);\r\n      return override;\r\n    },\r\n\r\n    indent: function(state, textAfter) {\r\n      var cx = state.context, ch = textAfter && textAfter.charAt(0);\r\n      var indent = cx.indent;\r\n      if (cx.type == \"prop\" && (ch == \"}\" || ch == \")\")) cx = cx.prev;\r\n      if (cx.prev) {\r\n        if (ch == \"}\" && (cx.type == \"block\" || cx.type == \"top\" ||\r\n                          cx.type == \"interpolation\" || cx.type == \"restricted_atBlock\")) {\r\n          // Resume indentation from parent context.\r\n          cx = cx.prev;\r\n          indent = cx.indent;\r\n        } else if (ch == \")\" && (cx.type == \"parens\" || cx.type == \"atBlock_parens\") ||\r\n            ch == \"{\" && (cx.type == \"at\" || cx.type == \"atBlock\")) {\r\n          // Dedent relative to current context.\r\n          indent = Math.max(0, cx.indent - indentUnit);\r\n        }\r\n      }\r\n      return indent;\r\n    },\r\n\r\n    electricChars: \"}\",\r\n    blockCommentStart: \"/*\",\r\n    blockCommentEnd: \"*/\",\r\n    blockCommentContinue: \" * \",\r\n    lineComment: lineComment,\r\n    fold: \"brace\"\r\n  };\r\n});\r\n\r\n  function keySet(array) {\r\n    var keys = {};\r\n    for (var i = 0; i < array.length; ++i) {\r\n      keys[array[i].toLowerCase()] = true;\r\n    }\r\n    return keys;\r\n  }\r\n\r\n  var documentTypes_ = [\r\n    \"domain\", \"regexp\", \"url\", \"url-prefix\"\r\n  ], documentTypes = keySet(documentTypes_);\r\n\r\n  var mediaTypes_ = [\r\n    \"all\", \"aural\", \"braille\", \"handheld\", \"print\", \"projection\", \"screen\",\r\n    \"tty\", \"tv\", \"embossed\"\r\n  ], mediaTypes = keySet(mediaTypes_);\r\n\r\n  var mediaFeatures_ = [\r\n    \"width\", \"min-width\", \"max-width\", \"height\", \"min-height\", \"max-height\",\r\n    \"device-width\", \"min-device-width\", \"max-device-width\", \"device-height\",\r\n    \"min-device-height\", \"max-device-height\", \"aspect-ratio\",\r\n    \"min-aspect-ratio\", \"max-aspect-ratio\", \"device-aspect-ratio\",\r\n    \"min-device-aspect-ratio\", \"max-device-aspect-ratio\", \"color\", \"min-color\",\r\n    \"max-color\", \"color-index\", \"min-color-index\", \"max-color-index\",\r\n    \"monochrome\", \"min-monochrome\", \"max-monochrome\", \"resolution\",\r\n    \"min-resolution\", \"max-resolution\", \"scan\", \"grid\", \"orientation\",\r\n    \"device-pixel-ratio\", \"min-device-pixel-ratio\", \"max-device-pixel-ratio\",\r\n    \"pointer\", \"any-pointer\", \"hover\", \"any-hover\"\r\n  ], mediaFeatures = keySet(mediaFeatures_);\r\n\r\n  var mediaValueKeywords_ = [\r\n    \"landscape\", \"portrait\", \"none\", \"coarse\", \"fine\", \"on-demand\", \"hover\",\r\n    \"interlace\", \"progressive\"\r\n  ], mediaValueKeywords = keySet(mediaValueKeywords_);\r\n\r\n  var propertyKeywords_ = [\r\n    \"align-content\", \"align-items\", \"align-self\", \"alignment-adjust\",\r\n    \"alignment-baseline\", \"anchor-point\", \"animation\", \"animation-delay\",\r\n    \"animation-direction\", \"animation-duration\", \"animation-fill-mode\",\r\n    \"animation-iteration-count\", \"animation-name\", \"animation-play-state\",\r\n    \"animation-timing-function\", \"appearance\", \"azimuth\", \"backface-visibility\",\r\n    \"background\", \"background-attachment\", \"background-blend-mode\", \"background-clip\",\r\n    \"background-color\", \"background-image\", \"background-origin\", \"background-position\",\r\n    \"background-repeat\", \"background-size\", \"baseline-shift\", \"binding\",\r\n    \"bleed\", \"bookmark-label\", \"bookmark-level\", \"bookmark-state\",\r\n    \"bookmark-target\", \"border\", \"border-bottom\", \"border-bottom-color\",\r\n    \"border-bottom-left-radius\", \"border-bottom-right-radius\",\r\n    \"border-bottom-style\", \"border-bottom-width\", \"border-collapse\",\r\n    \"border-color\", \"border-image\", \"border-image-outset\",\r\n    \"border-image-repeat\", \"border-image-slice\", \"border-image-source\",\r\n    \"border-image-width\", \"border-left\", \"border-left-color\",\r\n    \"border-left-style\", \"border-left-width\", \"border-radius\", \"border-right\",\r\n    \"border-right-color\", \"border-right-style\", \"border-right-width\",\r\n    \"border-spacing\", \"border-style\", \"border-top\", \"border-top-color\",\r\n    \"border-top-left-radius\", \"border-top-right-radius\", \"border-top-style\",\r\n    \"border-top-width\", \"border-width\", \"bottom\", \"box-decoration-break\",\r\n    \"box-shadow\", \"box-sizing\", \"break-after\", \"break-before\", \"break-inside\",\r\n    \"caption-side\", \"caret-color\", \"clear\", \"clip\", \"color\", \"color-profile\", \"column-count\",\r\n    \"column-fill\", \"column-gap\", \"column-rule\", \"column-rule-color\",\r\n    \"column-rule-style\", \"column-rule-width\", \"column-span\", \"column-width\",\r\n    \"columns\", \"content\", \"counter-increment\", \"counter-reset\", \"crop\", \"cue\",\r\n    \"cue-after\", \"cue-before\", \"cursor\", \"direction\", \"display\",\r\n    \"dominant-baseline\", \"drop-initial-after-adjust\",\r\n    \"drop-initial-after-align\", \"drop-initial-before-adjust\",\r\n    \"drop-initial-before-align\", \"drop-initial-size\", \"drop-initial-value\",\r\n    \"elevation\", \"empty-cells\", \"fit\", \"fit-position\", \"flex\", \"flex-basis\",\r\n    \"flex-direction\", \"flex-flow\", \"flex-grow\", \"flex-shrink\", \"flex-wrap\",\r\n    \"float\", \"float-offset\", \"flow-from\", \"flow-into\", \"font\", \"font-feature-settings\",\r\n    \"font-family\", \"font-kerning\", \"font-language-override\", \"font-size\", \"font-size-adjust\",\r\n    \"font-stretch\", \"font-style\", \"font-synthesis\", \"font-variant\",\r\n    \"font-variant-alternates\", \"font-variant-caps\", \"font-variant-east-asian\",\r\n    \"font-variant-ligatures\", \"font-variant-numeric\", \"font-variant-position\",\r\n    \"font-weight\", \"grid\", \"grid-area\", \"grid-auto-columns\", \"grid-auto-flow\",\r\n    \"grid-auto-rows\", \"grid-column\", \"grid-column-end\", \"grid-column-gap\",\r\n    \"grid-column-start\", \"grid-gap\", \"grid-row\", \"grid-row-end\", \"grid-row-gap\",\r\n    \"grid-row-start\", \"grid-template\", \"grid-template-areas\", \"grid-template-columns\",\r\n    \"grid-template-rows\", \"hanging-punctuation\", \"height\", \"hyphens\",\r\n    \"icon\", \"image-orientation\", \"image-rendering\", \"image-resolution\",\r\n    \"inline-box-align\", \"justify-content\", \"justify-items\", \"justify-self\", \"left\", \"letter-spacing\",\r\n    \"line-break\", \"line-height\", \"line-stacking\", \"line-stacking-ruby\",\r\n    \"line-stacking-shift\", \"line-stacking-strategy\", \"list-style\",\r\n    \"list-style-image\", \"list-style-position\", \"list-style-type\", \"margin\",\r\n    \"margin-bottom\", \"margin-left\", \"margin-right\", \"margin-top\",\r\n    \"marks\", \"marquee-direction\", \"marquee-loop\",\r\n    \"marquee-play-count\", \"marquee-speed\", \"marquee-style\", \"max-height\",\r\n    \"max-width\", \"min-height\", \"min-width\", \"mix-blend-mode\", \"move-to\", \"nav-down\", \"nav-index\",\r\n    \"nav-left\", \"nav-right\", \"nav-up\", \"object-fit\", \"object-position\",\r\n    \"opacity\", \"order\", \"orphans\", \"outline\",\r\n    \"outline-color\", \"outline-offset\", \"outline-style\", \"outline-width\",\r\n    \"overflow\", \"overflow-style\", \"overflow-wrap\", \"overflow-x\", \"overflow-y\",\r\n    \"padding\", \"padding-bottom\", \"padding-left\", \"padding-right\", \"padding-top\",\r\n    \"page\", \"page-break-after\", \"page-break-before\", \"page-break-inside\",\r\n    \"page-policy\", \"pause\", \"pause-after\", \"pause-before\", \"perspective\",\r\n    \"perspective-origin\", \"pitch\", \"pitch-range\", \"place-content\", \"place-items\", \"place-self\", \"play-during\", \"position\",\r\n    \"presentation-level\", \"punctuation-trim\", \"quotes\", \"region-break-after\",\r\n    \"region-break-before\", \"region-break-inside\", \"region-fragment\",\r\n    \"rendering-intent\", \"resize\", \"rest\", \"rest-after\", \"rest-before\", \"richness\",\r\n    \"right\", \"rotation\", \"rotation-point\", \"ruby-align\", \"ruby-overhang\",\r\n    \"ruby-position\", \"ruby-span\", \"shape-image-threshold\", \"shape-inside\", \"shape-margin\",\r\n    \"shape-outside\", \"size\", \"speak\", \"speak-as\", \"speak-header\",\r\n    \"speak-numeral\", \"speak-punctuation\", \"speech-rate\", \"stress\", \"string-set\",\r\n    \"tab-size\", \"table-layout\", \"target\", \"target-name\", \"target-new\",\r\n    \"target-position\", \"text-align\", \"text-align-last\", \"text-decoration\",\r\n    \"text-decoration-color\", \"text-decoration-line\", \"text-decoration-skip\",\r\n    \"text-decoration-style\", \"text-emphasis\", \"text-emphasis-color\",\r\n    \"text-emphasis-position\", \"text-emphasis-style\", \"text-height\",\r\n    \"text-indent\", \"text-justify\", \"text-outline\", \"text-overflow\", \"text-shadow\",\r\n    \"text-size-adjust\", \"text-space-collapse\", \"text-transform\", \"text-underline-position\",\r\n    \"text-wrap\", \"top\", \"transform\", \"transform-origin\", \"transform-style\",\r\n    \"transition\", \"transition-delay\", \"transition-duration\",\r\n    \"transition-property\", \"transition-timing-function\", \"unicode-bidi\",\r\n    \"user-select\", \"vertical-align\", \"visibility\", \"voice-balance\", \"voice-duration\",\r\n    \"voice-family\", \"voice-pitch\", \"voice-range\", \"voice-rate\", \"voice-stress\",\r\n    \"voice-volume\", \"volume\", \"white-space\", \"widows\", \"width\", \"will-change\", \"word-break\",\r\n    \"word-spacing\", \"word-wrap\", \"z-index\",\r\n    // SVG-specific\r\n    \"clip-path\", \"clip-rule\", \"mask\", \"enable-background\", \"filter\", \"flood-color\",\r\n    \"flood-opacity\", \"lighting-color\", \"stop-color\", \"stop-opacity\", \"pointer-events\",\r\n    \"color-interpolation\", \"color-interpolation-filters\",\r\n    \"color-rendering\", \"fill\", \"fill-opacity\", \"fill-rule\", \"image-rendering\",\r\n    \"marker\", \"marker-end\", \"marker-mid\", \"marker-start\", \"shape-rendering\", \"stroke\",\r\n    \"stroke-dasharray\", \"stroke-dashoffset\", \"stroke-linecap\", \"stroke-linejoin\",\r\n    \"stroke-miterlimit\", \"stroke-opacity\", \"stroke-width\", \"text-rendering\",\r\n    \"baseline-shift\", \"dominant-baseline\", \"glyph-orientation-horizontal\",\r\n    \"glyph-orientation-vertical\", \"text-anchor\", \"writing-mode\"\r\n  ], propertyKeywords = keySet(propertyKeywords_);\r\n\r\n  var nonStandardPropertyKeywords_ = [\r\n    \"scrollbar-arrow-color\", \"scrollbar-base-color\", \"scrollbar-dark-shadow-color\",\r\n    \"scrollbar-face-color\", \"scrollbar-highlight-color\", \"scrollbar-shadow-color\",\r\n    \"scrollbar-3d-light-color\", \"scrollbar-track-color\", \"shape-inside\",\r\n    \"searchfield-cancel-button\", \"searchfield-decoration\", \"searchfield-results-button\",\r\n    \"searchfield-results-decoration\", \"zoom\"\r\n  ], nonStandardPropertyKeywords = keySet(nonStandardPropertyKeywords_);\r\n\r\n  var fontProperties_ = [\r\n    \"font-family\", \"src\", \"unicode-range\", \"font-variant\", \"font-feature-settings\",\r\n    \"font-stretch\", \"font-weight\", \"font-style\"\r\n  ], fontProperties = keySet(fontProperties_);\r\n\r\n  var counterDescriptors_ = [\r\n    \"additive-symbols\", \"fallback\", \"negative\", \"pad\", \"prefix\", \"range\",\r\n    \"speak-as\", \"suffix\", \"symbols\", \"system\"\r\n  ], counterDescriptors = keySet(counterDescriptors_);\r\n\r\n  var colorKeywords_ = [\r\n    \"aliceblue\", \"antiquewhite\", \"aqua\", \"aquamarine\", \"azure\", \"beige\",\r\n    \"bisque\", \"black\", \"blanchedalmond\", \"blue\", \"blueviolet\", \"brown\",\r\n    \"burlywood\", \"cadetblue\", \"chartreuse\", \"chocolate\", \"coral\", \"cornflowerblue\",\r\n    \"cornsilk\", \"crimson\", \"cyan\", \"darkblue\", \"darkcyan\", \"darkgoldenrod\",\r\n    \"darkgray\", \"darkgreen\", \"darkkhaki\", \"darkmagenta\", \"darkolivegreen\",\r\n    \"darkorange\", \"darkorchid\", \"darkred\", \"darksalmon\", \"darkseagreen\",\r\n    \"darkslateblue\", \"darkslategray\", \"darkturquoise\", \"darkviolet\",\r\n    \"deeppink\", \"deepskyblue\", \"dimgray\", \"dodgerblue\", \"firebrick\",\r\n    \"floralwhite\", \"forestgreen\", \"fuchsia\", \"gainsboro\", \"ghostwhite\",\r\n    \"gold\", \"goldenrod\", \"gray\", \"grey\", \"green\", \"greenyellow\", \"honeydew\",\r\n    \"hotpink\", \"indianred\", \"indigo\", \"ivory\", \"khaki\", \"lavender\",\r\n    \"lavenderblush\", \"lawngreen\", \"lemonchiffon\", \"lightblue\", \"lightcoral\",\r\n    \"lightcyan\", \"lightgoldenrodyellow\", \"lightgray\", \"lightgreen\", \"lightpink\",\r\n    \"lightsalmon\", \"lightseagreen\", \"lightskyblue\", \"lightslategray\",\r\n    \"lightsteelblue\", \"lightyellow\", \"lime\", \"limegreen\", \"linen\", \"magenta\",\r\n    \"maroon\", \"mediumaquamarine\", \"mediumblue\", \"mediumorchid\", \"mediumpurple\",\r\n    \"mediumseagreen\", \"mediumslateblue\", \"mediumspringgreen\", \"mediumturquoise\",\r\n    \"mediumvioletred\", \"midnightblue\", \"mintcream\", \"mistyrose\", \"moccasin\",\r\n    \"navajowhite\", \"navy\", \"oldlace\", \"olive\", \"olivedrab\", \"orange\", \"orangered\",\r\n    \"orchid\", \"palegoldenrod\", \"palegreen\", \"paleturquoise\", \"palevioletred\",\r\n    \"papayawhip\", \"peachpuff\", \"peru\", \"pink\", \"plum\", \"powderblue\",\r\n    \"purple\", \"rebeccapurple\", \"red\", \"rosybrown\", \"royalblue\", \"saddlebrown\",\r\n    \"salmon\", \"sandybrown\", \"seagreen\", \"seashell\", \"sienna\", \"silver\", \"skyblue\",\r\n    \"slateblue\", \"slategray\", \"snow\", \"springgreen\", \"steelblue\", \"tan\",\r\n    \"teal\", \"thistle\", \"tomato\", \"turquoise\", \"violet\", \"wheat\", \"white\",\r\n    \"whitesmoke\", \"yellow\", \"yellowgreen\"\r\n  ], colorKeywords = keySet(colorKeywords_);\r\n\r\n  var valueKeywords_ = [\r\n    \"above\", \"absolute\", \"activeborder\", \"additive\", \"activecaption\", \"afar\",\r\n    \"after-white-space\", \"ahead\", \"alias\", \"all\", \"all-scroll\", \"alphabetic\", \"alternate\",\r\n    \"always\", \"amharic\", \"amharic-abegede\", \"antialiased\", \"appworkspace\",\r\n    \"arabic-indic\", \"armenian\", \"asterisks\", \"attr\", \"auto\", \"auto-flow\", \"avoid\", \"avoid-column\", \"avoid-page\",\r\n    \"avoid-region\", \"background\", \"backwards\", \"baseline\", \"below\", \"bidi-override\", \"binary\",\r\n    \"bengali\", \"blink\", \"block\", \"block-axis\", \"bold\", \"bolder\", \"border\", \"border-box\",\r\n    \"both\", \"bottom\", \"break\", \"break-all\", \"break-word\", \"bullets\", \"button\", \"button-bevel\",\r\n    \"buttonface\", \"buttonhighlight\", \"buttonshadow\", \"buttontext\", \"calc\", \"cambodian\",\r\n    \"capitalize\", \"caps-lock-indicator\", \"caption\", \"captiontext\", \"caret\",\r\n    \"cell\", \"center\", \"checkbox\", \"circle\", \"cjk-decimal\", \"cjk-earthly-branch\",\r\n    \"cjk-heavenly-stem\", \"cjk-ideographic\", \"clear\", \"clip\", \"close-quote\",\r\n    \"col-resize\", \"collapse\", \"color\", \"color-burn\", \"color-dodge\", \"column\", \"column-reverse\",\r\n    \"compact\", \"condensed\", \"contain\", \"content\", \"contents\",\r\n    \"content-box\", \"context-menu\", \"continuous\", \"copy\", \"counter\", \"counters\", \"cover\", \"crop\",\r\n    \"cross\", \"crosshair\", \"currentcolor\", \"cursive\", \"cyclic\", \"darken\", \"dashed\", \"decimal\",\r\n    \"decimal-leading-zero\", \"default\", \"default-button\", \"dense\", \"destination-atop\",\r\n    \"destination-in\", \"destination-out\", \"destination-over\", \"devanagari\", \"difference\",\r\n    \"disc\", \"discard\", \"disclosure-closed\", \"disclosure-open\", \"document\",\r\n    \"dot-dash\", \"dot-dot-dash\",\r\n    \"dotted\", \"double\", \"down\", \"e-resize\", \"ease\", \"ease-in\", \"ease-in-out\", \"ease-out\",\r\n    \"element\", \"ellipse\", \"ellipsis\", \"embed\", \"end\", \"ethiopic\", \"ethiopic-abegede\",\r\n    \"ethiopic-abegede-am-et\", \"ethiopic-abegede-gez\", \"ethiopic-abegede-ti-er\",\r\n    \"ethiopic-abegede-ti-et\", \"ethiopic-halehame-aa-er\",\r\n    \"ethiopic-halehame-aa-et\", \"ethiopic-halehame-am-et\",\r\n    \"ethiopic-halehame-gez\", \"ethiopic-halehame-om-et\",\r\n    \"ethiopic-halehame-sid-et\", \"ethiopic-halehame-so-et\",\r\n    \"ethiopic-halehame-ti-er\", \"ethiopic-halehame-ti-et\", \"ethiopic-halehame-tig\",\r\n    \"ethiopic-numeric\", \"ew-resize\", \"exclusion\", \"expanded\", \"extends\", \"extra-condensed\",\r\n    \"extra-expanded\", \"fantasy\", \"fast\", \"fill\", \"fixed\", \"flat\", \"flex\", \"flex-end\", \"flex-start\", \"footnotes\",\r\n    \"forwards\", \"from\", \"geometricPrecision\", \"georgian\", \"graytext\", \"grid\", \"groove\",\r\n    \"gujarati\", \"gurmukhi\", \"hand\", \"hangul\", \"hangul-consonant\", \"hard-light\", \"hebrew\",\r\n    \"help\", \"hidden\", \"hide\", \"higher\", \"highlight\", \"highlighttext\",\r\n    \"hiragana\", \"hiragana-iroha\", \"horizontal\", \"hsl\", \"hsla\", \"hue\", \"icon\", \"ignore\",\r\n    \"inactiveborder\", \"inactivecaption\", \"inactivecaptiontext\", \"infinite\",\r\n    \"infobackground\", \"infotext\", \"inherit\", \"initial\", \"inline\", \"inline-axis\",\r\n    \"inline-block\", \"inline-flex\", \"inline-grid\", \"inline-table\", \"inset\", \"inside\", \"intrinsic\", \"invert\",\r\n    \"italic\", \"japanese-formal\", \"japanese-informal\", \"justify\", \"kannada\",\r\n    \"katakana\", \"katakana-iroha\", \"keep-all\", \"khmer\",\r\n    \"korean-hangul-formal\", \"korean-hanja-formal\", \"korean-hanja-informal\",\r\n    \"landscape\", \"lao\", \"large\", \"larger\", \"left\", \"level\", \"lighter\", \"lighten\",\r\n    \"line-through\", \"linear\", \"linear-gradient\", \"lines\", \"list-item\", \"listbox\", \"listitem\",\r\n    \"local\", \"logical\", \"loud\", \"lower\", \"lower-alpha\", \"lower-armenian\",\r\n    \"lower-greek\", \"lower-hexadecimal\", \"lower-latin\", \"lower-norwegian\",\r\n    \"lower-roman\", \"lowercase\", \"ltr\", \"luminosity\", \"malayalam\", \"match\", \"matrix\", \"matrix3d\",\r\n    \"media-controls-background\", \"media-current-time-display\",\r\n    \"media-fullscreen-button\", \"media-mute-button\", \"media-play-button\",\r\n    \"media-return-to-realtime-button\", \"media-rewind-button\",\r\n    \"media-seek-back-button\", \"media-seek-forward-button\", \"media-slider\",\r\n    \"media-sliderthumb\", \"media-time-remaining-display\", \"media-volume-slider\",\r\n    \"media-volume-slider-container\", \"media-volume-sliderthumb\", \"medium\",\r\n    \"menu\", \"menulist\", \"menulist-button\", \"menulist-text\",\r\n    \"menulist-textfield\", \"menutext\", \"message-box\", \"middle\", \"min-intrinsic\",\r\n    \"mix\", \"mongolian\", \"monospace\", \"move\", \"multiple\", \"multiply\", \"myanmar\", \"n-resize\",\r\n    \"narrower\", \"ne-resize\", \"nesw-resize\", \"no-close-quote\", \"no-drop\",\r\n    \"no-open-quote\", \"no-repeat\", \"none\", \"normal\", \"not-allowed\", \"nowrap\",\r\n    \"ns-resize\", \"numbers\", \"numeric\", \"nw-resize\", \"nwse-resize\", \"oblique\", \"octal\", \"opacity\", \"open-quote\",\r\n    \"optimizeLegibility\", \"optimizeSpeed\", \"oriya\", \"oromo\", \"outset\",\r\n    \"outside\", \"outside-shape\", \"overlay\", \"overline\", \"padding\", \"padding-box\",\r\n    \"painted\", \"page\", \"paused\", \"persian\", \"perspective\", \"plus-darker\", \"plus-lighter\",\r\n    \"pointer\", \"polygon\", \"portrait\", \"pre\", \"pre-line\", \"pre-wrap\", \"preserve-3d\",\r\n    \"progress\", \"push-button\", \"radial-gradient\", \"radio\", \"read-only\",\r\n    \"read-write\", \"read-write-plaintext-only\", \"rectangle\", \"region\",\r\n    \"relative\", \"repeat\", \"repeating-linear-gradient\",\r\n    \"repeating-radial-gradient\", \"repeat-x\", \"repeat-y\", \"reset\", \"reverse\",\r\n    \"rgb\", \"rgba\", \"ridge\", \"right\", \"rotate\", \"rotate3d\", \"rotateX\", \"rotateY\",\r\n    \"rotateZ\", \"round\", \"row\", \"row-resize\", \"row-reverse\", \"rtl\", \"run-in\", \"running\",\r\n    \"s-resize\", \"sans-serif\", \"saturation\", \"scale\", \"scale3d\", \"scaleX\", \"scaleY\", \"scaleZ\", \"screen\",\r\n    \"scroll\", \"scrollbar\", \"scroll-position\", \"se-resize\", \"searchfield\",\r\n    \"searchfield-cancel-button\", \"searchfield-decoration\",\r\n    \"searchfield-results-button\", \"searchfield-results-decoration\", \"self-start\", \"self-end\",\r\n    \"semi-condensed\", \"semi-expanded\", \"separate\", \"serif\", \"show\", \"sidama\",\r\n    \"simp-chinese-formal\", \"simp-chinese-informal\", \"single\",\r\n    \"skew\", \"skewX\", \"skewY\", \"skip-white-space\", \"slide\", \"slider-horizontal\",\r\n    \"slider-vertical\", \"sliderthumb-horizontal\", \"sliderthumb-vertical\", \"slow\",\r\n    \"small\", \"small-caps\", \"small-caption\", \"smaller\", \"soft-light\", \"solid\", \"somali\",\r\n    \"source-atop\", \"source-in\", \"source-out\", \"source-over\", \"space\", \"space-around\", \"space-between\", \"space-evenly\", \"spell-out\", \"square\",\r\n    \"square-button\", \"start\", \"static\", \"status-bar\", \"stretch\", \"stroke\", \"sub\",\r\n    \"subpixel-antialiased\", \"super\", \"sw-resize\", \"symbolic\", \"symbols\", \"system-ui\", \"table\",\r\n    \"table-caption\", \"table-cell\", \"table-column\", \"table-column-group\",\r\n    \"table-footer-group\", \"table-header-group\", \"table-row\", \"table-row-group\",\r\n    \"tamil\",\r\n    \"telugu\", \"text\", \"text-bottom\", \"text-top\", \"textarea\", \"textfield\", \"thai\",\r\n    \"thick\", \"thin\", \"threeddarkshadow\", \"threedface\", \"threedhighlight\",\r\n    \"threedlightshadow\", \"threedshadow\", \"tibetan\", \"tigre\", \"tigrinya-er\",\r\n    \"tigrinya-er-abegede\", \"tigrinya-et\", \"tigrinya-et-abegede\", \"to\", \"top\",\r\n    \"trad-chinese-formal\", \"trad-chinese-informal\", \"transform\",\r\n    \"translate\", \"translate3d\", \"translateX\", \"translateY\", \"translateZ\",\r\n    \"transparent\", \"ultra-condensed\", \"ultra-expanded\", \"underline\", \"unset\", \"up\",\r\n    \"upper-alpha\", \"upper-armenian\", \"upper-greek\", \"upper-hexadecimal\",\r\n    \"upper-latin\", \"upper-norwegian\", \"upper-roman\", \"uppercase\", \"urdu\", \"url\",\r\n    \"var\", \"vertical\", \"vertical-text\", \"visible\", \"visibleFill\", \"visiblePainted\",\r\n    \"visibleStroke\", \"visual\", \"w-resize\", \"wait\", \"wave\", \"wider\",\r\n    \"window\", \"windowframe\", \"windowtext\", \"words\", \"wrap\", \"wrap-reverse\", \"x-large\", \"x-small\", \"xor\",\r\n    \"xx-large\", \"xx-small\"\r\n  ], valueKeywords = keySet(valueKeywords_);\r\n\r\n  var allWords = documentTypes_.concat(mediaTypes_).concat(mediaFeatures_).concat(mediaValueKeywords_)\r\n    .concat(propertyKeywords_).concat(nonStandardPropertyKeywords_).concat(colorKeywords_)\r\n    .concat(valueKeywords_);\r\n  CodeMirror.registerHelper(\"hintWords\", \"css\", allWords);\r\n\r\n  function tokenCComment(stream, state) {\r\n    var maybeEnd = false, ch;\r\n    while ((ch = stream.next()) != null) {\r\n      if (maybeEnd && ch == \"/\") {\r\n        state.tokenize = null;\r\n        break;\r\n      }\r\n      maybeEnd = (ch == \"*\");\r\n    }\r\n    return [\"comment\", \"comment\"];\r\n  }\r\n\r\n  CodeMirror.defineMIME(\"text/css\", {\r\n    documentTypes: documentTypes,\r\n    mediaTypes: mediaTypes,\r\n    mediaFeatures: mediaFeatures,\r\n    mediaValueKeywords: mediaValueKeywords,\r\n    propertyKeywords: propertyKeywords,\r\n    nonStandardPropertyKeywords: nonStandardPropertyKeywords,\r\n    fontProperties: fontProperties,\r\n    counterDescriptors: counterDescriptors,\r\n    colorKeywords: colorKeywords,\r\n    valueKeywords: valueKeywords,\r\n    tokenHooks: {\r\n      \"/\": function(stream, state) {\r\n        if (!stream.eat(\"*\")) return false;\r\n        state.tokenize = tokenCComment;\r\n        return tokenCComment(stream, state);\r\n      }\r\n    },\r\n    name: \"css\"\r\n  });\r\n\r\n  CodeMirror.defineMIME(\"text/x-scss\", {\r\n    mediaTypes: mediaTypes,\r\n    mediaFeatures: mediaFeatures,\r\n    mediaValueKeywords: mediaValueKeywords,\r\n    propertyKeywords: propertyKeywords,\r\n    nonStandardPropertyKeywords: nonStandardPropertyKeywords,\r\n    colorKeywords: colorKeywords,\r\n    valueKeywords: valueKeywords,\r\n    fontProperties: fontProperties,\r\n    allowNested: true,\r\n    lineComment: \"//\",\r\n    tokenHooks: {\r\n      \"/\": function(stream, state) {\r\n        if (stream.eat(\"/\")) {\r\n          stream.skipToEnd();\r\n          return [\"comment\", \"comment\"];\r\n        } else if (stream.eat(\"*\")) {\r\n          state.tokenize = tokenCComment;\r\n          return tokenCComment(stream, state);\r\n        } else {\r\n          return [\"operator\", \"operator\"];\r\n        }\r\n      },\r\n      \":\": function(stream) {\r\n        if (stream.match(/\\s*\\{/, false))\r\n          return [null, null]\r\n        return false;\r\n      },\r\n      \"$\": function(stream) {\r\n        stream.match(/^[\\w-]+/);\r\n        if (stream.match(/^\\s*:/, false))\r\n          return [\"variable-2\", \"variable-definition\"];\r\n        return [\"variable-2\", \"variable\"];\r\n      },\r\n      \"#\": function(stream) {\r\n        if (!stream.eat(\"{\")) return false;\r\n        return [null, \"interpolation\"];\r\n      }\r\n    },\r\n    name: \"css\",\r\n    helperType: \"scss\"\r\n  });\r\n\r\n  CodeMirror.defineMIME(\"text/x-less\", {\r\n    mediaTypes: mediaTypes,\r\n    mediaFeatures: mediaFeatures,\r\n    mediaValueKeywords: mediaValueKeywords,\r\n    propertyKeywords: propertyKeywords,\r\n    nonStandardPropertyKeywords: nonStandardPropertyKeywords,\r\n    colorKeywords: colorKeywords,\r\n    valueKeywords: valueKeywords,\r\n    fontProperties: fontProperties,\r\n    allowNested: true,\r\n    lineComment: \"//\",\r\n    tokenHooks: {\r\n      \"/\": function(stream, state) {\r\n        if (stream.eat(\"/\")) {\r\n          stream.skipToEnd();\r\n          return [\"comment\", \"comment\"];\r\n        } else if (stream.eat(\"*\")) {\r\n          state.tokenize = tokenCComment;\r\n          return tokenCComment(stream, state);\r\n        } else {\r\n          return [\"operator\", \"operator\"];\r\n        }\r\n      },\r\n      \"@\": function(stream) {\r\n        if (stream.eat(\"{\")) return [null, \"interpolation\"];\r\n        if (stream.match(/^(charset|document|font-face|import|(-(moz|ms|o|webkit)-)?keyframes|media|namespace|page|supports)\\b/i, false)) return false;\r\n        stream.eatWhile(/[\\w\\\\\\-]/);\r\n        if (stream.match(/^\\s*:/, false))\r\n          return [\"variable-2\", \"variable-definition\"];\r\n        return [\"variable-2\", \"variable\"];\r\n      },\r\n      \"&\": function() {\r\n        return [\"atom\", \"atom\"];\r\n      }\r\n    },\r\n    name: \"css\",\r\n    helperType: \"less\"\r\n  });\r\n\r\n  CodeMirror.defineMIME(\"text/x-gss\", {\r\n    documentTypes: documentTypes,\r\n    mediaTypes: mediaTypes,\r\n    mediaFeatures: mediaFeatures,\r\n    propertyKeywords: propertyKeywords,\r\n    nonStandardPropertyKeywords: nonStandardPropertyKeywords,\r\n    fontProperties: fontProperties,\r\n    counterDescriptors: counterDescriptors,\r\n    colorKeywords: colorKeywords,\r\n    valueKeywords: valueKeywords,\r\n    supportsAtComponent: true,\r\n    tokenHooks: {\r\n      \"/\": function(stream, state) {\r\n        if (!stream.eat(\"*\")) return false;\r\n        state.tokenize = tokenCComment;\r\n        return tokenCComment(stream, state);\r\n      }\r\n    },\r\n    name: \"css\",\r\n    helperType: \"gss\"\r\n  });\r\n\r\n});\r\n\n// CodeMirror, copyright (c) by Marijn Haverbeke and others\r\n// Distributed under an MIT license: https://codemirror.net/LICENSE\r\n\r\ndefine('skylark-codemirror/mode/javascript/javascript',[\"../../CodeMirror\"], function(CodeMirror) {\r\n\r\n\r\nCodeMirror.defineMode(\"javascript\", function(config, parserConfig) {\r\n  var indentUnit = config.indentUnit;\r\n  var statementIndent = parserConfig.statementIndent;\r\n  var jsonldMode = parserConfig.jsonld;\r\n  var jsonMode = parserConfig.json || jsonldMode;\r\n  var isTS = parserConfig.typescript;\r\n  var wordRE = parserConfig.wordCharacters || /[\\w$\\xa1-\\uffff]/;\r\n\r\n  // Tokenizer\r\n\r\n  var keywords = function(){\r\n    function kw(type) {return {type: type, style: \"keyword\"};}\r\n    var A = kw(\"keyword a\"), B = kw(\"keyword b\"), C = kw(\"keyword c\"), D = kw(\"keyword d\");\r\n    var operator = kw(\"operator\"), atom = {type: \"atom\", style: \"atom\"};\r\n\r\n    return {\r\n      \"if\": kw(\"if\"), \"while\": A, \"with\": A, \"else\": B, \"do\": B, \"try\": B, \"finally\": B,\r\n      \"return\": D, \"break\": D, \"continue\": D, \"new\": kw(\"new\"), \"delete\": C, \"void\": C, \"throw\": C,\r\n      \"debugger\": kw(\"debugger\"), \"var\": kw(\"var\"), \"const\": kw(\"var\"), \"let\": kw(\"var\"),\r\n      \"function\": kw(\"function\"), \"catch\": kw(\"catch\"),\r\n      \"for\": kw(\"for\"), \"switch\": kw(\"switch\"), \"case\": kw(\"case\"), \"default\": kw(\"default\"),\r\n      \"in\": operator, \"typeof\": operator, \"instanceof\": operator,\r\n      \"true\": atom, \"false\": atom, \"null\": atom, \"undefined\": atom, \"NaN\": atom, \"Infinity\": atom,\r\n      \"this\": kw(\"this\"), \"class\": kw(\"class\"), \"super\": kw(\"atom\"),\r\n      \"yield\": C, \"export\": kw(\"export\"), \"import\": kw(\"import\"), \"extends\": C,\r\n      \"await\": C\r\n    };\r\n  }();\r\n\r\n  var isOperatorChar = /[+\\-*&%=<>!?|~^@]/;\r\n  var isJsonldKeyword = /^@(context|id|value|language|type|container|list|set|reverse|index|base|vocab|graph)\"/;\r\n\r\n  function readRegexp(stream) {\r\n    var escaped = false, next, inSet = false;\r\n    while ((next = stream.next()) != null) {\r\n      if (!escaped) {\r\n        if (next == \"/\" && !inSet) return;\r\n        if (next == \"[\") inSet = true;\r\n        else if (inSet && next == \"]\") inSet = false;\r\n      }\r\n      escaped = !escaped && next == \"\\\\\";\r\n    }\r\n  }\r\n\r\n  // Used as scratch variables to communicate multiple values without\r\n  // consing up tons of objects.\r\n  var type, content;\r\n  function ret(tp, style, cont) {\r\n    type = tp; content = cont;\r\n    return style;\r\n  }\r\n  function tokenBase(stream, state) {\r\n    var ch = stream.next();\r\n    if (ch == '\"' || ch == \"'\") {\r\n      state.tokenize = tokenString(ch);\r\n      return state.tokenize(stream, state);\r\n    } else if (ch == \".\" && stream.match(/^\\d+(?:[eE][+\\-]?\\d+)?/)) {\r\n      return ret(\"number\", \"number\");\r\n    } else if (ch == \".\" && stream.match(\"..\")) {\r\n      return ret(\"spread\", \"meta\");\r\n    } else if (/[\\[\\]{}\\(\\),;\\:\\.]/.test(ch)) {\r\n      return ret(ch);\r\n    } else if (ch == \"=\" && stream.eat(\">\")) {\r\n      return ret(\"=>\", \"operator\");\r\n    } else if (ch == \"0\" && stream.match(/^(?:x[\\da-f]+|o[0-7]+|b[01]+)n?/i)) {\r\n      return ret(\"number\", \"number\");\r\n    } else if (/\\d/.test(ch)) {\r\n      stream.match(/^\\d*(?:n|(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?)?/);\r\n      return ret(\"number\", \"number\");\r\n    } else if (ch == \"/\") {\r\n      if (stream.eat(\"*\")) {\r\n        state.tokenize = tokenComment;\r\n        return tokenComment(stream, state);\r\n      } else if (stream.eat(\"/\")) {\r\n        stream.skipToEnd();\r\n        return ret(\"comment\", \"comment\");\r\n      } else if (expressionAllowed(stream, state, 1)) {\r\n        readRegexp(stream);\r\n        stream.match(/^\\b(([gimyus])(?![gimyus]*\\2))+\\b/);\r\n        return ret(\"regexp\", \"string-2\");\r\n      } else {\r\n        stream.eat(\"=\");\r\n        return ret(\"operator\", \"operator\", stream.current());\r\n      }\r\n    } else if (ch == \"`\") {\r\n      state.tokenize = tokenQuasi;\r\n      return tokenQuasi(stream, state);\r\n    } else if (ch == \"#\") {\r\n      stream.skipToEnd();\r\n      return ret(\"error\", \"error\");\r\n    } else if (isOperatorChar.test(ch)) {\r\n      if (ch != \">\" || !state.lexical || state.lexical.type != \">\") {\r\n        if (stream.eat(\"=\")) {\r\n          if (ch == \"!\" || ch == \"=\") stream.eat(\"=\")\r\n        } else if (/[<>*+\\-]/.test(ch)) {\r\n          stream.eat(ch)\r\n          if (ch == \">\") stream.eat(ch)\r\n        }\r\n      }\r\n      return ret(\"operator\", \"operator\", stream.current());\r\n    } else if (wordRE.test(ch)) {\r\n      stream.eatWhile(wordRE);\r\n      var word = stream.current()\r\n      if (state.lastType != \".\") {\r\n        if (keywords.propertyIsEnumerable(word)) {\r\n          var kw = keywords[word]\r\n          return ret(kw.type, kw.style, word)\r\n        }\r\n        if (word == \"async\" && stream.match(/^(\\s|\\/\\*.*?\\*\\/)*[\\[\\(\\w]/, false))\r\n          return ret(\"async\", \"keyword\", word)\r\n      }\r\n      return ret(\"variable\", \"variable\", word)\r\n    }\r\n  }\r\n\r\n  function tokenString(quote) {\r\n    return function(stream, state) {\r\n      var escaped = false, next;\r\n      if (jsonldMode && stream.peek() == \"@\" && stream.match(isJsonldKeyword)){\r\n        state.tokenize = tokenBase;\r\n        return ret(\"jsonld-keyword\", \"meta\");\r\n      }\r\n      while ((next = stream.next()) != null) {\r\n        if (next == quote && !escaped) break;\r\n        escaped = !escaped && next == \"\\\\\";\r\n      }\r\n      if (!escaped) state.tokenize = tokenBase;\r\n      return ret(\"string\", \"string\");\r\n    };\r\n  }\r\n\r\n  function tokenComment(stream, state) {\r\n    var maybeEnd = false, ch;\r\n    while (ch = stream.next()) {\r\n      if (ch == \"/\" && maybeEnd) {\r\n        state.tokenize = tokenBase;\r\n        break;\r\n      }\r\n      maybeEnd = (ch == \"*\");\r\n    }\r\n    return ret(\"comment\", \"comment\");\r\n  }\r\n\r\n  function tokenQuasi(stream, state) {\r\n    var escaped = false, next;\r\n    while ((next = stream.next()) != null) {\r\n      if (!escaped && (next == \"`\" || next == \"$\" && stream.eat(\"{\"))) {\r\n        state.tokenize = tokenBase;\r\n        break;\r\n      }\r\n      escaped = !escaped && next == \"\\\\\";\r\n    }\r\n    return ret(\"quasi\", \"string-2\", stream.current());\r\n  }\r\n\r\n  var brackets = \"([{}])\";\r\n  // This is a crude lookahead trick to try and notice that we're\r\n  // parsing the argument patterns for a fat-arrow function before we\r\n  // actually hit the arrow token. It only works if the arrow is on\r\n  // the same line as the arguments and there's no strange noise\r\n  // (comments) in between. Fallback is to only notice when we hit the\r\n  // arrow, and not declare the arguments as locals for the arrow\r\n  // body.\r\n  function findFatArrow(stream, state) {\r\n    if (state.fatArrowAt) state.fatArrowAt = null;\r\n    var arrow = stream.string.indexOf(\"=>\", stream.start);\r\n    if (arrow < 0) return;\r\n\r\n    if (isTS) { // Try to skip TypeScript return type declarations after the arguments\r\n      var m = /:\\s*(?:\\w+(?:<[^>]*>|\\[\\])?|\\{[^}]*\\})\\s*$/.exec(stream.string.slice(stream.start, arrow))\r\n      if (m) arrow = m.index\r\n    }\r\n\r\n    var depth = 0, sawSomething = false;\r\n    for (var pos = arrow - 1; pos >= 0; --pos) {\r\n      var ch = stream.string.charAt(pos);\r\n      var bracket = brackets.indexOf(ch);\r\n      if (bracket >= 0 && bracket < 3) {\r\n        if (!depth) { ++pos; break; }\r\n        if (--depth == 0) { if (ch == \"(\") sawSomething = true; break; }\r\n      } else if (bracket >= 3 && bracket < 6) {\r\n        ++depth;\r\n      } else if (wordRE.test(ch)) {\r\n        sawSomething = true;\r\n      } else if (/[\"'\\/]/.test(ch)) {\r\n        return;\r\n      } else if (sawSomething && !depth) {\r\n        ++pos;\r\n        break;\r\n      }\r\n    }\r\n    if (sawSomething && !depth) state.fatArrowAt = pos;\r\n  }\r\n\r\n  // Parser\r\n\r\n  var atomicTypes = {\"atom\": true, \"number\": true, \"variable\": true, \"string\": true, \"regexp\": true, \"this\": true, \"jsonld-keyword\": true};\r\n\r\n  function JSLexical(indented, column, type, align, prev, info) {\r\n    this.indented = indented;\r\n    this.column = column;\r\n    this.type = type;\r\n    this.prev = prev;\r\n    this.info = info;\r\n    if (align != null) this.align = align;\r\n  }\r\n\r\n  function inScope(state, varname) {\r\n    for (var v = state.localVars; v; v = v.next)\r\n      if (v.name == varname) return true;\r\n    for (var cx = state.context; cx; cx = cx.prev) {\r\n      for (var v = cx.vars; v; v = v.next)\r\n        if (v.name == varname) return true;\r\n    }\r\n  }\r\n\r\n  function parseJS(state, style, type, content, stream) {\r\n    var cc = state.cc;\r\n    // Communicate our context to the combinators.\r\n    // (Less wasteful than consing up a hundred closures on every call.)\r\n    cx.state = state; cx.stream = stream; cx.marked = null, cx.cc = cc; cx.style = style;\r\n\r\n    if (!state.lexical.hasOwnProperty(\"align\"))\r\n      state.lexical.align = true;\r\n\r\n    while(true) {\r\n      var combinator = cc.length ? cc.pop() : jsonMode ? expression : statement;\r\n      if (combinator(type, content)) {\r\n        while(cc.length && cc[cc.length - 1].lex)\r\n          cc.pop()();\r\n        if (cx.marked) return cx.marked;\r\n        if (type == \"variable\" && inScope(state, content)) return \"variable-2\";\r\n        return style;\r\n      }\r\n    }\r\n  }\r\n\r\n  // Combinator utils\r\n\r\n  var cx = {state: null, column: null, marked: null, cc: null};\r\n  function pass() {\r\n    for (var i = arguments.length - 1; i >= 0; i--) cx.cc.push(arguments[i]);\r\n  }\r\n  function cont() {\r\n    pass.apply(null, arguments);\r\n    return true;\r\n  }\r\n  function inList(name, list) {\r\n    for (var v = list; v; v = v.next) if (v.name == name) return true\r\n    return false;\r\n  }\r\n  function register(varname) {\r\n    var state = cx.state;\r\n    cx.marked = \"def\";\r\n    if (state.context) {\r\n      if (state.lexical.info == \"var\" && state.context && state.context.block) {\r\n        // FIXME function decls are also not block scoped\r\n        var newContext = registerVarScoped(varname, state.context)\r\n        if (newContext != null) {\r\n          state.context = newContext\r\n          return\r\n        }\r\n      } else if (!inList(varname, state.localVars)) {\r\n        state.localVars = new Var(varname, state.localVars)\r\n        return\r\n      }\r\n    }\r\n    // Fall through means this is global\r\n    if (parserConfig.globalVars && !inList(varname, state.globalVars))\r\n      state.globalVars = new Var(varname, state.globalVars)\r\n  }\r\n  function registerVarScoped(varname, context) {\r\n    if (!context) {\r\n      return null\r\n    } else if (context.block) {\r\n      var inner = registerVarScoped(varname, context.prev)\r\n      if (!inner) return null\r\n      if (inner == context.prev) return context\r\n      return new Context(inner, context.vars, true)\r\n    } else if (inList(varname, context.vars)) {\r\n      return context\r\n    } else {\r\n      return new Context(context.prev, new Var(varname, context.vars), false)\r\n    }\r\n  }\r\n\r\n  function isModifier(name) {\r\n    return name == \"public\" || name == \"private\" || name == \"protected\" || name == \"abstract\" || name == \"readonly\"\r\n  }\r\n\r\n  // Combinators\r\n\r\n  function Context(prev, vars, block) { this.prev = prev; this.vars = vars; this.block = block }\r\n  function Var(name, next) { this.name = name; this.next = next }\r\n\r\n  var defaultVars = new Var(\"this\", new Var(\"arguments\", null))\r\n  function pushcontext() {\r\n    cx.state.context = new Context(cx.state.context, cx.state.localVars, false)\r\n    cx.state.localVars = defaultVars\r\n  }\r\n  function pushblockcontext() {\r\n    cx.state.context = new Context(cx.state.context, cx.state.localVars, true)\r\n    cx.state.localVars = null\r\n  }\r\n  function popcontext() {\r\n    cx.state.localVars = cx.state.context.vars\r\n    cx.state.context = cx.state.context.prev\r\n  }\r\n  popcontext.lex = true\r\n  function pushlex(type, info) {\r\n    var result = function() {\r\n      var state = cx.state, indent = state.indented;\r\n      if (state.lexical.type == \"stat\") indent = state.lexical.indented;\r\n      else for (var outer = state.lexical; outer && outer.type == \")\" && outer.align; outer = outer.prev)\r\n        indent = outer.indented;\r\n      state.lexical = new JSLexical(indent, cx.stream.column(), type, null, state.lexical, info);\r\n    };\r\n    result.lex = true;\r\n    return result;\r\n  }\r\n  function poplex() {\r\n    var state = cx.state;\r\n    if (state.lexical.prev) {\r\n      if (state.lexical.type == \")\")\r\n        state.indented = state.lexical.indented;\r\n      state.lexical = state.lexical.prev;\r\n    }\r\n  }\r\n  poplex.lex = true;\r\n\r\n  function expect(wanted) {\r\n    function exp(type) {\r\n      if (type == wanted) return cont();\r\n      else if (wanted == \";\" || type == \"}\" || type == \")\" || type == \"]\") return pass();\r\n      else return cont(exp);\r\n    };\r\n    return exp;\r\n  }\r\n\r\n  function statement(type, value) {\r\n    if (type == \"var\") return cont(pushlex(\"vardef\", value), vardef, expect(\";\"), poplex);\r\n    if (type == \"keyword a\") return cont(pushlex(\"form\"), parenExpr, statement, poplex);\r\n    if (type == \"keyword b\") return cont(pushlex(\"form\"), statement, poplex);\r\n    if (type == \"keyword d\") return cx.stream.match(/^\\s*$/, false) ? cont() : cont(pushlex(\"stat\"), maybeexpression, expect(\";\"), poplex);\r\n    if (type == \"debugger\") return cont(expect(\";\"));\r\n    if (type == \"{\") return cont(pushlex(\"}\"), pushblockcontext, block, poplex, popcontext);\r\n    if (type == \";\") return cont();\r\n    if (type == \"if\") {\r\n      if (cx.state.lexical.info == \"else\" && cx.state.cc[cx.state.cc.length - 1] == poplex)\r\n        cx.state.cc.pop()();\r\n      return cont(pushlex(\"form\"), parenExpr, statement, poplex, maybeelse);\r\n    }\r\n    if (type == \"function\") return cont(functiondef);\r\n    if (type == \"for\") return cont(pushlex(\"form\"), forspec, statement, poplex);\r\n    if (type == \"class\" || (isTS && value == \"interface\")) {\r\n      cx.marked = \"keyword\"\r\n      return cont(pushlex(\"form\", type == \"class\" ? type : value), className, poplex)\r\n    }\r\n    if (type == \"variable\") {\r\n      if (isTS && value == \"declare\") {\r\n        cx.marked = \"keyword\"\r\n        return cont(statement)\r\n      } else if (isTS && (value == \"module\" || value == \"enum\" || value == \"type\") && cx.stream.match(/^\\s*\\w/, false)) {\r\n        cx.marked = \"keyword\"\r\n        if (value == \"enum\") return cont(enumdef);\r\n        else if (value == \"type\") return cont(typename, expect(\"operator\"), typeexpr, expect(\";\"));\r\n        else return cont(pushlex(\"form\"), pattern, expect(\"{\"), pushlex(\"}\"), block, poplex, poplex)\r\n      } else if (isTS && value == \"namespace\") {\r\n        cx.marked = \"keyword\"\r\n        return cont(pushlex(\"form\"), expression, statement, poplex)\r\n      } else if (isTS && value == \"abstract\") {\r\n        cx.marked = \"keyword\"\r\n        return cont(statement)\r\n      } else {\r\n        return cont(pushlex(\"stat\"), maybelabel);\r\n      }\r\n    }\r\n    if (type == \"switch\") return cont(pushlex(\"form\"), parenExpr, expect(\"{\"), pushlex(\"}\", \"switch\"), pushblockcontext,\r\n                                      block, poplex, poplex, popcontext);\r\n    if (type == \"case\") return cont(expression, expect(\":\"));\r\n    if (type == \"default\") return cont(expect(\":\"));\r\n    if (type == \"catch\") return cont(pushlex(\"form\"), pushcontext, maybeCatchBinding, statement, poplex, popcontext);\r\n    if (type == \"export\") return cont(pushlex(\"stat\"), afterExport, poplex);\r\n    if (type == \"import\") return cont(pushlex(\"stat\"), afterImport, poplex);\r\n    if (type == \"async\") return cont(statement)\r\n    if (value == \"@\") return cont(expression, statement)\r\n    return pass(pushlex(\"stat\"), expression, expect(\";\"), poplex);\r\n  }\r\n  function maybeCatchBinding(type) {\r\n    if (type == \"(\") return cont(funarg, expect(\")\"))\r\n  }\r\n  function expression(type, value) {\r\n    return expressionInner(type, value, false);\r\n  }\r\n  function expressionNoComma(type, value) {\r\n    return expressionInner(type, value, true);\r\n  }\r\n  function parenExpr(type) {\r\n    if (type != \"(\") return pass()\r\n    return cont(pushlex(\")\"), expression, expect(\")\"), poplex)\r\n  }\r\n  function expressionInner(type, value, noComma) {\r\n    if (cx.state.fatArrowAt == cx.stream.start) {\r\n      var body = noComma ? arrowBodyNoComma : arrowBody;\r\n      if (type == \"(\") return cont(pushcontext, pushlex(\")\"), commasep(funarg, \")\"), poplex, expect(\"=>\"), body, popcontext);\r\n      else if (type == \"variable\") return pass(pushcontext, pattern, expect(\"=>\"), body, popcontext);\r\n    }\r\n\r\n    var maybeop = noComma ? maybeoperatorNoComma : maybeoperatorComma;\r\n    if (atomicTypes.hasOwnProperty(type)) return cont(maybeop);\r\n    if (type == \"function\") return cont(functiondef, maybeop);\r\n    if (type == \"class\" || (isTS && value == \"interface\")) { cx.marked = \"keyword\"; return cont(pushlex(\"form\"), classExpression, poplex); }\r\n    if (type == \"keyword c\" || type == \"async\") return cont(noComma ? expressionNoComma : expression);\r\n    if (type == \"(\") return cont(pushlex(\")\"), maybeexpression, expect(\")\"), poplex, maybeop);\r\n    if (type == \"operator\" || type == \"spread\") return cont(noComma ? expressionNoComma : expression);\r\n    if (type == \"[\") return cont(pushlex(\"]\"), arrayLiteral, poplex, maybeop);\r\n    if (type == \"{\") return contCommasep(objprop, \"}\", null, maybeop);\r\n    if (type == \"quasi\") return pass(quasi, maybeop);\r\n    if (type == \"new\") return cont(maybeTarget(noComma));\r\n    if (type == \"import\") return cont(expression);\r\n    return cont();\r\n  }\r\n  function maybeexpression(type) {\r\n    if (type.match(/[;\\}\\)\\],]/)) return pass();\r\n    return pass(expression);\r\n  }\r\n\r\n  function maybeoperatorComma(type, value) {\r\n    if (type == \",\") return cont(expression);\r\n    return maybeoperatorNoComma(type, value, false);\r\n  }\r\n  function maybeoperatorNoComma(type, value, noComma) {\r\n    var me = noComma == false ? maybeoperatorComma : maybeoperatorNoComma;\r\n    var expr = noComma == false ? expression : expressionNoComma;\r\n    if (type == \"=>\") return cont(pushcontext, noComma ? arrowBodyNoComma : arrowBody, popcontext);\r\n    if (type == \"operator\") {\r\n      if (/\\+\\+|--/.test(value) || isTS && value == \"!\") return cont(me);\r\n      if (isTS && value == \"<\" && cx.stream.match(/^([^>]|<.*?>)*>\\s*\\(/, false))\r\n        return cont(pushlex(\">\"), commasep(typeexpr, \">\"), poplex, me);\r\n      if (value == \"?\") return cont(expression, expect(\":\"), expr);\r\n      return cont(expr);\r\n    }\r\n    if (type == \"quasi\") { return pass(quasi, me); }\r\n    if (type == \";\") return;\r\n    if (type == \"(\") return contCommasep(expressionNoComma, \")\", \"call\", me);\r\n    if (type == \".\") return cont(property, me);\r\n    if (type == \"[\") return cont(pushlex(\"]\"), maybeexpression, expect(\"]\"), poplex, me);\r\n    if (isTS && value == \"as\") { cx.marked = \"keyword\"; return cont(typeexpr, me) }\r\n    if (type == \"regexp\") {\r\n      cx.state.lastType = cx.marked = \"operator\"\r\n      cx.stream.backUp(cx.stream.pos - cx.stream.start - 1)\r\n      return cont(expr)\r\n    }\r\n  }\r\n  function quasi(type, value) {\r\n    if (type != \"quasi\") return pass();\r\n    if (value.slice(value.length - 2) != \"${\") return cont(quasi);\r\n    return cont(expression, continueQuasi);\r\n  }\r\n  function continueQuasi(type) {\r\n    if (type == \"}\") {\r\n      cx.marked = \"string-2\";\r\n      cx.state.tokenize = tokenQuasi;\r\n      return cont(quasi);\r\n    }\r\n  }\r\n  function arrowBody(type) {\r\n    findFatArrow(cx.stream, cx.state);\r\n    return pass(type == \"{\" ? statement : expression);\r\n  }\r\n  function arrowBodyNoComma(type) {\r\n    findFatArrow(cx.stream, cx.state);\r\n    return pass(type == \"{\" ? statement : expressionNoComma);\r\n  }\r\n  function maybeTarget(noComma) {\r\n    return function(type) {\r\n      if (type == \".\") return cont(noComma ? targetNoComma : target);\r\n      else if (type == \"variable\" && isTS) return cont(maybeTypeArgs, noComma ? maybeoperatorNoComma : maybeoperatorComma)\r\n      else return pass(noComma ? expressionNoComma : expression);\r\n    };\r\n  }\r\n  function target(_, value) {\r\n    if (value == \"target\") { cx.marked = \"keyword\"; return cont(maybeoperatorComma); }\r\n  }\r\n  function targetNoComma(_, value) {\r\n    if (value == \"target\") { cx.marked = \"keyword\"; return cont(maybeoperatorNoComma); }\r\n  }\r\n  function maybelabel(type) {\r\n    if (type == \":\") return cont(poplex, statement);\r\n    return pass(maybeoperatorComma, expect(\";\"), poplex);\r\n  }\r\n  function property(type) {\r\n    if (type == \"variable\") {cx.marked = \"property\"; return cont();}\r\n  }\r\n  function objprop(type, value) {\r\n    if (type == \"async\") {\r\n      cx.marked = \"property\";\r\n      return cont(objprop);\r\n    } else if (type == \"variable\" || cx.style == \"keyword\") {\r\n      cx.marked = \"property\";\r\n      if (value == \"get\" || value == \"set\") return cont(getterSetter);\r\n      var m // Work around fat-arrow-detection complication for detecting typescript typed arrow params\r\n      if (isTS && cx.state.fatArrowAt == cx.stream.start && (m = cx.stream.match(/^\\s*:\\s*/, false)))\r\n        cx.state.fatArrowAt = cx.stream.pos + m[0].length\r\n      return cont(afterprop);\r\n    } else if (type == \"number\" || type == \"string\") {\r\n      cx.marked = jsonldMode ? \"property\" : (cx.style + \" property\");\r\n      return cont(afterprop);\r\n    } else if (type == \"jsonld-keyword\") {\r\n      return cont(afterprop);\r\n    } else if (isTS && isModifier(value)) {\r\n      cx.marked = \"keyword\"\r\n      return cont(objprop)\r\n    } else if (type == \"[\") {\r\n      return cont(expression, maybetype, expect(\"]\"), afterprop);\r\n    } else if (type == \"spread\") {\r\n      return cont(expressionNoComma, afterprop);\r\n    } else if (value == \"*\") {\r\n      cx.marked = \"keyword\";\r\n      return cont(objprop);\r\n    } else if (type == \":\") {\r\n      return pass(afterprop)\r\n    }\r\n  }\r\n  function getterSetter(type) {\r\n    if (type != \"variable\") return pass(afterprop);\r\n    cx.marked = \"property\";\r\n    return cont(functiondef);\r\n  }\r\n  function afterprop(type) {\r\n    if (type == \":\") return cont(expressionNoComma);\r\n    if (type == \"(\") return pass(functiondef);\r\n  }\r\n  function commasep(what, end, sep) {\r\n    function proceed(type, value) {\r\n      if (sep ? sep.indexOf(type) > -1 : type == \",\") {\r\n        var lex = cx.state.lexical;\r\n        if (lex.info == \"call\") lex.pos = (lex.pos || 0) + 1;\r\n        return cont(function(type, value) {\r\n          if (type == end || value == end) return pass()\r\n          return pass(what)\r\n        }, proceed);\r\n      }\r\n      if (type == end || value == end) return cont();\r\n      if (sep && sep.indexOf(\";\") > -1) return pass(what)\r\n      return cont(expect(end));\r\n    }\r\n    return function(type, value) {\r\n      if (type == end || value == end) return cont();\r\n      return pass(what, proceed);\r\n    };\r\n  }\r\n  function contCommasep(what, end, info) {\r\n    for (var i = 3; i < arguments.length; i++)\r\n      cx.cc.push(arguments[i]);\r\n    return cont(pushlex(end, info), commasep(what, end), poplex);\r\n  }\r\n  function block(type) {\r\n    if (type == \"}\") return cont();\r\n    return pass(statement, block);\r\n  }\r\n  function maybetype(type, value) {\r\n    if (isTS) {\r\n      if (type == \":\" || value == \"in\") return cont(typeexpr);\r\n      if (value == \"?\") return cont(maybetype);\r\n    }\r\n  }\r\n  function mayberettype(type) {\r\n    if (isTS && type == \":\") {\r\n      if (cx.stream.match(/^\\s*\\w+\\s+is\\b/, false)) return cont(expression, isKW, typeexpr)\r\n      else return cont(typeexpr)\r\n    }\r\n  }\r\n  function isKW(_, value) {\r\n    if (value == \"is\") {\r\n      cx.marked = \"keyword\"\r\n      return cont()\r\n    }\r\n  }\r\n  function typeexpr(type, value) {\r\n    if (value == \"keyof\" || value == \"typeof\" || value == \"infer\") {\r\n      cx.marked = \"keyword\"\r\n      return cont(value == \"typeof\" ? expressionNoComma : typeexpr)\r\n    }\r\n    if (type == \"variable\" || value == \"void\") {\r\n      cx.marked = \"type\"\r\n      return cont(afterType)\r\n    }\r\n    if (value == \"|\" || value == \"&\") return cont(typeexpr)\r\n    if (type == \"string\" || type == \"number\" || type == \"atom\") return cont(afterType);\r\n    if (type == \"[\") return cont(pushlex(\"]\"), commasep(typeexpr, \"]\", \",\"), poplex, afterType)\r\n    if (type == \"{\") return cont(pushlex(\"}\"), commasep(typeprop, \"}\", \",;\"), poplex, afterType)\r\n    if (type == \"(\") return cont(commasep(typearg, \")\"), maybeReturnType, afterType)\r\n    if (type == \"<\") return cont(commasep(typeexpr, \">\"), typeexpr)\r\n  }\r\n  function maybeReturnType(type) {\r\n    if (type == \"=>\") return cont(typeexpr)\r\n  }\r\n  function typeprop(type, value) {\r\n    if (type == \"variable\" || cx.style == \"keyword\") {\r\n      cx.marked = \"property\"\r\n      return cont(typeprop)\r\n    } else if (value == \"?\" || type == \"number\" || type == \"string\") {\r\n      return cont(typeprop)\r\n    } else if (type == \":\") {\r\n      return cont(typeexpr)\r\n    } else if (type == \"[\") {\r\n      return cont(expect(\"variable\"), maybetype, expect(\"]\"), typeprop)\r\n    } else if (type == \"(\") {\r\n      return pass(functiondecl, typeprop)\r\n    }\r\n  }\r\n  function typearg(type, value) {\r\n    if (type == \"variable\" && cx.stream.match(/^\\s*[?:]/, false) || value == \"?\") return cont(typearg)\r\n    if (type == \":\") return cont(typeexpr)\r\n    if (type == \"spread\") return cont(typearg)\r\n    return pass(typeexpr)\r\n  }\r\n  function afterType(type, value) {\r\n    if (value == \"<\") return cont(pushlex(\">\"), commasep(typeexpr, \">\"), poplex, afterType)\r\n    if (value == \"|\" || type == \".\" || value == \"&\") return cont(typeexpr)\r\n    if (type == \"[\") return cont(typeexpr, expect(\"]\"), afterType)\r\n    if (value == \"extends\" || value == \"implements\") { cx.marked = \"keyword\"; return cont(typeexpr) }\r\n    if (value == \"?\") return cont(typeexpr, expect(\":\"), typeexpr)\r\n  }\r\n  function maybeTypeArgs(_, value) {\r\n    if (value == \"<\") return cont(pushlex(\">\"), commasep(typeexpr, \">\"), poplex, afterType)\r\n  }\r\n  function typeparam() {\r\n    return pass(typeexpr, maybeTypeDefault)\r\n  }\r\n  function maybeTypeDefault(_, value) {\r\n    if (value == \"=\") return cont(typeexpr)\r\n  }\r\n  function vardef(_, value) {\r\n    if (value == \"enum\") {cx.marked = \"keyword\"; return cont(enumdef)}\r\n    return pass(pattern, maybetype, maybeAssign, vardefCont);\r\n  }\r\n  function pattern(type, value) {\r\n    if (isTS && isModifier(value)) { cx.marked = \"keyword\"; return cont(pattern) }\r\n    if (type == \"variable\") { register(value); return cont(); }\r\n    if (type == \"spread\") return cont(pattern);\r\n    if (type == \"[\") return contCommasep(eltpattern, \"]\");\r\n    if (type == \"{\") return contCommasep(proppattern, \"}\");\r\n  }\r\n  function proppattern(type, value) {\r\n    if (type == \"variable\" && !cx.stream.match(/^\\s*:/, false)) {\r\n      register(value);\r\n      return cont(maybeAssign);\r\n    }\r\n    if (type == \"variable\") cx.marked = \"property\";\r\n    if (type == \"spread\") return cont(pattern);\r\n    if (type == \"}\") return pass();\r\n    if (type == \"[\") return cont(expression, expect(']'), expect(':'), proppattern);\r\n    return cont(expect(\":\"), pattern, maybeAssign);\r\n  }\r\n  function eltpattern() {\r\n    return pass(pattern, maybeAssign)\r\n  }\r\n  function maybeAssign(_type, value) {\r\n    if (value == \"=\") return cont(expressionNoComma);\r\n  }\r\n  function vardefCont(type) {\r\n    if (type == \",\") return cont(vardef);\r\n  }\r\n  function maybeelse(type, value) {\r\n    if (type == \"keyword b\" && value == \"else\") return cont(pushlex(\"form\", \"else\"), statement, poplex);\r\n  }\r\n  function forspec(type, value) {\r\n    if (value == \"await\") return cont(forspec);\r\n    if (type == \"(\") return cont(pushlex(\")\"), forspec1, poplex);\r\n  }\r\n  function forspec1(type) {\r\n    if (type == \"var\") return cont(vardef, forspec2);\r\n    if (type == \"variable\") return cont(forspec2);\r\n    return pass(forspec2)\r\n  }\r\n  function forspec2(type, value) {\r\n    if (type == \")\") return cont()\r\n    if (type == \";\") return cont(forspec2)\r\n    if (value == \"in\" || value == \"of\") { cx.marked = \"keyword\"; return cont(expression, forspec2) }\r\n    return pass(expression, forspec2)\r\n  }\r\n  function functiondef(type, value) {\r\n    if (value == \"*\") {cx.marked = \"keyword\"; return cont(functiondef);}\r\n    if (type == \"variable\") {register(value); return cont(functiondef);}\r\n    if (type == \"(\") return cont(pushcontext, pushlex(\")\"), commasep(funarg, \")\"), poplex, mayberettype, statement, popcontext);\r\n    if (isTS && value == \"<\") return cont(pushlex(\">\"), commasep(typeparam, \">\"), poplex, functiondef)\r\n  }\r\n  function functiondecl(type, value) {\r\n    if (value == \"*\") {cx.marked = \"keyword\"; return cont(functiondecl);}\r\n    if (type == \"variable\") {register(value); return cont(functiondecl);}\r\n    if (type == \"(\") return cont(pushcontext, pushlex(\")\"), commasep(funarg, \")\"), poplex, mayberettype, popcontext);\r\n    if (isTS && value == \"<\") return cont(pushlex(\">\"), commasep(typeparam, \">\"), poplex, functiondecl)\r\n  }\r\n  function typename(type, value) {\r\n    if (type == \"keyword\" || type == \"variable\") {\r\n      cx.marked = \"type\"\r\n      return cont(typename)\r\n    } else if (value == \"<\") {\r\n      return cont(pushlex(\">\"), commasep(typeparam, \">\"), poplex)\r\n    }\r\n  }\r\n  function funarg(type, value) {\r\n    if (value == \"@\") cont(expression, funarg)\r\n    if (type == \"spread\") return cont(funarg);\r\n    if (isTS && isModifier(value)) { cx.marked = \"keyword\"; return cont(funarg); }\r\n    if (isTS && type == \"this\") return cont(maybetype, maybeAssign)\r\n    return pass(pattern, maybetype, maybeAssign);\r\n  }\r\n  function classExpression(type, value) {\r\n    // Class expressions may have an optional name.\r\n    if (type == \"variable\") return className(type, value);\r\n    return classNameAfter(type, value);\r\n  }\r\n  function className(type, value) {\r\n    if (type == \"variable\") {register(value); return cont(classNameAfter);}\r\n  }\r\n  function classNameAfter(type, value) {\r\n    if (value == \"<\") return cont(pushlex(\">\"), commasep(typeparam, \">\"), poplex, classNameAfter)\r\n    if (value == \"extends\" || value == \"implements\" || (isTS && type == \",\")) {\r\n      if (value == \"implements\") cx.marked = \"keyword\";\r\n      return cont(isTS ? typeexpr : expression, classNameAfter);\r\n    }\r\n    if (type == \"{\") return cont(pushlex(\"}\"), classBody, poplex);\r\n  }\r\n  function classBody(type, value) {\r\n    if (type == \"async\" ||\r\n        (type == \"variable\" &&\r\n         (value == \"static\" || value == \"get\" || value == \"set\" || (isTS && isModifier(value))) &&\r\n         cx.stream.match(/^\\s+[\\w$\\xa1-\\uffff]/, false))) {\r\n      cx.marked = \"keyword\";\r\n      return cont(classBody);\r\n    }\r\n    if (type == \"variable\" || cx.style == \"keyword\") {\r\n      cx.marked = \"property\";\r\n      return cont(isTS ? classfield : functiondef, classBody);\r\n    }\r\n    if (type == \"number\" || type == \"string\") return cont(isTS ? classfield : functiondef, classBody);\r\n    if (type == \"[\")\r\n      return cont(expression, maybetype, expect(\"]\"), isTS ? classfield : functiondef, classBody)\r\n    if (value == \"*\") {\r\n      cx.marked = \"keyword\";\r\n      return cont(classBody);\r\n    }\r\n    if (isTS && type == \"(\") return pass(functiondecl, classBody)\r\n    if (type == \";\" || type == \",\") return cont(classBody);\r\n    if (type == \"}\") return cont();\r\n    if (value == \"@\") return cont(expression, classBody)\r\n  }\r\n  function classfield(type, value) {\r\n    if (value == \"?\") return cont(classfield)\r\n    if (type == \":\") return cont(typeexpr, maybeAssign)\r\n    if (value == \"=\") return cont(expressionNoComma)\r\n    var context = cx.state.lexical.prev, isInterface = context && context.info == \"interface\"\r\n    return pass(isInterface ? functiondecl : functiondef)\r\n  }\r\n  function afterExport(type, value) {\r\n    if (value == \"*\") { cx.marked = \"keyword\"; return cont(maybeFrom, expect(\";\")); }\r\n    if (value == \"default\") { cx.marked = \"keyword\"; return cont(expression, expect(\";\")); }\r\n    if (type == \"{\") return cont(commasep(exportField, \"}\"), maybeFrom, expect(\";\"));\r\n    return pass(statement);\r\n  }\r\n  function exportField(type, value) {\r\n    if (value == \"as\") { cx.marked = \"keyword\"; return cont(expect(\"variable\")); }\r\n    if (type == \"variable\") return pass(expressionNoComma, exportField);\r\n  }\r\n  function afterImport(type) {\r\n    if (type == \"string\") return cont();\r\n    if (type == \"(\") return pass(expression);\r\n    return pass(importSpec, maybeMoreImports, maybeFrom);\r\n  }\r\n  function importSpec(type, value) {\r\n    if (type == \"{\") return contCommasep(importSpec, \"}\");\r\n    if (type == \"variable\") register(value);\r\n    if (value == \"*\") cx.marked = \"keyword\";\r\n    return cont(maybeAs);\r\n  }\r\n  function maybeMoreImports(type) {\r\n    if (type == \",\") return cont(importSpec, maybeMoreImports)\r\n  }\r\n  function maybeAs(_type, value) {\r\n    if (value == \"as\") { cx.marked = \"keyword\"; return cont(importSpec); }\r\n  }\r\n  function maybeFrom(_type, value) {\r\n    if (value == \"from\") { cx.marked = \"keyword\"; return cont(expression); }\r\n  }\r\n  function arrayLiteral(type) {\r\n    if (type == \"]\") return cont();\r\n    return pass(commasep(expressionNoComma, \"]\"));\r\n  }\r\n  function enumdef() {\r\n    return pass(pushlex(\"form\"), pattern, expect(\"{\"), pushlex(\"}\"), commasep(enummember, \"}\"), poplex, poplex)\r\n  }\r\n  function enummember() {\r\n    return pass(pattern, maybeAssign);\r\n  }\r\n\r\n  function isContinuedStatement(state, textAfter) {\r\n    return state.lastType == \"operator\" || state.lastType == \",\" ||\r\n      isOperatorChar.test(textAfter.charAt(0)) ||\r\n      /[,.]/.test(textAfter.charAt(0));\r\n  }\r\n\r\n  function expressionAllowed(stream, state, backUp) {\r\n    return state.tokenize == tokenBase &&\r\n      /^(?:operator|sof|keyword [bcd]|case|new|export|default|spread|[\\[{}\\(,;:]|=>)$/.test(state.lastType) ||\r\n      (state.lastType == \"quasi\" && /\\{\\s*$/.test(stream.string.slice(0, stream.pos - (backUp || 0))))\r\n  }\r\n\r\n  // Interface\r\n\r\n  return {\r\n    startState: function(basecolumn) {\r\n      var state = {\r\n        tokenize: tokenBase,\r\n        lastType: \"sof\",\r\n        cc: [],\r\n        lexical: new JSLexical((basecolumn || 0) - indentUnit, 0, \"block\", false),\r\n        localVars: parserConfig.localVars,\r\n        context: parserConfig.localVars && new Context(null, null, false),\r\n        indented: basecolumn || 0\r\n      };\r\n      if (parserConfig.globalVars && typeof parserConfig.globalVars == \"object\")\r\n        state.globalVars = parserConfig.globalVars;\r\n      return state;\r\n    },\r\n\r\n    token: function(stream, state) {\r\n      if (stream.sol()) {\r\n        if (!state.lexical.hasOwnProperty(\"align\"))\r\n          state.lexical.align = false;\r\n        state.indented = stream.indentation();\r\n        findFatArrow(stream, state);\r\n      }\r\n      if (state.tokenize != tokenComment && stream.eatSpace()) return null;\r\n      var style = state.tokenize(stream, state);\r\n      if (type == \"comment\") return style;\r\n      state.lastType = type == \"operator\" && (content == \"++\" || content == \"--\") ? \"incdec\" : type;\r\n      return parseJS(state, style, type, content, stream);\r\n    },\r\n\r\n    indent: function(state, textAfter) {\r\n      if (state.tokenize == tokenComment) return CodeMirror.Pass;\r\n      if (state.tokenize != tokenBase) return 0;\r\n      var firstChar = textAfter && textAfter.charAt(0), lexical = state.lexical, top\r\n      // Kludge to prevent 'maybelse' from blocking lexical scope pops\r\n      if (!/^\\s*else\\b/.test(textAfter)) for (var i = state.cc.length - 1; i >= 0; --i) {\r\n        var c = state.cc[i];\r\n        if (c == poplex) lexical = lexical.prev;\r\n        else if (c != maybeelse) break;\r\n      }\r\n      while ((lexical.type == \"stat\" || lexical.type == \"form\") &&\r\n             (firstChar == \"}\" || ((top = state.cc[state.cc.length - 1]) &&\r\n                                   (top == maybeoperatorComma || top == maybeoperatorNoComma) &&\r\n                                   !/^[,\\.=+\\-*:?[\\(]/.test(textAfter))))\r\n        lexical = lexical.prev;\r\n      if (statementIndent && lexical.type == \")\" && lexical.prev.type == \"stat\")\r\n        lexical = lexical.prev;\r\n      var type = lexical.type, closing = firstChar == type;\r\n\r\n      if (type == \"vardef\") return lexical.indented + (state.lastType == \"operator\" || state.lastType == \",\" ? lexical.info.length + 1 : 0);\r\n      else if (type == \"form\" && firstChar == \"{\") return lexical.indented;\r\n      else if (type == \"form\") return lexical.indented + indentUnit;\r\n      else if (type == \"stat\")\r\n        return lexical.indented + (isContinuedStatement(state, textAfter) ? statementIndent || indentUnit : 0);\r\n      else if (lexical.info == \"switch\" && !closing && parserConfig.doubleIndentSwitch != false)\r\n        return lexical.indented + (/^(?:case|default)\\b/.test(textAfter) ? indentUnit : 2 * indentUnit);\r\n      else if (lexical.align) return lexical.column + (closing ? 0 : 1);\r\n      else return lexical.indented + (closing ? 0 : indentUnit);\r\n    },\r\n\r\n    electricInput: /^\\s*(?:case .*?:|default:|\\{|\\})$/,\r\n    blockCommentStart: jsonMode ? null : \"/*\",\r\n    blockCommentEnd: jsonMode ? null : \"*/\",\r\n    blockCommentContinue: jsonMode ? null : \" * \",\r\n    lineComment: jsonMode ? null : \"//\",\r\n    fold: \"brace\",\r\n    closeBrackets: \"()[]{}''\\\"\\\"``\",\r\n\r\n    helperType: jsonMode ? \"json\" : \"javascript\",\r\n    jsonldMode: jsonldMode,\r\n    jsonMode: jsonMode,\r\n\r\n    expressionAllowed: expressionAllowed,\r\n\r\n    skipExpression: function(state) {\r\n      var top = state.cc[state.cc.length - 1]\r\n      if (top == expression || top == expressionNoComma) state.cc.pop()\r\n    }\r\n  };\r\n});\r\n\r\nCodeMirror.registerHelper(\"wordChars\", \"javascript\", /[\\w$]/);\r\n\r\nCodeMirror.defineMIME(\"text/javascript\", \"javascript\");\r\nCodeMirror.defineMIME(\"text/ecmascript\", \"javascript\");\r\nCodeMirror.defineMIME(\"application/javascript\", \"javascript\");\r\nCodeMirror.defineMIME(\"application/x-javascript\", \"javascript\");\r\nCodeMirror.defineMIME(\"application/ecmascript\", \"javascript\");\r\nCodeMirror.defineMIME(\"application/json\", {name: \"javascript\", json: true});\r\nCodeMirror.defineMIME(\"application/x-json\", {name: \"javascript\", json: true});\r\nCodeMirror.defineMIME(\"application/ld+json\", {name: \"javascript\", jsonld: true});\r\nCodeMirror.defineMIME(\"text/typescript\", { name: \"javascript\", typescript: true });\r\nCodeMirror.defineMIME(\"application/typescript\", { name: \"javascript\", typescript: true });\r\n\r\n});\r\n\n// CodeMirror, copyright (c) by Marijn Haverbeke and others\r\n// Distributed under an MIT license: https://codemirror.net/LICENSE\r\n\r\n\r\ndefine('skylark-codemirror/mode/htmlmixed/htmlmixed',[\r\n  \"../../CodeMirror\",\r\n  \"../xml/xml\",\r\n  \"../javascript/javascript\",\r\n  \"../css/css\"\r\n], function(CodeMirror) {\r\n\r\n  \"use strict\";\r\n\r\n  var defaultTags = {\r\n    script: [\r\n      [\"lang\", /(javascript|babel)/i, \"javascript\"],\r\n      [\"type\", /^(?:text|application)\\/(?:x-)?(?:java|ecma)script$|^module$|^$/i, \"javascript\"],\r\n      [\"type\", /./, \"text/plain\"],\r\n      [null, null, \"javascript\"]\r\n    ],\r\n    style:  [\r\n      [\"lang\", /^css$/i, \"css\"],\r\n      [\"type\", /^(text\\/)?(x-)?(stylesheet|css)$/i, \"css\"],\r\n      [\"type\", /./, \"text/plain\"],\r\n      [null, null, \"css\"]\r\n    ]\r\n  };\r\n\r\n  function maybeBackup(stream, pat, style) {\r\n    var cur = stream.current(), close = cur.search(pat);\r\n    if (close > -1) {\r\n      stream.backUp(cur.length - close);\r\n    } else if (cur.match(/<\\/?$/)) {\r\n      stream.backUp(cur.length);\r\n      if (!stream.match(pat, false)) stream.match(cur);\r\n    }\r\n    return style;\r\n  }\r\n\r\n  var attrRegexpCache = {};\r\n  function getAttrRegexp(attr) {\r\n    var regexp = attrRegexpCache[attr];\r\n    if (regexp) return regexp;\r\n    return attrRegexpCache[attr] = new RegExp(\"\\\\s+\" + attr + \"\\\\s*=\\\\s*('|\\\")?([^'\\\"]+)('|\\\")?\\\\s*\");\r\n  }\r\n\r\n  function getAttrValue(text, attr) {\r\n    var match = text.match(getAttrRegexp(attr))\r\n    return match ? /^\\s*(.*?)\\s*$/.exec(match[2])[1] : \"\"\r\n  }\r\n\r\n  function getTagRegexp(tagName, anchored) {\r\n    return new RegExp((anchored ? \"^\" : \"\") + \"<\\/\\s*\" + tagName + \"\\s*>\", \"i\");\r\n  }\r\n\r\n  function addTags(from, to) {\r\n    for (var tag in from) {\r\n      var dest = to[tag] || (to[tag] = []);\r\n      var source = from[tag];\r\n      for (var i = source.length - 1; i >= 0; i--)\r\n        dest.unshift(source[i])\r\n    }\r\n  }\r\n\r\n  function findMatchingMode(tagInfo, tagText) {\r\n    for (var i = 0; i < tagInfo.length; i++) {\r\n      var spec = tagInfo[i];\r\n      if (!spec[0] || spec[1].test(getAttrValue(tagText, spec[0]))) return spec[2];\r\n    }\r\n  }\r\n\r\n  CodeMirror.defineMode(\"htmlmixed\", function (config, parserConfig) {\r\n    var htmlMode = CodeMirror.getMode(config, {\r\n      name: \"xml\",\r\n      htmlMode: true,\r\n      multilineTagIndentFactor: parserConfig.multilineTagIndentFactor,\r\n      multilineTagIndentPastTag: parserConfig.multilineTagIndentPastTag\r\n    });\r\n\r\n    var tags = {};\r\n    var configTags = parserConfig && parserConfig.tags, configScript = parserConfig && parserConfig.scriptTypes;\r\n    addTags(defaultTags, tags);\r\n    if (configTags) addTags(configTags, tags);\r\n    if (configScript) for (var i = configScript.length - 1; i >= 0; i--)\r\n      tags.script.unshift([\"type\", configScript[i].matches, configScript[i].mode])\r\n\r\n    function html(stream, state) {\r\n      var style = htmlMode.token(stream, state.htmlState), tag = /\\btag\\b/.test(style), tagName\r\n      if (tag && !/[<>\\s\\/]/.test(stream.current()) &&\r\n          (tagName = state.htmlState.tagName && state.htmlState.tagName.toLowerCase()) &&\r\n          tags.hasOwnProperty(tagName)) {\r\n        state.inTag = tagName + \" \"\r\n      } else if (state.inTag && tag && />$/.test(stream.current())) {\r\n        var inTag = /^([\\S]+) (.*)/.exec(state.inTag)\r\n        state.inTag = null\r\n        var modeSpec = stream.current() == \">\" && findMatchingMode(tags[inTag[1]], inTag[2])\r\n        var mode = CodeMirror.getMode(config, modeSpec)\r\n        var endTagA = getTagRegexp(inTag[1], true), endTag = getTagRegexp(inTag[1], false);\r\n        state.token = function (stream, state) {\r\n          if (stream.match(endTagA, false)) {\r\n            state.token = html;\r\n            state.localState = state.localMode = null;\r\n            return null;\r\n          }\r\n          return maybeBackup(stream, endTag, state.localMode.token(stream, state.localState));\r\n        };\r\n        state.localMode = mode;\r\n        state.localState = CodeMirror.startState(mode, htmlMode.indent(state.htmlState, \"\", \"\"));\r\n      } else if (state.inTag) {\r\n        state.inTag += stream.current()\r\n        if (stream.eol()) state.inTag += \" \"\r\n      }\r\n      return style;\r\n    };\r\n\r\n    return {\r\n      startState: function () {\r\n        var state = CodeMirror.startState(htmlMode);\r\n        return {token: html, inTag: null, localMode: null, localState: null, htmlState: state};\r\n      },\r\n\r\n      copyState: function (state) {\r\n        var local;\r\n        if (state.localState) {\r\n          local = CodeMirror.copyState(state.localMode, state.localState);\r\n        }\r\n        return {token: state.token, inTag: state.inTag,\r\n                localMode: state.localMode, localState: local,\r\n                htmlState: CodeMirror.copyState(htmlMode, state.htmlState)};\r\n      },\r\n\r\n      token: function (stream, state) {\r\n        return state.token(stream, state);\r\n      },\r\n\r\n      indent: function (state, textAfter, line) {\r\n        if (!state.localMode || /^\\s*<\\//.test(textAfter))\r\n          return htmlMode.indent(state.htmlState, textAfter, line);\r\n        else if (state.localMode.indent)\r\n          return state.localMode.indent(state.localState, textAfter, line);\r\n        else\r\n          return CodeMirror.Pass;\r\n      },\r\n\r\n      innerMode: function (state) {\r\n        return {state: state.localState || state.htmlState, mode: state.localMode || htmlMode};\r\n      }\r\n    };\r\n  }, \"xml\", \"javascript\", \"css\");\r\n\r\n  CodeMirror.defineMIME(\"text/html\", \"htmlmixed\");\r\n});\r\n\n// CodeMirror, copyright (c) by Marijn Haverbeke and others\r\n// Distributed under an MIT license: https://codemirror.net/LICENSE\r\n\r\n// Open simple dialogs on top of an editor. Relies on dialog.css.\r\n\r\ndefine('skylark-codemirror/addon/dialog/dialog',[\"../../CodeMirror\"], function(CodeMirror) {\r\n  function dialogDiv(cm, template, bottom) {\r\n    var wrap = cm.getWrapperElement();\r\n    var dialog;\r\n    dialog = wrap.appendChild(document.createElement(\"div\"));\r\n    if (bottom)\r\n      dialog.className = \"CodeMirror-dialog CodeMirror-dialog-bottom\";\r\n    else\r\n      dialog.className = \"CodeMirror-dialog CodeMirror-dialog-top\";\r\n\r\n    if (typeof template == \"string\") {\r\n      dialog.innerHTML = template;\r\n    } else { // Assuming it's a detached DOM element.\r\n      dialog.appendChild(template);\r\n    }\r\n    CodeMirror.addClass(wrap, 'dialog-opened');\r\n    return dialog;\r\n  }\r\n\r\n  function closeNotification(cm, newVal) {\r\n    if (cm.state.currentNotificationClose)\r\n      cm.state.currentNotificationClose();\r\n    cm.state.currentNotificationClose = newVal;\r\n  }\r\n\r\n  CodeMirror.defineExtension(\"openDialog\", function(template, callback, options) {\r\n    if (!options) options = {};\r\n\r\n    closeNotification(this, null);\r\n\r\n    var dialog = dialogDiv(this, template, options.bottom);\r\n    var closed = false, me = this;\r\n    function close(newVal) {\r\n      if (typeof newVal == 'string') {\r\n        inp.value = newVal;\r\n      } else {\r\n        if (closed) return;\r\n        closed = true;\r\n        CodeMirror.rmClass(dialog.parentNode, 'dialog-opened');\r\n        dialog.parentNode.removeChild(dialog);\r\n        me.focus();\r\n\r\n        if (options.onClose) options.onClose(dialog);\r\n      }\r\n    }\r\n\r\n    var inp = dialog.getElementsByTagName(\"input\")[0], button;\r\n    if (inp) {\r\n      inp.focus();\r\n\r\n      if (options.value) {\r\n        inp.value = options.value;\r\n        if (options.selectValueOnOpen !== false) {\r\n          inp.select();\r\n        }\r\n      }\r\n\r\n      if (options.onInput)\r\n        CodeMirror.on(inp, \"input\", function(e) { options.onInput(e, inp.value, close);});\r\n      if (options.onKeyUp)\r\n        CodeMirror.on(inp, \"keyup\", function(e) {options.onKeyUp(e, inp.value, close);});\r\n\r\n      CodeMirror.on(inp, \"keydown\", function(e) {\r\n        if (options && options.onKeyDown && options.onKeyDown(e, inp.value, close)) { return; }\r\n        if (e.keyCode == 27 || (options.closeOnEnter !== false && e.keyCode == 13)) {\r\n          inp.blur();\r\n          CodeMirror.e_stop(e);\r\n          close();\r\n        }\r\n        if (e.keyCode == 13) callback(inp.value, e);\r\n      });\r\n\r\n      if (options.closeOnBlur !== false) CodeMirror.on(inp, \"blur\", close);\r\n    } else if (button = dialog.getElementsByTagName(\"button\")[0]) {\r\n      CodeMirror.on(button, \"click\", function() {\r\n        close();\r\n        me.focus();\r\n      });\r\n\r\n      if (options.closeOnBlur !== false) CodeMirror.on(button, \"blur\", close);\r\n\r\n      button.focus();\r\n    }\r\n    return close;\r\n  });\r\n\r\n  CodeMirror.defineExtension(\"openConfirm\", function(template, callbacks, options) {\r\n    closeNotification(this, null);\r\n    var dialog = dialogDiv(this, template, options && options.bottom);\r\n    var buttons = dialog.getElementsByTagName(\"button\");\r\n    var closed = false, me = this, blurring = 1;\r\n    function close() {\r\n      if (closed) return;\r\n      closed = true;\r\n      CodeMirror.rmClass(dialog.parentNode, 'dialog-opened');\r\n      dialog.parentNode.removeChild(dialog);\r\n      me.focus();\r\n    }\r\n    buttons[0].focus();\r\n    for (var i = 0; i < buttons.length; ++i) {\r\n      var b = buttons[i];\r\n      (function(callback) {\r\n        CodeMirror.on(b, \"click\", function(e) {\r\n          CodeMirror.e_preventDefault(e);\r\n          close();\r\n          if (callback) callback(me);\r\n        });\r\n      })(callbacks[i]);\r\n      CodeMirror.on(b, \"blur\", function() {\r\n        --blurring;\r\n        setTimeout(function() { if (blurring <= 0) close(); }, 200);\r\n      });\r\n      CodeMirror.on(b, \"focus\", function() { ++blurring; });\r\n    }\r\n  });\r\n\r\n  /*\r\n   * openNotification\r\n   * Opens a notification, that can be closed with an optional timer\r\n   * (default 5000ms timer) and always closes on click.\r\n   *\r\n   * If a notification is opened while another is opened, it will close the\r\n   * currently opened one and open the new one immediately.\r\n   */\r\n  CodeMirror.defineExtension(\"openNotification\", function(template, options) {\r\n    closeNotification(this, close);\r\n    var dialog = dialogDiv(this, template, options && options.bottom);\r\n    var closed = false, doneTimer;\r\n    var duration = options && typeof options.duration !== \"undefined\" ? options.duration : 5000;\r\n\r\n    function close() {\r\n      if (closed) return;\r\n      closed = true;\r\n      clearTimeout(doneTimer);\r\n      CodeMirror.rmClass(dialog.parentNode, 'dialog-opened');\r\n      dialog.parentNode.removeChild(dialog);\r\n    }\r\n\r\n    CodeMirror.on(dialog, 'click', function(e) {\r\n      CodeMirror.e_preventDefault(e);\r\n      close();\r\n    });\r\n\r\n    if (duration)\r\n      doneTimer = setTimeout(close, duration);\r\n\r\n    return close;\r\n  });\r\n});\r\n\n// CodeMirror, copyright (c) by Marijn Haverbeke and others\r\n// Distributed under an MIT license: https://codemirror.net/LICENSE\r\n\r\ndefine('skylark-codemirror/addon/search/searchcursor',[\"../../CodeMirror\"],function(CodeMirror) {\r\n  \"use strict\"\r\n  var Pos = CodeMirror.Pos\r\n\r\n  function regexpFlags(regexp) {\r\n    var flags = regexp.flags\r\n    return flags != null ? flags : (regexp.ignoreCase ? \"i\" : \"\")\r\n      + (regexp.global ? \"g\" : \"\")\r\n      + (regexp.multiline ? \"m\" : \"\")\r\n  }\r\n\r\n  function ensureFlags(regexp, flags) {\r\n    var current = regexpFlags(regexp), target = current\r\n    for (var i = 0; i < flags.length; i++) if (target.indexOf(flags.charAt(i)) == -1)\r\n      target += flags.charAt(i)\r\n    return current == target ? regexp : new RegExp(regexp.source, target)\r\n  }\r\n\r\n  function maybeMultiline(regexp) {\r\n    return /\\\\s|\\\\n|\\n|\\\\W|\\\\D|\\[\\^/.test(regexp.source)\r\n  }\r\n\r\n  function searchRegexpForward(doc, regexp, start) {\r\n    regexp = ensureFlags(regexp, \"g\")\r\n    for (var line = start.line, ch = start.ch, last = doc.lastLine(); line <= last; line++, ch = 0) {\r\n      regexp.lastIndex = ch\r\n      var string = doc.getLine(line), match = regexp.exec(string)\r\n      if (match)\r\n        return {from: Pos(line, match.index),\r\n                to: Pos(line, match.index + match[0].length),\r\n                match: match}\r\n    }\r\n  }\r\n\r\n  function searchRegexpForwardMultiline(doc, regexp, start) {\r\n    if (!maybeMultiline(regexp)) return searchRegexpForward(doc, regexp, start)\r\n\r\n    regexp = ensureFlags(regexp, \"gm\")\r\n    var string, chunk = 1\r\n    for (var line = start.line, last = doc.lastLine(); line <= last;) {\r\n      // This grows the search buffer in exponentially-sized chunks\r\n      // between matches, so that nearby matches are fast and don't\r\n      // require concatenating the whole document (in case we're\r\n      // searching for something that has tons of matches), but at the\r\n      // same time, the amount of retries is limited.\r\n      for (var i = 0; i < chunk; i++) {\r\n        if (line > last) break\r\n        var curLine = doc.getLine(line++)\r\n        string = string == null ? curLine : string + \"\\n\" + curLine\r\n      }\r\n      chunk = chunk * 2\r\n      regexp.lastIndex = start.ch\r\n      var match = regexp.exec(string)\r\n      if (match) {\r\n        var before = string.slice(0, match.index).split(\"\\n\"), inside = match[0].split(\"\\n\")\r\n        var startLine = start.line + before.length - 1, startCh = before[before.length - 1].length\r\n        return {from: Pos(startLine, startCh),\r\n                to: Pos(startLine + inside.length - 1,\r\n                        inside.length == 1 ? startCh + inside[0].length : inside[inside.length - 1].length),\r\n                match: match}\r\n      }\r\n    }\r\n  }\r\n\r\n  function lastMatchIn(string, regexp) {\r\n    var cutOff = 0, match\r\n    for (;;) {\r\n      regexp.lastIndex = cutOff\r\n      var newMatch = regexp.exec(string)\r\n      if (!newMatch) return match\r\n      match = newMatch\r\n      cutOff = match.index + (match[0].length || 1)\r\n      if (cutOff == string.length) return match\r\n    }\r\n  }\r\n\r\n  function searchRegexpBackward(doc, regexp, start) {\r\n    regexp = ensureFlags(regexp, \"g\")\r\n    for (var line = start.line, ch = start.ch, first = doc.firstLine(); line >= first; line--, ch = -1) {\r\n      var string = doc.getLine(line)\r\n      if (ch > -1) string = string.slice(0, ch)\r\n      var match = lastMatchIn(string, regexp)\r\n      if (match)\r\n        return {from: Pos(line, match.index),\r\n                to: Pos(line, match.index + match[0].length),\r\n                match: match}\r\n    }\r\n  }\r\n\r\n  function searchRegexpBackwardMultiline(doc, regexp, start) {\r\n    regexp = ensureFlags(regexp, \"gm\")\r\n    var string, chunk = 1\r\n    for (var line = start.line, first = doc.firstLine(); line >= first;) {\r\n      for (var i = 0; i < chunk; i++) {\r\n        var curLine = doc.getLine(line--)\r\n        string = string == null ? curLine.slice(0, start.ch) : curLine + \"\\n\" + string\r\n      }\r\n      chunk *= 2\r\n\r\n      var match = lastMatchIn(string, regexp)\r\n      if (match) {\r\n        var before = string.slice(0, match.index).split(\"\\n\"), inside = match[0].split(\"\\n\")\r\n        var startLine = line + before.length, startCh = before[before.length - 1].length\r\n        return {from: Pos(startLine, startCh),\r\n                to: Pos(startLine + inside.length - 1,\r\n                        inside.length == 1 ? startCh + inside[0].length : inside[inside.length - 1].length),\r\n                match: match}\r\n      }\r\n    }\r\n  }\r\n\r\n  var doFold, noFold\r\n  if (String.prototype.normalize) {\r\n    doFold = function(str) { return str.normalize(\"NFD\").toLowerCase() }\r\n    noFold = function(str) { return str.normalize(\"NFD\") }\r\n  } else {\r\n    doFold = function(str) { return str.toLowerCase() }\r\n    noFold = function(str) { return str }\r\n  }\r\n\r\n  // Maps a position in a case-folded line back to a position in the original line\r\n  // (compensating for codepoints increasing in number during folding)\r\n  function adjustPos(orig, folded, pos, foldFunc) {\r\n    if (orig.length == folded.length) return pos\r\n    for (var min = 0, max = pos + Math.max(0, orig.length - folded.length);;) {\r\n      if (min == max) return min\r\n      var mid = (min + max) >> 1\r\n      var len = foldFunc(orig.slice(0, mid)).length\r\n      if (len == pos) return mid\r\n      else if (len > pos) max = mid\r\n      else min = mid + 1\r\n    }\r\n  }\r\n\r\n  function searchStringForward(doc, query, start, caseFold) {\r\n    // Empty string would match anything and never progress, so we\r\n    // define it to match nothing instead.\r\n    if (!query.length) return null\r\n    var fold = caseFold ? doFold : noFold\r\n    var lines = fold(query).split(/\\r|\\n\\r?/)\r\n\r\n    search: for (var line = start.line, ch = start.ch, last = doc.lastLine() + 1 - lines.length; line <= last; line++, ch = 0) {\r\n      var orig = doc.getLine(line).slice(ch), string = fold(orig)\r\n      if (lines.length == 1) {\r\n        var found = string.indexOf(lines[0])\r\n        if (found == -1) continue search\r\n        var start = adjustPos(orig, string, found, fold) + ch\r\n        return {from: Pos(line, adjustPos(orig, string, found, fold) + ch),\r\n                to: Pos(line, adjustPos(orig, string, found + lines[0].length, fold) + ch)}\r\n      } else {\r\n        var cutFrom = string.length - lines[0].length\r\n        if (string.slice(cutFrom) != lines[0]) continue search\r\n        for (var i = 1; i < lines.length - 1; i++)\r\n          if (fold(doc.getLine(line + i)) != lines[i]) continue search\r\n        var end = doc.getLine(line + lines.length - 1), endString = fold(end), lastLine = lines[lines.length - 1]\r\n        if (endString.slice(0, lastLine.length) != lastLine) continue search\r\n        return {from: Pos(line, adjustPos(orig, string, cutFrom, fold) + ch),\r\n                to: Pos(line + lines.length - 1, adjustPos(end, endString, lastLine.length, fold))}\r\n      }\r\n    }\r\n  }\r\n\r\n  function searchStringBackward(doc, query, start, caseFold) {\r\n    if (!query.length) return null\r\n    var fold = caseFold ? doFold : noFold\r\n    var lines = fold(query).split(/\\r|\\n\\r?/)\r\n\r\n    search: for (var line = start.line, ch = start.ch, first = doc.firstLine() - 1 + lines.length; line >= first; line--, ch = -1) {\r\n      var orig = doc.getLine(line)\r\n      if (ch > -1) orig = orig.slice(0, ch)\r\n      var string = fold(orig)\r\n      if (lines.length == 1) {\r\n        var found = string.lastIndexOf(lines[0])\r\n        if (found == -1) continue search\r\n        return {from: Pos(line, adjustPos(orig, string, found, fold)),\r\n                to: Pos(line, adjustPos(orig, string, found + lines[0].length, fold))}\r\n      } else {\r\n        var lastLine = lines[lines.length - 1]\r\n        if (string.slice(0, lastLine.length) != lastLine) continue search\r\n        for (var i = 1, start = line - lines.length + 1; i < lines.length - 1; i++)\r\n          if (fold(doc.getLine(start + i)) != lines[i]) continue search\r\n        var top = doc.getLine(line + 1 - lines.length), topString = fold(top)\r\n        if (topString.slice(topString.length - lines[0].length) != lines[0]) continue search\r\n        return {from: Pos(line + 1 - lines.length, adjustPos(top, topString, top.length - lines[0].length, fold)),\r\n                to: Pos(line, adjustPos(orig, string, lastLine.length, fold))}\r\n      }\r\n    }\r\n  }\r\n\r\n  function SearchCursor(doc, query, pos, options) {\r\n    this.atOccurrence = false\r\n    this.doc = doc\r\n    pos = pos ? doc.clipPos(pos) : Pos(0, 0)\r\n    this.pos = {from: pos, to: pos}\r\n\r\n    var caseFold\r\n    if (typeof options == \"object\") {\r\n      caseFold = options.caseFold\r\n    } else { // Backwards compat for when caseFold was the 4th argument\r\n      caseFold = options\r\n      options = null\r\n    }\r\n\r\n    if (typeof query == \"string\") {\r\n      if (caseFold == null) caseFold = false\r\n      this.matches = function(reverse, pos) {\r\n        return (reverse ? searchStringBackward : searchStringForward)(doc, query, pos, caseFold)\r\n      }\r\n    } else {\r\n      query = ensureFlags(query, \"gm\")\r\n      if (!options || options.multiline !== false)\r\n        this.matches = function(reverse, pos) {\r\n          return (reverse ? searchRegexpBackwardMultiline : searchRegexpForwardMultiline)(doc, query, pos)\r\n        }\r\n      else\r\n        this.matches = function(reverse, pos) {\r\n          return (reverse ? searchRegexpBackward : searchRegexpForward)(doc, query, pos)\r\n        }\r\n    }\r\n  }\r\n\r\n  SearchCursor.prototype = {\r\n    findNext: function() {return this.find(false)},\r\n    findPrevious: function() {return this.find(true)},\r\n\r\n    find: function(reverse) {\r\n      var result = this.matches(reverse, this.doc.clipPos(reverse ? this.pos.from : this.pos.to))\r\n\r\n      // Implements weird auto-growing behavior on null-matches for\r\n      // backwards-compatiblity with the vim code (unfortunately)\r\n      while (result && CodeMirror.cmpPos(result.from, result.to) == 0) {\r\n        if (reverse) {\r\n          if (result.from.ch) result.from = Pos(result.from.line, result.from.ch - 1)\r\n          else if (result.from.line == this.doc.firstLine()) result = null\r\n          else result = this.matches(reverse, this.doc.clipPos(Pos(result.from.line - 1)))\r\n        } else {\r\n          if (result.to.ch < this.doc.getLine(result.to.line).length) result.to = Pos(result.to.line, result.to.ch + 1)\r\n          else if (result.to.line == this.doc.lastLine()) result = null\r\n          else result = this.matches(reverse, Pos(result.to.line + 1, 0))\r\n        }\r\n      }\r\n\r\n      if (result) {\r\n        this.pos = result\r\n        this.atOccurrence = true\r\n        return this.pos.match || true\r\n      } else {\r\n        var end = Pos(reverse ? this.doc.firstLine() : this.doc.lastLine() + 1, 0)\r\n        this.pos = {from: end, to: end}\r\n        return this.atOccurrence = false\r\n      }\r\n    },\r\n\r\n    from: function() {if (this.atOccurrence) return this.pos.from},\r\n    to: function() {if (this.atOccurrence) return this.pos.to},\r\n\r\n    replace: function(newText, origin) {\r\n      if (!this.atOccurrence) return\r\n      var lines = CodeMirror.splitLines(newText)\r\n      this.doc.replaceRange(lines, this.pos.from, this.pos.to, origin)\r\n      this.pos.to = Pos(this.pos.from.line + lines.length - 1,\r\n                        lines[lines.length - 1].length + (lines.length == 1 ? this.pos.from.ch : 0))\r\n    }\r\n  }\r\n\r\n  CodeMirror.defineExtension(\"getSearchCursor\", function(query, pos, caseFold) {\r\n    return new SearchCursor(this.doc, query, pos, caseFold)\r\n  })\r\n  CodeMirror.defineDocExtension(\"getSearchCursor\", function(query, pos, caseFold) {\r\n    return new SearchCursor(this, query, pos, caseFold)\r\n  })\r\n\r\n  CodeMirror.defineExtension(\"selectMatches\", function(query, caseFold) {\r\n    var ranges = []\r\n    var cur = this.getSearchCursor(query, this.getCursor(\"from\"), caseFold)\r\n    while (cur.findNext()) {\r\n      if (CodeMirror.cmpPos(cur.to(), this.getCursor(\"to\")) > 0) break\r\n      ranges.push({anchor: cur.from(), head: cur.to()})\r\n    }\r\n    if (ranges.length)\r\n      this.setSelections(ranges, 0)\r\n  })\r\n});\r\n\n// CodeMirror, copyright (c) by Marijn Haverbeke and others\r\n// Distributed under an MIT license: https://codemirror.net/LICENSE\r\n\r\n// Define search commands. Depends on dialog.js or another\r\n// implementation of the openDialog method.\r\n\r\n// Replace works a little oddly -- it will do the replace on the next\r\n// Ctrl-G (or whatever is bound to findNext) press. You prevent a\r\n// replace by making sure the match is no longer selected when hitting\r\n// Ctrl-G.\r\n\r\ndefine('skylark-codemirror/addon/search/search',[\"../../CodeMirror\", \"./searchcursor\", \"../dialog/dialog\"],function(CodeMirror) {\r\n  \"use strict\";\r\n\r\n  function searchOverlay(query, caseInsensitive) {\r\n    if (typeof query == \"string\")\r\n      query = new RegExp(query.replace(/[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g, \"\\\\$&\"), caseInsensitive ? \"gi\" : \"g\");\r\n    else if (!query.global)\r\n      query = new RegExp(query.source, query.ignoreCase ? \"gi\" : \"g\");\r\n\r\n    return {token: function(stream) {\r\n      query.lastIndex = stream.pos;\r\n      var match = query.exec(stream.string);\r\n      if (match && match.index == stream.pos) {\r\n        stream.pos += match[0].length || 1;\r\n        return \"searching\";\r\n      } else if (match) {\r\n        stream.pos = match.index;\r\n      } else {\r\n        stream.skipToEnd();\r\n      }\r\n    }};\r\n  }\r\n\r\n  function SearchState() {\r\n    this.posFrom = this.posTo = this.lastQuery = this.query = null;\r\n    this.overlay = null;\r\n  }\r\n\r\n  function getSearchState(cm) {\r\n    return cm.state.search || (cm.state.search = new SearchState());\r\n  }\r\n\r\n  function queryCaseInsensitive(query) {\r\n    return typeof query == \"string\" && query == query.toLowerCase();\r\n  }\r\n\r\n  function getSearchCursor(cm, query, pos) {\r\n    // Heuristic: if the query string is all lowercase, do a case insensitive search.\r\n    return cm.getSearchCursor(query, pos, {caseFold: queryCaseInsensitive(query), multiline: true});\r\n  }\r\n\r\n  function persistentDialog(cm, text, deflt, onEnter, onKeyDown) {\r\n    cm.openDialog(text, onEnter, {\r\n      value: deflt,\r\n      selectValueOnOpen: true,\r\n      closeOnEnter: false,\r\n      onClose: function() { clearSearch(cm); },\r\n      onKeyDown: onKeyDown\r\n    });\r\n  }\r\n\r\n  function dialog(cm, text, shortText, deflt, f) {\r\n    if (cm.openDialog) cm.openDialog(text, f, {value: deflt, selectValueOnOpen: true});\r\n    else f(prompt(shortText, deflt));\r\n  }\r\n\r\n  function confirmDialog(cm, text, shortText, fs) {\r\n    if (cm.openConfirm) cm.openConfirm(text, fs);\r\n    else if (confirm(shortText)) fs[0]();\r\n  }\r\n\r\n  function parseString(string) {\r\n    return string.replace(/\\\\(.)/g, function(_, ch) {\r\n      if (ch == \"n\") return \"\\n\"\r\n      if (ch == \"r\") return \"\\r\"\r\n      return ch\r\n    })\r\n  }\r\n\r\n  function parseQuery(query) {\r\n    var isRE = query.match(/^\\/(.*)\\/([a-z]*)$/);\r\n    if (isRE) {\r\n      try { query = new RegExp(isRE[1], isRE[2].indexOf(\"i\") == -1 ? \"\" : \"i\"); }\r\n      catch(e) {} // Not a regular expression after all, do a string search\r\n    } else {\r\n      query = parseString(query)\r\n    }\r\n    if (typeof query == \"string\" ? query == \"\" : query.test(\"\"))\r\n      query = /x^/;\r\n    return query;\r\n  }\r\n\r\n  function startSearch(cm, state, query) {\r\n    state.queryText = query;\r\n    state.query = parseQuery(query);\r\n    cm.removeOverlay(state.overlay, queryCaseInsensitive(state.query));\r\n    state.overlay = searchOverlay(state.query, queryCaseInsensitive(state.query));\r\n    cm.addOverlay(state.overlay);\r\n    if (cm.showMatchesOnScrollbar) {\r\n      if (state.annotate) { state.annotate.clear(); state.annotate = null; }\r\n      state.annotate = cm.showMatchesOnScrollbar(state.query, queryCaseInsensitive(state.query));\r\n    }\r\n  }\r\n\r\n  function doSearch(cm, rev, persistent, immediate) {\r\n    var state = getSearchState(cm);\r\n    if (state.query) return findNext(cm, rev);\r\n    var q = cm.getSelection() || state.lastQuery;\r\n    if (q instanceof RegExp && q.source == \"x^\") q = null\r\n    if (persistent && cm.openDialog) {\r\n      var hiding = null\r\n      var searchNext = function(query, event) {\r\n        CodeMirror.e_stop(event);\r\n        if (!query) return;\r\n        if (query != state.queryText) {\r\n          startSearch(cm, state, query);\r\n          state.posFrom = state.posTo = cm.getCursor();\r\n        }\r\n        if (hiding) hiding.style.opacity = 1\r\n        findNext(cm, event.shiftKey, function(_, to) {\r\n          var dialog\r\n          if (to.line < 3 && document.querySelector &&\r\n              (dialog = cm.display.wrapper.querySelector(\".CodeMirror-dialog\")) &&\r\n              dialog.getBoundingClientRect().bottom - 4 > cm.cursorCoords(to, \"window\").top)\r\n            (hiding = dialog).style.opacity = .4\r\n        })\r\n      };\r\n      persistentDialog(cm, getQueryDialog(cm), q, searchNext, function(event, query) {\r\n        var keyName = CodeMirror.keyName(event)\r\n        var extra = cm.getOption('extraKeys'), cmd = (extra && extra[keyName]) || CodeMirror.keyMap[cm.getOption(\"keyMap\")][keyName]\r\n        if (cmd == \"findNext\" || cmd == \"findPrev\" ||\r\n          cmd == \"findPersistentNext\" || cmd == \"findPersistentPrev\") {\r\n          CodeMirror.e_stop(event);\r\n          startSearch(cm, getSearchState(cm), query);\r\n          cm.execCommand(cmd);\r\n        } else if (cmd == \"find\" || cmd == \"findPersistent\") {\r\n          CodeMirror.e_stop(event);\r\n          searchNext(query, event);\r\n        }\r\n      });\r\n      if (immediate && q) {\r\n        startSearch(cm, state, q);\r\n        findNext(cm, rev);\r\n      }\r\n    } else {\r\n      dialog(cm, getQueryDialog(cm), \"Search for:\", q, function(query) {\r\n        if (query && !state.query) cm.operation(function() {\r\n          startSearch(cm, state, query);\r\n          state.posFrom = state.posTo = cm.getCursor();\r\n          findNext(cm, rev);\r\n        });\r\n      });\r\n    }\r\n  }\r\n\r\n  function findNext(cm, rev, callback) {cm.operation(function() {\r\n    var state = getSearchState(cm);\r\n    var cursor = getSearchCursor(cm, state.query, rev ? state.posFrom : state.posTo);\r\n    if (!cursor.find(rev)) {\r\n      cursor = getSearchCursor(cm, state.query, rev ? CodeMirror.Pos(cm.lastLine()) : CodeMirror.Pos(cm.firstLine(), 0));\r\n      if (!cursor.find(rev)) return;\r\n    }\r\n    cm.setSelection(cursor.from(), cursor.to());\r\n    cm.scrollIntoView({from: cursor.from(), to: cursor.to()}, 20);\r\n    state.posFrom = cursor.from(); state.posTo = cursor.to();\r\n    if (callback) callback(cursor.from(), cursor.to())\r\n  });}\r\n\r\n  function clearSearch(cm) {cm.operation(function() {\r\n    var state = getSearchState(cm);\r\n    state.lastQuery = state.query;\r\n    if (!state.query) return;\r\n    state.query = state.queryText = null;\r\n    cm.removeOverlay(state.overlay);\r\n    if (state.annotate) { state.annotate.clear(); state.annotate = null; }\r\n  });}\r\n\r\n\r\n  function getQueryDialog(cm)  {\r\n    return '<span class=\"CodeMirror-search-label\">' + cm.phrase(\"Search:\") + '</span> <input type=\"text\" style=\"width: 10em\" class=\"CodeMirror-search-field\"/> <span style=\"color: #888\" class=\"CodeMirror-search-hint\">' + cm.phrase(\"(Use /re/ syntax for regexp search)\") + '</span>';\r\n  }\r\n  function getReplaceQueryDialog(cm) {\r\n    return ' <input type=\"text\" style=\"width: 10em\" class=\"CodeMirror-search-field\"/> <span style=\"color: #888\" class=\"CodeMirror-search-hint\">' + cm.phrase(\"(Use /re/ syntax for regexp search)\") + '</span>';\r\n  }\r\n  function getReplacementQueryDialog(cm) {\r\n    return '<span class=\"CodeMirror-search-label\">' + cm.phrase(\"With:\") + '</span> <input type=\"text\" style=\"width: 10em\" class=\"CodeMirror-search-field\"/>';\r\n  }\r\n  function getDoReplaceConfirm(cm) {\r\n    return '<span class=\"CodeMirror-search-label\">' + cm.phrase(\"Replace?\") + '</span> <button>' + cm.phrase(\"Yes\") + '</button> <button>' + cm.phrase(\"No\") + '</button> <button>' + cm.phrase(\"All\") + '</button> <button>' + cm.phrase(\"Stop\") + '</button> ';\r\n  }\r\n\r\n  function replaceAll(cm, query, text) {\r\n    cm.operation(function() {\r\n      for (var cursor = getSearchCursor(cm, query); cursor.findNext();) {\r\n        if (typeof query != \"string\") {\r\n          var match = cm.getRange(cursor.from(), cursor.to()).match(query);\r\n          cursor.replace(text.replace(/\\$(\\d)/g, function(_, i) {return match[i];}));\r\n        } else cursor.replace(text);\r\n      }\r\n    });\r\n  }\r\n\r\n  function replace(cm, all) {\r\n    if (cm.getOption(\"readOnly\")) return;\r\n    var query = cm.getSelection() || getSearchState(cm).lastQuery;\r\n    var dialogText = '<span class=\"CodeMirror-search-label\">' + (all ? cm.phrase(\"Replace all:\") : cm.phrase(\"Replace:\")) + '</span>';\r\n    dialog(cm, dialogText + getReplaceQueryDialog(cm), dialogText, query, function(query) {\r\n      if (!query) return;\r\n      query = parseQuery(query);\r\n      dialog(cm, getReplacementQueryDialog(cm), cm.phrase(\"Replace with:\"), \"\", function(text) {\r\n        text = parseString(text)\r\n        if (all) {\r\n          replaceAll(cm, query, text)\r\n        } else {\r\n          clearSearch(cm);\r\n          var cursor = getSearchCursor(cm, query, cm.getCursor(\"from\"));\r\n          var advance = function() {\r\n            var start = cursor.from(), match;\r\n            if (!(match = cursor.findNext())) {\r\n              cursor = getSearchCursor(cm, query);\r\n              if (!(match = cursor.findNext()) ||\r\n                  (start && cursor.from().line == start.line && cursor.from().ch == start.ch)) return;\r\n            }\r\n            cm.setSelection(cursor.from(), cursor.to());\r\n            cm.scrollIntoView({from: cursor.from(), to: cursor.to()});\r\n            confirmDialog(cm, getDoReplaceConfirm(cm), cm.phrase(\"Replace?\"),\r\n                          [function() {doReplace(match);}, advance,\r\n                           function() {replaceAll(cm, query, text)}]);\r\n          };\r\n          var doReplace = function(match) {\r\n            cursor.replace(typeof query == \"string\" ? text :\r\n                           text.replace(/\\$(\\d)/g, function(_, i) {return match[i];}));\r\n            advance();\r\n          };\r\n          advance();\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  CodeMirror.commands.find = function(cm) {clearSearch(cm); doSearch(cm);};\r\n  CodeMirror.commands.findPersistent = function(cm) {clearSearch(cm); doSearch(cm, false, true);};\r\n  CodeMirror.commands.findPersistentNext = function(cm) {doSearch(cm, false, true, true);};\r\n  CodeMirror.commands.findPersistentPrev = function(cm) {doSearch(cm, true, true, true);};\r\n  CodeMirror.commands.findNext = doSearch;\r\n  CodeMirror.commands.findPrev = function(cm) {doSearch(cm, true);};\r\n  CodeMirror.commands.clearSearch = clearSearch;\r\n  CodeMirror.commands.replace = replace;\r\n  CodeMirror.commands.replaceAll = function(cm) {replace(cm, true);};\r\n});\r\n\n// CodeMirror, copyright (c) by Marijn Haverbeke and others\r\n// Distributed under an MIT license: https://codemirror.net/LICENSE\r\n\r\ndefine('skylark-codemirror/addon/hint/anyword-hint',[\"../../CodeMirror\"], function(CodeMirror) {\r\n  \"use strict\";\r\n\r\n  var WORD = /[\\w$]+/, RANGE = 500;\r\n\r\n  CodeMirror.registerHelper(\"hint\", \"anyword\", function(editor, options) {\r\n    var word = options && options.word || WORD;\r\n    var range = options && options.range || RANGE;\r\n    var cur = editor.getCursor(), curLine = editor.getLine(cur.line);\r\n    var end = cur.ch, start = end;\r\n    while (start && word.test(curLine.charAt(start - 1))) --start;\r\n    var curWord = start != end && curLine.slice(start, end);\r\n\r\n    var list = options && options.list || [], seen = {};\r\n    var re = new RegExp(word.source, \"g\");\r\n    for (var dir = -1; dir <= 1; dir += 2) {\r\n      var line = cur.line, endLine = Math.min(Math.max(line + dir * range, editor.firstLine()), editor.lastLine()) + dir;\r\n      for (; line != endLine; line += dir) {\r\n        var text = editor.getLine(line), m;\r\n        while (m = re.exec(text)) {\r\n          if (line == cur.line && m[0] === curWord) continue;\r\n          if ((!curWord || m[0].lastIndexOf(curWord, 0) == 0) && !Object.prototype.hasOwnProperty.call(seen, m[0])) {\r\n            seen[m[0]] = true;\r\n            list.push(m[0]);\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return {list: list, from: CodeMirror.Pos(cur.line, start), to: CodeMirror.Pos(cur.line, end)};\r\n  });\r\n});\r\n\n// CodeMirror, copyright (c) by Marijn Haverbeke and others\r\n// Distributed under an MIT license: https://codemirror.net/LICENSE\r\n\r\ndefine('skylark-codemirror/addon/hint/javascript-hint',[\"../../CodeMirror\"], function(CodeMirror) {\r\n  var Pos = CodeMirror.Pos;\r\n\r\n  function forEach(arr, f) {\r\n    for (var i = 0, e = arr.length; i < e; ++i) f(arr[i]);\r\n  }\r\n\r\n  function arrayContains(arr, item) {\r\n    if (!Array.prototype.indexOf) {\r\n      var i = arr.length;\r\n      while (i--) {\r\n        if (arr[i] === item) {\r\n          return true;\r\n        }\r\n      }\r\n      return false;\r\n    }\r\n    return arr.indexOf(item) != -1;\r\n  }\r\n\r\n  function scriptHint(editor, keywords, getToken, options) {\r\n    // Find the token at the cursor\r\n    var cur = editor.getCursor(), token = getToken(editor, cur);\r\n    if (/\\b(?:string|comment)\\b/.test(token.type)) return;\r\n    var innerMode = CodeMirror.innerMode(editor.getMode(), token.state);\r\n    if (innerMode.mode.helperType === \"json\") return;\r\n    token.state = innerMode.state;\r\n\r\n    // If it's not a 'word-style' token, ignore the token.\r\n    if (!/^[\\w$_]*$/.test(token.string)) {\r\n      token = {start: cur.ch, end: cur.ch, string: \"\", state: token.state,\r\n               type: token.string == \".\" ? \"property\" : null};\r\n    } else if (token.end > cur.ch) {\r\n      token.end = cur.ch;\r\n      token.string = token.string.slice(0, cur.ch - token.start);\r\n    }\r\n\r\n    var tprop = token;\r\n    // If it is a property, find out what it is a property of.\r\n    while (tprop.type == \"property\") {\r\n      tprop = getToken(editor, Pos(cur.line, tprop.start));\r\n      if (tprop.string != \".\") return;\r\n      tprop = getToken(editor, Pos(cur.line, tprop.start));\r\n      if (!context) var context = [];\r\n      context.push(tprop);\r\n    }\r\n    return {list: getCompletions(token, context, keywords, options),\r\n            from: Pos(cur.line, token.start),\r\n            to: Pos(cur.line, token.end)};\r\n  }\r\n\r\n  function javascriptHint(editor, options) {\r\n    return scriptHint(editor, javascriptKeywords,\r\n                      function (e, cur) {return e.getTokenAt(cur);},\r\n                      options);\r\n  };\r\n  CodeMirror.registerHelper(\"hint\", \"javascript\", javascriptHint);\r\n\r\n  function getCoffeeScriptToken(editor, cur) {\r\n  // This getToken, it is for coffeescript, imitates the behavior of\r\n  // getTokenAt method in javascript.js, that is, returning \"property\"\r\n  // type and treat \".\" as indepenent token.\r\n    var token = editor.getTokenAt(cur);\r\n    if (cur.ch == token.start + 1 && token.string.charAt(0) == '.') {\r\n      token.end = token.start;\r\n      token.string = '.';\r\n      token.type = \"property\";\r\n    }\r\n    else if (/^\\.[\\w$_]*$/.test(token.string)) {\r\n      token.type = \"property\";\r\n      token.start++;\r\n      token.string = token.string.replace(/\\./, '');\r\n    }\r\n    return token;\r\n  }\r\n\r\n  function coffeescriptHint(editor, options) {\r\n    return scriptHint(editor, coffeescriptKeywords, getCoffeeScriptToken, options);\r\n  }\r\n  CodeMirror.registerHelper(\"hint\", \"coffeescript\", coffeescriptHint);\r\n\r\n  var stringProps = (\"charAt charCodeAt indexOf lastIndexOf substring substr slice trim trimLeft trimRight \" +\r\n                     \"toUpperCase toLowerCase split concat match replace search\").split(\" \");\r\n  var arrayProps = (\"length concat join splice push pop shift unshift slice reverse sort indexOf \" +\r\n                    \"lastIndexOf every some filter forEach map reduce reduceRight \").split(\" \");\r\n  var funcProps = \"prototype apply call bind\".split(\" \");\r\n  var javascriptKeywords = (\"break case catch class const continue debugger default delete do else export extends false finally for function \" +\r\n                  \"if in import instanceof new null return super switch this throw true try typeof var void while with yield\").split(\" \");\r\n  var coffeescriptKeywords = (\"and break catch class continue delete do else extends false finally for \" +\r\n                  \"if in instanceof isnt new no not null of off on or return switch then throw true try typeof until void while with yes\").split(\" \");\r\n\r\n  function forAllProps(obj, callback) {\r\n    if (!Object.getOwnPropertyNames || !Object.getPrototypeOf) {\r\n      for (var name in obj) callback(name)\r\n    } else {\r\n      for (var o = obj; o; o = Object.getPrototypeOf(o))\r\n        Object.getOwnPropertyNames(o).forEach(callback)\r\n    }\r\n  }\r\n\r\n  function getCompletions(token, context, keywords, options) {\r\n    var found = [], start = token.string, global = options && options.globalScope || window;\r\n    function maybeAdd(str) {\r\n      if (str.lastIndexOf(start, 0) == 0 && !arrayContains(found, str)) found.push(str);\r\n    }\r\n    function gatherCompletions(obj) {\r\n      if (typeof obj == \"string\") forEach(stringProps, maybeAdd);\r\n      else if (obj instanceof Array) forEach(arrayProps, maybeAdd);\r\n      else if (obj instanceof Function) forEach(funcProps, maybeAdd);\r\n      forAllProps(obj, maybeAdd)\r\n    }\r\n\r\n    if (context && context.length) {\r\n      // If this is a property, see if it belongs to some object we can\r\n      // find in the current environment.\r\n      var obj = context.pop(), base;\r\n      if (obj.type && obj.type.indexOf(\"variable\") === 0) {\r\n        if (options && options.additionalContext)\r\n          base = options.additionalContext[obj.string];\r\n        if (!options || options.useGlobalScope !== false)\r\n          base = base || global[obj.string];\r\n      } else if (obj.type == \"string\") {\r\n        base = \"\";\r\n      } else if (obj.type == \"atom\") {\r\n        base = 1;\r\n      } else if (obj.type == \"function\") {\r\n        if (global.jQuery != null && (obj.string == '$' || obj.string == 'jQuery') &&\r\n            (typeof global.jQuery == 'function'))\r\n          base = global.jQuery();\r\n        else if (global._ != null && (obj.string == '_') && (typeof global._ == 'function'))\r\n          base = global._();\r\n      }\r\n      while (base != null && context.length)\r\n        base = base[context.pop().string];\r\n      if (base != null) gatherCompletions(base);\r\n    } else {\r\n      // If not, just look in the global object and any local scope\r\n      // (reading into JS mode internals to get at the local and global variables)\r\n      for (var v = token.state.localVars; v; v = v.next) maybeAdd(v.name);\r\n      for (var v = token.state.globalVars; v; v = v.next) maybeAdd(v.name);\r\n      if (!options || options.useGlobalScope !== false)\r\n        gatherCompletions(global);\r\n      forEach(keywords, maybeAdd);\r\n    }\r\n    return found;\r\n  }\r\n});\r\n\n// CodeMirror, copyright (c) by Marijn Haverbeke and others\r\n// Distributed under an MIT license: https://codemirror.net/LICENSE\r\n\r\ndefine('skylark-codemirror/addon/edit/matchbrackets',[\"../../CodeMirror\"], function(CodeMirror) {\r\n  var ie_lt8 = /MSIE \\d/.test(navigator.userAgent) &&\r\n    (document.documentMode == null || document.documentMode < 8);\r\n\r\n  var Pos = CodeMirror.Pos;\r\n\r\n  var matching = {\"(\": \")>\", \")\": \"(<\", \"[\": \"]>\", \"]\": \"[<\", \"{\": \"}>\", \"}\": \"{<\", \"<\": \">>\", \">\": \"<<\"};\r\n\r\n  function bracketRegex(config) {\r\n    return config && config.bracketRegex || /[(){}[\\]]/\r\n  }\r\n\r\n  function findMatchingBracket(cm, where, config) {\r\n    var line = cm.getLineHandle(where.line), pos = where.ch - 1;\r\n    var afterCursor = config && config.afterCursor\r\n    if (afterCursor == null)\r\n      afterCursor = /(^| )cm-fat-cursor($| )/.test(cm.getWrapperElement().className)\r\n    var re = bracketRegex(config)\r\n\r\n    // A cursor is defined as between two characters, but in in vim command mode\r\n    // (i.e. not insert mode), the cursor is visually represented as a\r\n    // highlighted box on top of the 2nd character. Otherwise, we allow matches\r\n    // from before or after the cursor.\r\n    var match = (!afterCursor && pos >= 0 && re.test(line.text.charAt(pos)) && matching[line.text.charAt(pos)]) ||\r\n        re.test(line.text.charAt(pos + 1)) && matching[line.text.charAt(++pos)];\r\n    if (!match) return null;\r\n    var dir = match.charAt(1) == \">\" ? 1 : -1;\r\n    if (config && config.strict && (dir > 0) != (pos == where.ch)) return null;\r\n    var style = cm.getTokenTypeAt(Pos(where.line, pos + 1));\r\n\r\n    var found = scanForBracket(cm, Pos(where.line, pos + (dir > 0 ? 1 : 0)), dir, style || null, config);\r\n    if (found == null) return null;\r\n    return {from: Pos(where.line, pos), to: found && found.pos,\r\n            match: found && found.ch == match.charAt(0), forward: dir > 0};\r\n  }\r\n\r\n  // bracketRegex is used to specify which type of bracket to scan\r\n  // should be a regexp, e.g. /[[\\]]/\r\n  //\r\n  // Note: If \"where\" is on an open bracket, then this bracket is ignored.\r\n  //\r\n  // Returns false when no bracket was found, null when it reached\r\n  // maxScanLines and gave up\r\n  function scanForBracket(cm, where, dir, style, config) {\r\n    var maxScanLen = (config && config.maxScanLineLength) || 10000;\r\n    var maxScanLines = (config && config.maxScanLines) || 1000;\r\n\r\n    var stack = [];\r\n    var re = bracketRegex(config)\r\n    var lineEnd = dir > 0 ? Math.min(where.line + maxScanLines, cm.lastLine() + 1)\r\n                          : Math.max(cm.firstLine() - 1, where.line - maxScanLines);\r\n    for (var lineNo = where.line; lineNo != lineEnd; lineNo += dir) {\r\n      var line = cm.getLine(lineNo);\r\n      if (!line) continue;\r\n      var pos = dir > 0 ? 0 : line.length - 1, end = dir > 0 ? line.length : -1;\r\n      if (line.length > maxScanLen) continue;\r\n      if (lineNo == where.line) pos = where.ch - (dir < 0 ? 1 : 0);\r\n      for (; pos != end; pos += dir) {\r\n        var ch = line.charAt(pos);\r\n        if (re.test(ch) && (style === undefined || cm.getTokenTypeAt(Pos(lineNo, pos + 1)) == style)) {\r\n          var match = matching[ch];\r\n          if (match && (match.charAt(1) == \">\") == (dir > 0)) stack.push(ch);\r\n          else if (!stack.length) return {pos: Pos(lineNo, pos), ch: ch};\r\n          else stack.pop();\r\n        }\r\n      }\r\n    }\r\n    return lineNo - dir == (dir > 0 ? cm.lastLine() : cm.firstLine()) ? false : null;\r\n  }\r\n\r\n  function matchBrackets(cm, autoclear, config) {\r\n    // Disable brace matching in long lines, since it'll cause hugely slow updates\r\n    var maxHighlightLen = cm.state.matchBrackets.maxHighlightLineLength || 1000;\r\n    var marks = [], ranges = cm.listSelections();\r\n    for (var i = 0; i < ranges.length; i++) {\r\n      var match = ranges[i].empty() && findMatchingBracket(cm, ranges[i].head, config);\r\n      if (match && cm.getLine(match.from.line).length <= maxHighlightLen) {\r\n        var style = match.match ? \"CodeMirror-matchingbracket\" : \"CodeMirror-nonmatchingbracket\";\r\n        marks.push(cm.markText(match.from, Pos(match.from.line, match.from.ch + 1), {className: style}));\r\n        if (match.to && cm.getLine(match.to.line).length <= maxHighlightLen)\r\n          marks.push(cm.markText(match.to, Pos(match.to.line, match.to.ch + 1), {className: style}));\r\n      }\r\n    }\r\n\r\n    if (marks.length) {\r\n      // Kludge to work around the IE bug from issue #1193, where text\r\n      // input stops going to the textare whever this fires.\r\n      if (ie_lt8 && cm.state.focused) cm.focus();\r\n\r\n      var clear = function() {\r\n        cm.operation(function() {\r\n          for (var i = 0; i < marks.length; i++) marks[i].clear();\r\n        });\r\n      };\r\n      if (autoclear) setTimeout(clear, 800);\r\n      else return clear;\r\n    }\r\n  }\r\n\r\n  function doMatchBrackets(cm) {\r\n    cm.operation(function() {\r\n      if (cm.state.matchBrackets.currentlyHighlighted) {\r\n        cm.state.matchBrackets.currentlyHighlighted();\r\n        cm.state.matchBrackets.currentlyHighlighted = null;\r\n      }\r\n      cm.state.matchBrackets.currentlyHighlighted = matchBrackets(cm, false, cm.state.matchBrackets);\r\n    });\r\n  }\r\n\r\n  CodeMirror.defineOption(\"matchBrackets\", false, function(cm, val, old) {\r\n    if (old && old != CodeMirror.Init) {\r\n      cm.off(\"cursorActivity\", doMatchBrackets);\r\n      if (cm.state.matchBrackets && cm.state.matchBrackets.currentlyHighlighted) {\r\n        cm.state.matchBrackets.currentlyHighlighted();\r\n        cm.state.matchBrackets.currentlyHighlighted = null;\r\n      }\r\n    }\r\n    if (val) {\r\n      cm.state.matchBrackets = typeof val == \"object\" ? val : {};\r\n      cm.on(\"cursorActivity\", doMatchBrackets);\r\n    }\r\n  });\r\n\r\n  CodeMirror.defineExtension(\"matchBrackets\", function() {matchBrackets(this, true);});\r\n  CodeMirror.defineExtension(\"findMatchingBracket\", function(pos, config, oldConfig){\r\n    // Backwards-compatibility kludge\r\n    if (oldConfig || typeof config == \"boolean\") {\r\n      if (!oldConfig) {\r\n        config = config ? {strict: true} : null\r\n      } else {\r\n        oldConfig.strict = config\r\n        config = oldConfig\r\n      }\r\n    }\r\n    return findMatchingBracket(this, pos, config)\r\n  });\r\n  CodeMirror.defineExtension(\"scanForBracket\", function(pos, dir, style, config){\r\n    return scanForBracket(this, pos, dir, style, config);\r\n  });\r\n});\r\n\n// CodeMirror, copyright (c) by Marijn Haverbeke and others\r\n// Distributed under an MIT license: https://codemirror.net/LICENSE\r\ndefine('skylark-codemirror/addon/comment/comment',[\"../../CodeMirror\"], function(CodeMirror) {\r\n  \"use strict\";\r\n\r\n  var noOptions = {};\r\n  var nonWS = /[^\\s\\u00a0]/;\r\n  var Pos = CodeMirror.Pos;\r\n\r\n  function firstNonWS(str) {\r\n    var found = str.search(nonWS);\r\n    return found == -1 ? 0 : found;\r\n  }\r\n\r\n  CodeMirror.commands.toggleComment = function(cm) {\r\n    cm.toggleComment();\r\n  };\r\n\r\n  CodeMirror.defineExtension(\"toggleComment\", function(options) {\r\n    if (!options) options = noOptions;\r\n    var cm = this;\r\n    var minLine = Infinity, ranges = this.listSelections(), mode = null;\r\n    for (var i = ranges.length - 1; i >= 0; i--) {\r\n      var from = ranges[i].from(), to = ranges[i].to();\r\n      if (from.line >= minLine) continue;\r\n      if (to.line >= minLine) to = Pos(minLine, 0);\r\n      minLine = from.line;\r\n      if (mode == null) {\r\n        if (cm.uncomment(from, to, options)) mode = \"un\";\r\n        else { cm.lineComment(from, to, options); mode = \"line\"; }\r\n      } else if (mode == \"un\") {\r\n        cm.uncomment(from, to, options);\r\n      } else {\r\n        cm.lineComment(from, to, options);\r\n      }\r\n    }\r\n  });\r\n\r\n  // Rough heuristic to try and detect lines that are part of multi-line string\r\n  function probablyInsideString(cm, pos, line) {\r\n    return /\\bstring\\b/.test(cm.getTokenTypeAt(Pos(pos.line, 0))) && !/^[\\'\\\"\\`]/.test(line)\r\n  }\r\n\r\n  function getMode(cm, pos) {\r\n    var mode = cm.getMode()\r\n    return mode.useInnerComments === false || !mode.innerMode ? mode : cm.getModeAt(pos)\r\n  }\r\n\r\n  CodeMirror.defineExtension(\"lineComment\", function(from, to, options) {\r\n    if (!options) options = noOptions;\r\n    var self = this, mode = getMode(self, from);\r\n    var firstLine = self.getLine(from.line);\r\n    if (firstLine == null || probablyInsideString(self, from, firstLine)) return;\r\n\r\n    var commentString = options.lineComment || mode.lineComment;\r\n    if (!commentString) {\r\n      if (options.blockCommentStart || mode.blockCommentStart) {\r\n        options.fullLines = true;\r\n        self.blockComment(from, to, options);\r\n      }\r\n      return;\r\n    }\r\n\r\n    var end = Math.min(to.ch != 0 || to.line == from.line ? to.line + 1 : to.line, self.lastLine() + 1);\r\n    var pad = options.padding == null ? \" \" : options.padding;\r\n    var blankLines = options.commentBlankLines || from.line == to.line;\r\n\r\n    self.operation(function() {\r\n      if (options.indent) {\r\n        var baseString = null;\r\n        for (var i = from.line; i < end; ++i) {\r\n          var line = self.getLine(i);\r\n          var whitespace = line.slice(0, firstNonWS(line));\r\n          if (baseString == null || baseString.length > whitespace.length) {\r\n            baseString = whitespace;\r\n          }\r\n        }\r\n        for (var i = from.line; i < end; ++i) {\r\n          var line = self.getLine(i), cut = baseString.length;\r\n          if (!blankLines && !nonWS.test(line)) continue;\r\n          if (line.slice(0, cut) != baseString) cut = firstNonWS(line);\r\n          self.replaceRange(baseString + commentString + pad, Pos(i, 0), Pos(i, cut));\r\n        }\r\n      } else {\r\n        for (var i = from.line; i < end; ++i) {\r\n          if (blankLines || nonWS.test(self.getLine(i)))\r\n            self.replaceRange(commentString + pad, Pos(i, 0));\r\n        }\r\n      }\r\n    });\r\n  });\r\n\r\n  CodeMirror.defineExtension(\"blockComment\", function(from, to, options) {\r\n    if (!options) options = noOptions;\r\n    var self = this, mode = getMode(self, from);\r\n    var startString = options.blockCommentStart || mode.blockCommentStart;\r\n    var endString = options.blockCommentEnd || mode.blockCommentEnd;\r\n    if (!startString || !endString) {\r\n      if ((options.lineComment || mode.lineComment) && options.fullLines != false)\r\n        self.lineComment(from, to, options);\r\n      return;\r\n    }\r\n    if (/\\bcomment\\b/.test(self.getTokenTypeAt(Pos(from.line, 0)))) return\r\n\r\n    var end = Math.min(to.line, self.lastLine());\r\n    if (end != from.line && to.ch == 0 && nonWS.test(self.getLine(end))) --end;\r\n\r\n    var pad = options.padding == null ? \" \" : options.padding;\r\n    if (from.line > end) return;\r\n\r\n    self.operation(function() {\r\n      if (options.fullLines != false) {\r\n        var lastLineHasText = nonWS.test(self.getLine(end));\r\n        self.replaceRange(pad + endString, Pos(end));\r\n        self.replaceRange(startString + pad, Pos(from.line, 0));\r\n        var lead = options.blockCommentLead || mode.blockCommentLead;\r\n        if (lead != null) for (var i = from.line + 1; i <= end; ++i)\r\n          if (i != end || lastLineHasText)\r\n            self.replaceRange(lead + pad, Pos(i, 0));\r\n      } else {\r\n        self.replaceRange(endString, to);\r\n        self.replaceRange(startString, from);\r\n      }\r\n    });\r\n  });\r\n\r\n  CodeMirror.defineExtension(\"uncomment\", function(from, to, options) {\r\n    if (!options) options = noOptions;\r\n    var self = this, mode = getMode(self, from);\r\n    var end = Math.min(to.ch != 0 || to.line == from.line ? to.line : to.line - 1, self.lastLine()), start = Math.min(from.line, end);\r\n\r\n    // Try finding line comments\r\n    var lineString = options.lineComment || mode.lineComment, lines = [];\r\n    var pad = options.padding == null ? \" \" : options.padding, didSomething;\r\n    lineComment: {\r\n      if (!lineString) break lineComment;\r\n      for (var i = start; i <= end; ++i) {\r\n        var line = self.getLine(i);\r\n        var found = line.indexOf(lineString);\r\n        if (found > -1 && !/comment/.test(self.getTokenTypeAt(Pos(i, found + 1)))) found = -1;\r\n        if (found == -1 && nonWS.test(line)) break lineComment;\r\n        if (found > -1 && nonWS.test(line.slice(0, found))) break lineComment;\r\n        lines.push(line);\r\n      }\r\n      self.operation(function() {\r\n        for (var i = start; i <= end; ++i) {\r\n          var line = lines[i - start];\r\n          var pos = line.indexOf(lineString), endPos = pos + lineString.length;\r\n          if (pos < 0) continue;\r\n          if (line.slice(endPos, endPos + pad.length) == pad) endPos += pad.length;\r\n          didSomething = true;\r\n          self.replaceRange(\"\", Pos(i, pos), Pos(i, endPos));\r\n        }\r\n      });\r\n      if (didSomething) return true;\r\n    }\r\n\r\n    // Try block comments\r\n    var startString = options.blockCommentStart || mode.blockCommentStart;\r\n    var endString = options.blockCommentEnd || mode.blockCommentEnd;\r\n    if (!startString || !endString) return false;\r\n    var lead = options.blockCommentLead || mode.blockCommentLead;\r\n    var startLine = self.getLine(start), open = startLine.indexOf(startString)\r\n    if (open == -1) return false\r\n    var endLine = end == start ? startLine : self.getLine(end)\r\n    var close = endLine.indexOf(endString, end == start ? open + startString.length : 0);\r\n    var insideStart = Pos(start, open + 1), insideEnd = Pos(end, close + 1)\r\n    if (close == -1 ||\r\n        !/comment/.test(self.getTokenTypeAt(insideStart)) ||\r\n        !/comment/.test(self.getTokenTypeAt(insideEnd)) ||\r\n        self.getRange(insideStart, insideEnd, \"\\n\").indexOf(endString) > -1)\r\n      return false;\r\n\r\n    // Avoid killing block comments completely outside the selection.\r\n    // Positions of the last startString before the start of the selection, and the first endString after it.\r\n    var lastStart = startLine.lastIndexOf(startString, from.ch);\r\n    var firstEnd = lastStart == -1 ? -1 : startLine.slice(0, from.ch).indexOf(endString, lastStart + startString.length);\r\n    if (lastStart != -1 && firstEnd != -1 && firstEnd + endString.length != from.ch) return false;\r\n    // Positions of the first endString after the end of the selection, and the last startString before it.\r\n    firstEnd = endLine.indexOf(endString, to.ch);\r\n    var almostLastStart = endLine.slice(to.ch).lastIndexOf(startString, firstEnd - to.ch);\r\n    lastStart = (firstEnd == -1 || almostLastStart == -1) ? -1 : to.ch + almostLastStart;\r\n    if (firstEnd != -1 && lastStart != -1 && lastStart != to.ch) return false;\r\n\r\n    self.operation(function() {\r\n      self.replaceRange(\"\", Pos(end, close - (pad && endLine.slice(close - pad.length, close) == pad ? pad.length : 0)),\r\n                        Pos(end, close + endString.length));\r\n      var openEnd = open + startString.length;\r\n      if (pad && startLine.slice(openEnd, openEnd + pad.length) == pad) openEnd += pad.length;\r\n      self.replaceRange(\"\", Pos(start, open), Pos(start, openEnd));\r\n      if (lead) for (var i = start + 1; i <= end; ++i) {\r\n        var line = self.getLine(i), found = line.indexOf(lead);\r\n        if (found == -1 || nonWS.test(line.slice(0, found))) continue;\r\n        var foundEnd = found + lead.length;\r\n        if (pad && line.slice(foundEnd, foundEnd + pad.length) == pad) foundEnd += pad.length;\r\n        self.replaceRange(\"\", Pos(i, found), Pos(i, foundEnd));\r\n      }\r\n    });\r\n    return true;\r\n  });\r\n});\r\n\n// CodeMirror, copyright (c) by Marijn Haverbeke and others\r\n// Distributed under an MIT license: https://codemirror.net/LICENSE\r\n\r\ndefine('skylark-codemirror/addon/lint/javascript-lint',[\"../../CodeMirror\"], function(CodeMirror) {\r\n  \"use strict\";\r\n  // declare global: JSHINT\r\n\r\n  function validator(text, options) {\r\n    if (!window.JSHINT) {\r\n      if (window.console) {\r\n        window.console.error(\"Error: window.JSHINT not defined, CodeMirror JavaScript linting cannot run.\");\r\n      }\r\n      return [];\r\n    }\r\n    if (!options.indent) // JSHint error.character actually is a column index, this fixes underlining on lines using tabs for indentation\r\n      options.indent = 1; // JSHint default value is 4\r\n    JSHINT(text, options, options.globals);\r\n    var errors = JSHINT.data().errors, result = [];\r\n    if (errors) parseErrors(errors, result);\r\n    return result;\r\n  }\r\n\r\n  CodeMirror.registerHelper(\"lint\", \"javascript\", validator);\r\n\r\n  function parseErrors(errors, output) {\r\n    for ( var i = 0; i < errors.length; i++) {\r\n      var error = errors[i];\r\n      if (error) {\r\n        if (error.line <= 0) {\r\n          if (window.console) {\r\n            window.console.warn(\"Cannot display JSHint error (invalid line \" + error.line + \")\", error);\r\n          }\r\n          continue;\r\n        }\r\n\r\n        var start = error.character - 1, end = start + 1;\r\n        if (error.evidence) {\r\n          var index = error.evidence.substring(start).search(/.\\b/);\r\n          if (index > -1) {\r\n            end += index;\r\n          }\r\n        }\r\n\r\n        // Convert to format expected by validation service\r\n        var hint = {\r\n          message: error.reason,\r\n          severity: error.code ? (error.code.startsWith('W') ? \"warning\" : \"error\") : \"error\",\r\n          from: CodeMirror.Pos(error.line - 1, start),\r\n          to: CodeMirror.Pos(error.line - 1, end)\r\n        };\r\n\r\n        output.push(hint);\r\n      }\r\n    }\r\n  }\r\n});\r\n\n// CodeMirror, copyright (c) by Marijn Haverbeke and others\r\n// Distributed under an MIT license: https://codemirror.net/LICENSE\r\n\r\ndefine('skylark-codemirror/addon/lint/lint',[\"../../CodeMirror\"], function(CodeMirror) {\r\n  \"use strict\";\r\n  var GUTTER_ID = \"CodeMirror-lint-markers\";\r\n\r\n  function showTooltip(e, content) {\r\n    var tt = document.createElement(\"div\");\r\n    tt.className = \"CodeMirror-lint-tooltip\";\r\n    tt.appendChild(content.cloneNode(true));\r\n    document.body.appendChild(tt);\r\n\r\n    function position(e) {\r\n      if (!tt.parentNode) return CodeMirror.off(document, \"mousemove\", position);\r\n      tt.style.top = Math.max(0, e.clientY - tt.offsetHeight - 5) + \"px\";\r\n      tt.style.left = (e.clientX + 5) + \"px\";\r\n    }\r\n    CodeMirror.on(document, \"mousemove\", position);\r\n    position(e);\r\n    if (tt.style.opacity != null) tt.style.opacity = 1;\r\n    return tt;\r\n  }\r\n  function rm(elt) {\r\n    if (elt.parentNode) elt.parentNode.removeChild(elt);\r\n  }\r\n  function hideTooltip(tt) {\r\n    if (!tt.parentNode) return;\r\n    if (tt.style.opacity == null) rm(tt);\r\n    tt.style.opacity = 0;\r\n    setTimeout(function() { rm(tt); }, 600);\r\n  }\r\n\r\n  function showTooltipFor(e, content, node) {\r\n    var tooltip = showTooltip(e, content);\r\n    function hide() {\r\n      CodeMirror.off(node, \"mouseout\", hide);\r\n      if (tooltip) { hideTooltip(tooltip); tooltip = null; }\r\n    }\r\n    var poll = setInterval(function() {\r\n      if (tooltip) for (var n = node;; n = n.parentNode) {\r\n        if (n && n.nodeType == 11) n = n.host;\r\n        if (n == document.body) return;\r\n        if (!n) { hide(); break; }\r\n      }\r\n      if (!tooltip) return clearInterval(poll);\r\n    }, 400);\r\n    CodeMirror.on(node, \"mouseout\", hide);\r\n  }\r\n\r\n  function LintState(cm, options, hasGutter) {\r\n    this.marked = [];\r\n    this.options = options;\r\n    this.timeout = null;\r\n    this.hasGutter = hasGutter;\r\n    this.onMouseOver = function(e) { onMouseOver(cm, e); };\r\n    this.waitingFor = 0\r\n  }\r\n\r\n  function parseOptions(_cm, options) {\r\n    if (options instanceof Function) return {getAnnotations: options};\r\n    if (!options || options === true) options = {};\r\n    return options;\r\n  }\r\n\r\n  function clearMarks(cm) {\r\n    var state = cm.state.lint;\r\n    if (state.hasGutter) cm.clearGutter(GUTTER_ID);\r\n    for (var i = 0; i < state.marked.length; ++i)\r\n      state.marked[i].clear();\r\n    state.marked.length = 0;\r\n  }\r\n\r\n  function makeMarker(labels, severity, multiple, tooltips) {\r\n    var marker = document.createElement(\"div\"), inner = marker;\r\n    marker.className = \"CodeMirror-lint-marker-\" + severity;\r\n    if (multiple) {\r\n      inner = marker.appendChild(document.createElement(\"div\"));\r\n      inner.className = \"CodeMirror-lint-marker-multiple\";\r\n    }\r\n\r\n    if (tooltips != false) CodeMirror.on(inner, \"mouseover\", function(e) {\r\n      showTooltipFor(e, labels, inner);\r\n    });\r\n\r\n    return marker;\r\n  }\r\n\r\n  function getMaxSeverity(a, b) {\r\n    if (a == \"error\") return a;\r\n    else return b;\r\n  }\r\n\r\n  function groupByLine(annotations) {\r\n    var lines = [];\r\n    for (var i = 0; i < annotations.length; ++i) {\r\n      var ann = annotations[i], line = ann.from.line;\r\n      (lines[line] || (lines[line] = [])).push(ann);\r\n    }\r\n    return lines;\r\n  }\r\n\r\n  function annotationTooltip(ann) {\r\n    var severity = ann.severity;\r\n    if (!severity) severity = \"error\";\r\n    var tip = document.createElement(\"div\");\r\n    tip.className = \"CodeMirror-lint-message-\" + severity;\r\n    if (typeof ann.messageHTML != 'undefined') {\r\n        tip.innerHTML = ann.messageHTML;\r\n    } else {\r\n        tip.appendChild(document.createTextNode(ann.message));\r\n    }\r\n    return tip;\r\n  }\r\n\r\n  function lintAsync(cm, getAnnotations, passOptions) {\r\n    var state = cm.state.lint\r\n    var id = ++state.waitingFor\r\n    function abort() {\r\n      id = -1\r\n      cm.off(\"change\", abort)\r\n    }\r\n    cm.on(\"change\", abort)\r\n    getAnnotations(cm.getValue(), function(annotations, arg2) {\r\n      cm.off(\"change\", abort)\r\n      if (state.waitingFor != id) return\r\n      if (arg2 && annotations instanceof CodeMirror) annotations = arg2\r\n      cm.operation(function() {updateLinting(cm, annotations)})\r\n    }, passOptions, cm);\r\n  }\r\n\r\n  function startLinting(cm) {\r\n    var state = cm.state.lint, options = state.options;\r\n    /*\r\n     * Passing rules in `options` property prevents JSHint (and other linters) from complaining\r\n     * about unrecognized rules like `onUpdateLinting`, `delay`, `lintOnChange`, etc.\r\n     */\r\n    var passOptions = options.options || options;\r\n    var getAnnotations = options.getAnnotations || cm.getHelper(CodeMirror.Pos(0, 0), \"lint\");\r\n    if (!getAnnotations) return;\r\n    if (options.async || getAnnotations.async) {\r\n      lintAsync(cm, getAnnotations, passOptions)\r\n    } else {\r\n      var annotations = getAnnotations(cm.getValue(), passOptions, cm);\r\n      if (!annotations) return;\r\n      if (annotations.then) annotations.then(function(issues) {\r\n        cm.operation(function() {updateLinting(cm, issues)})\r\n      });\r\n      else cm.operation(function() {updateLinting(cm, annotations)})\r\n    }\r\n  }\r\n\r\n  function updateLinting(cm, annotationsNotSorted) {\r\n    clearMarks(cm);\r\n    var state = cm.state.lint, options = state.options;\r\n\r\n    var annotations = groupByLine(annotationsNotSorted);\r\n\r\n    for (var line = 0; line < annotations.length; ++line) {\r\n      var anns = annotations[line];\r\n      if (!anns) continue;\r\n\r\n      var maxSeverity = null;\r\n      var tipLabel = state.hasGutter && document.createDocumentFragment();\r\n\r\n      for (var i = 0; i < anns.length; ++i) {\r\n        var ann = anns[i];\r\n        var severity = ann.severity;\r\n        if (!severity) severity = \"error\";\r\n        maxSeverity = getMaxSeverity(maxSeverity, severity);\r\n\r\n        if (options.formatAnnotation) ann = options.formatAnnotation(ann);\r\n        if (state.hasGutter) tipLabel.appendChild(annotationTooltip(ann));\r\n\r\n        if (ann.to) state.marked.push(cm.markText(ann.from, ann.to, {\r\n          className: \"CodeMirror-lint-mark-\" + severity,\r\n          __annotation: ann\r\n        }));\r\n      }\r\n\r\n      if (state.hasGutter)\r\n        cm.setGutterMarker(line, GUTTER_ID, makeMarker(tipLabel, maxSeverity, anns.length > 1,\r\n                                                       state.options.tooltips));\r\n    }\r\n    if (options.onUpdateLinting) options.onUpdateLinting(annotationsNotSorted, annotations, cm);\r\n  }\r\n\r\n  function onChange(cm) {\r\n    var state = cm.state.lint;\r\n    if (!state) return;\r\n    clearTimeout(state.timeout);\r\n    state.timeout = setTimeout(function(){startLinting(cm);}, state.options.delay || 500);\r\n  }\r\n\r\n  function popupTooltips(annotations, e) {\r\n    var target = e.target || e.srcElement;\r\n    var tooltip = document.createDocumentFragment();\r\n    for (var i = 0; i < annotations.length; i++) {\r\n      var ann = annotations[i];\r\n      tooltip.appendChild(annotationTooltip(ann));\r\n    }\r\n    showTooltipFor(e, tooltip, target);\r\n  }\r\n\r\n  function onMouseOver(cm, e) {\r\n    var target = e.target || e.srcElement;\r\n    if (!/\\bCodeMirror-lint-mark-/.test(target.className)) return;\r\n    var box = target.getBoundingClientRect(), x = (box.left + box.right) / 2, y = (box.top + box.bottom) / 2;\r\n    var spans = cm.findMarksAt(cm.coordsChar({left: x, top: y}, \"client\"));\r\n\r\n    var annotations = [];\r\n    for (var i = 0; i < spans.length; ++i) {\r\n      var ann = spans[i].__annotation;\r\n      if (ann) annotations.push(ann);\r\n    }\r\n    if (annotations.length) popupTooltips(annotations, e);\r\n  }\r\n\r\n  CodeMirror.defineOption(\"lint\", false, function(cm, val, old) {\r\n    if (old && old != CodeMirror.Init) {\r\n      clearMarks(cm);\r\n      if (cm.state.lint.options.lintOnChange !== false)\r\n        cm.off(\"change\", onChange);\r\n      CodeMirror.off(cm.getWrapperElement(), \"mouseover\", cm.state.lint.onMouseOver);\r\n      clearTimeout(cm.state.lint.timeout);\r\n      delete cm.state.lint;\r\n    }\r\n\r\n    if (val) {\r\n      var gutters = cm.getOption(\"gutters\"), hasLintGutter = false;\r\n      for (var i = 0; i < gutters.length; ++i) if (gutters[i] == GUTTER_ID) hasLintGutter = true;\r\n      var state = cm.state.lint = new LintState(cm, parseOptions(cm, val), hasLintGutter);\r\n      if (state.options.lintOnChange !== false)\r\n        cm.on(\"change\", onChange);\r\n      if (state.options.tooltips != false && state.options.tooltips != \"gutter\")\r\n        CodeMirror.on(cm.getWrapperElement(), \"mouseover\", state.onMouseOver);\r\n\r\n      startLinting(cm);\r\n    }\r\n  });\r\n\r\n  CodeMirror.defineExtension(\"performLint\", function() {\r\n    if (this.state.lint) startLinting(this);\r\n  });\r\n});\r\n\n// CodeMirror, copyright (c) by Marijn Haverbeke and others\r\n// Distributed under an MIT license: https://codemirror.net/LICENSE\r\n\r\n// Glue code between CodeMirror and Tern.\r\n//\r\n// Create a CodeMirror.TernServer to wrap an actual Tern server,\r\n// register open documents (CodeMirror.Doc instances) with it, and\r\n// call its methods to activate the assisting functions that Tern\r\n// provides.\r\n//\r\n// Options supported (all optional):\r\n// * defs: An array of JSON definition data structures.\r\n// * plugins: An object mapping plugin names to configuration\r\n//   options.\r\n// * getFile: A function(name, c) that can be used to access files in\r\n//   the project that haven't been loaded yet. Simply do c(null) to\r\n//   indicate that a file is not available.\r\n// * fileFilter: A function(value, docName, doc) that will be applied\r\n//   to documents before passing them on to Tern.\r\n// * switchToDoc: A function(name, doc) that should, when providing a\r\n//   multi-file view, switch the view or focus to the named file.\r\n// * showError: A function(editor, message) that can be used to\r\n//   override the way errors are displayed.\r\n// * completionTip: Customize the content in tooltips for completions.\r\n//   Is passed a single argumentthe completion's data as returned by\r\n//   Ternand may return a string, DOM node, or null to indicate that\r\n//   no tip should be shown. By default the docstring is shown.\r\n// * typeTip: Like completionTip, but for the tooltips shown for type\r\n//   queries.\r\n// * responseFilter: A function(doc, query, request, error, data) that\r\n//   will be applied to the Tern responses before treating them\r\n//\r\n//\r\n// It is possible to run the Tern server in a web worker by specifying\r\n// these additional options:\r\n// * useWorker: Set to true to enable web worker mode. You'll probably\r\n//   want to feature detect the actual value you use here, for example\r\n//   !!window.Worker.\r\n// * workerScript: The main script of the worker. Point this to\r\n//   wherever you are hosting worker.js from this directory.\r\n// * workerDeps: An array of paths pointing (relative to workerScript)\r\n//   to the Acorn and Tern libraries and any Tern plugins you want to\r\n//   load. Or, if you minified those into a single script and included\r\n//   them in the workerScript, simply leave this undefined.\r\n\r\ndefine('skylark-codemirror/addon/tern/tern',[\"../../CodeMirror\"], function(CodeMirror) {\r\n  \"use strict\";\r\n  // declare global: tern\r\n\r\n  CodeMirror.TernServer = function(options) {\r\n    var self = this;\r\n    this.options = options || {};\r\n    var plugins = this.options.plugins || (this.options.plugins = {});\r\n    if (!plugins.doc_comment) plugins.doc_comment = true;\r\n    this.docs = Object.create(null);\r\n    if (this.options.useWorker) {\r\n      this.server = new WorkerServer(this);\r\n    } else {\r\n      this.server = new tern.Server({\r\n        getFile: function(name, c) { return getFile(self, name, c); },\r\n        async: true,\r\n        defs: this.options.defs || [],\r\n        plugins: plugins\r\n      });\r\n    }\r\n    this.trackChange = function(doc, change) { trackChange(self, doc, change); };\r\n\r\n    this.cachedArgHints = null;\r\n    this.activeArgHints = null;\r\n    this.jumpStack = [];\r\n\r\n    this.getHint = function(cm, c) { return hint(self, cm, c); };\r\n    this.getHint.async = true;\r\n  };\r\n\r\n  CodeMirror.TernServer.prototype = {\r\n    addDoc: function(name, doc) {\r\n      var data = {doc: doc, name: name, changed: null};\r\n      this.server.addFile(name, docValue(this, data));\r\n      CodeMirror.on(doc, \"change\", this.trackChange);\r\n      return this.docs[name] = data;\r\n    },\r\n\r\n    delDoc: function(id) {\r\n      var found = resolveDoc(this, id);\r\n      if (!found) return;\r\n      CodeMirror.off(found.doc, \"change\", this.trackChange);\r\n      delete this.docs[found.name];\r\n      this.server.delFile(found.name);\r\n    },\r\n\r\n    hideDoc: function(id) {\r\n      closeArgHints(this);\r\n      var found = resolveDoc(this, id);\r\n      if (found && found.changed) sendDoc(this, found);\r\n    },\r\n\r\n    complete: function(cm) {\r\n      cm.showHint({hint: this.getHint});\r\n    },\r\n\r\n    showType: function(cm, pos, c) { showContextInfo(this, cm, pos, \"type\", c); },\r\n\r\n    showDocs: function(cm, pos, c) { showContextInfo(this, cm, pos, \"documentation\", c); },\r\n\r\n    updateArgHints: function(cm) { updateArgHints(this, cm); },\r\n\r\n    jumpToDef: function(cm) { jumpToDef(this, cm); },\r\n\r\n    jumpBack: function(cm) { jumpBack(this, cm); },\r\n\r\n    rename: function(cm) { rename(this, cm); },\r\n\r\n    selectName: function(cm) { selectName(this, cm); },\r\n\r\n    request: function (cm, query, c, pos) {\r\n      var self = this;\r\n      var doc = findDoc(this, cm.getDoc());\r\n      var request = buildRequest(this, doc, query, pos);\r\n      var extraOptions = request.query && this.options.queryOptions && this.options.queryOptions[request.query.type]\r\n      if (extraOptions) for (var prop in extraOptions) request.query[prop] = extraOptions[prop];\r\n\r\n      this.server.request(request, function (error, data) {\r\n        if (!error && self.options.responseFilter)\r\n          data = self.options.responseFilter(doc, query, request, error, data);\r\n        c(error, data);\r\n      });\r\n    },\r\n\r\n    destroy: function () {\r\n      closeArgHints(this)\r\n      if (this.worker) {\r\n        this.worker.terminate();\r\n        this.worker = null;\r\n      }\r\n    }\r\n  };\r\n\r\n  var Pos = CodeMirror.Pos;\r\n  var cls = \"CodeMirror-Tern-\";\r\n  var bigDoc = 250;\r\n\r\n  function getFile(ts, name, c) {\r\n    var buf = ts.docs[name];\r\n    if (buf)\r\n      c(docValue(ts, buf));\r\n    else if (ts.options.getFile)\r\n      ts.options.getFile(name, c);\r\n    else\r\n      c(null);\r\n  }\r\n\r\n  function findDoc(ts, doc, name) {\r\n    for (var n in ts.docs) {\r\n      var cur = ts.docs[n];\r\n      if (cur.doc == doc) return cur;\r\n    }\r\n    if (!name) for (var i = 0;; ++i) {\r\n      n = \"[doc\" + (i || \"\") + \"]\";\r\n      if (!ts.docs[n]) { name = n; break; }\r\n    }\r\n    return ts.addDoc(name, doc);\r\n  }\r\n\r\n  function resolveDoc(ts, id) {\r\n    if (typeof id == \"string\") return ts.docs[id];\r\n    if (id instanceof CodeMirror) id = id.getDoc();\r\n    if (id instanceof CodeMirror.Doc) return findDoc(ts, id);\r\n  }\r\n\r\n  function trackChange(ts, doc, change) {\r\n    var data = findDoc(ts, doc);\r\n\r\n    var argHints = ts.cachedArgHints;\r\n    if (argHints && argHints.doc == doc && cmpPos(argHints.start, change.to) >= 0)\r\n      ts.cachedArgHints = null;\r\n\r\n    var changed = data.changed;\r\n    if (changed == null)\r\n      data.changed = changed = {from: change.from.line, to: change.from.line};\r\n    var end = change.from.line + (change.text.length - 1);\r\n    if (change.from.line < changed.to) changed.to = changed.to - (change.to.line - end);\r\n    if (end >= changed.to) changed.to = end + 1;\r\n    if (changed.from > change.from.line) changed.from = change.from.line;\r\n\r\n    if (doc.lineCount() > bigDoc && change.to - changed.from > 100) setTimeout(function() {\r\n      if (data.changed && data.changed.to - data.changed.from > 100) sendDoc(ts, data);\r\n    }, 200);\r\n  }\r\n\r\n  function sendDoc(ts, doc) {\r\n    ts.server.request({files: [{type: \"full\", name: doc.name, text: docValue(ts, doc)}]}, function(error) {\r\n      if (error) window.console.error(error);\r\n      else doc.changed = null;\r\n    });\r\n  }\r\n\r\n  // Completion\r\n\r\n  function hint(ts, cm, c) {\r\n    ts.request(cm, {type: \"completions\", types: true, docs: true, urls: true}, function(error, data) {\r\n      if (error) return showError(ts, cm, error);\r\n      var completions = [], after = \"\";\r\n      var from = data.start, to = data.end;\r\n      if (cm.getRange(Pos(from.line, from.ch - 2), from) == \"[\\\"\" &&\r\n          cm.getRange(to, Pos(to.line, to.ch + 2)) != \"\\\"]\")\r\n        after = \"\\\"]\";\r\n\r\n      for (var i = 0; i < data.completions.length; ++i) {\r\n        var completion = data.completions[i], className = typeToIcon(completion.type);\r\n        if (data.guess) className += \" \" + cls + \"guess\";\r\n        completions.push({text: completion.name + after,\r\n                          displayText: completion.displayName || completion.name,\r\n                          className: className,\r\n                          data: completion});\r\n      }\r\n\r\n      var obj = {from: from, to: to, list: completions};\r\n      var tooltip = null;\r\n      CodeMirror.on(obj, \"close\", function() { remove(tooltip); });\r\n      CodeMirror.on(obj, \"update\", function() { remove(tooltip); });\r\n      CodeMirror.on(obj, \"select\", function(cur, node) {\r\n        remove(tooltip);\r\n        var content = ts.options.completionTip ? ts.options.completionTip(cur.data) : cur.data.doc;\r\n        if (content) {\r\n          tooltip = makeTooltip(node.parentNode.getBoundingClientRect().right + window.pageXOffset,\r\n                                node.getBoundingClientRect().top + window.pageYOffset, content);\r\n          tooltip.className += \" \" + cls + \"hint-doc\";\r\n        }\r\n      });\r\n      c(obj);\r\n    });\r\n  }\r\n\r\n  function typeToIcon(type) {\r\n    var suffix;\r\n    if (type == \"?\") suffix = \"unknown\";\r\n    else if (type == \"number\" || type == \"string\" || type == \"bool\") suffix = type;\r\n    else if (/^fn\\(/.test(type)) suffix = \"fn\";\r\n    else if (/^\\[/.test(type)) suffix = \"array\";\r\n    else suffix = \"object\";\r\n    return cls + \"completion \" + cls + \"completion-\" + suffix;\r\n  }\r\n\r\n  // Type queries\r\n\r\n  function showContextInfo(ts, cm, pos, queryName, c) {\r\n    ts.request(cm, queryName, function(error, data) {\r\n      if (error) return showError(ts, cm, error);\r\n      if (ts.options.typeTip) {\r\n        var tip = ts.options.typeTip(data);\r\n      } else {\r\n        var tip = elt(\"span\", null, elt(\"strong\", null, data.type || \"not found\"));\r\n        if (data.doc)\r\n          tip.appendChild(document.createTextNode(\"  \" + data.doc));\r\n        if (data.url) {\r\n          tip.appendChild(document.createTextNode(\" \"));\r\n          var child = tip.appendChild(elt(\"a\", null, \"[docs]\"));\r\n          child.href = data.url;\r\n          child.target = \"_blank\";\r\n        }\r\n      }\r\n      tempTooltip(cm, tip, ts);\r\n      if (c) c();\r\n    }, pos);\r\n  }\r\n\r\n  // Maintaining argument hints\r\n\r\n  function updateArgHints(ts, cm) {\r\n    closeArgHints(ts);\r\n\r\n    if (cm.somethingSelected()) return;\r\n    var state = cm.getTokenAt(cm.getCursor()).state;\r\n    var inner = CodeMirror.innerMode(cm.getMode(), state);\r\n    if (inner.mode.name != \"javascript\") return;\r\n    var lex = inner.state.lexical;\r\n    if (lex.info != \"call\") return;\r\n\r\n    var ch, argPos = lex.pos || 0, tabSize = cm.getOption(\"tabSize\");\r\n    for (var line = cm.getCursor().line, e = Math.max(0, line - 9), found = false; line >= e; --line) {\r\n      var str = cm.getLine(line), extra = 0;\r\n      for (var pos = 0;;) {\r\n        var tab = str.indexOf(\"\\t\", pos);\r\n        if (tab == -1) break;\r\n        extra += tabSize - (tab + extra) % tabSize - 1;\r\n        pos = tab + 1;\r\n      }\r\n      ch = lex.column - extra;\r\n      if (str.charAt(ch) == \"(\") {found = true; break;}\r\n    }\r\n    if (!found) return;\r\n\r\n    var start = Pos(line, ch);\r\n    var cache = ts.cachedArgHints;\r\n    if (cache && cache.doc == cm.getDoc() && cmpPos(start, cache.start) == 0)\r\n      return showArgHints(ts, cm, argPos);\r\n\r\n    ts.request(cm, {type: \"type\", preferFunction: true, end: start}, function(error, data) {\r\n      if (error || !data.type || !(/^fn\\(/).test(data.type)) return;\r\n      ts.cachedArgHints = {\r\n        start: start,\r\n        type: parseFnType(data.type),\r\n        name: data.exprName || data.name || \"fn\",\r\n        guess: data.guess,\r\n        doc: cm.getDoc()\r\n      };\r\n      showArgHints(ts, cm, argPos);\r\n    });\r\n  }\r\n\r\n  function showArgHints(ts, cm, pos) {\r\n    closeArgHints(ts);\r\n\r\n    var cache = ts.cachedArgHints, tp = cache.type;\r\n    var tip = elt(\"span\", cache.guess ? cls + \"fhint-guess\" : null,\r\n                  elt(\"span\", cls + \"fname\", cache.name), \"(\");\r\n    for (var i = 0; i < tp.args.length; ++i) {\r\n      if (i) tip.appendChild(document.createTextNode(\", \"));\r\n      var arg = tp.args[i];\r\n      tip.appendChild(elt(\"span\", cls + \"farg\" + (i == pos ? \" \" + cls + \"farg-current\" : \"\"), arg.name || \"?\"));\r\n      if (arg.type != \"?\") {\r\n        tip.appendChild(document.createTextNode(\":\\u00a0\"));\r\n        tip.appendChild(elt(\"span\", cls + \"type\", arg.type));\r\n      }\r\n    }\r\n    tip.appendChild(document.createTextNode(tp.rettype ? \") ->\\u00a0\" : \")\"));\r\n    if (tp.rettype) tip.appendChild(elt(\"span\", cls + \"type\", tp.rettype));\r\n    var place = cm.cursorCoords(null, \"page\");\r\n    var tooltip = ts.activeArgHints = makeTooltip(place.right + 1, place.bottom, tip)\r\n    setTimeout(function() {\r\n      tooltip.clear = onEditorActivity(cm, function() {\r\n        if (ts.activeArgHints == tooltip) closeArgHints(ts) })\r\n    }, 20)\r\n  }\r\n\r\n  function parseFnType(text) {\r\n    var args = [], pos = 3;\r\n\r\n    function skipMatching(upto) {\r\n      var depth = 0, start = pos;\r\n      for (;;) {\r\n        var next = text.charAt(pos);\r\n        if (upto.test(next) && !depth) return text.slice(start, pos);\r\n        if (/[{\\[\\(]/.test(next)) ++depth;\r\n        else if (/[}\\]\\)]/.test(next)) --depth;\r\n        ++pos;\r\n      }\r\n    }\r\n\r\n    // Parse arguments\r\n    if (text.charAt(pos) != \")\") for (;;) {\r\n      var name = text.slice(pos).match(/^([^, \\(\\[\\{]+): /);\r\n      if (name) {\r\n        pos += name[0].length;\r\n        name = name[1];\r\n      }\r\n      args.push({name: name, type: skipMatching(/[\\),]/)});\r\n      if (text.charAt(pos) == \")\") break;\r\n      pos += 2;\r\n    }\r\n\r\n    var rettype = text.slice(pos).match(/^\\) -> (.*)$/);\r\n\r\n    return {args: args, rettype: rettype && rettype[1]};\r\n  }\r\n\r\n  // Moving to the definition of something\r\n\r\n  function jumpToDef(ts, cm) {\r\n    function inner(varName) {\r\n      var req = {type: \"definition\", variable: varName || null};\r\n      var doc = findDoc(ts, cm.getDoc());\r\n      ts.server.request(buildRequest(ts, doc, req), function(error, data) {\r\n        if (error) return showError(ts, cm, error);\r\n        if (!data.file && data.url) { window.open(data.url); return; }\r\n\r\n        if (data.file) {\r\n          var localDoc = ts.docs[data.file], found;\r\n          if (localDoc && (found = findContext(localDoc.doc, data))) {\r\n            ts.jumpStack.push({file: doc.name,\r\n                               start: cm.getCursor(\"from\"),\r\n                               end: cm.getCursor(\"to\")});\r\n            moveTo(ts, doc, localDoc, found.start, found.end);\r\n            return;\r\n          }\r\n        }\r\n        showError(ts, cm, \"Could not find a definition.\");\r\n      });\r\n    }\r\n\r\n    if (!atInterestingExpression(cm))\r\n      dialog(cm, \"Jump to variable\", function(name) { if (name) inner(name); });\r\n    else\r\n      inner();\r\n  }\r\n\r\n  function jumpBack(ts, cm) {\r\n    var pos = ts.jumpStack.pop(), doc = pos && ts.docs[pos.file];\r\n    if (!doc) return;\r\n    moveTo(ts, findDoc(ts, cm.getDoc()), doc, pos.start, pos.end);\r\n  }\r\n\r\n  function moveTo(ts, curDoc, doc, start, end) {\r\n    doc.doc.setSelection(start, end);\r\n    if (curDoc != doc && ts.options.switchToDoc) {\r\n      closeArgHints(ts);\r\n      ts.options.switchToDoc(doc.name, doc.doc);\r\n    }\r\n  }\r\n\r\n  // The {line,ch} representation of positions makes this rather awkward.\r\n  function findContext(doc, data) {\r\n    var before = data.context.slice(0, data.contextOffset).split(\"\\n\");\r\n    var startLine = data.start.line - (before.length - 1);\r\n    var start = Pos(startLine, (before.length == 1 ? data.start.ch : doc.getLine(startLine).length) - before[0].length);\r\n\r\n    var text = doc.getLine(startLine).slice(start.ch);\r\n    for (var cur = startLine + 1; cur < doc.lineCount() && text.length < data.context.length; ++cur)\r\n      text += \"\\n\" + doc.getLine(cur);\r\n    if (text.slice(0, data.context.length) == data.context) return data;\r\n\r\n    var cursor = doc.getSearchCursor(data.context, 0, false);\r\n    var nearest, nearestDist = Infinity;\r\n    while (cursor.findNext()) {\r\n      var from = cursor.from(), dist = Math.abs(from.line - start.line) * 10000;\r\n      if (!dist) dist = Math.abs(from.ch - start.ch);\r\n      if (dist < nearestDist) { nearest = from; nearestDist = dist; }\r\n    }\r\n    if (!nearest) return null;\r\n\r\n    if (before.length == 1)\r\n      nearest.ch += before[0].length;\r\n    else\r\n      nearest = Pos(nearest.line + (before.length - 1), before[before.length - 1].length);\r\n    if (data.start.line == data.end.line)\r\n      var end = Pos(nearest.line, nearest.ch + (data.end.ch - data.start.ch));\r\n    else\r\n      var end = Pos(nearest.line + (data.end.line - data.start.line), data.end.ch);\r\n    return {start: nearest, end: end};\r\n  }\r\n\r\n  function atInterestingExpression(cm) {\r\n    var pos = cm.getCursor(\"end\"), tok = cm.getTokenAt(pos);\r\n    if (tok.start < pos.ch && tok.type == \"comment\") return false;\r\n    return /[\\w)\\]]/.test(cm.getLine(pos.line).slice(Math.max(pos.ch - 1, 0), pos.ch + 1));\r\n  }\r\n\r\n  // Variable renaming\r\n\r\n  function rename(ts, cm) {\r\n    var token = cm.getTokenAt(cm.getCursor());\r\n    if (!/\\w/.test(token.string)) return showError(ts, cm, \"Not at a variable\");\r\n    dialog(cm, \"New name for \" + token.string, function(newName) {\r\n      ts.request(cm, {type: \"rename\", newName: newName, fullDocs: true}, function(error, data) {\r\n        if (error) return showError(ts, cm, error);\r\n        applyChanges(ts, data.changes);\r\n      });\r\n    });\r\n  }\r\n\r\n  function selectName(ts, cm) {\r\n    var name = findDoc(ts, cm.doc).name;\r\n    ts.request(cm, {type: \"refs\"}, function(error, data) {\r\n      if (error) return showError(ts, cm, error);\r\n      var ranges = [], cur = 0;\r\n      var curPos = cm.getCursor();\r\n      for (var i = 0; i < data.refs.length; i++) {\r\n        var ref = data.refs[i];\r\n        if (ref.file == name) {\r\n          ranges.push({anchor: ref.start, head: ref.end});\r\n          if (cmpPos(curPos, ref.start) >= 0 && cmpPos(curPos, ref.end) <= 0)\r\n            cur = ranges.length - 1;\r\n        }\r\n      }\r\n      cm.setSelections(ranges, cur);\r\n    });\r\n  }\r\n\r\n  var nextChangeOrig = 0;\r\n  function applyChanges(ts, changes) {\r\n    var perFile = Object.create(null);\r\n    for (var i = 0; i < changes.length; ++i) {\r\n      var ch = changes[i];\r\n      (perFile[ch.file] || (perFile[ch.file] = [])).push(ch);\r\n    }\r\n    for (var file in perFile) {\r\n      var known = ts.docs[file], chs = perFile[file];;\r\n      if (!known) continue;\r\n      chs.sort(function(a, b) { return cmpPos(b.start, a.start); });\r\n      var origin = \"*rename\" + (++nextChangeOrig);\r\n      for (var i = 0; i < chs.length; ++i) {\r\n        var ch = chs[i];\r\n        known.doc.replaceRange(ch.text, ch.start, ch.end, origin);\r\n      }\r\n    }\r\n  }\r\n\r\n  // Generic request-building helper\r\n\r\n  function buildRequest(ts, doc, query, pos) {\r\n    var files = [], offsetLines = 0, allowFragments = !query.fullDocs;\r\n    if (!allowFragments) delete query.fullDocs;\r\n    if (typeof query == \"string\") query = {type: query};\r\n    query.lineCharPositions = true;\r\n    if (query.end == null) {\r\n      query.end = pos || doc.doc.getCursor(\"end\");\r\n      if (doc.doc.somethingSelected())\r\n        query.start = doc.doc.getCursor(\"start\");\r\n    }\r\n    var startPos = query.start || query.end;\r\n\r\n    if (doc.changed) {\r\n      if (doc.doc.lineCount() > bigDoc && allowFragments !== false &&\r\n          doc.changed.to - doc.changed.from < 100 &&\r\n          doc.changed.from <= startPos.line && doc.changed.to > query.end.line) {\r\n        files.push(getFragmentAround(doc, startPos, query.end));\r\n        query.file = \"#0\";\r\n        var offsetLines = files[0].offsetLines;\r\n        if (query.start != null) query.start = Pos(query.start.line - -offsetLines, query.start.ch);\r\n        query.end = Pos(query.end.line - offsetLines, query.end.ch);\r\n      } else {\r\n        files.push({type: \"full\",\r\n                    name: doc.name,\r\n                    text: docValue(ts, doc)});\r\n        query.file = doc.name;\r\n        doc.changed = null;\r\n      }\r\n    } else {\r\n      query.file = doc.name;\r\n    }\r\n    for (var name in ts.docs) {\r\n      var cur = ts.docs[name];\r\n      if (cur.changed && cur != doc) {\r\n        files.push({type: \"full\", name: cur.name, text: docValue(ts, cur)});\r\n        cur.changed = null;\r\n      }\r\n    }\r\n\r\n    return {query: query, files: files};\r\n  }\r\n\r\n  function getFragmentAround(data, start, end) {\r\n    var doc = data.doc;\r\n    var minIndent = null, minLine = null, endLine, tabSize = 4;\r\n    for (var p = start.line - 1, min = Math.max(0, p - 50); p >= min; --p) {\r\n      var line = doc.getLine(p), fn = line.search(/\\bfunction\\b/);\r\n      if (fn < 0) continue;\r\n      var indent = CodeMirror.countColumn(line, null, tabSize);\r\n      if (minIndent != null && minIndent <= indent) continue;\r\n      minIndent = indent;\r\n      minLine = p;\r\n    }\r\n    if (minLine == null) minLine = min;\r\n    var max = Math.min(doc.lastLine(), end.line + 20);\r\n    if (minIndent == null || minIndent == CodeMirror.countColumn(doc.getLine(start.line), null, tabSize))\r\n      endLine = max;\r\n    else for (endLine = end.line + 1; endLine < max; ++endLine) {\r\n      var indent = CodeMirror.countColumn(doc.getLine(endLine), null, tabSize);\r\n      if (indent <= minIndent) break;\r\n    }\r\n    var from = Pos(minLine, 0);\r\n\r\n    return {type: \"part\",\r\n            name: data.name,\r\n            offsetLines: from.line,\r\n            text: doc.getRange(from, Pos(endLine, end.line == endLine ? null : 0))};\r\n  }\r\n\r\n  // Generic utilities\r\n\r\n  var cmpPos = CodeMirror.cmpPos;\r\n\r\n  function elt(tagname, cls /*, ... elts*/) {\r\n    var e = document.createElement(tagname);\r\n    if (cls) e.className = cls;\r\n    for (var i = 2; i < arguments.length; ++i) {\r\n      var elt = arguments[i];\r\n      if (typeof elt == \"string\") elt = document.createTextNode(elt);\r\n      e.appendChild(elt);\r\n    }\r\n    return e;\r\n  }\r\n\r\n  function dialog(cm, text, f) {\r\n    if (cm.openDialog)\r\n      cm.openDialog(text + \": <input type=text>\", f);\r\n    else\r\n      f(prompt(text, \"\"));\r\n  }\r\n\r\n  // Tooltips\r\n\r\n  function tempTooltip(cm, content, ts) {\r\n    if (cm.state.ternTooltip) remove(cm.state.ternTooltip);\r\n    var where = cm.cursorCoords();\r\n    var tip = cm.state.ternTooltip = makeTooltip(where.right + 1, where.bottom, content);\r\n    function maybeClear() {\r\n      old = true;\r\n      if (!mouseOnTip) clear();\r\n    }\r\n    function clear() {\r\n      cm.state.ternTooltip = null;\r\n      if (tip.parentNode) fadeOut(tip)\r\n      clearActivity()\r\n    }\r\n    var mouseOnTip = false, old = false;\r\n    CodeMirror.on(tip, \"mousemove\", function() { mouseOnTip = true; });\r\n    CodeMirror.on(tip, \"mouseout\", function(e) {\r\n      var related = e.relatedTarget || e.toElement\r\n      if (!related || !CodeMirror.contains(tip, related)) {\r\n        if (old) clear();\r\n        else mouseOnTip = false;\r\n      }\r\n    });\r\n    setTimeout(maybeClear, ts.options.hintDelay ? ts.options.hintDelay : 1700);\r\n    var clearActivity = onEditorActivity(cm, clear)\r\n  }\r\n\r\n  function onEditorActivity(cm, f) {\r\n    cm.on(\"cursorActivity\", f)\r\n    cm.on(\"blur\", f)\r\n    cm.on(\"scroll\", f)\r\n    cm.on(\"setDoc\", f)\r\n    return function() {\r\n      cm.off(\"cursorActivity\", f)\r\n      cm.off(\"blur\", f)\r\n      cm.off(\"scroll\", f)\r\n      cm.off(\"setDoc\", f)\r\n    }\r\n  }\r\n\r\n  function makeTooltip(x, y, content) {\r\n    var node = elt(\"div\", cls + \"tooltip\", content);\r\n    node.style.left = x + \"px\";\r\n    node.style.top = y + \"px\";\r\n    document.body.appendChild(node);\r\n    return node;\r\n  }\r\n\r\n  function remove(node) {\r\n    var p = node && node.parentNode;\r\n    if (p) p.removeChild(node);\r\n  }\r\n\r\n  function fadeOut(tooltip) {\r\n    tooltip.style.opacity = \"0\";\r\n    setTimeout(function() { remove(tooltip); }, 1100);\r\n  }\r\n\r\n  function showError(ts, cm, msg) {\r\n    if (ts.options.showError)\r\n      ts.options.showError(cm, msg);\r\n    else\r\n      tempTooltip(cm, String(msg), ts);\r\n  }\r\n\r\n  function closeArgHints(ts) {\r\n    if (ts.activeArgHints) {\r\n      if (ts.activeArgHints.clear) ts.activeArgHints.clear()\r\n      remove(ts.activeArgHints)\r\n      ts.activeArgHints = null\r\n    }\r\n  }\r\n\r\n  function docValue(ts, doc) {\r\n    var val = doc.doc.getValue();\r\n    if (ts.options.fileFilter) val = ts.options.fileFilter(val, doc.name, doc.doc);\r\n    return val;\r\n  }\r\n\r\n  // Worker wrapper\r\n\r\n  function WorkerServer(ts) {\r\n    var worker = ts.worker = new Worker(ts.options.workerScript);\r\n    worker.postMessage({type: \"init\",\r\n                        defs: ts.options.defs,\r\n                        plugins: ts.options.plugins,\r\n                        scripts: ts.options.workerDeps});\r\n    var msgId = 0, pending = {};\r\n\r\n    function send(data, c) {\r\n      if (c) {\r\n        data.id = ++msgId;\r\n        pending[msgId] = c;\r\n      }\r\n      worker.postMessage(data);\r\n    }\r\n    worker.onmessage = function(e) {\r\n      var data = e.data;\r\n      if (data.type == \"getFile\") {\r\n        getFile(ts, data.name, function(err, text) {\r\n          send({type: \"getFile\", err: String(err), text: text, id: data.id});\r\n        });\r\n      } else if (data.type == \"debug\") {\r\n        window.console.log(data.message);\r\n      } else if (data.id && pending[data.id]) {\r\n        pending[data.id](data.err, data.body);\r\n        delete pending[data.id];\r\n      }\r\n    };\r\n    worker.onerror = function(e) {\r\n      for (var id in pending) pending[id](e);\r\n      pending = {};\r\n    };\r\n\r\n    this.addFile = function(name, text) { send({type: \"add\", name: name, text: text}); };\r\n    this.delFile = function(name) { send({type: \"del\", name: name}); };\r\n    this.request = function(body, c) { send({type: \"req\", body: body}, c); };\r\n  }\r\n});\r\n\n//= require \"../vendor/codemirror2/codemirror\"\r\n//= require \"../vendor/codemirror2/xml\"\r\n//= require \"../vendor/codemirror2/css\"\r\n//= require \"../vendor/codemirror2/javascript\"\r\n//= require \"../vendor/codemirror2/htmlmixed\"\r\n//= require \"../vendor/codemirror2/searchcursor\"\r\n\r\ndefine('skylark-jsbin-coder/editors/codemirror',[\r\n\t\"skylark-codemirror/CodeMirror\",\r\n\t\"../coder\",\r\n    \"skylark-codemirror/mode/xml/xml\",\r\n    \"skylark-codemirror/mode/css/css\",\r\n    \"skylark-codemirror/mode/javascript/javascript\",\r\n    \"skylark-codemirror/mode/htmlmixed/htmlmixed\",\r\n    \"skylark-codemirror/addon/dialog/dialog\",\r\n    \"skylark-codemirror/addon/search/searchcursor\",\r\n    \"skylark-codemirror/addon/search/search\",\r\n    \"skylark-codemirror/addon/hint/anyword-hint\",\r\n    \"skylark-codemirror/addon/hint/javascript-hint\",\r\n    \"skylark-codemirror/addon/edit/matchbrackets\",\r\n    \"skylark-codemirror/addon/comment/comment\",\r\n    \"skylark-codemirror/addon/lint/javascript-lint\",\r\n    \"skylark-codemirror/addon/lint/lint\",\r\n    \"skylark-codemirror/addon/tern/tern\"\r\n],function(CodeMirror,coder){\r\n\r\n\treturn coder.editors.CodeMirror = CodeMirror;\r\n});\r\n\ndefine('skylark-jsbin-coder/editors/mobileCodeMirror',[\r\n  \"skylark-jquery\",\r\n   \"../jsbin\",\r\n   \"./codemirror\"\r\n],function ($,jsbin,CodeMirror) {\r\n  /* globals jsbin, throttle, $, $body, CodeMirror, $document */\r\n  var noop = function () {};\r\n  var rootClassName = document.body.className;\r\n  var oldCodeMirror = null;\r\n\r\n  var simple = jsbin.settings.editor && jsbin.settings.editor.simple;\r\n\r\n  if (simple ||\r\n      jsbin.mobile ||\r\n      jsbin.tablet ||\r\n      rootClassName.indexOf('ie6') !== -1 ||\r\n      rootClassName.indexOf('ie7') !== -1) {\r\n    $('body').addClass('mobile');\r\n    enableMobileMirror();\r\n  }\r\n\r\n  function enableMobileMirror() {\r\n    var re = /\\b./g;\r\n    jsbin.lameEditor = true;\r\n\r\n    var setCursor = function (sPos, ePos) {\r\n      if (!ePos) {\r\n        ePos = sPos;\r\n      }\r\n      var field = this.textarea;\r\n      var value = field.value;\r\n      field.value = ''; // hack to reset the cursor position\r\n      field.value = value;\r\n      if (field.setSelectionRange) {\r\n        field.setSelectionRange(sPos, ePos);\r\n      } else if (field.createTextRange) {\r\n        var range = field.createTextRange();\r\n        range.collapse(true);\r\n        if (sPos < 0) {\r\n          sPos = field.value.length + sPos;\r\n        }\r\n        range.moveEnd('character', ePos);\r\n        range.moveStart('character', sPos);\r\n        range.select();\r\n      }\r\n    }\r\n\r\n    var insert = function (value, from, to) {\r\n      var field = this.textarea;\r\n      if (value === undefined || value === null) {\r\n        value = '';\r\n      }\r\n\r\n      if (!from) {\r\n        from = this.getCursor();\r\n      }\r\n\r\n      if (!to) {\r\n        to = from;\r\n        if (this.textarea.selectionEnd !== this.textarea.selectionStart) {\r\n          to = this.posFromIndex(this.textarea.selectionEnd);\r\n        }\r\n      }\r\n\r\n      var prev = field.value;\r\n      var lines = field.value.split('\\n');\r\n      var line = lines[from.line];\r\n      line = line.substring(0, from.ch) + value + line.substring(to.ch);\r\n      lines[from.line] = line;\r\n\r\n      field.value = lines.join('\\n');\r\n\r\n      var endPos = lines.slice(0, from.line).join('\\n').length + 1 + from.ch + value.length; // +1 for missing ln\r\n      //lines.slice(0, from.line - 1).join('\\n').length + value.length + to.ch - 1;\r\n\r\n      setCursor.call({ textarea: field }, endPos);\r\n    };\r\n\r\n    var Editor = function (el, options) {\r\n      this.textarea = el;\r\n      this.win = { document: this.textarea };\r\n      this.ready = true;\r\n      this.wrapping = document.createElement('div');\r\n\r\n      var textareaParent = this.textarea.parentNode;\r\n      this.wrapping.appendChild(this.textarea);\r\n      textareaParent.appendChild(this.wrapping);\r\n\r\n      this.textarea.style.opacity = 1;\r\n      // this.textarea.style.width = '100%';\r\n\r\n      var eventName = jsbin.mobile || jsbin.tablet ? 'blur' : 'keyup';\r\n      var old = null;\r\n\r\n      var update = function () {\r\n        if (old !== el.value) {\r\n          old = el.value;\r\n          $document.trigger('codeChange', { panelId: el.id });\r\n        }\r\n      };\r\n\r\n      $document.on('jsbinReady', function () {\r\n        old = el.value;\r\n      });\r\n\r\n      $(this.textarea)\r\n        .on(eventName, throttle(function () {\r\n          update();\r\n          $body.removeClass('editor-focus');\r\n        }, 200))\r\n        .on('focus', function () {\r\n          hideOpen();\r\n          $body.addClass('editor-focus');\r\n        })\r\n        .on('touchstart', function () {\r\n          completionIndex = -1; // reset the completion\r\n        })\r\n        .on('keypress', function () {\r\n          completionIndex = -1; // reset the completion\r\n        });\r\n\r\n      if (options.initCallback) {\r\n        $(options.initCallback);\r\n      }\r\n\r\n      this.commands = {};\r\n      this.options = options;\r\n\r\n      this.__update = update;\r\n    };\r\n\r\n    var completionIndex = -1;\r\n    var completionCache = [];\r\n    var lastToken = null;\r\n\r\n    Editor.prototype = {\r\n      _hasCompletions: function () {\r\n        return completionIndex !== -1;\r\n      },\r\n      _completionIndex: completionIndex,\r\n      _showCompletion: function (completions, token) {\r\n        if (completionIndex === -1) {\r\n          // reset\r\n          console.log(completions);\r\n          completionCache = completions;\r\n          lastToken = token;\r\n          console.log(token);\r\n        }\r\n\r\n        // else, show the next completion\r\n        completionIndex++;\r\n        if (completionIndex >= completionCache.length) {\r\n          completionIndex = 0;\r\n        }\r\n        var pos = this.getCursor();\r\n        var i = this.indexFromPos(pos);\r\n        var value = completionCache[completionIndex].substr(lastToken.string.length);\r\n        insert.call(this, value);\r\n        this.setCursor(i, i + value.length); // highlight the section\r\n\r\n        return;\r\n      },\r\n      cursorCoords: function (from) {\r\n        var pos = getCaretCoordinates(this.textarea, this.textarea.selectionEnd);\r\n        pos.bottom = pos.top; // hack for CM\r\n        return pos;\r\n      },\r\n      replaceRange: function () {\r\n        this._completionIndex = -1;\r\n        return insert.apply(this, arguments);\r\n      },\r\n      getMode: function () {\r\n        return this.options.mode;\r\n      },\r\n      Pos: function (line, ch) {\r\n        return {\r\n          line: line,\r\n          ch: ch,\r\n        };\r\n      },\r\n      getWrapperElement: function () {\r\n        return this.wrapping;\r\n      },\r\n      getScrollerElement: function () {\r\n        return this.textarea;\r\n      },\r\n      setOption: function (type, handler) {\r\n        if (type === 'onChange') {\r\n          $(this.textarea).change(handler);\r\n        }\r\n      },\r\n      setCode: function (code) {\r\n        this.textarea.value = code;\r\n      },\r\n      getOption: noop,\r\n      getCode: function () {\r\n        return this.textarea.value;\r\n      },\r\n      getLine: function (n) {\r\n        return this.textarea.value.split('\\n')[n - 1];\r\n      },\r\n      getValue: function () {\r\n        return this.textarea.value;\r\n      },\r\n      setValue: function (code)  {\r\n        this.textarea.value = code;\r\n      },\r\n      focus: function () {\r\n        this.textarea.focus();\r\n      },\r\n      getCursor: function () {\r\n        var p = this.cursorPosition().character;\r\n        var lines = this.textarea.value.substring(0, p).split('\\n');\r\n        var line = lines.length - 1;\r\n        var char = lines[line].length;\r\n        return {\r\n          line: line,\r\n          char: char,\r\n          ch: char,\r\n        };\r\n      },\r\n      getTokenAt: function (pos) {\r\n        var line = this.textarea.value.split('\\n')[pos.line];\r\n        var frag = line.substr(0, pos.char);\r\n        var start = -1;\r\n        line.replace(re, function (m, i) {\r\n          if (line.substr(i).trim()) { // ignore the end of the line\r\n            start = i;\r\n          }\r\n        });\r\n\r\n        //var start = (re.exec(line.substr(0, pos.char)) || { index: -1 }).index + 1;\r\n        var end = (re.exec(line.substr(pos.char)) || { index: line.length }).index;\r\n        var string = line.substr(start, end);\r\n\r\n        // TODO validate string is made up entirely of \\w characters\r\n        if (!(/^\\w+$/g).test(string)) {\r\n          string = '';\r\n        }\r\n\r\n        return {\r\n          start: start,\r\n          end: end,\r\n          string: string.trim(),\r\n          type: 'variable',\r\n          state: {\r\n            mode: this.options.mode,\r\n          },\r\n        };\r\n      },\r\n      setCursor: setCursor,\r\n      currentLine: function () {\r\n        return 0;\r\n      },\r\n      defaultTextHeight: function () {\r\n        return 16;\r\n      },\r\n      highlightLines: function () {\r\n        return {\r\n          string: '',\r\n        };\r\n      },\r\n      removeKeyMap: noop,\r\n      addKeyMap: noop,\r\n      indentLine: noop,\r\n      cursorPosition: function () {\r\n        var character = 0;\r\n        if (this.textarea.selectionStart) {\r\n          character = this.textarea.selectionStart;\r\n        } else if (this.textarea.createTextRange) {\r\n          var range = this.textarea.createTextRange();\r\n          character = range.startOffset;\r\n        }\r\n        return { character: character };\r\n      },\r\n      nthLine: noop,\r\n      refresh: noop,\r\n      selectLines: noop,\r\n      on: noop,\r\n      somethingSelected: noop,\r\n      indexFromPos: function (pos) {\r\n        var lines = this.textarea.value.split('\\n');\r\n        return lines.slice(0, pos.line).join('').length + pos.ch + pos.line;\r\n      },\r\n      posFromIndex: function (i) {\r\n        var lines = this.textarea.value.substr(0, i).split('\\n');\r\n        var line = lines.length - 1;\r\n        return {\r\n          line: line,\r\n          ch: lines[line].length,\r\n        };\r\n      },\r\n      getRange: function (start, end) {\r\n        return this.textarea.value.substring(this.indexFromPos(start), this.indexFromPos(end));\r\n      },\r\n      getModeAt: function () {\r\n        var name = this.options.mode;\r\n        if (name === 'htmlmixed') {\r\n          name = 'html';\r\n        }\r\n        return { name: name };\r\n      },\r\n      setSelections: function (sel) {\r\n        setCursor.call(this, this.indexFromPos(sel[0].anchor), this.indexFromPos(sel[0].head));\r\n      },\r\n      listSelections: function () {\r\n        return [{\r\n          head: this.getCursor(),\r\n          anchor: this.getCursor(),\r\n        }];\r\n      },\r\n      operation: function (fn) {\r\n        fn();\r\n        // return fn;\r\n      }\r\n    };\r\n\r\n    oldCodeMirror = CodeMirror;\r\n    CodeMirror = noop;\r\n\r\n    for (var key in oldCodeMirror) {\r\n      CodeMirror[key] = noop;\r\n    }\r\n\r\n    // copy across some useful stuff\r\n    ['Pass', 'hint', 'snippets', 'execCommand', 'simpleHint', 'commands'].forEach(function (key) {\r\n      CodeMirror[key] = oldCodeMirror[key];\r\n    });\r\n\r\n    CodeMirror.fromTextArea = function (el, options) {\r\n      return new Editor(el, options);\r\n    };\r\n\r\n    CodeMirror.keyMap = { basic: {} };\r\n  }\r\n});\ndefine('skylark-jsbin-coder/editors/mobile-command-maps',[\r\n  \"skylark-jquery\",\r\n   \"../jsbin\"\r\n],function ($,jsbin) {\r\n  var commandMaps = [\r\n    {\r\n      value: '',\r\n      callback: function () { return this.complete(); }\r\n    },\r\n    {\r\n      value: 'fn',\r\n      callback: function () { return 'function $0() {\\n  \\n}' },\r\n      panel: ['js', 'console']\r\n    },\r\n    {\r\n      value: '($0)',\r\n      panel: ['js', 'console']\r\n    },\r\n    {\r\n      value: '{$0}',\r\n      panel: ['css', 'js'],\r\n      callback: function () {\r\n        return '{\\n  $0\\n}';\r\n      },\r\n    },\r\n    {\r\n      value: 'log',\r\n      callback: function () { return 'console.log($0)' },\r\n      panel: 'js',\r\n    },\r\n    {\r\n      value: '<$0',\r\n      panel: 'html',\r\n    },\r\n    {\r\n      value: '>$0',\r\n      panel: 'html',\r\n    },\r\n    {\r\n      value: '</>',\r\n      callback: function () { return this.close('>'); },\r\n      panel: 'html',\r\n    },\r\n    {\r\n      value: '=\"$0\"',\r\n      panel: 'html',\r\n    },\r\n    {\r\n      value: '&rarr;|',\r\n      callback: function () {\r\n        return '  $0';\r\n      },\r\n    },\r\n    {\r\n      value: ': \"$0\";',\r\n      panel: 'css',\r\n    },\r\n  ];\r\n\r\n\r\n  /**\r\n   * Notes\r\n   *\r\n   * - Undo isn't really possible. I tried it. It was terrible.\r\n   */\r\n\r\n   return jsbin.commandMaps = commandMaps;\r\n});\n/*global jsbin:true, CodeMirror:true */\r\ndefine('skylark-jsbin-coder/editors/snippets.cm',[\r\n  \"skylark-jquery\",\r\n   \"../jsbin\",\r\n   \"../coder\",\r\n   \"./codemirror\"\r\n],function ($,jsbin,coder,CodeMirror) {\r\n  'use strict';\r\n  var defaults = {\r\n      cl: 'console.log(\\'$0\\');',\r\n      fn: 'function $0() {\\n\\t\\n}'\r\n    };\r\n\r\n  CodeMirror.snippets = function(cm) {\r\n    var pos = cm.getCursor(),\r\n        tok = cm.getTokenAt(pos),\r\n        targetCursorPos = -1,\r\n        macro = '',\r\n        tagName = tok.string,\r\n        snippets = jsbin.settings.snippets || defaults;\r\n\r\n    if (tok.end > pos.ch) {\r\n      tagName = tagName.slice(0, tagName.length - tok.end + pos.ch);\r\n    }\r\n    var key = tagName.toLowerCase();\r\n\r\n    if (snippets[key]) {\r\n      targetCursorPos = snippets[key].indexOf('$0');\r\n      macro = snippets[key].replace(/\\$0/, '');\r\n      cm.replaceRange(macro,{line: pos.line, ch: pos.ch - key.length}, {line: pos.line, ch: pos.ch + key.length});\r\n\r\n      if (targetCursorPos !== -1) {\r\n        cm.setCursor({ line: pos.line, ch: pos.ch - key.length + targetCursorPos });\r\n      }\r\n      return;\r\n    }\r\n    return CodeMirror.Pass;\r\n  };\r\n\r\n  return coder.editors.snippets = CodeMirror.snippets;\r\n});\ndefine('skylark-jsbin-coder/editors/panel',[\r\n  \"skylark-jquery\",\r\n  \"skylark-jsbin-base/storage\",\r\n   \"../jsbin\",\r\n   \"../coder\",\r\n  \"./codemirror\",\r\n  \"./snippets.cm\"\r\n],function ($,store,jsbin,coder,CodeMirror) {\r\n  /*globals $, CodeMirror, jsbin, jshintEnabled, */\r\n  var $document = $(document),\r\n      $source = $('#source'),\r\n      userResizeable = !$('html').hasClass('layout');\r\n\r\n  var editorModes = {\r\n    html: 'htmlmixed',\r\n    javascript: 'javascript',\r\n    css: 'css',\r\n    typescript: 'javascript',\r\n    markdown: 'markdown',\r\n    coffeescript: 'coffeescript',\r\n    livescript: 'text/x-livescript',\r\n    jsx: 'javascript',\r\n    less: 'text/x-less',\r\n    sass: 'text/x-sass',\r\n    scss: 'text/x-scss',\r\n    processing: 'text/x-csrc',\r\n    jade: 'text/x-jade',\r\n    clojurescript: 'clojure'\r\n  };\r\n\r\n  var badChars = new RegExp('[\\u200B\\u0080-\\u00a0]', 'g');\r\n\r\n  if (jsbin.settings.editor.tabMode === 'default') {\r\n    CodeMirror.keyMap.basic.Tab = undefined;\r\n  } else if (jsbin.settings.editor.tabMode !== 'classic') {\r\n    CodeMirror.keyMap.basic.Tab = 'indentMore';\r\n  }\r\n\r\n  if (!CodeMirror.commands) {\r\n    CodeMirror.commands = {};\r\n  }\r\n\r\n  // Save a reference to this autocomplete function to use it when Tern scripts\r\n  // are loaded but not used, since they will automatically overwrite the\r\n  // CodeMirror autocomplete function with CodeMirror.showHint\r\n  var simpleJsHint = function(cm) {\r\n    if (CodeMirror.snippets(cm) === CodeMirror.Pass) {\r\n      return CodeMirror.simpleHint(cm, CodeMirror.hint.javascript);\r\n    }\r\n  };\r\n\r\n  CodeMirror.commands.autocomplete = simpleJsHint;\r\n\r\n  CodeMirror.commands.snippets = function (cm) {\r\n    'use strict';\r\n    if (['htmlmixed', 'javascript', 'css', editorModes['less'], editorModes['sass'], editorModes['scss']].indexOf(cm.options.mode) === -1) {\r\n      return CodeMirror.simpleHint(cm, CodeMirror.hint.anyword);\r\n    } else if (oldCodeMirror) {\r\n      return oldCodeMirror.snippets(cm);\r\n    } else if (!jsbin.mobile) {\r\n      return CodeMirror.snippets(cm);\r\n    }\r\n  };\r\n\r\n  var Panel = function (name, settings) {\r\n    'use strict';\r\n    var panel = this,\r\n        showPanelButton = true,\r\n        $panel = null,\r\n        splitterSettings = {},\r\n        cmSettings = {},\r\n        panelLanguage = name,\r\n        $panelwrapper = $('<div class=\"stretch panelwrapper\"></div>');\r\n\r\n    panel.settings = settings = settings || {};\r\n    panel.id = panel.name = name;\r\n    $panel = $('.panel.' + name);\r\n    $panel.data('name', name);\r\n    panel.$el = $panel.detach();\r\n    panel.$el.appendTo($panelwrapper);\r\n    $panelwrapper.appendTo($source);\r\n    panel.$panel = panel.$el;\r\n    panel.$el = panel.$el.parent().hide();\r\n    panel.el = document.getElementById(name);\r\n    panel.order = ++Panel.order;\r\n\r\n    panel.label = (settings.label || name);\r\n\r\n    panel.$el.data('panel', panel);\r\n\r\n    this._eventHandlers = {};\r\n\r\n    panel.on('show', panels.updateQuery);\r\n    panel.on('hide', panels.updateQuery);\r\n\r\n    // keyboard shortcut (set in keyboardcontrol.js)\r\n    panelShortcuts[panelShortcuts.start + panel.order] = panel.id;\r\n\r\n    if (panel.order === 1) {\r\n      settings.nosplitter = true;\r\n    }\r\n\r\n    if (settings.editor) {\r\n      cmSettings = {\r\n        parserfile: [],\r\n        readOnly: jsbin.state.embed ? 'nocursor' : false,\r\n        dragDrop: false, // we handle it ourselves\r\n        mode: editorModes[panelLanguage],\r\n        lineWrapping: false,\r\n        // gutters: ['line-highlight'],\r\n        theme: jsbin.settings.theme || 'jsbin',\r\n        highlightLine: true\r\n      };\r\n\r\n      $.extend(cmSettings, jsbin.settings.editor || {});\r\n\r\n      cmSettings.extraKeys = {};\r\n\r\n      // only the js panel for now, I'd like this to work in\r\n      // the HTML panel too, but only when you were in JS scope\r\n      if (name === 'javascript') {\r\n        cmSettings.extraKeys.Tab = 'autocomplete';\r\n      } else {\r\n        cmSettings.extraKeys.Tab = 'snippets';\r\n      }\r\n\r\n\r\n      if (name === 'html') {\r\n        // some emmet \"stuff\" - TODO decide whether this is needed still...\r\n        $.extend(cmSettings, {\r\n          syntax: name, // define Zen Coding syntax\r\n          profile: name, // define Zen Coding output profile\r\n        });\r\n      }\r\n\r\n      // make sure tabSize and indentUnit are numbers\r\n      if (typeof cmSettings.tabSize === 'string') {\r\n        cmSettings.tabSize = parseInt(cmSettings.tabSize, 10) || 2;\r\n      }\r\n      if (typeof cmSettings.indentUnit === 'string') {\r\n        cmSettings.indentUnit = parseInt(cmSettings.indentUnit, 10) || 2;\r\n      }\r\n\r\n      panel.editor = CodeMirror.fromTextArea(panel.el, cmSettings);\r\n\r\n      if (name === 'html' || name === 'css') {\r\n        delete emmetCodeMirror.defaultKeymap['Cmd-D'];\r\n        delete emmetCodeMirror.defaultKeymap['Ctrl-D'];\r\n        emmetCodeMirror(panel.editor);\r\n      }\r\n\r\n      panel.editor.on('highlightLines', function () {\r\n        window.location.hash = panels.getHighlightLines();\r\n      });\r\n\r\n      // Bind events using CM3 syntax\r\n      panel.editor.on('change', function codeChange(cm, changeObj) {\r\n        if (jsbin.saveDisabled) {\r\n          $document.trigger('codeChange.live', [{ panelId: panel.id, revert: true, origin: changeObj.origin }]);\r\n        } else {\r\n          $document.trigger('codeChange', [{ panelId: panel.id, revert: true, origin: changeObj.origin }]);\r\n        }\r\n        return true;\r\n      });\r\n\r\n      panel.editor.on('focus', function () {\r\n        panel.focus();\r\n      });\r\n\r\n      // Restore keymaps taken by emmet but that we need for other functionalities\r\n      if (name === 'javascript') {\r\n        var cmd = $.browser.platform === 'mac' ? 'Cmd' : 'Ctrl';\r\n        var map = {};\r\n        map[cmd + '-D'] = 'deleteLine';\r\n        map[cmd + '-/'] = function(cm) { CodeMirror.commands.toggleComment(cm); };\r\n        map.name = 'noEmmet';\r\n        panel.editor.addKeyMap(map);\r\n      }\r\n\r\n      panel._setupEditor(panel.editor, name);\r\n    }\r\n\r\n    if ($('html').is('.layout')) {\r\n      panel.splitter = $();\r\n      panel.$el.removeClass('stretch');\r\n    } else if (!settings.nosplitter) {\r\n      panel.splitter = panel.$el.splitter(splitterSettings).data('splitter');\r\n      panel.splitter.hide();\r\n    } else {\r\n      // create a fake splitter to let the rest of the code work\r\n      panel.splitter = $();\r\n    }\r\n\r\n    if (jsbin.state.processors && jsbin.state.processors[name]) {\r\n      panelLanguage = jsbin.state.processors[name];\r\n      jsbin.processors.set(panel, jsbin.state.processors[name]);\r\n    } else if (settings.processor) { // FIXME is this even used?\r\n      panelLanguage = settings.processors[settings.processor];\r\n      jsbin.processors.set(panel, settings.processor);\r\n    } else if (processors[panel.id]) {\r\n      jsbin.processors.set(panel, panel.id);\r\n    } else {\r\n      // this is just a dummy function for console & output...which makes no sense...\r\n      panel.processor = function (str) {\r\n        return new Promise(function (resolve) {\r\n          resolve(str);\r\n        });\r\n      };\r\n\r\n    }\r\n\r\n    if (settings.beforeRender) {\r\n      $document.bind('render', $.proxy(settings.beforeRender, panel));\r\n    }\r\n\r\n    if (!settings.editor) {\r\n      panel.ready = true;\r\n    }\r\n\r\n    // append panel to controls\r\n    if (jsbin.state.embed) {\r\n      // showPanelButton = window.location.search.indexOf(panel.id) !== -1;\r\n    }\r\n\r\n    if (showPanelButton) {\r\n      this.controlButton = $('<a role=\"button\" class=\"button group\" href=\"?' + name + '\">' + panel.label + '</a>');\r\n      this.updateAriaState();\r\n\r\n      this.controlButton.on('click touchstart', function () {\r\n        panel.toggle();\r\n        return false;\r\n      });\r\n      this.controlButton.appendTo('#panels');\r\n    }\r\n\r\n    $panel.focus(function () {\r\n      panel.focus();\r\n    });\r\n    if (!jsbin.mobile) {\r\n      $panel.add(this.$el.find('.label')).click(function () {\r\n        panel.focus();\r\n      });\r\n    }\r\n  };\r\n\r\n  Panel.order = 0;\r\n\r\n  Panel.prototype = {\r\n    virgin: true,\r\n    visible: false,\r\n    updateAriaState: function updateAriaState() {\r\n      this.controlButton.attr('aria-label', this.label + ' Panel: ' + (this.visible ? 'Active' : 'Inactive'));\r\n    },\r\n    show: function show(x) {\r\n      hideOpen();\r\n      if (this.visible) {\r\n        return;\r\n      }\r\n      $document.trigger('history:close');\r\n      // check to see if there's a panel to the left.\r\n      // if there is, take it's size/2 and make this our\r\n      // width\r\n      var panel = this,\r\n          panelCount = panel.$el.find('.panel').length;\r\n\r\n      analytics.showPanel(panel.id);\r\n\r\n      if (jsbin.mobile) {\r\n        panels.hideAll(true);\r\n      }\r\n\r\n      if (panel.splitter.length) {\r\n        if (panelCount === 0 || panelCount > 1) {\r\n          var $panel = $('.panel.' + panel.id).show();\r\n          // $panel.next().show(); // should be the splitter...\r\n          $panel.closest('.panelwrapper').show();\r\n        } else {\r\n          panel.$el.show();\r\n        }\r\n        panel.splitter.show();\r\n      } else {\r\n        panel.$el.show();\r\n      }\r\n\r\n      $body.addClass('panelsVisible');\r\n\r\n      if (panel.settings.show) {\r\n        panel.settings.show.call(panel, true);\r\n      }\r\n      panel.controlButton.addClass('active');\r\n      panel.visible = true;\r\n      this.updateAriaState();\r\n\r\n\r\n      // if the textarea is in focus AND we're mobile AND the keyboard is up\r\n      if (jsbin.mobile && window.matchMedia && window.matchMedia('(max-height: 410px) and (max-width: 640px)').matches) {\r\n        if (panel.editor) panel.editor.focus();\r\n      }\r\n\r\n      if (jsbin.mobile) {\r\n        panel.focus();\r\n        panel.trigger('show');\r\n        return;\r\n      }\r\n\r\n      // update the splitter - but do it on the next tick\r\n      // required to allow the splitter to see it's visible first\r\n      setTimeout(function () {\r\n        if (userResizeable) {\r\n          if (x !== undefined) {\r\n            panel.splitter.trigger('init', x);\r\n          } else {\r\n            panel.distribute();\r\n          }\r\n        }\r\n        if (panel.editor) {\r\n          // populate the panel for the first time\r\n          if (panel.virgin) {\r\n            var top = panel.$el.find('.label').outerHeight();\r\n            top += 8;\r\n\r\n            if (!jsbin.mobile) {\r\n              $(panel.editor.scroller).find('.CodeMirror-lines').css('padding-top', top);\r\n            }\r\n\r\n            populateEditor(panel, panel.name);\r\n          }\r\n          if (!panel.virgin || jsbin.panels.ready) {\r\n            panel.editor.focus();\r\n            panel.focus();\r\n          }\r\n          if (panel.virgin) {\r\n            if (panel.settings.init) {\r\n              setTimeout(function () {\r\n                panel.settings.init.call(panel);\r\n              }, 10);\r\n            }\r\n          }\r\n        } else {\r\n          panel.focus();\r\n        }\r\n        // update all splitter positions\r\n        $document.trigger('sizeeditors');\r\n\r\n        panel.trigger('show');\r\n\r\n        panel.virgin = false;\r\n      }, 0);\r\n\r\n      // TODO save which panels are visible in their profile - but check whether it's their code\r\n    },\r\n    hide: function (fromShow) {\r\n      var panel = this;\r\n      // panel.$el.hide();\r\n      panel.visible = false;\r\n      this.updateAriaState();\r\n\r\n      if (!fromShow) {\r\n        analytics.hidePanel(panel.id);\r\n      } else if (panel.editor) {\r\n        getRenderedCode[panel.id] = getRenderedCode.render(panel.id);\r\n      }\r\n\r\n      // update all splitter positions\r\n      // LOGIC: when you go to hide, you need to check if there's\r\n      // other panels inside the panel wrapper - if there are\r\n      // hide the nested panel and any previous visible splitter\r\n      // if there's only one - then hide the whole thing.\r\n      // if (panel.splitter.length) {\r\n      var panelCount = panel.$el.find('.panel').length;\r\n      if (panelCount === 0 || panelCount > 1) {\r\n        var $panel = $('.panel.' + panel.id).hide();\r\n        $panel.prev().hide(); // hide the splitter if there is one\r\n\r\n        // TODO trigger a distribute horizontally\r\n        if ($panel.closest('.panelwrapper').find('.panel:visible').length === 0) {\r\n          $panel.closest('.panelwrapper').hide();\r\n          // panel.splitter.hide();\r\n          // TODO FIXME\r\n        }\r\n      } else {\r\n        panel.$el.hide();\r\n        panel.splitter.hide();\r\n      }\r\n\r\n\r\n      if (panel.editor) {\r\n        panel.controlButton.toggleClass('hasContent', !!this.getCode().trim().length);\r\n      }\r\n\r\n      panel.controlButton.removeClass('active');\r\n\r\n      if (panel.settings.hide) {\r\n        panel.settings.hide.call(panel, true);\r\n      }\r\n\r\n      var visible = jsbin.panels.getVisible();\r\n      if (visible.length) {\r\n        jsbin.panels.focused = visible[0];\r\n        if (jsbin.panels.focused.editor) {\r\n          jsbin.panels.focused.editor.focus();\r\n        } else {\r\n          jsbin.panels.focused.$el.focus();\r\n        }\r\n        jsbin.panels.focused.focus();\r\n      }\r\n\r\n      if (!fromShow && jsbin.mobile && visible.length === 0) {\r\n        $document.trigger('history:load');\r\n        $('#history').show();\r\n        setTimeout(function () {\r\n          $body.removeClass('panelsVisible');\r\n        }, 100); // 100 is on purpose to add to the effect of the reveal\r\n      }\r\n\r\n      panel.trigger('hide');\r\n\r\n      if (fromShow) {\r\n        return;\r\n      }\r\n\r\n      panel.distribute();\r\n      $document.trigger('sizeeditors');\r\n\r\n      // note: the history:open does first check whether there's an open panels\r\n      // and if there are, it won't show the history, it'll just ignore the event\r\n      $document.trigger('history:open');\r\n    },\r\n    toggle: function () {\r\n      (this)[this.visible ? 'hide' : 'show']();\r\n    },\r\n    getCode: function () {\r\n      if (this.editor) {\r\n        badChars.lastIndex = 0;\r\n        return this.editor.getCode().replace(badChars, '');\r\n      }\r\n    },\r\n    setCode: function (content) {\r\n      if (this.editor) {\r\n        if (content === undefined) {\r\n          content = '';\r\n        }\r\n        this.controlButton.toggleClass('hasContent', !!content.trim().length);\r\n        this.codeSet = true;\r\n        this.editor.setCode(content.replace(badChars, ''));\r\n      }\r\n    },\r\n    codeSet: false,\r\n    blur: function () {\r\n      this.$panel.addClass('blur');\r\n    },\r\n    focus: function () {\r\n      this.$panel.removeClass('blur');\r\n      jsbin.panels.focus(this);\r\n    },\r\n    render: function () {\r\n      'use strict';\r\n      var args = [].slice.call(arguments);\r\n      var panel = this;\r\n      return new Promise(function (resolve, reject) {\r\n        if (panel.editor) {\r\n          panel.processor(panel.getCode()).then(resolve, reject);\r\n        } else if (panel.visible && panel.settings.render) {\r\n          if (jsbin.panels.ready) {\r\n            panel.settings.render.apply(panel, args);\r\n          }\r\n          resolve();\r\n        }\r\n      });\r\n    },\r\n    init: function () {\r\n      if (this.settings.init) this.settings.init.call(this);\r\n    },\r\n    _setupEditor: function () {\r\n      var focusedPanel = store.sessionStorage.getItem('panel') || jsbin.settings.focusedPanel,\r\n          panel = this,\r\n          editor = panel.editor;\r\n\r\n      // overhang from CodeMirror1\r\n      editor.setCode = function (str) {\r\n        //Cannot call method 'chunkSize' of undefined\r\n        try {\r\n          editor.setValue(str);\r\n        } catch(err) {\r\n          // console.error(panel.id, err);\r\n        }\r\n      };\r\n\r\n\r\n      editor.getCode = function () {\r\n        return editor.getValue();\r\n      };\r\n\r\n      editor.currentLine = function () {\r\n        var pos = editor.getCursor();\r\n        return pos.line;\r\n      };\r\n\r\n      // editor.setOption('onKeyEvent', keycontrol);\r\n      // editor.setOption('onFocus', function () {\r\n        // panel.$el.trigger('focus');\r\n      // });\r\n\r\n      // This prevents the browser from jumping\r\n      if (jsbin.embed) {\r\n        editor._focus = editor.focus;\r\n        editor.focus = function () {\r\n          // console.log('ignoring manual call');\r\n        };\r\n      }\r\n\r\n      editor.id = panel.name;\r\n\r\n      editor.win = editor.getWrapperElement();\r\n      editor.scroller = $(editor.getScrollerElement());\r\n\r\n      var $label = panel.$el.find('.label');\r\n      if (document.body.className.indexOf('ie6') === -1 && $label.length) {\r\n        editor.on('scroll', function (event) {\r\n          var scrollInfo = editor.getScrollInfo();\r\n          if (scrollInfo.top > 10) {\r\n            $label.stop().animate({ opacity: 0 }, 20, function () {\r\n              $(this).hide();\r\n            });\r\n          } else {\r\n            $label.show().stop().animate({ opacity: 1 }, 150);\r\n          }\r\n        });\r\n      }\r\n\r\n      var $error = null;\r\n      $document.bind('sizeeditors', function () {\r\n        if (panel.visible) {\r\n          var height = panel.editor.scroller.closest('.panel').outerHeight();\r\n          var offset = 0;\r\n          $error = panel.$el.find('details');\r\n          offset += ($error.filter(':visible').height() || 0);\r\n\r\n          if (!jsbin.lameEditor) {\r\n            editor.scroller.height(height - offset);\r\n          }\r\n          try { editor.refresh(); } catch (e) {}\r\n\r\n          setTimeout(function () {\r\n            $source[0].style.paddingLeft = '1px';\r\n            setTimeout(function () {\r\n              $source[0].style.paddingLeft = '0';\r\n            }, 0);\r\n          }, 0);\r\n        }\r\n      });\r\n\r\n      // required because the populate looks at the height, and at\r\n      // this point in the code, the editor isn't visible, the browser\r\n      // needs one more tick and it'll be there.\r\n      setTimeout(function () {\r\n        // if the panel isn't visible this only has the effect of putting\r\n        // the code in the textarea (though probably costs us a lot more)\r\n        // it has to be re-populated upon show for the first time because\r\n        // it appears that CM2 uses the visible height to work out what\r\n        // should be shown.\r\n        panel.ready = true;\r\n        populateEditor(panel, panel.name);\r\n\r\n        if (focusedPanel == panel.name) {\r\n          // another fracking timeout to avoid conflict with other panels firing up\r\n          setTimeout(function () {\r\n            panel.focus();\r\n            if (panel.visible && !jsbin.mobile && !jsbin.tablet) {\r\n              editor.focus();\r\n\r\n              var code = editor.getCode().split('\\n'),\r\n                  blank = null,\r\n                  i = 0;\r\n\r\n              for (; i < code.length; i++) {\r\n                if (blank === null && code[i].trim() === '') {\r\n                  blank = i;\r\n                  break;\r\n                }\r\n              }\r\n\r\n              editor.setCursor({ line: (store.sessionStorage.getItem('line') || blank || 0) * 1, ch: (store.sessionStorage.getItem('character') || 0) * 1 });\r\n            }\r\n          }, 110); // This is totally arbitrary\r\n        }\r\n      }, 0);\r\n    },\r\n    populateEditor: function () {\r\n      populateEditor(this, this.name);\r\n    },\r\n\r\n    // events\r\n    on: function (event, fn) {\r\n      (this._eventHandlers[event] = this._eventHandlers[event] || []).push(fn);\r\n      return this;\r\n    },\r\n\r\n    trigger: function (event) {\r\n      var args = [].slice.call(arguments, 1);\r\n      args.unshift({ type: event });\r\n      for (var list = this._eventHandlers[event], i = 0; list && list[i];) {\r\n        list[i++].apply(this, args);\r\n      }\r\n      return this;\r\n    }\r\n  };\r\n\r\n  function populateEditor(editor, panel) {\r\n    if (!editor.codeSet) {\r\n      // populate - should eventually use: session, saved data, local storage\r\n      var cached = store.sessionStorage.getItem('jsbin.content.' + panel), // session code\r\n          saved = jsbin.embed ? null : store.localStorage.getItem('saved-' + panel), // user template\r\n          sessionURL = store.sessionStorage.getItem('url'),\r\n          changed = false;\r\n\r\n      // if we clone the bin, there will be a checksum on the state object\r\n      // which means we happily have write access to the bin\r\n      if (sessionURL !== jsbin.getURL() && !jsbin.state.checksum) {\r\n        // nuke the live saving checksum\r\n        store.sessionStorage.removeItem('checksum');\r\n        saveChecksum = false;\r\n      }\r\n\r\n      if (template && cached == template[panel]) { // restored from original saved\r\n        editor.setCode(cached);\r\n      } else if (cached && sessionURL == jsbin.getURL() && sessionURL !== jsbin.root) { // try to restore the session first - only if it matches this url\r\n        editor.setCode(cached);\r\n        // tell the document that it's currently being edited, but check that it doesn't match the saved template\r\n        // because sessionStorage gets set on a reload\r\n        changed = cached != saved && cached != template[panel];\r\n      } else if (!template.post && saved !== null && !/(edit|embed)$/.test(window.location) && !window.location.search) { // then their saved preference\r\n        editor.setCode(saved);\r\n        var processor = JSON.parse(store.localStorage.getItem('saved-processors') || '{}')[panel];\r\n        if (processor) {\r\n          jsbin.processors.set(jsbin.panels.panels[panel], processor);\r\n        }\r\n      } else { // otherwise fall back on the JS Bin default\r\n        editor.setCode(template[panel]);\r\n      }\r\n\r\n      if (editor.editor && editor.editor.clearHistory) {\r\n        editor.editor.clearHistory();\r\n      }\r\n\r\n    } else {\r\n      // this means it was set via the url\r\n      changed = true;\r\n    }\r\n\r\n    if (changed) {\r\n      $document.trigger('codeChange', [ { revert: false, onload: true } ]);\r\n    }\r\n  }\r\n\r\n  return coder.editors.Panel = Panel;\r\n});\ndefine('skylark-jsbin-coder/editors/panels',[\r\n  \"skylark-jquery\",\r\n   \"skylark-jsbin-base/storage\",\r\n  \"../jsbin\",\r\n   \"./panel\"\r\n],function ($,store,jsbin,Panel) {\r\n  var panels = {};\r\n\r\n  panels.getVisible = function () {\r\n    var panels = this.named,  // this.panels => this.named\r\n        visible = [];\r\n    for (var panel in panels) {\r\n      if (panels[panel].visible) visible.push(panels[panel]);\r\n    }\r\n    return visible;\r\n  };\r\n\r\n  panels.save = function () {\r\n    // don't save panel state if we're in embed mode\r\n    if (jsbin.embed) {\r\n      return;\r\n    }\r\n\r\n    var visible = this.getVisible(),\r\n        state = {},\r\n        panel,\r\n        left = '',\r\n        width = $(window).width();\r\n\r\n    for (var i = 0; i < visible.length; i++) {\r\n      panel = visible[i];\r\n      left = panel.$el.css('left');\r\n      if (left.indexOf('%') === -1) {\r\n        // convert the pixel to relative - this is because jQuery pulls\r\n        // % for Webkit based, but px for Firefox & Opera. Cover our bases\r\n        left = (parseFloat(left)  / width * 100) + '%';\r\n      }\r\n      state[panel.name] = left;\r\n    }\r\n\r\n    store.sessionStorage.setItem('jsbin.panels', JSON.stringify(state));\r\n  };\r\n\r\n  function getQuery(qs) {\r\n    /*globals $*/\r\n    var sep = '&';\r\n    var eq = '=';\r\n    var obj = {};\r\n\r\n    var regexp = /\\+/g;\r\n    qs = qs.split(sep);\r\n\r\n    var maxKeys = 1000;\r\n\r\n    var len = qs.length;\r\n    // maxKeys <= 0 means that we should not limit keys count\r\n    if (maxKeys > 0 && len > maxKeys) {\r\n      len = maxKeys;\r\n    }\r\n\r\n    for (var i = 0; i < len; ++i) {\r\n      var x = qs[i].replace(regexp, '%20'),\r\n          idx = x.indexOf(eq),\r\n          kstr, vstr, k, v;\r\n\r\n      if (idx >= 0) {\r\n        kstr = x.substr(0, idx);\r\n        vstr = x.substr(idx + 1);\r\n      } else {\r\n        kstr = x;\r\n        vstr = '';\r\n      }\r\n\r\n      try {\r\n        k = decodeURIComponent(kstr);\r\n        v = decodeURIComponent(vstr);\r\n      } catch (e) {\r\n        k = kstr;\r\n        v = vstr;\r\n      }\r\n\r\n      if (!(window.hasOwnProperty ? window.hasOwnProperty(obj, k) : obj.hasOwnProperty(k))) {\r\n        obj[k] = v;\r\n      } else if ($.isArray(obj[k])) {\r\n        obj[k].push(v);\r\n      } else {\r\n        obj[k] = [obj[k], v];\r\n      }\r\n    }\r\n\r\n    return obj;\r\n  }\r\n\r\n  function stringAsPanelsToOpen(query) {\r\n    var validPanels = ['live', 'javascript', 'html', 'css', 'console'];\r\n\r\n    return query.split(',').reduce(function (toopen, key) {\r\n      if (key === 'js') {\r\n        key = 'javascript';\r\n      }\r\n\r\n      if (key === 'output') {\r\n        key = 'live';\r\n      }\r\n\r\n      if (validPanels.indexOf(key) !== -1) {\r\n        toopen.push(key);\r\n      }\r\n\r\n      return toopen;\r\n    }, []);\r\n  }\r\n\r\n  panels.restore = function () {\r\n    'use strict';\r\n    /*globals jsbin, editors, $window, $document*/\r\n    // if there are panel names on the hash (v2 of jsbin) or in the query (v3)\r\n    // then restore those specific panels and evenly distribute them.\r\n    var open = [],\r\n        defaultPanels = ['html', 'live'], // sigh, live == output :(\r\n        location = window.location,\r\n        search = location.search.substring(1),\r\n        hash = location.hash.substring(1),\r\n        toopen = [],\r\n        state = jsbin.embed ? null : JSON.parse(store.sessionStorage.getItem('jsbin.panels') || 'null'),\r\n        hasContent = { javascript: editors.javascript.getCode().length,\r\n          css: editors.css.getCode().length,\r\n          html: editors.html.getCode().length\r\n        },\r\n        name = '',\r\n        i = 0,\r\n        panel = null,\r\n        init = [],\r\n        panelURLValue = '',\r\n        openWithSameDimensions = false,\r\n        width = $window.width(),\r\n        deferredCodeInsert = '',\r\n        focused = !!store.sessionStorage.getItem('panel'),\r\n        validPanels = 'live javascript html css console'.split(' '),\r\n        cachedHash = '';\r\n\r\n    if (history.replaceState && (location.pathname.indexOf('/edit') !== -1) || ((location.origin + location.pathname) === jsbin.getURL() + '/')) {\r\n      // history.replaceState(null, '', jsbin.getURL() + (jsbin.getURL() === jsbin.root ? '' : '/edit') + (hash ? '#' + hash : ''));\r\n    }\r\n\r\n    if (search || hash) {\r\n      var query = (search || hash);\r\n\r\n      // assume the query is: html=xyz\r\n      if (query.indexOf('&') !== -1) {\r\n        query = getQuery(search || hash);\r\n        toopen = Object.keys(query).reduce(function (toopen, key) {\r\n          if (key.indexOf(',') !== -1 && query[key] === '') {\r\n            toopen = stringAsPanelsToOpen(key);\r\n            return toopen;\r\n          }\r\n\r\n          if (key === 'js') {\r\n            query.javascript = query.js;\r\n            key = 'javascript';\r\n          }\r\n\r\n          if (key === 'output') {\r\n            query.live = query.live;\r\n            key = 'live';\r\n          }\r\n\r\n          if (query[key] === undefined) {\r\n            query[key] = '';\r\n          }\r\n\r\n          if (validPanels.indexOf(key) !== -1) {\r\n            toopen.push(key + '=' + query[key]);\r\n          }\r\n\r\n          return toopen;\r\n        }, []);\r\n      } else {\r\n        toopen = stringAsPanelsToOpen(query);\r\n      }\r\n    }\r\n\r\n    if (toopen.length === 0) {\r\n      if (state !== null) {\r\n        toopen = Object.keys(state);\r\n      }\r\n      else {\r\n        // load from personal settings\r\n        toopen = jsbin.mobile ? [jsbin.settings.panels[0]] : jsbin.settings.panels;\r\n      }\r\n    }\r\n\r\n    if (toopen.length === 0) {\r\n      if (hasContent.javascript) {toopen.push('javascript');}\r\n      if (hasContent.html) {toopen.push('html');}\r\n      if (hasContent.css) {toopen.push('css');}\r\n      toopen.push('live');\r\n    }\r\n\r\n    panels.saveOnExit = true;\r\n\r\n    /* Boot code */\r\n    // then allow them to view specific panels based on comma separated hash fragment/query\r\n    i = 0;\r\n\r\n    if (toopen.length === 0) {\r\n      toopen = defaultPanels;\r\n    }\r\n\r\n    if (toopen.length) {\r\n      for (name in state) {\r\n        if (toopen.indexOf(name) !== -1) {\r\n          i++;\r\n        }\r\n      }\r\n\r\n      if (i === toopen.length) {\r\n        openWithSameDimensions = true;\r\n      }\r\n\r\n      for (i = 0; i < toopen.length; i++) {\r\n        panelURLValue = null;\r\n        name = toopen[i];\r\n\r\n        // if name contains an `=` it means we also need to set that particular panel to that code\r\n        if (name.indexOf('=') !== -1) {\r\n          panelURLValue = name.substring(name.indexOf('=') + 1);\r\n          name = name.substring(0, name.indexOf('='));\r\n        }\r\n\r\n        if (panels.named[name]) { // panels.panels => panels.named\r\n          panel = panels.named[name]; // panels.panels => panels.named\r\n          // console.log(name, 'width', state[name], width * parseFloat(state[name]) / 100);\r\n          if (panel.editor && panelURLValue !== null) {\r\n            panel.setCode(decodeURIComponent(panelURLValue));\r\n          }\r\n\r\n          if (openWithSameDimensions && toopen.length > 1) {\r\n            panel.show(width * parseFloat(state[name]) / 100);\r\n          } else {\r\n            panel.show();\r\n          }\r\n          init.push(panel);\r\n        } else if (name && panelURLValue !== null) { // TODO support any varible insertion\r\n          (function (name, panelURLValue) {\r\n            var todo = ['html', 'javascript', 'css'];\r\n\r\n            var deferredInsert = function (event, data) {\r\n              var code, parts, panel = panels.named[data.panelId] || {}; // panels.panels => panels.named\r\n\r\n              if (data.panelId && panel.editor && panel.ready === true) {\r\n                todo.splice(todo.indexOf(data.panelId), 1);\r\n                try {\r\n                  code = panel.getCode();\r\n                } catch (e) {\r\n                  // this really shouldn't happen\r\n                  // console.error(e);\r\n                }\r\n                if (code.indexOf('%' + name + '%') !== -1) {\r\n                  parts = code.split('%' + name + '%');\r\n                  code = parts[0] + decodeURIComponent(panelURLValue) + parts[1];\r\n                  panel.setCode(code);\r\n                  $document.unbind('codeChange', deferredInsert);\r\n                }\r\n              }\r\n\r\n              if (todo.length === 0) {\r\n                $document.unbind('codeChange', deferredInsert);\r\n              }\r\n            };\r\n\r\n            $document.bind('codeChange', deferredInsert);\r\n          }(name, panelURLValue));\r\n        }\r\n      }\r\n\r\n      // support the old jsbin v1 links directly to the preview\r\n      if (toopen.length === 1 && toopen[0] === 'preview') {\r\n        panels.named.live.show(); // panels.panels => panels.named\r\n      }\r\n\r\n      if (!openWithSameDimensions) {this.distribute();}\r\n    }\r\n\r\n    // now restore any data from sessionStorage\r\n    // TODO add default templates somewhere\r\n    // var template = {};\r\n    // for (name in this.panels) {\r\n    //   panel = this.panels[name];\r\n    //   if (panel.editor) {\r\n    //     // panel.setCode(store.sessionStorage.getItem('jsbin.content.' + name) || template[name]);\r\n    //   }\r\n    // }\r\n\r\n    for (i = 0; i < init.length; i++) {\r\n      init[i].init();\r\n    }\r\n\r\n    var visible = panels.getVisible();\r\n    if (visible.length) {\r\n      $body.addClass('panelsVisible');\r\n      if (!focused) {\r\n        visible[0].show();\r\n      }\r\n    }\r\n\r\n  };\r\n\r\n  panels.savecontent = function () {\r\n    // loop through each panel saving it's content to sessionStorage\r\n    var name, panel;\r\n    for (name in this.named) {  // this.panels => this.named\r\n      panel = this.named[name]; // this.panels => this.named\r\n      if (panel.editor) store.sessionStorage.setItem('jsbin.content.' + name, panel.getCode());\r\n    }\r\n  };\r\n\r\n  panels.getHighlightLines = function () {\r\n    'use strict';\r\n    var hash = [];\r\n    var lines = '';\r\n    var panel;\r\n    for (name in panels.named) { // panels.panels => panels.named\r\n      panel = panels.named[name]; // panels.panels => panels.named\r\n      if (panel.editor) {\r\n        lines = panel.editor.highlightLines().string;\r\n        if (lines) {\r\n          hash.push(name.substr(0, 1).toUpperCase() + ':L' + lines);\r\n        }\r\n      }\r\n    }\r\n    return hash.join(',');\r\n  };\r\n\r\n  panels.focus = function (panel) {\r\n    this.focused = panel;\r\n    if (panel) {\r\n      $('.panel').removeClass('focus').filter('.' + panel.id).addClass('focus');\r\n    }\r\n  }\r\n\r\n  panels.getQuery = function () {\r\n    var alt = {\r\n      javascript: 'js',\r\n      live: 'output'\r\n    };\r\n\r\n    var visible = panels.getVisible();\r\n\r\n    return visible.map(function (p) {\r\n      return alt[p.id] || p.id;\r\n    }).join(',');\r\n  }\r\n\r\n  panels.updateQuery = throttle(function updateQuery() {\r\n    var query = panels.getQuery();\r\n\r\n    if (jsbin.state.code && jsbin.state.owner) {\r\n      $.ajax({\r\n        url: jsbin.getURL({ withRevision: true }) + '/settings',\r\n        type: 'PUT',\r\n        data: { panels: visible.map(function (p) { return p.id; }) },\r\n        success: function () {}\r\n      });\r\n    }\r\n\r\n    if (history.replaceState) {\r\n      history.replaceState(null, null, '?' + query);\r\n    }\r\n  }, 100);\r\n\r\n  var userResizeable = !$('html').hasClass('layout');\r\n\r\n  if (!userResizeable) {\r\n    $('#source').removeClass('stretch');\r\n  }\r\n\r\n  // evenly distribute the width of all the visible panels\r\n  panels.distribute = function () {\r\n    if (!userResizeable) {\r\n      return;\r\n    }\r\n\r\n    var visible = $('#source .panelwrapper:visible'),\r\n        width = 100,\r\n        height = 0,\r\n        innerW = $window.width() - (visible.length - 1), // to compensate for border-left\r\n        innerH = $('#source').outerHeight(),\r\n        left = 0,\r\n        right = 0,\r\n        top = 0,\r\n        panel,\r\n        nestedPanels = [];\r\n\r\n    if (visible.length) {\r\n      $body.addClass('panelsVisible');\r\n\r\n      // visible = visible.sort(function (a, b) {\r\n      //   return a.order < b.order ? -1 : 1;\r\n      // });\r\n\r\n      width = 100 / visible.length;\r\n      for (var i = 0; i < visible.length; i++) {\r\n        panel = $.data(visible[i], 'panel');\r\n        right = 100 - (width * (i+1));\r\n        panel.$el.css({ top: 0, bottom: 0, left: left + '%', right: right + '%' });\r\n        panel.splitter.trigger('init', innerW * left/100);\r\n        panel.splitter[i == 0 ? 'hide' : 'show']();\r\n        left += width;\r\n\r\n        nestedPanels = $(visible[i]).find('.panel');\r\n        if (nestedPanels.length > 1) {\r\n          top = 0;\r\n          nestedPanels = nestedPanels.filter(':visible');\r\n          height = 100 / nestedPanels.length;\r\n          nestedPanels.each(function (i) {\r\n            bottom = 100 - (height * (i+1));\r\n            var panel = panels.named[$.data(this, 'name')];  // jsbin.panels.panels => panels.named\r\n            // $(this).css({ top: top + '%', bottom: bottom + '%' });\r\n            $(this).css('top', top + '%');\r\n            $(this).css('bottom', bottom + '%' );\r\n            if (panel.splitter.hasClass('vertical')) {\r\n              panel.splitter.trigger('init', innerH * top/100);\r\n              panel.splitter[i == 0 ? 'hide' : 'show']();\r\n            }\r\n            top += height;\r\n          });\r\n        }\r\n      }\r\n    } else if (!jsbin.embed) {\r\n      $('#history').show();\r\n      setTimeout(function () {\r\n        $body.removeClass('panelsVisible');\r\n      }, 100); // 100 is on purpose to add to the effect of the reveal\r\n    }\r\n  };\r\n\r\n  panels.show = function (panelId) {\r\n    this.named[panelId].show();  // this.panels => this.named\r\n    if (this.named[panelId].editor) { // this.panels => this.named\r\n      this.named[panelId].editor.focus(); // this.panels => this.named\r\n    }\r\n    this.named[panelId].focus(); // this.panels => this.named\r\n  };\r\n\r\n  panels.hide = function (panelId) {\r\n    var $history = $('#history'); // TODO shouldn't have to keep hitting this\r\n    var panels = this.named; // this.panels => this.named\r\n    if (panels[panelId].visible) {\r\n      panels[panelId].hide();\r\n    }\r\n\r\n    var visible = panels.getVisible();\r\n    if (visible.length) {\r\n      panels.focused = visible[0];\r\n      if (panels.focused.editor) {\r\n        panels.focused.editor.focus();\r\n      } else {\r\n        panels.focused.$el.focus();\r\n      }\r\n      panels.focused.focus();\r\n    }\r\n\r\n    /*\r\n    } else if ($history.length && !$body.hasClass('panelsVisible')) {\r\n      $body.toggleClass('dave', $history.is(':visible'));\r\n      $history.toggle(100);\r\n    } else if ($history.length === 0) {\r\n      // TODO load up the history\r\n    }\r\n    */\r\n  };\r\n\r\n  panels.hideAll = function (fromShow) {\r\n    var visible = panels.getVisible(),\r\n        i = visible.length;\r\n    while (i--) {\r\n      visible[i].hide(fromShow);\r\n    }\r\n  };\r\n\r\n  // dirty, but simple\r\n  Panel.prototype.distribute = function () {\r\n    panels.distribute();\r\n  };\r\n\r\n  var ignoreDuringLive = /^\\s*(while|do|for)[\\s*|$]/;\r\n\r\n\r\n  var panelInit = {\r\n    html: function () {\r\n      var init = function () {\r\n        // set cursor position on first blank line\r\n        // 1. read all the inital lines\r\n        var lines = this.editor.getValue().split('\\n'),\r\n            blank = -1;\r\n        lines.forEach(function (line, i) {\r\n          if (blank === -1 && line.trim().length === 0) {\r\n            blank = i;\r\n            //exit\r\n          }\r\n        });\r\n\r\n        if (blank !== -1) {\r\n          this.editor.setCursor({ line: blank, ch: 2 });\r\n          if (lines[blank].length === 0) {\r\n            this.editor.indentLine(blank, 'add');\r\n          }\r\n        }\r\n      };\r\n\r\n      return new Panel('html', { editor: true, label: 'HTML', init: init });\r\n    },\r\n    css: function () {\r\n      return new Panel('css', { editor: true, label: 'CSS' });\r\n    },\r\n    javascript: function () {\r\n      return new Panel('javascript', { editor: true, label: 'JavaScript' });\r\n    },\r\n    console: function () {\r\n      // hide and show callbacks registered in console.js\r\n      return new Panel('console', { label: 'Console' });\r\n    },\r\n    live: function () {\r\n      function show() {\r\n        // var panel = this;\r\n        if (panels.ready) {\r\n          renderLivePreview();\r\n        }\r\n      }\r\n\r\n      function hide() {\r\n        // detroy the iframe if we hide the panel\r\n        // note: $live is defined in live.js\r\n        // Commented out so that the live iframe is never destroyed\r\n        if (panels.named.console.visible === false) { // panels.panels => panels.named\r\n          // $live.find('iframe').remove();\r\n        }\r\n      }\r\n\r\n      return new Panel('live', { label: 'Output', show: show, hide: hide });\r\n    }\r\n  };\r\n\r\n  var editors = panels.named = {};  // panels.panels => panels.named\r\n\r\n  // show all panels (change the order to control the panel order)\r\n  editors.html = panelInit.html();\r\n  editors.css = panelInit.css();\r\n  editors.javascript = panelInit.javascript();\r\n  editors.console = panelInit.console();\r\n  upgradeConsolePanel(editors.console);\r\n  editors.live = panelInit.live();\r\n\r\n  editors.live.settings.render = function (showAlerts) {\r\n    if (panels.ready) {\r\n      renderLivePreview(showAlerts);\r\n    }\r\n  };\r\n\r\n  panels.allEditors = function (fn) {\r\n    var panelId, panel;\r\n    for (panelId in panels.named) {  // panels.panels => panels.named\r\n      panel = panels.named[panelId]; // panels.panels => panels.named\r\n      if (panel.editor) fn(panel);\r\n    }\r\n  };\r\n\r\n  setTimeout(function () {\r\n    panels.restore();\r\n  }, 10);\r\n  panels.focus(panels.getVisible()[0] || null);\r\n\r\n  var editorsReady = setInterval(function () {\r\n    var ready = true,\r\n        resizeTimer = null,\r\n        panel,\r\n        panelId,\r\n        hash = window.location.hash.substring(1);\r\n\r\n\r\n    for (panelId in panels.named) {  // panels.panels => panels.named\r\n      panel = panels.named[panelId]; // panels.panels => panels.named\r\n      if (panel.visible && !panel.ready) {\r\n        ready = false;\r\n        break;\r\n      }\r\n    }\r\n\r\n    panels.ready = ready;\r\n\r\n    if (ready) {\r\n      panels.allEditors(function (panel) {\r\n        var key = panel.id.substr(0, 1).toUpperCase() + ':L';\r\n        if (hash.indexOf(key) !== -1) {\r\n          var lines = hash.match(new RegExp(key + '(\\\\d+(?:-\\\\d+)?)'));\r\n          if (lines !== null) {\r\n            panel.editor.highlightLines(lines[1]);\r\n          }\r\n        }\r\n      });\r\n\r\n      var altLibraries = $('li.add-library');\r\n      var altRun = $('li.run-with-js');\r\n      editors.live.on('hide', function () {\r\n        altLibraries.show();\r\n        altRun.hide();\r\n      });\r\n\r\n      editors.live.on('show', function () {\r\n        altLibraries.hide();\r\n        altRun.show();\r\n      });\r\n\r\n      if (panels.named.live.visible) { // panels.panels => panels.named\r\n        editors.live.trigger('show');\r\n      } else {\r\n        editors.live.trigger('hide');\r\n      }\r\n\r\n      clearInterval(editorsReady);\r\n\r\n      // if the console is visible, it'll handle rendering of the output and console\r\n      if (panels.named.console.visible) { // panels.panels => panels.named\r\n        editors.console.render();\r\n      } else {\r\n        // otherwise, force a render\r\n        renderLivePreview();\r\n      }\r\n\r\n\r\n      if (!jsbin.mobile) {\r\n        $(window).resize(function () {\r\n          clearTimeout(resizeTimer);\r\n          resizeTimer = setTimeout(function () {\r\n            $document.trigger('sizeeditors');\r\n          }, 100);\r\n        });\r\n      }\r\n\r\n      $document.trigger('sizeeditors');\r\n      $document.trigger('jsbinReady');\r\n    }\r\n  }, 100);\r\n\r\n\r\n\r\n  setTimeout(function () {\r\n    panels.restore();\r\n  }, 10);\r\n  panels.focus(panels.getVisible()[0] || null);\r\n\r\n\r\n  return jsbin.codepan.panels = panels;\r\n});\ndefine('skylark-jsbin-coder/editors/mobile-keyboard',[\r\n  \"skylark-jquery\",\r\n   \"../jsbin\",\r\n   \"./mobile-command-maps\",\r\n   \"./panels\"\r\n],function ($,jsbin,commandMaps,panels) {\r\n  /* globals jsbin, $, escapeHTML, $document, editors, commandMaps */\r\n\r\n  if (!jsbin.mobile || jsbin.embed) {\r\n    return;\r\n  }\r\n\r\n  var getCursor = function (field) {\r\n    if (field.selectionStart) {\r\n      return field.selectionStart;\r\n    }\r\n    if (field.createTextRange) {\r\n      var range = field.createTextRange();\r\n      return range.startOffset;\r\n    }\r\n  };\r\n\r\n  var getTA = function () {\r\n    return jsbin.panels.focused.editor.textarea;\r\n  };\r\n\r\n  var mobileUtils = {\r\n    next: function () {\r\n\r\n    },\r\n    close: function (needle) {\r\n      var ta = getTA();\r\n      var pos = getCursor(ta);\r\n      // look backwards\r\n      var tagposition = ta.value.substring(0, pos).lastIndexOf(needle);\r\n      if (needle === '>') {\r\n        var start = 0;\r\n        while (start > -1) {\r\n          start = ta.value.substring(0, tagposition).lastIndexOf('<') + 1;\r\n          var c = ta.value.substr(start, 1);\r\n          if (c === '/') {\r\n            // we've got another closing tag, move back\r\n            var matched = ta.value.substr(start + 1, ta.value.substr(start).indexOf('>') - 1);\r\n            tagposition = ta.value.lastIndexOf('<' + matched);\r\n            continue;\r\n          }\r\n\r\n          if (c === '!') {\r\n            return '';\r\n          }\r\n\r\n          if (start === 0) {\r\n            return '';\r\n          }\r\n          break;\r\n        }\r\n\r\n        var tail = ta.value.substr(start, tagposition).indexOf(needle);\r\n        return '</' + ta.value.substr(start, tail) + '>$0';\r\n      }\r\n    },\r\n    complete: function () {\r\n      var focused = jsbin.panels.focused;\r\n      if (focused.id === 'html' || focused.id === 'css') {\r\n        CodeMirror.commands['emmet.expand_abbreviation_with_tab'].call(null, focused.editor);\r\n      } else if (focused.editor._hasCompletions && focused.editor._hasCompletions()) {\r\n        focused.editor._showCompletion();\r\n      } else {\r\n        CodeMirror.commands.autocomplete(focused.editor);\r\n      }\r\n      focused.editor.focus();\r\n    },\r\n  };\r\n\r\n  var buttons = {\r\n    html: $(),\r\n    css: $(),\r\n    js: $(),\r\n    console: $(),\r\n    all: $(),\r\n  };\r\n\r\n  var makeCommand = function (command) {\r\n    var button = $('<button>');\r\n    var toinsert = command.value;\r\n    var label = command.value.replace(/\\$0/, '');\r\n    if (!command.callback) {\r\n      command.callback = function () {\r\n        return toinsert;\r\n      };\r\n    }\r\n\r\n    button.on('click', function () {\r\n      var focused = jsbin.panels.focused;\r\n      if (focused.editor) {\r\n        var pos = focused.editor.getCursor();\r\n        var value = command.callback.call(mobileUtils);\r\n        if (value == null) {\r\n          return;\r\n        }\r\n        var resetTo = value.indexOf('$0');\r\n        if (resetTo === -1) {\r\n          resetTo = 0;\r\n        }\r\n        var offset = focused.editor.cursorPosition().character + resetTo;\r\n        if (pos !== -1) {\r\n          value = value.replace('$0', '');\r\n        }\r\n        focused.editor.replaceRange(value, pos, pos);\r\n        focused.editor.setCursor(offset);\r\n\r\n        focused.editor.textarea.focus();\r\n      } else if (focused.id === 'console') {\r\n        focused.setCursorTo(command.callback().replace('\\$0', ''), true);\r\n        focused.$el.click();\r\n      }\r\n    });\r\n\r\n    button.html(escapeHTML(label));\r\n    strip.find('div').append(button);\r\n\r\n    if (command.panel) {\r\n      if (typeof command.panel === 'string') {\r\n        buttons[command.panel] = buttons[command.panel].add(button);\r\n      } else {\r\n        command.panel.forEach(function (p) {\r\n          buttons[p] = buttons[p].add(button);\r\n        });\r\n      }\r\n      buttons.all = buttons.all.add(button);\r\n    }\r\n  };\r\n\r\n  var strip = $('<div id=\"strip\"><div class=\"inner-strip\"></div></div>');\r\n\r\n  commandMaps.map(makeCommand);\r\n\r\n  $('body').append(strip);\r\n\r\n  var hideAll = function (panel) {\r\n    return function () {\r\n      buttons.all.hide();\r\n      if (buttons[panel]) {\r\n        buttons[panel].show();\r\n      }\r\n    };\r\n  };\r\n\r\n  $document.on('jsbinReady', function () {\r\n    // hook up which buttons should be shown and when\r\n    panels.named.html.on('show', hideAll('html')); // editors => panels.named\r\n    panels.named.css.on('show', hideAll('css'));// editors => panels.named\r\n    panels.named.javascript.on('show', hideAll('js'));// editors => panels.named\r\n    panels.named.console.on('show', hideAll('console'));// editors => panels.named\r\n    hideAll(panels.focused.id === 'javascript' ? 'js' : panels.focused.id)();  // jsbin.panels =>panels\r\n  });\r\n});\ndefine('skylark-jsbin-coder/editors/autocomplete',[\r\n  \"skylark-jquery\",\r\n   \"../jsbin\",\r\n   \"../coder\"\r\n],function ($,jsbin,coder) {\r\n\r\n  // Minimal event-handling wrapper.\r\n  function stopEvent() {\r\n    if (this.preventDefault) {this.preventDefault(); this.stopPropagation();}\r\n    else {this.returnValue = false; this.cancelBubble = true;}\r\n  }\r\n  function addStop(event) {\r\n    if (!event.stop) event.stop = stopEvent;\r\n    return event;\r\n  }\r\n  function connect(node, type, handler) {\r\n    function wrapHandler(event) {handler(addStop(event || window.event));}\r\n    if (typeof node.addEventListener == \"function\")\r\n      node.addEventListener(type, wrapHandler, false);\r\n    else\r\n      node.attachEvent(\"on\" + type, wrapHandler);\r\n  }\r\n\r\n  function forEach(arr, f) {\r\n    for (var i = 0, e = arr.length; i < e; ++i) f(arr[i]);\r\n  }\r\n\r\n  function startTagComplete(editor) {\r\n    // We want a single cursor position.\r\n    if (editor.somethingSelected()) return;\r\n    // Find the token at the cursor\r\n    var cur = editor.getCursor(false), token = editor.getTokenAt(cur), tprop = token;\r\n    // If it's not a 'word-style' token, ignore the token.\r\n    if (!/^[\\w$_]*$/.test(token.string)) {\r\n      token = tprop = {start: cur.ch, end: cur.ch, string: \"\", state: token.state,\r\n                       className: token.string == \".\" ? \"js-property\" : null};\r\n    }\r\n    \r\n    // If it is a property, find out what it is a property of.\r\n    while (tprop.className == \"js-property\") {\r\n      tprop = editor.getTokenAt({line: cur.line, ch: tprop.start});\r\n      if (tprop.string != \".\") return;\r\n      tprop = editor.getTokenAt({line: cur.line, ch: tprop.start});\r\n      if (!context) var context = [];\r\n      context.push(tprop);\r\n    }\r\n    \r\n    function insert(str) {\r\n      editor.replaceRange(str, {line: cur.line, ch: token.start}, {line: cur.line, ch: token.end});\r\n    }\r\n    \r\n    insert('<></>');\r\n    editor.focus();\r\n    editor.setCursor({ line: cur.line, ch: token.end });\r\n    return true;\r\n  }\r\n\r\n  function startComplete(editor) {\r\n    // We want a single cursor position.\r\n    if (editor.somethingSelected()) return;\r\n    // Find the token at the cursor\r\n    var cur = editor.getCursor(false), token = editor.getTokenAt(cur), tprop = token;\r\n    // If it's not a 'word-style' token, ignore the token.\r\n\r\n    if (token.string == '') return;\r\n\r\n    if (!/^[\\w$_]*$/.test(token.string)) {\r\n      token = tprop = {start: cur.ch, end: cur.ch, string: \"\", state: token.state,\r\n                       className: token.string == \".\" ? \"js-property\" : null};\r\n    }\r\n    \r\n    // If it is a property, find out what it is a property of.\r\n    while (tprop.className == \"js-property\") {\r\n      tprop = editor.getTokenAt({line: cur.line, ch: tprop.start});\r\n      if (tprop.string != \".\") return;\r\n      tprop = editor.getTokenAt({line: cur.line, ch: tprop.start});\r\n      if (!context) var context = [];\r\n      context.push(tprop);\r\n    }\r\n    \r\n    if (token.string == '' && context === undefined) return;\r\n    \r\n    var completions = getCompletions(token, context, editor);\r\n    if (!completions.length) return;\r\n    function insert(str) {\r\n      editor.replaceRange(str, {line: cur.line, ch: token.start}, {line: cur.line, ch: token.end});\r\n    }\r\n    // When there is only one completion, use it directly.\r\n    if (completions.length == 1) {insert(completions[0]); return true;}\r\n\r\n    // Build the select widget\r\n    var complete = document.createElement(\"div\");\r\n    complete.className = \"completions\";\r\n    var sel = complete.appendChild(document.createElement(\"select\"));\r\n    sel.multiple = true;\r\n    for (var i = 0; i < completions.length; ++i) {\r\n      var opt = sel.appendChild(document.createElement(\"option\"));\r\n      opt.appendChild(document.createTextNode(completions[i]));\r\n    }\r\n    sel.firstChild.selected = true;\r\n    sel.size = Math.min(10, completions.length);\r\n    var pos = editor.cursorCoords();\r\n    complete.style.left = pos.x + \"px\";\r\n    complete.style.top = pos.yBot + \"px\";\r\n    complete.style.position = 'absolute';\r\n    complete.style.outline = 'none';\r\n    complete.className = 'autocomplete';\r\n    document.body.appendChild(complete);\r\n    \r\n    // Hack to hide the scrollbar.\r\n    if (completions.length <= 10) {\r\n      complete.style.width = (sel.clientWidth - 1) + \"px\";\r\n    }\r\n\r\n    var done = false;\r\n    function close() {\r\n      if (done) return;\r\n      done = true;\r\n      complete.parentNode.removeChild(complete);\r\n    }\r\n    function pick() {\r\n      insert(sel.options[sel.selectedIndex].value);\r\n      close();\r\n      setTimeout(function(){editor.focus();}, 50);\r\n    }\r\n    \r\n    function pickandclose() {\r\n      pick()\r\n      setTimeout(function () { editor.focus(); }, 50);\r\n    }\r\n    \r\n    connect(sel, \"blur\", close);\r\n    connect(sel, \"keydown\", function(event) {\r\n      var code = event.keyCode;\r\n      // Enter and space\r\n      if (code == 13 || code == 32) { event.stop(); pick();}\r\n      // Escape\r\n      else if (code == 27) {event.stop(); close(); editor.focus();}\r\n      else if (code != 38 && code != 40) {close(); editor.focus(); setTimeout(function () { startComplete(editor) }, 50);}\r\n    });\r\n    connect(sel, \"dblclick\", pick);\r\n\r\n    sel.focus();\r\n    // Opera sometimes ignores focusing a freshly created node\r\n    if (window.opera) setTimeout(function(){if (!done) sel.focus();}, 100);\r\n    return true;\r\n  }\r\n\r\n  var stringProps = (\"charAt charCodeAt indexOf lastIndexOf substring substr slice trim trimLeft trimRight \" +\r\n                     \"toUpperCase toLowerCase split concat match replace search\").split(\" \");\r\n  var arrayProps = (\"length concat join splice push pop shift unshift slice reverse sort indexOf \" +\r\n                    \"lastIndexOf every some filter forEach map reduce reduceRight \").split(\" \");\r\n  var funcProps = \"prototype apply call bind\".split(\" \");\r\n  var keywords = (\"break case catch continue debugger default delete do else false finally for function \" +\r\n                  \"if in instanceof new null return switch throw true try typeof var void while with\").split(\" \");\r\n\r\n  function getCompletions(token, context, editor) {\r\n    var found = [], start = token.string;\r\n    function maybeAdd(str) {\r\n      if (str && str != start && str.indexOf(start) == 0 && found.indexOf(str) === -1) found.push(str);\r\n    }\r\n    function gatherCompletions(obj) {\r\n      if (typeof obj == \"string\") forEach(stringProps, maybeAdd);\r\n      else if (obj instanceof Array) forEach(arrayProps, maybeAdd);\r\n      else if (obj instanceof Function) forEach(funcProps, maybeAdd);\r\n      for (var name in obj) maybeAdd(name);\r\n    }\r\n\r\n    if (context) {\r\n      // If this is a property, see if it belongs to some object we can\r\n      // find in the current environment.\r\n      var obj = context.pop(), base;\r\n      if (obj.className == \"js-variable\")\r\n        base = window[obj.string];\r\n      else if (obj.className == \"js-string\")\r\n        base = \"\";\r\n      else if (obj.className == \"js-atom\")\r\n        base = 1;\r\n      while (base != null && context.length)\r\n        base = base[context.pop().string];\r\n      if (base != null) gatherCompletions(base);\r\n    }\r\n    else {\r\n      // If not, just look in the window object and any local scope\r\n      // (reading into JS mode internals to get at the local variables)\r\n      for (var v = token.state.localVars; v; v = v.next) maybeAdd(v.name);\r\n      gatherCompletions(window);\r\n      forEach(keywords, maybeAdd);\r\n    }\r\n    \r\n    // also look up symbols in the current document\r\n    var code = editor.getValue().split(/\\W/);\r\n    forEach(code, maybeAdd);\r\n    \r\n    return found;\r\n  }\r\n\r\n  return coder.editors.autocomplete = {\r\n    startTagComplete\r\n  };\r\n});\ndefine('skylark-jsbin-coder/editors/keycontrol',[\r\n  \"skylark-jquery\",\r\n   \"../jsbin\",\r\n   \"../coder\",\r\n   \"./autocomplete\",\r\n   \"./panels\"\r\n],function ($,jsbin,coder,autocomplete,panels) {\r\n  /*globals objectValue, $, jsbin, $body, $document, saveChecksum, jsconsole*/\r\n  var keyboardHelpVisible = false;\r\n\r\n  var customKeys = objectValue('settings.keys', jsbin) || {};\r\n\r\n  function enableAltUse() {\r\n    if (!jsbin.settings.keys) {\r\n      jsbin.settings.keys = {};\r\n    }\r\n    jsbin.settings.keys.useAlt = this.checked;\r\n    settings.save();\r\n  }\r\n\r\n  $('input.enablealt').attr('checked', customKeys.useAlt ? true : false).change(enableAltUse);\r\n\r\n  if (!customKeys.disabled) {\r\n    $body.keydown(keycontrol);\r\n  } else {\r\n    $body.addClass('nokeyboardshortcuts');\r\n  }\r\n\r\n  var panelShortcuts = {};\r\n  panelShortcuts.start = 48;\r\n  //   49: 'javascript', // 1\r\n  //   50: 'css', // 2\r\n  //   51: 'html', // 3\r\n  //   52: 'console', // 4\r\n  //   53: 'live' // 5\r\n  // };\r\n\r\n  // work out the browser platform\r\n  var ua = navigator.userAgent;\r\n  if (ua.indexOf(' Mac ') !== -1) {\r\n    $.browser.platform = 'mac';\r\n  } else if (/windows|win32/.test(ua)) {\r\n    $.browser.platform = 'win';\r\n  } else if (/linux/.test(ua)) {\r\n    $.browser.platform = 'linux';\r\n  } else {\r\n    $.browser.platform = '';\r\n  }\r\n\r\n\r\n  if (!customKeys.disabled) {\r\n    $document.keydown(function (event) {\r\n      var includeAltKey = customKeys.useAlt ? event.altKey : !event.altKey,\r\n          closekey = customKeys.closePanel ? customKeys.closePanel : 48;\r\n\r\n      if (event.ctrlKey && $.browser.platform !== 'mac') { event.metaKey = true; }\r\n\r\n      // if (event.metaKey && event.which === 89 && !event.shiftKey) {\r\n      //   archive(!jsbin.state.metadata.archive);\r\n      //   return event.preventDefault();\r\n      // }\r\n\r\n      if (event.metaKey && event.which === 79) { // open\r\n        $('a.homebtn').trigger('click', 'keyboard');\r\n        event.preventDefault();\r\n      } else if (event.metaKey && event.shiftKey && event.which === 8) { // cmd+shift+backspace\r\n        $('a.deletebin:first').trigger('click', 'keyboard');\r\n        event.preventDefault();\r\n      } else if (!jsbin.embed && event.metaKey && event.which === 83) { // save\r\n        if (event.shiftKey === false) {\r\n          if (saveChecksum) {\r\n            saveChecksum = false;\r\n            $document.trigger('snapshot');\r\n          } else {\r\n            // trigger an initial save\r\n            $('a.save:first').click();\r\n          }\r\n          event.preventDefault();\r\n        } else if (event.shiftKey === true) { // shift+s = open share menu\r\n          var $sharemenu = $('#sharemenu');\r\n          if ($sharemenu.hasClass('open')) {\r\n\r\n          }\r\n          $('#sharemenu a').trigger('mousedown');\r\n          event.preventDefault();\r\n        }\r\n      } else if (event.which === closekey && event.metaKey && includeAltKey && jsbin.panels.focused) {\r\n        jsbin.panels.hide(jsbin.panels.focused.id);\r\n      } else if (event.which === 220 && (event.metaKey || event.ctrlKey)) {\r\n        jsbin.settings.hideheader = !jsbin.settings.hideheader;\r\n        $body[jsbin.settings.hideheader ? 'addClass' : 'removeClass']('hideheader');\r\n      } else if (event.which === 76 && event.ctrlKey && jsbin.panels.panels.console.visible) {\r\n        if (event.shiftKey) {\r\n          // reset\r\n          jsconsole.reset();\r\n        } else {\r\n          // clear\r\n          jsconsole.clear();\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  var ignoreNextKey = false;\r\n\r\n  function keycontrol(event) {\r\n    event = normalise(event);\r\n\r\n    var panel = {};\r\n\r\n    if (jsbin.panels.focused && jsbin.panels.focused.editor) {\r\n      panel = jsbin.panels.focused.editor;\r\n    } else if (jsbin.panels.focused) {\r\n      panel = jsbin.panels.focused;\r\n    }\r\n\r\n    var codePanel = { css: 1, javascript: 1, html: 1}[panel.id],\r\n        hasRun = false;\r\n\r\n    var includeAltKey = customKeys.useAlt ? event.altKey : !event.altKey;\r\n\r\n    // if (event.which === 27 && !ignoreNextKey) {\r\n    //   ignoreNextKey = true;\r\n    //   return;\r\n    // } else if (ignoreNextKey && panelShortcuts[event.which] !== undefined && event.metaKey && includeAltKey) {\r\n    //   ignoreNextKey = false;\r\n    //   return;\r\n    // } else if (!event.metaKey) {\r\n    //   ignoreNextKey = false;\r\n    // }\r\n\r\n    // these should fire when the key goes down\r\n    if (event.type === 'keydown') {\r\n      if (codePanel) {\r\n        if (event.metaKey && event.which === 13) {\r\n          if (panels.named.console.visible && !panels.named.live.visible) { // editors => panels.named\r\n            hasRun = true;\r\n            // panels.named.console.render(); // editors => panels.named\r\n            $('#runconsole').trigger('click', 'keyboard');\r\n          } else if (panels.named.live.visible) {\r\n            // panels.named.live.render(true); // editors => panels.named\r\n            $('#runwithalerts').trigger('click', 'keyboard');\r\n            hasRun = true;\r\n          } else {\r\n            $('#runwithalerts').trigger('click', 'keyboard');\r\n            hasRun = true;\r\n          }\r\n\r\n          if (hasRun) {\r\n            event.stop();\r\n          } else {\r\n            // if we have write access - do a save - this will make this bin our latest for use with\r\n            // /<user>/last/ - useful for phonegap inject\r\n            sendReload();\r\n          }\r\n        }\r\n      }\r\n\r\n      // shortcut for showing a panel\r\n      if (panelShortcuts[event.which] !== undefined && event.metaKey && includeAltKey) {\r\n        if (jsbin.panels.focused.id === panelShortcuts[event.which]) {\r\n          // this has been disabled in favour of:\r\n          // if the panel is visible, and the user tries cmd+n - then the browser\r\n          // gets the key command.\r\n          jsbin.panels.hide(panelShortcuts[event.which]);\r\n          event.stop();\r\n        } else {\r\n          // show\r\n          jsbin.panels.show(panelShortcuts[event.which]);\r\n          event.stop();\r\n\r\n          if (!customKeys.useAlt && (!jsbin.settings.keys || !jsbin.settings.keys.seenWarning)) {\r\n            var cmd = $.browser.platform === 'mac' ? 'cmd' : 'ctrl';\r\n            if (!jsbin.settings.keys) {\r\n              jsbin.settings.keys = {};\r\n            }\r\n            jsbin.settings.keys.seenWarning = true;\r\n            $document.trigger('tip', {\r\n              type: 'notification',\r\n              content: '<label><input type=\"checkbox\" class=\"enablealt\"> <strong>Turn this off</strong>. Reserve ' + cmd + '+[n] for switching browser tabs and use ' + cmd + '+<u>alt</u>+[n] to switch JS Bin panels. You can access this any time in <strong>Help&rarr;Keyboard</strong></label>'\r\n            });\r\n            $('#tip').delegate('input.enablealt', 'click', function () {\r\n              enableAltUse.call(this);\r\n              window.location.reload();\r\n            });\r\n          }\r\n        }\r\n      }\r\n\r\n      if (event.which === 191 && event.metaKey && event.shiftKey) {\r\n        // show help\r\n        opendropdown($('#help').prev()[0]);\r\n        event.stop();\r\n      } else if (event.which === 27 && keyboardHelpVisible) {\r\n        $body.removeClass('keyboardHelp');\r\n        keyboardHelpVisible = false;\r\n        event.stop();\r\n      } else if (event.which === 27 && jsbin.panels.focused && codePanel) {\r\n        // event.stop();\r\n        // return CodeMirror.commands.autocomplete(jsbin.panels.focused.editor);\r\n      } else if (event.which === 190 && includeAltKey && event.metaKey && panel.id === 'html') {\r\n        // auto close the element\r\n        if (panel.somethingSelected()) {return;}\r\n        // Find the token at the cursor\r\n        var cur = panel.getCursor(false), token = panel.getTokenAt(cur), tprop = token;\r\n        // If it's not a 'word-style' token, ignore the token.\r\n        if (!/^[\\w$_]*$/.test(token.string)) {\r\n          token = tprop = {start: cur.ch, end: cur.ch, string: '', state: token.state,\r\n                           className: token.string === '.' ? 'js-property' : null};\r\n        }\r\n\r\n        panel.replaceRange('</' + token.state.htmlState.context.tagName + '>', {line: cur.line, ch: token.end}, {line: cur.line, ch: token.end});\r\n        event.stop();\r\n      } else if (event.which === 188 && event.ctrlKey && event.shiftKey && codePanel) {\r\n        // start a new tag\r\n        event.stop();\r\n        return autocomplete.startTagComplete(panel);\r\n      }\r\n    }\r\n    // return true;\r\n\r\n    if (event.stopping) {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  function normalise(event) {\r\n    var myEvent = {\r\n      type: event.type,\r\n      which: event.which,\r\n      metaKey: event.metaKey,\r\n      shiftKey: event.shiftKey,\r\n      ctrlKey: event.ctrlKey,\r\n      altKey: event.altKey,\r\n      orig: event\r\n    };\r\n\r\n    if ( event.which === null && (event.charCode !== null || event.keyCode !== null) ) {\r\n      myEvent.which = event.charCode !== null ? event.charCode : event.keyCode;\r\n    }\r\n\r\n    // Add metaKey to non-Mac browsers (use ctrl for PC's and Meta for Macs)\r\n    if ( !event.metaKey && event.ctrlKey ) {\r\n      myEvent.metaKey = event.ctrlKey;\r\n    }\r\n\r\n    // this is retarded - I'm having to mess with the event just to get Firefox\r\n    // to send through the right value. i.e. when you include a shift key modifier\r\n    // in Firefox, if it's punctuation - event.which is zero :(\r\n    // Note that I'm only doing this for the ? symbol + ctrl + shift\r\n    if (event.which === 0 && event.ctrlKey === true && event.shiftKey === true && event.type === 'keydown') {\r\n      myEvent.which = 191;\r\n    }\r\n\r\n    var oldStop = event.stop;\r\n    myEvent.stop = function () {\r\n      myEvent.stopping = true;\r\n      if (oldStop) {oldStop.call(event);}\r\n    };\r\n\r\n    return myEvent;\r\n  }\r\n\r\n  return coder.editors.keycontrol = keycontrol;\r\n});\ndefine('skylark-jsbin-coder/editors/libraries',[\r\n  \"skylark-jquery\",\r\n  \"skylark-jsbin-base/storage\",\r\n   \"../jsbin\",\r\n   \"../coder\"\r\n],function ($,store,jsbin,coder) {\r\n  var libraries = [\r\n    {\r\n      'url': 'https://code.jquery.com/jquery-git.js',\r\n      'label': 'jQuery WIP (via git)',\r\n      'group': 'jQuery'\r\n    },\r\n    {\r\n      'url': 'https://code.jquery.com/jquery-3.1.0.js',\r\n      'label': 'jQuery 3.1.0',\r\n      'group': 'jQuery'\r\n    },\r\n    {\r\n      'url': 'https://code.jquery.com/jquery-3.0.0.js',\r\n      'label': 'jQuery 3.0.0',\r\n      'group': 'jQuery'\r\n    },\r\n    {\r\n      'url': 'https://code.jquery.com/jquery-2.2.4.js',\r\n      'label': 'jQuery 2.2.4',\r\n      'group': 'jQuery'\r\n    },\r\n    {\r\n      'url': 'https://code.jquery.com/jquery-2.1.4.js',\r\n      'label': 'jQuery 2.1.4',\r\n      'group': 'jQuery'\r\n    },\r\n    {\r\n      'url': 'https://code.jquery.com/jquery-2.0.3.js',\r\n      'label': 'jQuery 2.0.3',\r\n      'group': 'jQuery'\r\n    },\r\n    {\r\n      'url': 'https://code.jquery.com/jquery-1.12.4.js',\r\n      'label': 'jQuery 1.12.4',\r\n      'group': 'jQuery'\r\n    },\r\n    {\r\n      'url': 'https://code.jquery.com/jquery-1.11.3.js',\r\n      'label': 'jQuery 1.11.3',\r\n      'group': 'jQuery'\r\n    },\r\n    {\r\n      'url': 'https://code.jquery.com/jquery-1.10.2.js',\r\n      'label': 'jQuery 1.10.2',\r\n      'group': 'jQuery'\r\n    },\r\n    {\r\n      'url': 'https://code.jquery.com/jquery-1.9.1.js',\r\n      'label': 'jQuery 1.9.1',\r\n      'group': 'jQuery'\r\n    },\r\n    {\r\n      'url': 'https://code.jquery.com/jquery-1.8.3.js',\r\n      'label': 'jQuery 1.8.3',\r\n      'group': 'jQuery'\r\n    },\r\n    {\r\n      'url': 'https://code.jquery.com/jquery-1.7.2.js',\r\n      'label': 'jQuery 1.7.2',\r\n      'group': 'jQuery'\r\n    },\r\n    {\r\n      'url': 'https://code.jquery.com/jquery-1.6.4.js',\r\n      'label': 'jQuery 1.6.4',\r\n      'group': 'jQuery'\r\n    },\r\n    {\r\n      'url': [\r\n        'https://code.jquery.com/ui/jquery-ui-git.css',\r\n        'https://code.jquery.com/jquery-git.js',\r\n        'https://code.jquery.com/ui/jquery-ui-git.js'\r\n      ],\r\n      'label': 'jQuery UI WIP (via git)',\r\n      'group': 'jQuery UI'\r\n    },\r\n    {\r\n      'url': [\r\n        'https://code.jquery.com/ui/1.12.1/themes/smoothness/jquery-ui.css',\r\n        'https://code.jquery.com/jquery-3.1.0.js',\r\n        'https://code.jquery.com/ui/1.12.1/jquery-ui.js'\r\n      ],\r\n      'label': 'jQuery UI 1.12.1',\r\n      'group': 'jQuery UI'\r\n    },\r\n    {\r\n      'url': [\r\n        'https://code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css',\r\n        'https://code.jquery.com/jquery-1.12.4.js',\r\n        'https://code.jquery.com/ui/1.11.4/jquery-ui.js'\r\n      ],\r\n      'label': 'jQuery UI 1.11.4',\r\n      'group': 'jQuery UI'\r\n    },\r\n    {\r\n      'url': [\r\n        'https://code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.css',\r\n        'https://code.jquery.com/jquery-1.11.3.js',\r\n        'https://code.jquery.com/ui/1.10.4/jquery-ui.js'\r\n      ],\r\n      'label': 'jQuery UI 1.10.4',\r\n      'group': 'jQuery UI'\r\n    },\r\n    {\r\n      'url': [\r\n        'https://code.jquery.com/ui/1.9.2/themes/smoothness/jquery-ui.css',\r\n        'https://code.jquery.com/jquery-1.8.3.js',\r\n        'https://code.jquery.com/ui/1.9.2/jquery-ui.js'\r\n      ],\r\n      'label': 'jQuery UI 1.9.2',\r\n      'group': 'jQuery UI'\r\n    },\r\n    {\r\n      'url': [\r\n        'https://code.jquery.com/mobile/git/jquery.mobile-git.css',\r\n        'https://code.jquery.com/jquery-1.11.3.js',\r\n        'https://code.jquery.com/mobile/git/jquery.mobile-git.js'\r\n      ],\r\n      'label': 'jQuery Mobile WIP (via git)',\r\n      'group': 'jQuery Mobile'\r\n    },\r\n    {\r\n      'url': [\r\n        'https://code.jquery.com/mobile/1.4.2/jquery.mobile-1.4.2.css',\r\n        'https://code.jquery.com/jquery-1.11.3.js',\r\n        'https://code.jquery.com/mobile/1.4.2/jquery.mobile-1.4.2.js'\r\n      ],\r\n      'label': 'jQuery Mobile 1.4.2',\r\n      'group': 'jQuery Mobile'\r\n    },\r\n    {\r\n      'url': [\r\n        'https://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.css',\r\n        'https://code.jquery.com/jquery-1.9.1.js',\r\n        'https://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.js'\r\n      ],\r\n      'label': 'jQuery Mobile 1.3.2',\r\n      'group': 'jQuery Mobile'\r\n    },\r\n    {\r\n      'url': [\r\n        'https://code.jquery.com/mobile/1.2.1/jquery.mobile-1.2.1.css',\r\n        'https://code.jquery.com/jquery-1.8.3.js',\r\n        'https://code.jquery.com/mobile/1.2.1/jquery.mobile-1.2.1.js'\r\n      ],\r\n      'label': 'jQuery Mobile 1.2.1',\r\n      'group': 'jQuery Mobile'\r\n    },\r\n    {\r\n      'url': [\r\n        'https://code.jquery.com/mobile/1.1.2/jquery.mobile-1.1.2.css',\r\n        'https://code.jquery.com/jquery-1.6.4.js',\r\n        'https://code.jquery.com/mobile/1.1.2/jquery.mobile-1.1.2.js'\r\n      ],\r\n      'label': 'jQuery Mobile 1.1.2',\r\n      'group': 'jQuery Mobile'\r\n    },\r\n    {\r\n      'url': [\r\n        'https://code.jquery.com/jquery.min.js',\r\n        'https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css',\r\n        'https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js'\r\n      ],\r\n      'label': 'Bootstrap Latest',\r\n      'group': 'Bootstrap'\r\n    },\r\n    {\r\n      'url': [\r\n        'https://code.jquery.com/jquery.min.js',\r\n        'https://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css',\r\n        'https://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js'\r\n      ],\r\n      'label': 'Bootstrap 2.3.2',\r\n      'group': 'Bootstrap'\r\n    },\r\n    {\r\n      'url': 'https://ajax.googleapis.com/ajax/libs/prototype/1/prototype.js',\r\n      'label': 'Prototype latest',\r\n      'group': 'Prototype'\r\n    },\r\n    {\r\n      'url': 'https://ajax.googleapis.com/ajax/libs/prototype/1.7/prototype.js',\r\n      'label': 'Prototype 1.7.1',\r\n      'group': 'Prototype'\r\n    },\r\n    {\r\n      'url': 'https://ajax.googleapis.com/ajax/libs/prototype/1.6.1.0/prototype.js',\r\n      'label': 'Prototype 1.6.1.0',\r\n      'group': 'Prototype'\r\n    },\r\n    {\r\n      'url': [\r\n        'https://ajax.googleapis.com/ajax/libs/prototype/1/prototype.js',\r\n        'https://ajax.googleapis.com/ajax/libs/scriptaculous/1/scriptaculous.js'\r\n      ],\r\n      'label': 'script.aculo.us latest',\r\n      'group': 'Prototype'\r\n    },\r\n    {\r\n      'url': [\r\n        'https://ajax.googleapis.com/ajax/libs/prototype/1/prototype.js',\r\n        'https://ajax.googleapis.com/ajax/libs/scriptaculous/1.8.3/scriptaculous.js'\r\n      ],\r\n      'label': 'script.aculo.us 1.8.3',\r\n      'group': 'Prototype'\r\n    },\r\n    {\r\n      'url': 'http://yui.yahooapis.com/3.10.0/build/yui/yui.js',\r\n      'label': 'YUI 3.10.0',\r\n      'group': 'YUI'\r\n    },\r\n    {\r\n      'url': 'http://yui.yahooapis.com/2.9.0/build/yuiloader/yuiloader-min.js',\r\n      'label': 'YUI 2.9.0',\r\n      'group': 'YUI'\r\n    },\r\n    {\r\n      'url': 'https://ajax.googleapis.com/ajax/libs/mootools/1.5.0/mootools-yui-compressed.js',\r\n      'label': 'MooTools 1.5.0',\r\n      'group': 'MooTools'\r\n    },\r\n    {\r\n      'url': 'https://ajax.googleapis.com/ajax/libs/mootools/1.5.0/mootools-nocompat-yui-compressed.js',\r\n      'label': 'MooTools 1.5.0 (without 1.2+ compatibility layer)',\r\n      'group': 'MooTools'\r\n    },\r\n    {\r\n      'url': 'https://ajax.googleapis.com/ajax/libs/mootools/1.4.5/mootools-yui-compressed.js',\r\n      'label': 'MooTools 1.4.5',\r\n      'group': 'MooTools'\r\n    },\r\n    {\r\n      'url': 'https://ajax.googleapis.com/ajax/libs/dojo/1/dojo/dojo.js',\r\n      'label': 'Dojo latest',\r\n      'group': 'Dojo'\r\n    },\r\n    {\r\n      'url': 'https://ajax.googleapis.com/ajax/libs/dojo/1.8/dojo/dojo.js',\r\n      'label': 'Dojo 1.8.4',\r\n      'group': 'Dojo'\r\n    },\r\n    {\r\n      'url': 'https://ajax.googleapis.com/ajax/libs/dojo/1.7/dojo/dojo.js',\r\n      'label': 'Dojo 1.7.4',\r\n      'group': 'Dojo'\r\n    },\r\n    {\r\n      'url': [\r\n        'https://ajax.googleapis.com/ajax/libs/dojo/1/dijit/themes/claro/claro.css',\r\n        'https://ajax.googleapis.com/ajax/libs/dojo/1/dojo/dojo.js'\r\n      ],\r\n      'label': 'Dijit latest (Claro)',\r\n      'group': 'Dojo'\r\n    },\r\n    {\r\n      'url': [\r\n        'https://ajax.googleapis.com/ajax/libs/dojo/1.8.4/dijit/themes/claro/claro.css',\r\n        'https://ajax.googleapis.com/ajax/libs/dojo/1.8.4/dojo/dojo.js'\r\n      ],\r\n      'label': 'Dijit 1.8.4 (Claro)',\r\n      'group': 'Dojo'\r\n    },\r\n    {\r\n      'url': [\r\n        'https://ajax.googleapis.com/ajax/libs/dojo/1.7.4/dijit/themes/claro/claro.css',\r\n        'https://ajax.googleapis.com/ajax/libs/dojo/1.7.4/dojo/dojo.xd.js'\r\n      ],\r\n      'label': 'Dijit 1.7.4 (Claro)',\r\n      'group': 'Dojo'\r\n    },\r\n    {\r\n      'url': [\r\n        'https://da7xgjtj801h2.cloudfront.net/2015.2.624/styles/kendo.common.min.css',\r\n        'https://da7xgjtj801h2.cloudfront.net/2015.2.624/styles/kendo.silver.min.css',\r\n        'https://code.jquery.com/jquery-2.1.4.min.js',\r\n        'https://da7xgjtj801h2.cloudfront.net/2015.2.624/js/kendo.ui.core.min.js'\r\n      ],\r\n      'label': 'Kendo UI Core 2015.2.624',\r\n      'group': 'Kendo UI'\r\n    },\r\n    {\r\n      'url': [\r\n        'https://da7xgjtj801h2.cloudfront.net/2014.3.1411/styles/kendo.common.min.css',\r\n        'https://da7xgjtj801h2.cloudfront.net/2014.3.1411/styles/kendo.default.min.css',\r\n        'https://code.jquery.com/jquery-1.9.1.min.js',\r\n        'https://da7xgjtj801h2.cloudfront.net/2014.3.1411/js/kendo.ui.core.min.js'\r\n      ],\r\n      'label': 'Kendo UI Core 2014.3.1411',\r\n      'group': 'Kendo UI'\r\n    },\r\n    {\r\n      'url' : [\r\n        'https://code.jquery.com/qunit/qunit-git.css',\r\n        'https://code.jquery.com/qunit/qunit-git.js'\r\n      ],\r\n      'label': 'QUnit',\r\n      'group': 'Testing'\r\n    },\r\n    {\r\n      'url' : [\r\n      'https://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.14/require.js',\r\n    ],\r\n      'label': 'RequireJS',\r\n      'group': 'AMD'\r\n    },\r\n    {\r\n      'url': 'http://zeptojs.com/zepto.min.js',\r\n      'label': 'Zepto latest',\r\n      'group': 'Zepto'\r\n    },\r\n    {\r\n      'url': 'https://cdnjs.cloudflare.com/ajax/libs/zepto/1.0/zepto.min.js',\r\n      'label': 'Zepto 1.0',\r\n      'group': 'Zepto'\r\n    },\r\n    {\r\n      'url':'https://ajax.googleapis.com/ajax/libs/angularjs/1.4.0/angular.min.js',\r\n      'label': 'Angular 1.4.0 Stable',\r\n      'group': 'Angular'\r\n    },\r\n    {\r\n      'url': 'https://ajax.googleapis.com/ajax/libs/angularjs/1.4.0/angular.js',\r\n      'label': 'Angular 1.4.0 Stable Uncompressed',\r\n      'group': 'Angular'\r\n    },\r\n    {\r\n      'url':'https://ajax.googleapis.com/ajax/libs/angularjs/1.3.15/angular.min.js',\r\n      'label': 'Angular 1.3.15 Stable',\r\n      'group': 'Angular'\r\n    },\r\n    {\r\n      'url': 'https://ajax.googleapis.com/ajax/libs/angularjs/1.3.15/angular.js',\r\n      'label': 'Angular 1.3.15 Stable Uncompressed',\r\n      'group': 'Angular'\r\n    },\r\n    {\r\n      'url': 'https://ajax.googleapis.com/ajax/libs/angularjs/1.2.26/angular.min.js',\r\n      'label': 'Angular 1.2.26 Legacy',\r\n      'group': 'Angular'\r\n    },\r\n    {\r\n      'url':'https://rawgit.com/angular/bower-angular/master/angular.min.js',\r\n      'label': 'Angular Latest',\r\n      'group': 'Angular'\r\n    },\r\n    {\r\n      'url': 'https://rawgit.com/angular/bower-angular/master/angular.js',\r\n      'label': 'Angular Latest Uncompressed',\r\n      'group': 'Angular'\r\n    },\r\n    {\r\n      'url': 'https://rawgit.com/angular/bower-angular-animate/master/angular-animate.min.js',\r\n      'label': 'Angular Animate Latest',\r\n      'group': 'Angular'\r\n    },\r\n    {\r\n      'url': 'https://rawgit.com/angular/bower-angular-aria/master/angular-aria.min.js',\r\n      'label': 'Angular Aria Latest',\r\n      'group': 'Angular'\r\n    },\r\n    {\r\n      'url': 'https://rawgit.com/angular/bower-angular-messages/master/angular-messages.min.js',\r\n      'label': 'Angular Messages Latest',\r\n      'group': 'Angular'\r\n    },\r\n    {\r\n      'url': 'https://rawgit.com/angular/bower-angular-resource/master/angular-resource.min.js',\r\n      'label': 'Angular Resource Latest',\r\n      'group': 'Angular'\r\n    },\r\n    {\r\n      'url': 'https://rawgit.com/angular/bower-angular-route/master/angular-route.min.js',\r\n      'label': 'Angular Route Latest',\r\n      'group': 'Angular'\r\n    },\r\n    {\r\n      'url': 'https://rawgit.com/angular/bower-angular-sanitize/master/angular-sanitize.min.js',\r\n      'label': 'Angular Sanitize Latest',\r\n      'group': 'Angular'\r\n    },\r\n    {\r\n      'url': ['https://fb.me/react-15.1.0.js', 'https://fb.me/react-dom-15.1.0.js'],\r\n      'label': 'React + React DOM 15.1.0',\r\n      'group': 'React'\r\n    },\r\n    {\r\n      'url': ['https://fb.me/react-with-addons-15.1.0.js', 'https://fb.me/react-dom-15.1.0.js'],\r\n      'label': 'React with Add-Ons + React DOM 15.1.0',\r\n      'group': 'React'\r\n    },\r\n    {\r\n      'url': ['https://fb.me/react-0.14.7.js', 'https://fb.me/react-dom-0.14.7.js'],\r\n      'label': 'React + React DOM 0.14.7',\r\n      'group': 'React'\r\n    },\r\n    {\r\n      'url': ['https://fb.me/react-with-addons-0.14.7.js', 'https://fb.me/react-dom-0.14.7.js'],\r\n      'label': 'React with Add-Ons + React DOM 0.14.7',\r\n      'group': 'React'\r\n    },\r\n    {\r\n      'url': 'https://fb.me/react-0.13.3.js',\r\n      'label': 'React 0.13.3',\r\n      'group': 'React'\r\n    },\r\n    {\r\n      'url': 'https://fb.me/react-with-addons-0.13.3.js',\r\n      'label': 'React with Add-Ons 0.13.3',\r\n      'group': 'React'\r\n    },\r\n    {\r\n      'url': 'https://cdn.rawgit.com/zloirock/core-js/master/client/shim.min.js',\r\n      'label': 'core-js',\r\n      'group': 'shims'\r\n    },\r\n    {\r\n      'url': 'https://cdnjs.cloudflare.com/ajax/libs/es5-shim/2.0.8/es5-shim.min.js',\r\n      'label': 'ES5 shim 2.0.8',\r\n      'group': 'shims'\r\n    },\r\n    {\r\n      'url': 'https://cdnjs.cloudflare.com/ajax/libs/blissfuljs/1.0.2/bliss.min.js',\r\n      'label': 'Bliss 1.0.2',\r\n    },\r\n    {\r\n      'url': 'https://cdnjs.cloudflare.com/ajax/libs/vue/1.0.16/vue.js',\r\n      'label': 'Vue.js 1.0.16',\r\n    },\r\n    {\r\n      'url': 'https://cdnjs.cloudflare.com/ajax/libs/vue/2.0.3/vue.js',\r\n      'label': 'Vue.js 2.0.3',\r\n    },\r\n    {\r\n      'url': 'http://cdn.ractivejs.org/latest/ractive.js',\r\n      'label': 'Ractive.js'\r\n    },\r\n    {\r\n      'url': [\r\n        'http://nightly.enyojs.com/latest/enyo-nightly/enyo.css',\r\n        'http://nightly.enyojs.com/latest/enyo-nightly/enyo.js',\r\n        'http://nightly.enyojs.com/latest/lib/layout/package.js',\r\n        'http://nightly.enyojs.com/latest/lib/onyx/package.js',\r\n        'http://nightly.enyojs.com/latest/lib/g11n/package.js',\r\n        'http://nightly.enyojs.com/latest/lib/canvas/package.js'\r\n      ],\r\n      'label': 'Enyo latest',\r\n      'group': 'Enyo'\r\n    },\r\n    {\r\n      'url': [\r\n        'http://enyojs.com/enyo-2.2.0/enyo.css',\r\n        'http://enyojs.com/enyo-2.2.0/enyo.js',\r\n        'http://enyojs.com/enyo-2.2.0/lib/layout/package.js',\r\n        'http://enyojs.com/enyo-2.2.0/lib/onyx/package.js',\r\n        'http://enyojs.com/enyo-2.2.0/lib/g11n/package.js',\r\n        'http://enyojs.com/enyo-2.2.0/lib/canvas/package.js'\r\n      ],\r\n      'label': 'Enyo 2.2.0',\r\n      'group': 'Enyo'\r\n    },\r\n    {\r\n      'url': 'https://cdnjs.cloudflare.com/ajax/libs/bluebird/1.2.2/bluebird.js',\r\n      'label': 'Bluebird 1.2.2',\r\n      'group': 'Promises'\r\n    },\r\n    {\r\n      'url': 'https://www.promisejs.org/polyfills/promise-4.0.0.js',\r\n      'label': 'Promise 4.0.0',\r\n      'group': 'Promises'\r\n    },\r\n    {\r\n      'url': 'https://cdnjs.cloudflare.com/ajax/libs/q.js/1.0.1/q.js',\r\n      'label': 'Q 1.0.1',\r\n      'group': 'Promises'\r\n    },\r\n    {\r\n      'url': [\r\n        'https://rawgithub.com/ai/autoprefixer-rails/master/vendor/autoprefixer.js'\r\n      ],\r\n      'label': 'Autoprefixer',\r\n      'snippet': '<style type=\"unprocessed\" id=\"AutoprefixerIn\">%css%</style>\\n<style id=\"AutoprefixerOut\"></style>\\n<script>\\nAutoprefixerSettings = \"\"; //Specify here the browsers you want to target or leave empty\\ndocument.getElementById(\"AutoprefixerOut\").innerHTML = autoprefixer(AutoprefixerSettings || null).process(document.getElementById(\"AutoprefixerIn\").innerHTML).css;\\n</script>'\r\n    },\r\n    {\r\n      'url': [\r\n        'https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js',\r\n        'https://cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.2/backbone-min.js'\r\n      ],\r\n      'label': 'Backbone 1.1.2'\r\n    },\r\n    {\r\n      'url': [\r\n        'https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js',\r\n        'https://cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.2/backbone-min.js',\r\n        'http://marionettejs.com/downloads/backbone.marionette.min.js'\r\n      ],\r\n      'label': 'MarionetteJS latest'\r\n    },\r\n    {\r\n      'url': 'https://cdnjs.cloudflare.com/ajax/libs/bonsai/0.4/bonsai.min.js',\r\n      'label': 'Bonsai 0.4.latest'\r\n    },\r\n    {\r\n      'url': 'https://cdnjs.cloudflare.com/ajax/libs/coffee-script/1.9.2/coffee-script.min.js',\r\n      'label': 'CoffeeScript'\r\n    },\r\n    {\r\n      'url': [\r\n        'https://code.jquery.com/jquery-1.11.1.min.js',\r\n        '//builds.emberjs.com/tags/v1.13.5/ember-template-compiler.js',\r\n        '//builds.emberjs.com/tags/v1.13.5/ember.debug.js'\r\n      ],\r\n      'label': 'Ember.js 1.13.5',\r\n      'group': 'Ember'\r\n    },\r\n    {\r\n      'url': '//builds.emberjs.com/tags/v1.13.6/ember-data.js',\r\n      'label': 'Ember Data 1.13.6',\r\n      'group': 'Ember'\r\n    },\r\n    {\r\n      'url': 'https://cdnjs.cloudflare.com/ajax/libs/normalize/3.0.2/normalize.min.css',\r\n      'label': 'Normalize.css 3.0.2'\r\n    },\r\n    {\r\n      'url': [\r\n        '//extjs.cachefly.net/ext-3.1.0/resources/css/ext-all.css',\r\n        'https://cdnjs.cloudflare.com/ajax/libs/ext-core/3.1.0/ext-core.min.js'\r\n      ],\r\n      'label': 'ext-core 3.1.0'\r\n    },\r\n    {\r\n      'url': [\r\n        'https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.2/css/normalize.min.css',\r\n        'https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.2/css/foundation.min.css',\r\n        'https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.2/js/vendor/modernizr.js',\r\n        'https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.2/js/vendor/jquery.js',\r\n        'https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.2/js/foundation.min.js'\r\n      ],\r\n      'label': 'Foundation 5.5.2'\r\n    },\r\n    {\r\n      'url': 'https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/1.0.0/handlebars.js',\r\n      'label': 'Handlebars.js 1.0.0'\r\n    },\r\n    {\r\n      'url': 'https://cdnjs.cloudflare.com/ajax/libs/knockout/3.3.0/knockout-min.js',\r\n      'label': 'Knockout 3.3.0'\r\n    },\r\n    {\r\n      'url': 'https://cdnjs.cloudflare.com/ajax/libs/less.js/1.3.3/less.min.js',\r\n      'label': 'Less 1.3.3'\r\n    },\r\n    {\r\n      'url': 'https://cdn.jsdelivr.net/lodash/4/lodash.min.js',\r\n      'label': 'lodash 4.x',\r\n      'group': 'Lodash'\r\n    },\r\n    {\r\n      'url': 'https://cdn.jsdelivr.net/g/lodash@4(lodash.min.js+lodash.fp.min.js)',\r\n      'label': 'lodash fp 4.x',\r\n      'group': 'Lodash'\r\n    },\r\n    {\r\n      'url': 'https://cdn.jsdelivr.net/lodash/3/lodash.min.js',\r\n      'label': 'lodash 3.x',\r\n      'group': 'Lodash'\r\n    },\r\n    {\r\n      'url': 'http://modernizr.com/downloads/modernizr-latest.js',\r\n      'label': 'Modernizr Development latest'\r\n    },\r\n    {\r\n      'url': [\r\n        'https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js',\r\n        'https://cdnjs.cloudflare.com/ajax/libs/detectizr/1.5.0/detectizr.min.js'\r\n      ],\r\n      'label': 'Detectizr 1.5.0'\r\n    },\r\n    {\r\n      'url': 'https://cdnjs.cloudflare.com/ajax/libs/prefixfree/1.0.7/prefixfree.min.js',\r\n      'label': 'Prefixfree 1.0.7'\r\n    },\r\n    {\r\n      'url': 'https://cdnjs.cloudflare.com/ajax/libs/processing.js/1.4.1/processing-api.min.js',\r\n      'label': 'Processing 1.4.1'\r\n    },\r\n    {\r\n      'url': 'https://cdnjs.cloudflare.com/ajax/libs/d3/4.2.3/d3.min.js',\r\n      'label': 'D3 4.2.3',\r\n      'group': 'D3'\r\n    },\r\n    {\r\n      'url': 'https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js',\r\n      'label': 'D3 3.5.6',\r\n      'group': 'D3'\r\n    },\r\n    {\r\n      'url': '//code.highcharts.com/highcharts.js',\r\n      'label': 'Highcharts latest'\r\n    },\r\n    {\r\n      'url': 'https://cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js',\r\n      'label': 'Rapha&euml;l 2.1.0'\r\n    },\r\n    {\r\n      'url': [\r\n        '//cdn.jsdelivr.net/chartist.js/latest/chartist.min.js',\r\n        '//cdn.jsdelivr.net/chartist.js/latest/chartist.min.css'\r\n      ],\r\n      'label': 'Chartist.js latest'\r\n    },\r\n    {\r\n      'url': 'https://cdnjs.cloudflare.com/ajax/libs/sammy.js/0.7.4/sammy.min.js',\r\n      'label': 'Sammy 0.7.4'\r\n    },\r\n    {\r\n      'url': [\r\n        'http://cdn.sencha.io/touch/1.1.0/resources/css/sencha-touch.css',\r\n        'http://cdn.sencha.io/touch/1.1.0/sencha-touch.js'\r\n      ],\r\n      'label': 'Sencha Touch'\r\n    },\r\n    {\r\n      'url': [\r\n        jsbin.static + '/js/vendor/traceur.js'\r\n      ],\r\n      'label': 'Traceur'\r\n    },\r\n    {\r\n      'url': '//remy.github.io/twitterlib/twitterlib.min.js',\r\n      'label': 'TwitterLib'\r\n    },\r\n    {\r\n      'url': '//jashkenas.github.io/underscore/underscore-min.js',\r\n      'label': 'underscore'\r\n    },\r\n    {\r\n      'url':[\r\n        'https://code.jquery.com/jquery.min.js',\r\n        '//canjs.com/release/2.0.3/can.jquery.min.js'\r\n      ],\r\n      'label': 'CanJS 2.0.3'\r\n    },\r\n    {\r\n      'url':[\r\n        'https://cdnjs.cloudflare.com/ajax/libs/three.js/r82/three.min.js'\r\n      ],\r\n      'label': 'Three.js r82'\r\n    },\r\n    {\r\n      'url':[\r\n        'https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.6.2/html5shiv.js'\r\n      ],\r\n      'label': 'HTML5 shiv'\r\n    },\r\n    {\r\n      'url': [\r\n        'https://cdnjs.cloudflare.com/ajax/libs/polymer/0.3.3/platform.js',\r\n        'https://cdnjs.cloudflare.com/ajax/libs/polymer/0.3.3/polymer.js'\r\n      ],\r\n      'label': 'Polymer 0.3.3'\r\n    },\r\n    {\r\n      'url':[\r\n        'https://code.getmdl.io/1.2.1/material.indigo-pink.min.css',\r\n        'https://code.getmdl.io/1.2.1/material.min.js',\r\n        'https://fonts.googleapis.com/icon?family=Material+Icons'\r\n        ],\r\n      'label': 'Material Design Lite 1.2.1'\r\n    },\r\n    {\r\n      'url': '//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css',\r\n      'label': 'Font Awesome 4.0.3'\r\n    },\r\n    {\r\n      'url': 'https://cdnjs.cloudflare.com/ajax/libs/paper.js/0.9.12/paper.js',\r\n      'label': 'Paper.js 0.9.12'\r\n    },\r\n    {\r\n      'url': {\r\n        'url': 'https://openui5.hana.ondemand.com/resources/sap-ui-core.js',\r\n        'id': 'sap-ui-bootstrap',\r\n        'data-sap-ui-theme': 'sap_belize',\r\n        'data-sap-ui-libs': 'sap.m'\r\n      },\r\n      'label': 'OpenUI5 CDN (belize Theme, mobile library)'\r\n    },\r\n    {\r\n      'url': 'https://cdnjs.cloudflare.com/ajax/libs/gsap/1.11.7/TweenMax.min.js',\r\n      'label': 'GSAP 1.11.7'\r\n    },\r\n    {\r\n      'url': 'https://cdnjs.cloudflare.com/ajax/libs/phaser/2.0.5/phaser.min.js',\r\n      'label': 'Phaser 2.0.5'\r\n    },\r\n    {\r\n      'url': [\r\n        '//vjs.zencdn.net/5.11/video-js.css',\r\n        '//vjs.zencdn.net/5.11/video.js'\r\n      ],\r\n      'label': 'Video.js 5.11.x'\r\n    },\r\n    {\r\n      'url': [\r\n        'https://aui-cdn.atlassian.com/aui-adg/5.7.0/js/aui.js',\r\n        'https://aui-cdn.atlassian.com/aui-adg/5.7.0/css/aui.css',\r\n        'https://aui-cdn.atlassian.com/aui-adg/5.7.0/js/aui-experimental.js',\r\n        'https://aui-cdn.atlassian.com/aui-adg/5.7.0/css/aui-experimental.css'\r\n      ],\r\n      'label': 'AUI (Atlassian UI) 5.7.0'\r\n    },\r\n    {\r\n      'url': 'https://cdn.firebase.com/js/client/2.0.2/firebase.js',\r\n      'label': 'Firebase 2.0.2'\r\n    },\r\n    {\r\n      'url': [\r\n        'https://code.ionicframework.com/1.0.0-beta.13/js/ionic.bundle.min.js',\r\n        'https://code.ionicframework.com/1.0.0-beta.13/css/ionic.min.css'\r\n      ],\r\n      'label': 'Ionic 1.0.0-beta-13'\r\n    },\r\n    {\r\n      'url': '//static.opentok.com/v2/js/opentok.min.js',\r\n      'label': 'OpenTok v2.x (latest)'\r\n    },\r\n    {\r\n      'url': 'https://cdn.jsdelivr.net/riot/2.6/riot+compiler.min.js',\r\n      'label': 'Riot + Compiler (latest 2.6.x)'\r\n    },\r\n    {\r\n      'url': [\r\n        'https://unpkg.com/blaze/dist/blaze.min.css',\r\n        'https://unpkg.com/blaze/dist/blaze.colors.min.css'\r\n      ],\r\n      'label': 'Blaze CSS (latest)'\r\n    },\r\n    {\r\n      'url': 'https://unpkg.com/@reactivex/rxjs@5.0.3/dist/global/Rx.js',\r\n      'label': 'RxJS 5.0.3',\r\n      'group': 'RxJS'\r\n    },\r\n    {\r\n      'url': 'https://cdnjs.cloudflare.com/ajax/libs/rxjs/4.0.6/rx.all.js',\r\n      'label': 'rx.all 4.0.6',\r\n      'group': 'RxJS'\r\n    },\r\n    {\r\n      'url': 'https://cdnjs.cloudflare.com/ajax/libs/rxjs/4.0.6/rx.all.compat.js',\r\n      'label': 'rx.all.compat 4.0.6',\r\n      'group': 'RxJS'\r\n    },\r\n    {\r\n      'url': 'https://cdnjs.cloudflare.com/ajax/libs/rxjs/4.0.6/rx.testing.js',\r\n      'label': 'rx.testing 4.0.6',\r\n      'group': 'RxJS'\r\n    },\r\n    {\r\n      'url': 'https://unpkg.com/rx-dom@7.0.3/dist/rx.dom.js',\r\n      'label': 'rx.dom 7.0.3 (requires 4.x)',\r\n      'group': 'RxJS'\r\n    },\r\n    {\r\n      'url': 'http://cdn.popcornjs.org/code/dist/popcorn.min.js',\r\n      'label': 'Popcorn.js 1.5.6 (Core)',\r\n      'group': 'Popcorn.js'\r\n    },\r\n    {\r\n      'url': 'http://cdn.popcornjs.org/code/dist/popcorn-complete.min.js',\r\n      'label': 'Popcorn.js 1.5.6 (Core + Extensions)',\r\n      'group': 'Popcorn.js'\r\n    },\r\n    {\r\n      'url': 'https://cdnjs.cloudflare.com/ajax/libs/immutable/3.7.3/immutable.min.js',\r\n      'label': 'Immutable 3.7.3',\r\n      'group': 'Data structures'\r\n    },\r\n    {\r\n      'url': 'https://cdnjs.cloudflare.com/ajax/libs/mori/0.3.2/mori.js',\r\n      'label': 'mori 0.3.2',\r\n      'group': 'Data structures'\r\n    },\r\n    {\r\n      'url': 'https://cdnjs.cloudflare.com/ajax/libs/ramda/0.22.1/ramda.min.js',\r\n      'label': 'Ramda 0.22.1'\r\n    },\r\n    {\r\n      'url': [\r\n        'https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.2/semantic.min.css',\r\n        'https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.2/semantic.min.js'\r\n      ],\r\n      'label': 'Semantic UI 2.2.2'\r\n    },\r\n    {\r\n      'url': 'https://cdn.jsdelivr.net/pouchdb/latest/pouchdb.min.js',\r\n      'label': 'PouchDB (latest)',\r\n      'group': 'PouchDB'\r\n    },\r\n    {\r\n      'url': 'https://cdn.jsdelivr.net/momentjs/2.14.1/moment-with-locales.min.js',\r\n      'label': 'Moment 2.14.1',\r\n      'group': 'Moment.js'\r\n    },\r\n    {\r\n      'url': [\r\n        'https://cdn.jsdelivr.net/momentjs/2.14.1/moment-with-locales.min.js',\r\n        'https://cdn.jsdelivr.net/momentjs/2.14.1/locales.min.js'\r\n      ],\r\n      'label': 'Moment 2.14.1 (with locales)',\r\n      'group': 'Moment.js'\r\n    },\r\n    {\r\n      'url': '//cdn.jsdelivr.net/velocity/1.2.3/velocity.min.js',\r\n      'label': 'Velocity JS 1.2.3',\r\n      'group': 'Velocity'\r\n    },\r\n    {\r\n      'url': '//cdn.jsdelivr.net/velocity/1.2.3/velocity.ui.min.js',\r\n      'label': 'Velocity UI Pack 1.2.3',\r\n      'group': 'Velocity'\r\n    }\r\n  ];\r\n\r\n  window.libraries = libraries; // expose a command line API\r\n\r\n  libraries.userSpecified = JSON.parse(store.localStorage.getItem('libraries') || '[]');\r\n  for (var i = 0; i < libraries.userSpecified.length; i++) {\r\n    libraries.push(libraries.userSpecified[i]);\r\n  }\r\n\r\n  libraries.add = function (lib) {\r\n    // Extract each script from a list (as documented) or use the default way\r\n    if (lib.scripts) {\r\n      lib.scripts.forEach(function (script) {\r\n        script.group = lib.text;\r\n        script.label = script.text;\r\n        libraries.userSpecified.push(script);\r\n        libraries.push(script);\r\n      });\r\n    } else {\r\n      // Adding a lib according to the above schema\r\n      lib.group = 'Custom';\r\n      libraries.userSpecified.push(lib);\r\n      libraries.push(lib);\r\n    }\r\n    try {\r\n      store.localStorage.setItem('libraries', JSON.stringify(this.userSpecified));\r\n    } catch (e) {} // just in case of DOM_22 error, makes me so sad to use this :(\r\n    $('#library').trigger('init');\r\n  };\r\n\r\n  libraries.clear = function () {\r\n    libraries.userSpecified = [];\r\n    store.localStorage.removeItem('libraries');\r\n    var length = libraries.length;\r\n    for (var i = 0; i < length; i++) {\r\n      if (libraries[i].group === 'Custom') {\r\n        libraries.splice(i, 1);\r\n        length--;\r\n      }\r\n    }\r\n    // force a refresh?\r\n    $('#library').trigger('init');\r\n  };\r\n\r\n  return coder.editors.libraries = libraries;\r\n});\ndefine('skylark-jsbin-coder/editors/library',[\r\n  \"skylark-jquery\",\r\n   \"../jsbin\",\r\n   \"../coder\",\r\n   \"./panels\"\r\n],function ($,jsbin,coder,panels) {\r\n  /*global $:true, editors:true, libraries:true, analytics:true */\r\n  // 'use strict'; // this causes bigger issues :-\\\r\n\r\n  var $library = $('#library, #alt-library'),\r\n      groups = {};\r\n\r\n  $library.bind('init', function () {\r\n    var i = 0,\r\n      j = 0,\r\n      k = 0,\r\n      library = {},\r\n      groupOrder = [],\r\n      group = {},\r\n      groupLabel = '',\r\n      lcGroup = '';\r\n\r\n    // reset\r\n    groups = {};\r\n    $library.empty();\r\n\r\n    for (i = 0; i < libraries.length; i++) {\r\n      library = libraries[i];\r\n      groupLabel = library.group || 'Other';\r\n      lcGroup = groupLabel.toLowerCase().replace(/[^a-z0-9]/ig, '');\r\n      if (groupOrder.indexOf(lcGroup) === -1) {\r\n        group = { label: groupLabel, libraries: [], key: lcGroup };\r\n        groups[lcGroup] = group;\r\n        groupOrder.push(lcGroup);\r\n      } else {\r\n        group = groups[lcGroup];\r\n      }\r\n\r\n      group.libraries.push(library);\r\n    }\r\n\r\n    var html = ['<option value=\"none\">None</option>'];\r\n\r\n    for (i = 0; i < groupOrder.length; i++) {\r\n      group = groups[groupOrder[i]];\r\n      html.push('<option value=\"\" data-group=\"' + group.label + '\" class=\"heading\">-------------</option>');\r\n\r\n      for (j = 0; j < group.libraries.length; j++) {\r\n        library = group.libraries[j];\r\n        html.push('<option value=\"' + group.key + ':' + j + '\">' + library.label + '</option>');\r\n      }\r\n    }\r\n\r\n    $library.html( html.join('') );\r\n  }).trigger('init');\r\n\r\n\r\n  $library.bind('change', function () {\r\n    if (!this.value) { return; }\r\n\r\n    var selected = this.value.split(':'),\r\n        group = groups[selected[0]],\r\n        library = group.libraries[selected[1]];\r\n\r\n    analytics.library('select', group.libraries[selected[1]].label);\r\n    insertResources(library.url);\r\n    if (library.snippet) {\r\n      insertSnippet(library.snippet);\r\n    }\r\n  }).on('click', function () {\r\n    analytics.library('open');\r\n  });\r\n\r\n  function insertResources(urls) {\r\n    if (!$.isArray(urls)) {\r\n      urls = [urls];\r\n    }\r\n\r\n    var i = 0,\r\n        length = urls.length,\r\n        url = '',\r\n        code = panels.named.html.getCode(), // editors => panels.named\r\n        state = { line: panels.named.html.editor.currentLine(), // editors => panels.named\r\n          character: panels.named.html.editor.getCursor().ch, // editors => panels.named\r\n          add: 0\r\n        },\r\n        html = [],\r\n        file = '',\r\n        resource,\r\n        attrList,\r\n        attrs,\r\n        scriptDefaultAttrs = {},\r\n        cssDefaultAttrs = { 'rel': 'stylesheet', 'type': 'text/css' };\r\n\r\n    for (i = 0; i < length; i++) {\r\n      url = urls[i];\r\n\r\n      // URLs can be objects carrying desired attributes\r\n      // The main resource (src, href) property is always 'url'\r\n      if ($.isPlainObject(url)) {\r\n        attrs = url;\r\n        url = url.url;\r\n        delete attrs.url;\r\n      } else {\r\n        attrs = {};\r\n      }\r\n\r\n      file = url.split('/').pop();\r\n\r\n      // Introduce any default attrs and flatten into a list for insertion\r\n      attrs = $.extend({}, (isCssFile(file) ? cssDefaultAttrs : scriptDefaultAttrs), attrs);\r\n      attrList = '';\r\n      for (var attr in attrs) {\r\n        attrList += ' ' + attr + '=\"' + attrs[attr] + '\"';\r\n      }\r\n\r\n      if (file && code.indexOf(file + '\"')) {\r\n        // attempt to lift out similar scripts\r\n        if (isCssFile(file)) {\r\n          code = code.replace(new RegExp('<link.*href=\".*?/' + file + '\".*?/>\\n?'), '');\r\n        } else {\r\n          code = code.replace(new RegExp('<script.*src=\".*?/' + file + '\".*?><' + '/script>\\n?'), '');\r\n        }\r\n        state.add--;\r\n      }\r\n\r\n      if (isCssFile(url)) {\r\n        resource = '<' + 'link href=\"' + url + '\"' + attrList  + ' />';\r\n      } else {\r\n        resource = '<' + 'script src=\"' + url + '\"' + attrList + '><' + '/script>';\r\n      }\r\n\r\n      if (isJadeActive()) {\r\n        resource = isCssFile(url) ? htmlLinkToJade(resource) : htmlScriptToJade(resource);\r\n      }\r\n\r\n      html.push(resource);\r\n\r\n      state.add++;\r\n    }\r\n\r\n    if (isJadeActive()) {\r\n      // always append Jade at the end, it's just easier that way...okay?\r\n      var indent = (code.match(/html.*\\n(\\s*)\\S?/i) || [,])[1];\r\n      code = code.trim() + '\\n' + indent + html.join('\\n' + indent).trim();\r\n    } else {\r\n      if (code.indexOf('<head') !== -1) {\r\n        var codeLines = code.split('\\n');\r\n        codeLines.splice(state.line, 0, html.join('\\n'));\r\n        code = codeLines.join('\\n');\r\n      } else { // add to the start of the doc\r\n        code = html.join('\\n') + code;\r\n      }\r\n    }\r\n\r\n    panels.named.html.setCode(code); // editors => panels.named\r\n    panels.named.html.editor.setCursor({ line: state.line + state.add, ch: state.character }); // editors => panels.named\r\n\r\n  }\r\n\r\n  function insertSnippet(snippet) {\r\n    var code = panels.named.html.getCode(), // editors => panels.named\r\n        state = { line: panels.named.html.editor.currentLine(),\r\n          character: panels.named.html.editor.getCursor().ch,\r\n          add: 0\r\n        };\r\n\r\n    if (code.indexOf('</head') !== -1) {\r\n      code = code.replace(/<\\/head>/i, snippet + '\\n</head>');\r\n    } else { // add to the start of the doc\r\n      code = snippet + '\\n' + code;\r\n    }\r\n\r\n    panels.named.html.setCode(code); // editors => panels.named\r\n    panels.named.html.editor.setCursor({ line: state.line + state.add, ch: state.character }); // editors => panels.named\r\n  }\r\n\r\n  function createHTMLToJadeTagConverter(tagName, attribute, suffix){\r\n    var regExToGrabResource = new RegExp(attribute+'=(\\'|\").+.'+suffix+'\\\\1');\r\n    return function(html){\r\n      var resource = html.match(regExToGrabResource);\r\n      return tagName+'('+resource[0]+')';\r\n    };\r\n  }\r\n\r\n  var htmlScriptToJade = createHTMLToJadeTagConverter('script', 'src', 'js');\r\n  // Dirty, but good enough for now, parse the link and add commas between attributes;\r\n  var htmlLinkToJade = (function(){\r\n    var parseLink = createHTMLToJadeTagConverter('link', 'href', 'css');\r\n    return function(html){\r\n      var jadeLink = parseLink(html);\r\n      return jadeLink.split('\" ').join('\",');\r\n    };\r\n  }());\r\n\r\n  function isJadeActive(){\r\n    return jsbin.state.processors.html === 'jade';\r\n  }\r\n\r\n  function isCssFile(url) {\r\n    return (url.length - (url.lastIndexOf('.css') + 4) === 0);\r\n  }\r\n\r\n  \r\n});\ndefine('skylark-jsbin-coder/editors/tern',[\r\n  \"skylark-jquery\",\r\n  \"../jsbin\",\r\n  \"../coder\",\r\n  \"./codemirror\"\r\n],function ($,jsbin,coder,CodeMirror) {\r\n  'use strict';\r\n  /*globals $, jsbin, CodeMirror, template, ternDefinitions, ternBasicDefs */\r\n\r\n  if (true || jsbin.embed || jsbin.mobile) {\r\n    return;\r\n  }\r\n\r\n  var ternServer;\r\n  var ternLoaded = {};\r\n\r\n  var initTern = function(editor, defs){\r\n    var keyMap = {\r\n      'Ctrl-Q': function(cm) { ternServer.selectName(cm); },\r\n      'Ctrl-I': function(cm) { ternServer.showType(cm); },\r\n      'Ctrl-Space': function(cm) { ternServer.complete(cm); }\r\n    };\r\n    if (typeof defs === 'undefined') {\r\n      defs = [];\r\n    }\r\n    ternServer = new CodeMirror.TernServer({\r\n      defs: defs,\r\n      useWorker: false,\r\n      cm: editor\r\n    });\r\n    editor.addKeyMap(keyMap);\r\n    editor.on('cursorActivity', function(cm) { ternServer.updateArgHints(cm); });\r\n  };\r\n\r\n  var addTernDefinition = function(def) {\r\n    if (typeof ternServer === 'object') {\r\n      ternServer.options.defs.push(def);\r\n      ternServer = new CodeMirror.TernServer({\r\n        defs: ternServer.options.defs,\r\n        useWorker: ternServer.options.useWorker,\r\n        tooltipType: ternServer.options.tooltipType,\r\n        cm: ternServer.options.cm\r\n      });\r\n    }\r\n  };\r\n\r\n  // Load the json defition of the library\r\n  var loadTernDefinition = function(name, file) {\r\n    if (!ternLoaded[name]) {\r\n      $.ajax({\r\n        url: file,\r\n        dataType: 'json',\r\n        success: function(data) {\r\n          addTernDefinition(data);\r\n          ternLoaded[name] = true;\r\n        }\r\n      });\r\n    }\r\n  };\r\n\r\n  // Load the actual js library\r\n  var loadTernFile = function(name, file) {\r\n    if (!ternLoaded[name]) {\r\n      $.ajax({\r\n        url: file,\r\n        dataType: 'script',\r\n        success: function(data) {\r\n          ternServer.server.addFile(name, data);\r\n          ternLoaded[name] = true;\r\n        }\r\n      });\r\n    }\r\n  };\r\n\r\n  var loadTern = function(editor) {\r\n    initTern(editor, ternBasicDefs);\r\n    ternLoaded.ecma5 = true;\r\n    ternLoaded.browser = true;\r\n  };\r\n\r\n  var searchTernDefinition = function(htmlCode) {\r\n    for (var i = 0; i < ternDefinitions.length; i++) {\r\n      if (ternDefinitions[i].match.test(htmlCode)) {\r\n        if (ternDefinitions[i].type === 'def') {\r\n          loadTernDefinition(ternDefinitions[i].name, ternDefinitions[i].file);\r\n        } else {\r\n          loadTernFile(ternDefinitions[i].name, ternDefinitions[i].file);\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  // Overwrite the autocomplete function to use tern\r\n  CodeMirror.commands.autocomplete = function(cm) {\r\n    if (CodeMirror.snippets(cm) === CodeMirror.Pass) {\r\n      var pos = cm.getCursor();\r\n      var tok = cm.getTokenAt(pos);\r\n      var indent = '';\r\n      if (cm.options.indentWithTabs) {\r\n        indent = '\\t';\r\n      } else {\r\n        indent = new Array(cm.options.indentUnit * 1 + 1).join(' ');\r\n      }\r\n\r\n      // I don't like this - feel like we shouldnt be pseudo parsing the code around the cursor. - FO\r\n      // the && here is in the correct place, if the token type is null, but the token string is '.'\r\n      // then we're probably at the end of an object lookup so let's use tern for autocomplete\r\n      if (tok.string === ';' || tok.type === 'string' || tok.type === null && tok.string !== '.') {\r\n        return cm.replaceRange(indent, pos);\r\n      }\r\n      if (tok.string.trim() !== '') {\r\n        return ternServer.complete(cm);\r\n      }\r\n      return cm.replaceRange(indent, pos);\r\n    }\r\n  };\r\n\r\n  CodeMirror.startTern = function() {\r\n    loadTern(jsbin.panels.panels.javascript.editor);\r\n    searchTernDefinition(jsbin.panels.panels.html.getCode());\r\n\r\n    $('#library').bind('change', function () {\r\n      searchTernDefinition(jsbin.panels.panels.html.getCode());\r\n    });\r\n  };\r\n\r\n  return coder.editors.tern = {\r\n    startTern\r\n  };\r\n});\r\n\ndefine('skylark-jsbin-coder/editors/addons',[\r\n  \"skylark-jquery\",\r\n   \"../jsbin\",\r\n   \"../coder\",\r\n   \"./tern\"\r\n],function ($,jsbin,coder) {\r\n  'use strict';\r\n  /*globals $, jsbin, CodeMirror*/\r\n\r\n  // ignore addons for embedded views\r\n  if (jsbin.embed || jsbin.mobile) {\r\n    return;\r\n  }\r\n\r\n  var processors = jsbin.state.processors;\r\n\r\n  var defaults = {\r\n    closebrackets: true,\r\n    highlight: false,\r\n    vim: false,\r\n    emacs: false,\r\n    trailingspace: false,\r\n    fold: false,\r\n    sublime: false,\r\n    tern: false,\r\n    activeline: true,\r\n    matchbrackets: false\r\n  };\r\n\r\n  if (!jsbin.settings.addons) {\r\n    jsbin.settings.addons = defaults;\r\n  }\r\n\r\n  var detailsSupport = 'open' in document.createElement('details');\r\n\r\n  var settingsHints = {};\r\n  var settingsHintShow = {};\r\n  var hintShow = {\r\n    console: true,\r\n    line: false,\r\n    under: false,\r\n    gutter: false\r\n  };\r\n  // css must go last for the moment due to CSSLint creating the\r\n  // global variable 'exports'\r\n  ['js', 'html', 'coffeescript', 'css'].forEach(function (val) {\r\n    var h = val + 'hint';\r\n    var d = false;\r\n    if (val === 'js') {\r\n      d = true;\r\n    }\r\n    settingsHints[h] = (jsbin.settings[h] !== undefined) ? jsbin.settings[h] : d;\r\n  });\r\n\r\n  settingsHintShow = $.extend({}, hintShow, jsbin.settings.hintShow);\r\n  settingsHintShow.tooltip = settingsHintShow.gutter;\r\n  var settingsAddons = $.extend({}, jsbin.settings.addons, settingsHints);\r\n\r\n  var addons = {\r\n    closebrackets: {\r\n      url: '/js/vendor/codemirror5/addon/edit/closebrackets.js',\r\n      test: defaultTest('autoCloseBrackets'),\r\n      done: function (cm) {\r\n        setOption(cm, 'autoCloseBrackets', true);\r\n      }\r\n    },\r\n    highlight: {\r\n      url: '/js/vendor/codemirror5/addon/search/match-highlighter.js',\r\n      test: defaultTest('highlightSelectionMatches'),\r\n      done: function (cm) {\r\n        setOption(cm, 'highlightSelectionMatches', true);\r\n      }\r\n    },\r\n    vim: {\r\n      url: [\r\n        '/js/vendor/codemirror5/keymap/vim.js'\r\n      ],\r\n      test: defaultTest('vimMode'),\r\n      done: function (cm) {\r\n        setOption(cm, 'vimMode', true);\r\n        setOption(cm, 'showCursorWhenSelecting', true);\r\n      }\r\n    },\r\n    emacs: {\r\n      url: [\r\n        '/js/vendor/codemirror5/keymap/emacs.js'\r\n      ],\r\n      test: function () {\r\n        return CodeMirror.keyMap.emacs;\r\n      },\r\n      done: function (cm) {\r\n        setOption(cm, 'keyMap', 'emacs');\r\n      }\r\n    },\r\n    matchtags: {\r\n      url: [\r\n        '/js/vendor/codemirror5/addon/fold/xml-fold.js',\r\n        '/js/vendor/codemirror5/addon/edit/matchtags.js'\r\n      ],\r\n      test: function () {\r\n        return CodeMirror.scanForClosingTag &&\r\n               CodeMirror.optionHandlers.matchTags;\r\n      },\r\n      done: function (cm) {\r\n        setOption(cm, 'matchTags', { bothTags: true });\r\n        cm.addKeyMap({'Ctrl-J': 'toMatchingTag' });\r\n      }\r\n    },\r\n    trailingspace: {\r\n      url: '/js/vendor/codemirror5/addon/edit/trailingspace.js',\r\n      test: defaultTest('showTrailingSpace'),\r\n      done: function (cm) {\r\n        setOption(cm, 'showTrailingSpace', true);\r\n      }\r\n    },\r\n    fold: {\r\n      url: [\r\n        '/js/vendor/codemirror5/addon/fold/foldgutter.css',\r\n        '/js/vendor/codemirror5/addon/fold/foldcode.js',\r\n        '/js/vendor/codemirror5/addon/fold/foldgutter.js',\r\n        '/js/vendor/codemirror5/addon/fold/brace-fold.js',\r\n        '/js/vendor/codemirror5/addon/fold/xml-fold.js',\r\n        '/js/vendor/codemirror5/addon/fold/comment-fold.js'\r\n      ],\r\n      test: function () {\r\n        return CodeMirror.helpers.fold &&\r\n               CodeMirror.optionHandlers.foldGutter &&\r\n               CodeMirror.optionHandlers.gutters;\r\n      },\r\n      done: function (cm) {\r\n        $body.addClass('code-fold');\r\n        cm.addKeyMap({'Ctrl-Q': function (cm) {\r\n          cm.foldCode(cm.getCursor());\r\n        }});\r\n        setOption(cm, 'foldGutter', true);\r\n        var gutters = cm.getOption('gutters');\r\n        var copyGutters = gutters.slice();\r\n        copyGutters.push('CodeMirror-foldgutter');\r\n        setOption(cm, 'gutters', copyGutters);\r\n      }\r\n    },\r\n    sublime: {\r\n      url: [\r\n        '/js/vendor/codemirror5/keymap/sublime.js'\r\n      ],\r\n      test: function () {\r\n        return CodeMirror.keyMap.sublime;\r\n      },\r\n      done: function (cm) {\r\n        setOption(cm, 'keyMap', 'sublime');\r\n        // Keys that CodeMirror should never take over\r\n        var cmd = $.browser.platform === 'mac' ? 'Cmd' : 'Ctrl';\r\n        delete CodeMirror.keyMap['sublime'][cmd + '-L'];\r\n        delete CodeMirror.keyMap['sublime'][cmd + '-T'];\r\n        delete CodeMirror.keyMap['sublime'][cmd + '-W'];\r\n        delete CodeMirror.keyMap['sublime'][cmd + '-J'];\r\n        delete CodeMirror.keyMap['sublime'][cmd + '-R'];\r\n        delete CodeMirror.keyMap['sublime'][cmd + '-Enter'];\r\n        delete CodeMirror.keyMap['sublime'][cmd + '-Up'];\r\n        delete CodeMirror.keyMap['sublime'][cmd + '-Down'];\r\n        CodeMirror.keyMap['sublime']['Shift-Tab'] = 'indentAuto';\r\n        cm.removeKeyMap('noEmmet');\r\n      }\r\n    },\r\n    tern: {\r\n      url: [\r\n        '/js/vendor/codemirror5/addon/hint/show-hint.css',\r\n        '/js/vendor/codemirror5/addon/tern/tern.css',\r\n        '/js/vendor/codemirror5/addon/hint/show-hint.js',\r\n        '/js/prod/addon-tern-' + jsbin.version + '.min.js'\r\n      ],\r\n      test: function () {\r\n        return (typeof window.ternBasicDefs !== 'undefined') &&\r\n               CodeMirror.showHint &&\r\n               CodeMirror.TernServer &&\r\n               CodeMirror.startTern;\r\n      },\r\n      done: function () {\r\n        CodeMirror.startTern();\r\n      }\r\n    },\r\n    activeline: {\r\n      url: [\r\n        '/js/vendor/codemirror5/addon/selection/active-line.js'\r\n      ],\r\n      test: function() {\r\n        return (typeof CodeMirror.defaults.styleActiveLine !== 'undefined');\r\n      },\r\n      done: function(cm) {\r\n        setOption(cm, 'styleActiveLine', true);\r\n      }\r\n    },\r\n    matchbrackets: {\r\n      url: [],\r\n      test: function() {\r\n        return (typeof CodeMirror.defaults.matchBrackets !== 'undefined');\r\n      },\r\n      done: function(cm) {\r\n        setOption(cm, 'matchBrackets', true);\r\n      }\r\n    },\r\n    csshint: {\r\n      url: [\r\n        '/js/vendor/csslint/csslint.min.js',\r\n        '/js/vendor/cm_addons/lint/css-lint.js'\r\n      ],\r\n      test: function() {\r\n        return hintingTest('css') &&\r\n               (typeof CSSLint !== 'undefined');\r\n      },\r\n      done: function(cm) {\r\n        if (cm.getOption('mode') !== 'css') {\r\n          return;\r\n        }\r\n\r\n        if (processors.css !== undefined && processors.css !== 'css') {\r\n          return;\r\n        }\r\n        hintingDone(cm);\r\n      }\r\n    },\r\n    jshint: {\r\n      url: [\r\n        // because jshint uses new style set/get - so we sniff for IE8 or lower\r\n        // since it's the only one that doesn't have it\r\n        $.browser.msie && $.browser.version < 9 ?\r\n        '/js/vendor/jshint/jshint.old.min.js' :\r\n        '/js/vendor/jshint/jshint.min.js',\r\n      ],\r\n      test: function() {\r\n        return hintingTest('javascript') &&\r\n               (typeof JSHINT !== 'undefined');\r\n      },\r\n      done: function(cm) {\r\n        if (cm.getOption('mode') !== 'javascript') {\r\n          return;\r\n        }\r\n\r\n        if (processors.javascript !== undefined && processors.javascript !== 'javascript') {\r\n          return;\r\n        }\r\n\r\n        hintingDone(cm, {\r\n          'eqnull': true\r\n        });\r\n      }\r\n    },\r\n    htmlhint: {\r\n      url: [\r\n        '/js/vendor/htmlhint/htmlhint.js',\r\n        '/js/vendor/cm_addons/lint/html-lint.js'\r\n      ],\r\n      test: function() {\r\n        return hintingTest('htmlmixed') &&\r\n               (typeof HTMLHint !== 'undefined');\r\n      },\r\n      done: function(cm) {\r\n        if (cm.getOption('mode') !== 'htmlmixed') {\r\n          return;\r\n        }\r\n\r\n        if (processors.html !== undefined && processors.html !== 'html') {\r\n          return;\r\n        }\r\n\r\n        hintingDone(cm);\r\n      }\r\n    },\r\n    coffeescripthint: {\r\n      url: [\r\n        '/js/vendor/coffeelint/coffeelint.min.js',\r\n        '/js/vendor/cm_addons/lint/coffeescript-lint.js'\r\n      ],\r\n      test: function() {\r\n        return hintingTest('coffeescript') &&\r\n               (typeof coffeelint !== 'undefined');\r\n      },\r\n      done: function(cm) {\r\n        if (cm.getOption('mode') !== 'coffeescript' || jsbin.state.processors.javascript !== 'coffeescript') {\r\n          return;\r\n        }\r\n        hintingDone(cm);\r\n      }\r\n    }\r\n  };\r\n\r\n  // begin loading user addons\r\n\r\n\r\n  var $body = $('body');\r\n\r\n  function load(url) {\r\n    if (url.indexOf('http') !== 0) {\r\n      url = jsbin.static + url;\r\n    }\r\n\r\n    if (url.slice(-3) === '.js') {\r\n      return $.ajax({\r\n        url: url + '?' + jsbin.version, // manual cache busting\r\n        dataType: 'script',\r\n        cache: true\r\n      });\r\n    } else if (url.slice(-4) === '.css') {\r\n      var d = $.Deferred();\r\n      setTimeout(function () {\r\n        $body.append('<link rel=\"stylesheet\" href=\"' + url + '?' + jsbin.version + '\">');\r\n        d.resolve();\r\n      }, 0);\r\n      return d;\r\n    }\r\n  }\r\n\r\n  function ready(test) {\r\n    var d = $.Deferred();\r\n    var timer = null;\r\n\r\n    if (test()) {\r\n      d.resolve();\r\n    } else {\r\n      var start = new Date().getTime();\r\n      var last = new Date();\r\n      timer = setInterval(function () {\r\n        last = new Date();\r\n        if (test()) {\r\n          clearInterval(timer);\r\n          d.resolve();\r\n        } else if (last.getTime() - start > 10 * 1000) {\r\n          clearInterval(timer);\r\n          d.reject();\r\n        }\r\n      }, 100);\r\n    }\r\n\r\n    return d;\r\n  }\r\n\r\n  function setOption(cm, option, value) {\r\n    cm.setOption(option, value);\r\n  }\r\n\r\n  function defaultTest(prop) {\r\n    return function () {\r\n      return (typeof CodeMirror.optionHandlers[prop] !== 'undefined');\r\n    };\r\n  }\r\n\r\n  function hintingTest(mode) {\r\n    return (typeof CodeMirror.defaults.lint !== 'undefined') &&\r\n           CodeMirror.helpers.lint &&\r\n           CodeMirror.helpers.lint[mode] &&\r\n           CodeMirror.optionHandlers.lint;\r\n  }\r\n\r\n  window.hintingDone = function(cm, defhintOptions) {\r\n    var mode = cm.getOption('mode');\r\n    if (mode === 'javascript') {\r\n      mode = 'js';\r\n    }\r\n    if (mode === 'htmlmixed') {\r\n      mode = 'html';\r\n    }\r\n    var opt = $.extend({}, settingsHintShow);\r\n    opt.consoleParent = cm.getWrapperElement().parentNode.parentNode;\r\n    setOption(cm, 'lintOpt', opt);\r\n    if (opt.gutter) {\r\n      var gutters = cm.getOption('gutters');\r\n      if (gutters.indexOf('CodeMirror-lint-markers') === -1) {\r\n        var copyGutters = gutters.slice();\r\n        copyGutters.push('CodeMirror-lint-markers');\r\n        setOption(cm, 'gutters', copyGutters);\r\n      }\r\n      var ln = cm.getOption('lineNumbers');\r\n      setOption(cm, 'lineNumbers', !ln);\r\n      setOption(cm, 'lineNumbers', ln);\r\n    }\r\n\r\n    setOption(cm, 'lint', { delay: 800, options: $.extend({}, defhintOptions, jsbin.settings[mode + 'hintOptions']) });\r\n\r\n    if (opt.console && cm.consolelint) {\r\n      $document.trigger('sizeeditors');\r\n      $(cm.consolelint.head).on('click', function() {\r\n        if (!detailsSupport) {\r\n          $(this).nextAll().toggle();\r\n        }\r\n        // trigger a resize after the click has completed and the details is close\r\n        setTimeout(function () {\r\n          $document.trigger('sizeeditors');\r\n        }, 10);\r\n      });\r\n    }\r\n  }\r\n\r\n  var options = Object.keys(settingsAddons);\r\n\r\n  function loadAddon(key) {\r\n    var addon = addons[key];\r\n    if (addon && settingsAddons[key]) {\r\n      if (typeof addon.url === 'string') {\r\n        addon.url = [addon.url];\r\n      }\r\n\r\n      // dirty jQuery way of doing .done on an array of promises\r\n      $.when.call($, addon.url.map(load)).done(function () {\r\n        if (addon.done) {\r\n          ready(addon.test).then(function () {\r\n            jsbin.panels.allEditors(function (panel) {\r\n              if (panel.editor) {\r\n                addon.done(panel.editor);\r\n              }\r\n            });\r\n          });\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  options.forEach(loadAddon);\r\n\r\n  // External method to realod all the addons\r\n  window.reloadAddons = function(arr) {\r\n    if (arr) {\r\n      arr.forEach(loadAddon);\r\n    } else {\r\n      options.forEach(loadAddon);\r\n    }\r\n  };\r\n\r\n  // External method to realod the selected addon\r\n  // may be useful in the future\r\n  // window.reloadSelectedAddon = function(addon) {\r\n  //   if (options.indexOf(addon) !== -1) {\r\n  //     loadAddon(addon);\r\n  //   }\r\n  // };\r\n\r\n});\r\n\ndefine('skylark-jsbin-coder/updateTitle',[\r\n  \"skylark-jquery\",\r\n   \"./jsbin\"\r\n],function ($,jsbin) {\r\n  function updateTitle(source) {\r\n    'use strict';\r\n    /*globals jsbin, documentTitle, $*/\r\n    if (source === undefined) {\r\n      source = jsbin.panels.panels.html.getCode();\r\n    }\r\n    // read the element out of the source code and plug it in to our document.title\r\n    var newDocTitle = source.match(updateTitle.re);\r\n    if (newDocTitle !== null && newDocTitle[1] !== documentTitle) {\r\n      updateTitle.lastState = jsbin.state.latest;\r\n      documentTitle = $('<div>').html(newDocTitle[1].trim()).text(); // jshint ignore:line\r\n      if (documentTitle) {\r\n        document.title = documentTitle + ' - ' + 'JS Bin';\r\n\r\n        // add the snapshot if not the latest\r\n      } else {\r\n        document.title = 'JS Bin';\r\n      }\r\n\r\n\r\n      if (!jsbin.state.latest && jsbin.state.revision) {\r\n        document.title = '(#' + jsbin.state.revision + ') ' + document.title;\r\n      }\r\n    }\r\n\r\n    // there's an edge case here if newDocTitle === null, it won't update to show\r\n    // the snapshot, but frankly, it's an edge case that people won't notice.\r\n\r\n  }\r\n\r\n  updateTitle.re = /<title>(.*)<\\/title>/i;\r\n  updateTitle.lastState = null;\r\n\r\n  return jsbin.codepan.updateTitle = updateTitle;\r\n});\ndefine('skylark-jsbin-coder/editors/snapshot',[\r\n  \"skylark-jquery\",\r\n   \"../jsbin\",\r\n   \"../updateTitle\"\r\n],function ($,jsbin,updateTitle) {\r\n  function watchForSnapshots() {\r\n    /*globals $document, jsbin, updateTitle, saveChecksum*/\r\n    'use strict';\r\n\r\n    $(document).on('saved', function () {\r\n      localStorage.latest = jsbin.state.code + '/' + jsbin.state.revision;\r\n    });\r\n\r\n    window.addEventListener('storage', function (event) {\r\n      if (event.key === 'latest') {\r\n        var parts = localStorage.latest.split('/');\r\n        if (parts[0] === jsbin.state.code) {\r\n          jsbin.state.latest = false;\r\n          saveChecksum = false; // jshint ignore:line\r\n          jsbin.state.checksum = false;\r\n          updateTitle();\r\n          window.history.replaceState(null, null, jsbin.getURL() + '/edit');\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n\r\n  return coder.editors.snapshot = {\r\n    watchForSnapshots\r\n  };\r\n});\ndefine('skylark-jsbin-coder/editors/beautify',[\r\n  \"skylark-jquery\",\r\n   \"../jsbin\",\r\n   \"../coder\"\r\n],function ($,jsbin,coder) {\r\n  'use strict';\r\n  /*globals $, jsbin, objectValue */\r\n\r\n  var settings = jsbin.settings || {};\r\n  var customKeys = settings.keys || {};\r\n\r\n  if (jsbin.embed || customKeys.disabled) {\r\n    return;\r\n  }\r\n\r\n  function beautify() {\r\n\r\n    var focusedPanel = jsbin.panels.focused;\r\n    var beautifyUrls = {\r\n      html: jsbin['static'] + '/js/vendor/beautify/beautify-html.js',\r\n      css: jsbin['static'] + '/js/vendor/beautify/beautify-css.js',\r\n      js: jsbin['static'] + '/js/vendor/beautify/beautify.js'\r\n    };\r\n\r\n    if (jsbin.state.processors[focusedPanel.id] === 'html') {\r\n      if (!window.html_beautify) {\r\n        lazyLoadAndRun(beautifyUrls.html, beautifyHTML);\r\n      } else {\r\n        beautifyHTML();\r\n      }\r\n    } else if (jsbin.state.processors[focusedPanel.id] === 'css') {\r\n      if (!window.css_beautify) {\r\n        lazyLoadAndRun(beautifyUrls.css, beautifyCSS);\r\n      } else {\r\n        beautifyCSS();\r\n      }\r\n    } else if (jsbin.state.processors[focusedPanel.id] === 'javascript') {\r\n      if (!window.js_beautify) {\r\n        lazyLoadAndRun(beautifyUrls.js, beautifyJS);\r\n      } else {\r\n        beautifyJS();\r\n      }\r\n    }\r\n\r\n  }\r\n\r\n  function lazyLoadAndRun(url, callback) {\r\n    $.getScript(url).done(callback);\r\n  }\r\n\r\n  function beautifyHTML() {\r\n    runBeautifier(jsbin.panels.focused, window.html_beautify);\r\n  }\r\n\r\n  function beautifyCSS() {\r\n    runBeautifier(jsbin.panels.focused, window.css_beautify);\r\n  }\r\n\r\n  function beautifyJS() {\r\n    runBeautifier(jsbin.panels.focused, window.js_beautify);\r\n  }\r\n\r\n  function runBeautifier(panel, beautifier) {\r\n    panel.editor.setCode(beautifier(panel.editor.getCode(), {\r\n      indent_size: settings.editor ? settings.editor.indentUnit || 2 : 2\r\n    }));\r\n  }\r\n\r\n  var ctrlKey = $.browser.platform === 'mac' ? 'metaKey' : 'ctrlKey'\r\n\r\n  $(document).on('keydown', function beautifyKeyBinding(e) {\r\n    if (e[ctrlKey] && e.shiftKey && e.which == 76) {\r\n      // ctrl/command + shift + L\r\n      beautify();\r\n    }\r\n  });\r\n\r\n  return coder.editors.beautify =  beautify;\r\n\r\n});\r\n\ndefine('skylark-jsbin-coder/main',[\r\n\t\"./coder\",\r\n    \"./editors/mobileCodeMirror\",\r\n    \"./editors/mobile-command-maps\",\r\n    \"./editors/mobile-keyboard\",\r\n    \"./editors/keycontrol\",\r\n    \"./editors/panel\",\r\n    \"./editors/panels\",\r\n    \"./editors/libraries\",\r\n    \"./editors/library\",\r\n    \"./editors/addons\",\r\n    \"./editors/snapshot\",\r\n    \"./editors/beautify\"\r\n\r\n],function(coder){\r\n\treturn coder;\r\n});\ndefine('skylark-jsbin-coder', ['skylark-jsbin-coder/main'], function (main) { return main; });\n\n"]}